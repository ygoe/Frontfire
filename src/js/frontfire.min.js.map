{"version":3,"sources":["compatibility.js","jquery-extras.js","plugin.js","util.js","jquery-ui.js","modules/accordion.js","modules/carousel.js","modules/color.js","modules/dom.js","modules/draggable.js","modules/dropdown.js","modules/input.js","modules/menu.js","modules/message.js","dimmer.js","modules/modal.js","modules/offcanvas.js","modules/resizable.js","modules/slider.js","modules/sortable.js","modules/tabs.js","modules/autostart.js"],"names":["String","prototype","includes","search","start","length","this","indexOf","startsWith","pos","substr","endsWith","this_len","undefined","substring","padEnd","targetLength","padString","repeat","slice","padStart","count","TypeError","str","RangeError","Infinity","Math","floor","rpt","i","trunc","x","log10","log","LOG10E","$","fn","each$","each","index","element","call","isSet","value","isBoolean","isNumber","isString","isEven","isOdd","isAndroid","navigator","userAgent","match","isIos","platform","isLinux","isMac","isWindows","addClass","registerPlugin","name","create","obj","Object","defineProperty","get","ret","key","isFunction","bind","initOptions","defaults","elem","converters","params","opts","extend","optValue","data","Function","err","console","error","elemDataValue","loadOptions","minmax","min","max","round","decimals","precision","pow","forceReflow","body","css","offset","installDisabledchangeHook","hooks","id","_get","_set","ffId","prevHook","a","b","c","result","set","installHook","propHooks","disabled","trigger","bindInputButtonsDisabled","input","buttons","handler","disable","forEach","button","enable","on","preventScrolling","state","$document","document","$html","scrollTop","scrollLeft","off","expr","focusable","hasTabindex","attr","nodeName","toLowerCase","mapName","map","parentNode","href","img","is","test","focusableIfVisible","fieldset","closest","accordionClass","accordionDefaults","exclusive","options","accordion","hasClass","children","item","header","first","content","last","click","clientHeight","collapse","expand","keydown","event","which","preventDefault","location","hash","animate","top","indexOrItem","items","isNumeric","eq","scrollHeight","removeClass","Event","history","replaceState","title","pathname","opt","onTransitionEnd","originalEvent","propertyName","passedExpandedItem","height","carouselClass","carouselIndicatorClass","carouselDefaults","active","dotsEach","gutter","indicator","autoPlay","autoPlayInterval","pauseOnHover","dragCursor","animation","loop","carousel","find","stage","_gutterWidth","_gutterOffset","_itemWidthPercent","_layout","layout","autoPlayTimeout","itemOffset","startItemOffset","prevItemOffset","dragDirection","itemOffsetMin","itemOffsetMax","itemWidth","maxItemHeight","currentTransition","outerHeight","detach","appendTo","indicatorCount","ceil","_loop","dot","activeItem","suspendAutoplay","resumeAutoplay","draggable","axis","dx","abs","dragPoint","left","newPoint","width","lastPageFirstItem","_isDragging","removeTransition","elastic","exceeding","elemRect","addTransition","newDot","autoplaySuspendLevel","mouseenter","mouseleave","setTimeout","next","clearTimeout","clearPending","opacityTime","allSame","z1","z2","z2Opacity","parseFloat","anyZero","firstGtZero","push","anyPositive","firstZero","fullyVisible","partiallyVisible","sign","_z","_z2","_z2Opacity","currentVisible","percent","opacity","Color","format","trim","r","keep255","Number","g","keep1","context","getContext","fillStyle","fillRect","getImageData","_typeof","window","Color_prototype","processColor","color","hslMode","updateHSL","updateRGB","extendFF","toString","toIntARGB","toHTML","toCSS","conv","number","h","s","l","q","p","t","that","blendWith","other","ratio","includeAlpha","isHSL","invert","complement","lighten","factor","darken","gray","isDark","text","rect","outerWidth","right","bottom","visible","show","hide","prop","removeAttr","parents","toggleDisabled","firstChild","add","firstElementChild","actualCursor","cursor","fontExists","font","probes","refFonts","container","probe","k","j","remove","pointer","type","capture","mouse","touch","mouseHandler","touchHandler","touchType","types","split","eventRemovers","eventRemover","_eventRemovers","_that","addEventListener","removeEventListener","event2","pointerId","pointerType","changedTouches","pageX","pageY","identifier","handleTouchEvent","draggableClass","resetAllCursorsClass","draggableDefaults","handle","cancel","containment","stack","dragClass","grid","scroll","$elem","dragging","draggingCancelled","minDragDistance","htmlCursor","stopImmediatePropagation","onMove","onEnd","cont","viewportWidth","viewportHeight","sqrt","isDefaultPrevented","setCapture","stackedElems","topElem","el","zIndex","parseInt","dragElem","sort","maxZIndex","apply","toArray","o","stackElements","documentElement","style","getPropertyValue","setProperty","gridBase","parent","contRect","stepX","stepY","_event","wasDragging","releaseCapture","revert","dropdownContainerClass","dropdownDefaults","placement","autoClose","target","dropdown","autoPlacement","optPlacement","dropdownWidth","dropdownHeight","targetRect","direction","close","inputWrapperClass","repeatButtonClass","styleCheckboxClass","treeStateClass","textareaWrapperClass","timeout","ms","wrapper","replaceWith","decButton","val","stepBase","step","repeatButton","incButton","lastColor","keyCode","focus","pickButton","colorBox","setColor","buttonRow","colors","baseColor_","baseColor","newButton","activeButton","prev","currentColor","toggleClass","toInput","wrap","after","cb","checked","readOnly","indeterminate","minRows","maxRows","extraRows","textarea","shadowContent","outerHeightOffset","lineHeight","updateShadow","replace","copyStyle","menu","isVertical","has","submenu","ddOpt","one","messageCloseButtonClass","message","closeButton","closableMessage","backgroundDimmerClass","dimmingClass","dimmedClass","dimBackground","noinput","backgroundLayer","undimBackground","$body","modalEventNamespace","modalClass","modalCloseButtonClass","modalDefaults","cancellable","closeTooltip","modal","blur","filter","offCanvasEventNamespace","offCanvasClass","offCanvasDefaults","edge","offCanvas","_opposite","html","_htmlStyle","transition","overflowX","resizableClass","resizableDefaults","aspectRatio","handles","minWidth","minHeight","maxWidth","maxHeight","handleElements","isFinite","optHandles","vCursor","hCursor","nwCursor","neCursor","handleAddClass","addHandle","vertical","negative","vertical2","negative2","append","resize","side","extent","extentLower","delta","newElemOffset","newLength","minLength","maxLength","resizable","rangeClass","ticksClass","handleClass","resetAllCursorsClass$1","sliderDefaults","orientation","values","rangeBase","largeStep","smallStep","largeTicks","smallTicks","largeTickLabels","smallTickLabels","tickPlacement","handleCount","handleInteractionMode","rangeOverflowEqual","ranges","logarithmic","slider","draggedHandleCursor","sliderBorder","initialTabindex","dragHandleOffset","dragHandlePointerId","lastTouchedHandleIndex","_setValue","setValue","rangeItem","className","ticks","$handles","_index","rangeBaseValue","startAttr","endAttr","handleLength","rangeBasePos","innerHeight","innerWidth","_index2","resetDragHandleOffset","large","tickArr","inArray","warn","isFirstDrag","pointerValue","getValueFromEvent","minValueDistance","valueIndex","valueDistance","shiftKey","otherIndex","_otherIndex","isLastDrag","myDragHandleOffset","pointerPosIntoSlider","sliderLength","sliderRect","getPosFromValue","rangeIndex","startHandleIndex","endHandleIndex","end","startPos","endPos","overflowEqual","setRange","pos0","pos1","moveHandle","multivalue","sortableClass","sortablePlaceholderClass","sortableDefaults","_prepareChild","prepareChild","contents","nodeType","flowStart","flowEnd","crossStart","crossEnd","placeholder","initialChildAfterElement","placeholderAfterElement","betweenChildren","child","updateChildren","rowMin","rowMax","currentPos","rowElements","addRow","rowCenter","p1","createPoint","p2","center","position","childStartCenter","childEndCenter","newPlaceholderAfterElementStart","newPlaceholderAfterElementEnd","newPlaceholderAfterElement","minStartDistance","minEndDistance","startDistance","distToSegment","endDistance","eventCancelled","_event2","insertAfter","insertBefore","flow","cross","dist2","v","w","l2","distToSegmentSquared","addChild","sortable","tabHeadersClass","tabPagesClass","pageDivs","activePage","headers","pages","page","tabs","activeTab","indexOrPage","frontfire","prefix","spinner","colorPicker","styleCheckbox","threeState","autoHeight"],"mappings":"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","sourcesContent":["﻿// Bring older browsers to a usable level\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/includes#Polyfill\r\nif (!String.prototype.includes) {\r\n\tString.prototype.includes = function (search, start) {\r\n\t\tif (typeof start !== \"number\") start = 0;\r\n\t\tif (start + search.length > this.length) return false;\r\n\t\treturn this.indexOf(search, start) !== -1;\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith#Polyfill\r\nif (!String.prototype.startsWith) {\r\n\tString.prototype.startsWith = function (search, pos) {\r\n\t\treturn this.substr(!pos || pos < 0 ? 0 : +pos, search.length) === search;\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith#Polyfill\r\nif (!String.prototype.endsWith) {\r\n\tString.prototype.endsWith = function (search, this_len) {\r\n\t\tif (this_len === undefined || this_len > this.length) this_len = this.length;\r\n\t\treturn this.substring(this_len - search.length, this_len) === search;\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/padEnd#Polyfill\r\nif (!String.prototype.padEnd) {\r\n\tString.prototype.padEnd = function padEnd(targetLength, padString) {\r\n\t\ttargetLength = targetLength >> 0; //floor if number or convert non-number to 0;\r\n\t\tpadString = String(padString || ' ');\r\n\t\tif (this.length > targetLength) return String(this);\r\n\t\ttargetLength = targetLength - this.length;\r\n\t\tif (targetLength > padString.length)\r\n\t\t\tpadString += padString.repeat(targetLength / padString.length); //append to original to ensure we are longer than needed\r\n\t\treturn String(this) + padString.slice(0, targetLength);\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/padStart#Polyfill\r\nif (!String.prototype.padStart) {\r\n\tString.prototype.padStart = function padStart(targetLength, padString) {\r\n\t\ttargetLength = targetLength >> 0; //floor if number or convert non-number to 0;\r\n\t\tpadString = String(padString || ' ');\r\n\t\tif (this.length > targetLength) return String(this);\r\n\t\ttargetLength = targetLength - this.length;\r\n\t\tif (targetLength > padString.length)\r\n\t\t\tpadString += padString.repeat(targetLength / padString.length); //append to original to ensure we are longer than needed\r\n\t\treturn padString.slice(0, targetLength) + String(this);\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/repeat#Polyfill\r\nif (!String.prototype.repeat) {\r\n\tString.prototype.repeat = function(count) {\r\n\t\t'use strict';\r\n\t\tif (this == null) {\r\n\t\t\tthrow new TypeError('can\\'t convert ' + this + ' to object');\r\n\t\t}\r\n\t\tvar str = '' + this;\r\n\t\tcount = +count;\r\n\t\tif (count != count) {\r\n\t\t\tcount = 0;\r\n\t\t}\r\n\t\tif (count < 0) {\r\n\t\t\tthrow new RangeError('repeat count must be non-negative');\r\n\t\t}\r\n\t\tif (count == Infinity) {\r\n\t\t\tthrow new RangeError('repeat count must be less than infinity');\r\n\t\t}\r\n\t\tcount = Math.floor(count);\r\n\t\tif (str.length == 0 || count == 0) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\t\t// Ensuring count is a 31-bit integer allows us to heavily optimize the\r\n\t\t// main part. But anyway, most current (August 2014) browsers can't handle\r\n\t\t// strings 1 << 28 chars or longer, so:\r\n\t\tif (str.length * count >= 1 << 28) {\r\n\t\t\tthrow new RangeError('repeat count must not overflow maximum string size');\r\n\t\t}\r\n\t\tvar rpt = '';\r\n\t\tfor (var i = 0; i < count; i++) {\r\n\t\t\trpt += str;\r\n\t\t}\r\n\t\treturn rpt;\r\n\t}\r\n}\r\n\r\n// Source: https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/Math/trunc#Polyfill\r\nMath.trunc = Math.trunc || (x => x - x % 1);\r\n\r\n// Source: https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/Math/log10#Polyfill\r\nMath.log10 = Math.log10 || (x => Math.log(x) * Math.LOG10E);\r\n","// Define some more helper functions as jQuery plugins. Similar functions already exist in\r\n// jQuery and these complement the set.\r\n\r\n// A variant of $.each that uses $(this) as the called function's context instead of this.\r\n$.fn.each$ = function (fn) {\r\n\treturn this.each(function (index, element) {\r\n\t\treturn fn.call($(this), index, element);\r\n\t});\r\n};\r\n\r\n// Determines whether the value is set (i. e. not undefined or null).\r\n$.isSet = value => typeof value !== \"undefined\" && value !== null;\r\n\r\n// Determines whether the value is boolean.\r\n$.isBoolean = value => typeof value === \"boolean\";\r\n\r\n// Determines whether the value is a number.\r\n$.isNumber = value => typeof value === \"number\";\r\n\r\n// Determines whether the value is a string.\r\n$.isString = value => typeof value === \"string\";\r\n\r\n// Determines whether the value is an even number.\r\n$.isEven = value => $.isNumber(value) && value % 2 === 0;\r\n\r\n// Determines whether the value is an odd number.\r\n$.isOdd = value => $.isNumber(value) && value % 2 === 1;\r\n\r\n// Determines whether the client operating system is Android.\r\n$.isAndroid = () => !!navigator.userAgent.match(/Android/);\r\n\r\n// Determines whether the client operating system is iOS.\r\n$.isIos = () => !!navigator.platform.match(/iPhone|iPad|iPod/);\r\n\r\n// Determines whether the client operating system is Linux (not Android).\r\n$.isLinux = () => !!navigator.platform.match(/Linux/) && !$.isAndroid();\r\n\r\n// Determines whether the client operating system is macOS.\r\n$.isMac = () => !!navigator.platform.match(/Mac/);\r\n\r\n// Determines whether the client operating system is Windows.\r\n$.isWindows = () => !!navigator.platform.match(/Win/);\r\n\r\nif ($.isAndroid()) {\r\n\t$(\"html\").addClass(\"simple-dimmer\");\r\n}\r\n","// Registers a jQuery plugin.\r\n// name: The name of the plugin.\r\n// create: The plugin create function.\r\n// obj: An object containing additional operation functions.\r\nexport { registerPlugin };\r\nfunction registerPlugin(name, create, obj) {\r\n\t// Define a new property for each jQuery object in which the plugin is accessible.\r\n\t// This property getter is called whenever the plugin or one of its additional functions is called.\r\n\tObject.defineProperty($.fn, name, {\r\n\t\tget: function () {\r\n\t\t\t// Plugin default function\r\n\t\t\t// Returned to make this property callable\r\n\t\t\tvar ret = create;\r\n\r\n\t\t\t// Plugin additional functions, added to the returned function\r\n\t\t\t// Bound to whoever has called this property to pass on \"this\" to the next function\r\n\t\t\tfor (let key in obj) {\r\n\t\t\t\tif ($.isFunction(obj[key])) {\r\n\t\t\t\t\tret[key] = obj[key].bind(this);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Determines the options to use for a plugin.\r\n// name: The plugin name.\r\n// defaults: The plugin's default options. Only properties defined in here are considered for data attributes.\r\n// elem: The element to find data attributes in. Options are stored here, too.\r\n// converters: An object that specifies a conversion function for each special data attribute.\r\n// params: The options specified to the plugin function.\r\nexport { initOptions };\r\nfunction initOptions(name, defaults, elem, converters, params) {\r\n\tparams = params || {};\r\n\r\n\t// Start with the defaults\r\n\tvar opts = $.extend({}, defaults);\r\n\r\n\t// Look for a combined HTML data-opt attribute containing a JSON object\r\n\tvar optValue = $(elem).data(\"opt\");\r\n\tif (optValue !== undefined) {\r\n\t\ttry {\r\n\t\t\toptValue = (new Function(\"return \" + optValue + \";\"))();\r\n\t\t\topts = $.extend(opts, optValue);\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tconsole.error(\"ERROR: data-opt value for \" + name + \" cannot be parsed:\", optValue, err);\r\n\t\t}\r\n\t}\r\n\r\n\t// Then overwrite with individual HTML data attributes\r\n\tfor (let key in defaults) {\r\n\t\t// Only do the work if it's not overridden again by params\r\n\t\tif (params[key] === undefined) {\r\n\t\t\tlet elemDataValue = $(elem).data(\"opt-\" + key);\r\n\t\t\tif (elemDataValue !== undefined) {\r\n\t\t\t\tif ($.isFunction(converters[key])) {\r\n\t\t\t\t\topts[key] = converters[key](elemDataValue);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\topts[key] = elemDataValue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Finally overwrite with params\r\n\t$.extend(opts, params);\r\n\r\n\t// Keep options in DOM element's data\r\n\t$(elem).data(\"ff-\" + name + \"-options\", opts);\r\n\r\n\treturn opts;\r\n}\r\n\r\n// Loads plugin options for additional plugin functions.\r\n// name: The plugin name.\r\n// elem: The element to find data attributes in. Options are stored here, too.\r\nexport { loadOptions };\r\nfunction loadOptions(name, elem) {\r\n\treturn $(elem).data(\"ff-\" + name + \"-options\") || {};\r\n}\r\n","// Returns the value in the range between min and max.\r\nexport function minmax(value, min, max) {\r\n\treturn Math.max(min, Math.min(value, max));\r\n}\r\n\r\n// Returns the value rounded to the specified number of decimals.\r\nexport function round(value, decimals) {\r\n\tif (decimals === undefined) decimals = 0;\r\n\tvar precision = Math.pow(10, decimals);\r\n\treturn Math.round(value * precision) / precision;\r\n}\r\n\r\n// Forces a browser layout reflow. This can be used to start CSS transitions on new elements.\r\nexport function forceReflow() {\r\n\t// Try two different methods\r\n\tvar body = $(\"body\");\r\n\tbody.css(\"display\");\r\n\tbody.offset();\r\n}\r\n\r\n// Installs a jQuery hook if it isn't installed yet. Existing hooks are chained to the new hook.\r\n// hooks: The hooks collection, like $.attrHooks or $.propHooks\r\n// name: The name of the hooked entry\r\n// id: The internal ID with which an already installed hook can be recognised\r\n// get: The get function (optional)\r\n// set: The set function (optional)\r\nfunction installHook(hooks, name, id, get, set) {\r\n\t// Explanation: https://blog.rodneyrehm.de/archives/11-jQuery-Hooks.html\r\n\tvar hookInstalled = name in hooks &&\r\n\t\t\"ffId\" in hooks[name] &&\r\n\t\thooks[name].ffId === id;\r\n\tif (!hookInstalled) {\r\n\t\tvar prevHook = hooks[name];\r\n\t\thooks[name] = {\r\n\t\t\tffId: id,\r\n\t\t\tget: function (a, b, c) {\r\n\t\t\t\tif (get) {\r\n\t\t\t\t\tvar result = get(a, b, c);\r\n\t\t\t\t\tif (result !== null)\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t\tif (prevHook && prevHook.get)\r\n\t\t\t\t\treturn prevHook.get(a, b, c);\r\n\t\t\t\treturn null;\r\n\t\t\t},\r\n\t\t\tset: function (a, b, c) {\r\n\t\t\t\tif (set) {\r\n\t\t\t\t\tvar result = set(a, b, c);\r\n\t\t\t\t\tif (result !== undefined)\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t\tif (prevHook && prevHook.set)\r\n\t\t\t\t\treturn prevHook.set(a, b, c);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\n// Installs a hook that triggers the \"disabledchange\" event for input elements.\r\nexport function installDisabledchangeHook() {\r\n\tinstallHook(\r\n\t\t$.propHooks, \"disabled\", \"disabledchange\",\r\n\t\tundefined,\r\n\t\tfunction (elem, value, name) {\r\n\t\t\tif (elem.disabled !== value) {\r\n\t\t\t\telem.disabled = value;   // Set before triggering change event\r\n\t\t\t\t$(elem).trigger(\"disabledchange\");\r\n\t\t\t}\r\n\t\t});\r\n}\r\n\r\n// Binds the disabled state of the input element to the associated buttons.\r\nexport function bindInputButtonsDisabled(input, buttons) {\r\n\t// When the input element was disabled or enabled, also update other elements\r\n\tinstallDisabledchangeHook();\r\n\tvar handler = function () {\r\n\t\tif (input.disabled()) {\r\n\t\t\tinput.disable();   // Disable everything related as well (label etc.)\r\n\t\t\tbuttons.forEach(button => button.disable());\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinput.enable();   // Enable everything related as well (label etc.)\r\n\t\t\tbuttons.forEach(button => button.enable());\r\n\t\t}\r\n\t};\r\n\tinput.on(\"disabledchange\", handler);\r\n\r\n\t// Setup disabled state initially.\r\n\t// Also enable elements. If they were disabled and the page is reloaded, their state\r\n\t// may be restored halfway. This setup brings everything in the same state.\r\n\thandler();\r\n}\r\n\r\n// Scrolls the window so that the rectangle is fully visible.\r\nexport function scrollIntoView(rect) {\r\n\tvar cont = $(window);\r\n\tvar viewportWidth = cont.width() - 1;\r\n\tvar viewportHeight = cont.height() - 1;\r\n\tvar scrollTop = cont.scrollTop();\r\n\tvar scrollLeft = cont.scrollLeft();\r\n\r\n\tif (rect.top < scrollTop) {\r\n\t\tcont.scrollTop(rect.top);\r\n\t}\r\n\tif (rect.bottom > scrollTop + viewportHeight) {\r\n\t\tcont.scrollTop(scrollTop + (rect.bottom - (scrollTop + viewportHeight)));\r\n\t}\r\n\tif (rect.left < scrollLeft) {\r\n\t\tcont.scrollLeft(rect.left);\r\n\t}\r\n\tif (rect.right > scrollLeft + viewportWidth) {\r\n\t\tcont.scrollLeft(scrollLeft + (rect.right - (scrollLeft + viewportWidth)));\r\n\t}\r\n}\r\n\r\n// Prevents scrolling the document.\r\n// state: Enable or disable the scrolling prevention.\r\nexport function preventScrolling(state) {\r\n\tvar $document = $(document), $html = $(\"html\");\r\n\tif (state || state === undefined) {\r\n\t\tvar scrollTop = $document.scrollTop();\r\n\t\tvar scrollLeft = $document.scrollLeft();\r\n\t\t$document.on(\"scroll.ff-prevent-scrolling\", function () {\r\n\t\t\t$document.scrollTop(scrollTop);\r\n\t\t\t$document.scrollLeft(scrollLeft);\r\n\t\t});\r\n\t\t$html.css(\"touch-action\", \"none\");\r\n\t}\r\n\telse {\r\n\t\t$document.off(\"scroll.ff-prevent-scrolling\");\r\n\t\t$html.css(\"touch-action\", \"\");\r\n\t}\r\n}\r\n\r\n// Stacks the selected elements and moved one element to the top.\r\nexport function stackElements(stackedElems, topElem) {\r\n\t// Find all selected stackable elements and sort them by:\r\n\t//   currently dragging, then z-index, then DOM index\r\n\t// and assign their new z-index\r\n\tstackedElems = stackedElems\r\n\t\t.map(function (index, el) {\r\n\t\t\tvar zIndex = parseInt($(el).css(\"z-index\"));\r\n\t\t\tif (!$.isNumeric(zIndex))\r\n\t\t\t\tzIndex = stackedElems.length;\r\n\t\t\treturn { elem: el, dragElem: el === topElem ? 1 : 0, index: index, zIndex: zIndex };\r\n\t\t})\r\n\t\t.sort(function (a, b) {\r\n\t\t\tif (a.dragElem !== b.dragElem) return a.dragElem - b.dragElem;\r\n\t\t\tif (a.zIndex !== b.zIndex) return a.zIndex - b.zIndex;\r\n\t\t\treturn a.index - b.index;\r\n\t\t});\r\n\tif (stackedElems.length !== 0) {\r\n\t\tvar maxZIndex = Math.max.apply(Math, stackedElems.toArray().map(o => o.zIndex));\r\n\t\tstackedElems.each(function (index) {\r\n\t\t\t$(this.elem).css(\"z-index\", maxZIndex - (stackedElems.length - 1) + index);\r\n\t\t});\r\n\t}\r\n}\r\n","/*! jQuery UI - v1.12.1 - 2017-12-25\r\n* http://jqueryui.com\r\n* Includes: focusable.js\r\n* Copyright jQuery Foundation and other contributors; Licensed MIT */\r\n\r\n// NOTE: This file was modified to not include unnecessary jQuery UI stuff.\r\n// IE8 support removed, which was introduced in\r\n// * https://bugs.jqueryui.com/ticket/14596\r\n// * https://github.com/jquery/jquery-ui/commit/d3025968f349c37a8ca41bfc63ee1b37d9d7354f\r\n\r\n/*\r\n * jQuery UI Focusable 1.12.1\r\n * http://jqueryui.com\r\n *\r\n * Copyright jQuery Foundation and other contributors\r\n * Released under the MIT license.\r\n * http://jquery.org/license\r\n */\r\n\r\n//>>label: :focusable Selector\r\n//>>group: Core\r\n//>>description: Selects elements which can be focused.\r\n//>>docs: http://api.jqueryui.com/focusable-selector/\r\n\r\n\r\n\r\n// Selectors\r\nvar focusable = function( element, hasTabindex ) {\r\n\tvar map, mapName, img, focusableIfVisible, fieldset,\r\n\t\tnodeName = element.nodeName.toLowerCase();\r\n\r\n\tif ( \"area\" === nodeName ) {\r\n\t\tmap = element.parentNode;\r\n\t\tmapName = map.name;\r\n\t\tif ( !element.href || !mapName || map.nodeName.toLowerCase() !== \"map\" ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\timg = $( \"img[usemap='#\" + mapName + \"']\" );\r\n\t\treturn img.length > 0 && img.is( \":visible\" );\r\n\t}\r\n\r\n\tif ( /^(input|select|textarea|button|object)$/.test( nodeName ) ) {\r\n\t\tfocusableIfVisible = !element.disabled;\r\n\r\n\t\tif ( focusableIfVisible ) {\r\n\r\n\t\t\t// Form controls within a disabled fieldset are disabled.\r\n\t\t\t// However, controls within the fieldset's legend do not get disabled.\r\n\t\t\t// Since controls generally aren't placed inside legends, we skip\r\n\t\t\t// this portion of the check.\r\n\t\t\tfieldset = $( element ).closest( \"fieldset\" )[ 0 ];\r\n\t\t\tif ( fieldset ) {\r\n\t\t\t\tfocusableIfVisible = !fieldset.disabled;\r\n\t\t\t}\r\n\t\t}\r\n\t} else if ( \"a\" === nodeName ) {\r\n\t\tfocusableIfVisible = element.href || hasTabindex;\r\n\t} else {\r\n\t\tfocusableIfVisible = hasTabindex;\r\n\t}\r\n\r\n\treturn focusableIfVisible && $( element ).is( \":visible\" ) && $( element ).css( \"visibility\" ) === \"visible\";\r\n};\r\n\r\n$.extend( $.expr[ \":\" ], {\r\n\tfocusable: function( element ) {\r\n\t\treturn focusable( element, $.attr( element, \"tabindex\" ) !== undefined );\r\n\t}\r\n} );\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow } from \"../util\";\r\n\r\nvar accordionClass = \"ff-accordion\";\r\n\r\n// Defines default options for the accordion plugin.\r\nvar accordionDefaults = {\r\n\t// Exclusive mode allows only one item to be expanded at a time. Default: false.\r\n\texclusive: false\r\n};\r\n\r\n// Converts all div elements in each selected element into accordion pages.\r\nfunction accordion(options) {\r\n\treturn this.each(function () {\r\n\t\tvar accordion = $(this);\r\n\t\tif (accordion.hasClass(accordionClass)) return;   // Already done\r\n\t\tvar opt = initOptions(\"accordion\", accordionDefaults, accordion, {}, options);\r\n\r\n\t\taccordion.addClass(accordionClass);\r\n\t\tvar items = $(this).children(\"div\");\r\n\t\titems.each$(function () {\r\n\t\t\tvar item = this;\r\n\t\t\tvar header = item.children(\"div\").first();\r\n\t\t\tvar content = item.children(\"div\").last();\r\n\r\n\t\t\theader.css(\"transition\", \"none\");\r\n\t\t\theader.addClass(\"ff-accordion-header\");\r\n\t\t\tforceReflow();\r\n\t\t\theader.css(\"transition\", \"\");\r\n\t\t\theader.attr(\"tabindex\", \"0\");\r\n\r\n\t\t\tcontent.addClass(\"ff-accordion-content\");\r\n\t\t\t\r\n\t\t\theader.click(function () {\r\n\t\t\t\tif (content[0].clientHeight) {\r\n\t\t\t\t\taccordion.accordion.collapse(item);\r\n\t\t\t\t} else {\r\n\t\t\t\t\taccordion.accordion.expand(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\theader.keydown(function (event) {\r\n\t\t\t\tif (event.which === 13) {   // Enter\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.click();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tvar id = item.attr(\"id\");\r\n\t\t\tif (id !== undefined && location.hash === \"#\" + id) {\r\n\t\t\t\t// Manually set item expanded\r\n\t\t\t\titem.addClass(\"expanded\");\r\n\t\t\t\tcontent.css(\"height\", \"auto\");\r\n\t\t\t\t$(function() {\r\n\t\t\t\t\t$(\"html,body\").animate({ scrollTop: item.offset().top });\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcontent.css(\"transition\", \"none\");\r\n\t\t\t\taccordion.accordion.collapse(item);\r\n\t\t\t\tforceReflow();\r\n\t\t\t\tcontent.css(\"transition\", \"\");\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction collapse(indexOrItem) {\r\n\treturn this.each(function () {\r\n\t\tvar accordion = $(this);\r\n\t\tvar opt = loadOptions(\"accordion\", accordion);\r\n\r\n\t\tvar items = accordion.children(\"div\");\r\n\t\tif (indexOrItem === undefined) {\r\n\t\t\t// Collapse all items\r\n\t\t\titems.each(function () {\r\n\t\t\t\taccordion.accordion.collapse(this);\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar item;\r\n\t\tif ($.isNumeric(indexOrItem)) {\r\n\t\t\titem = items.eq(+indexOrItem);\r\n\t\t}\r\n\t\telse {\r\n\t\t\titem = $(indexOrItem);\r\n\t\t}\r\n\r\n\t\tvar content = item.children(\"div.ff-accordion-content\").first();\r\n\t\tif (!content.hasClass(\"ff-fixed-height\")) {\r\n\t\t\tcontent.css(\"height\", content[0].scrollHeight);   // explicitly set to current value\r\n\t\t\tforceReflow();\r\n\t\t\tcontent.css(\"height\", 0);   // now animate to 0\r\n\t\t\tcontent.addClass(\"ff-fixed-height\");\r\n\t\t\titem.removeClass(\"expanded\");\r\n\r\n\t\t\tlet event = $.Event(\"itemCollapse\");\r\n\t\t\tevent.item = item;\r\n\t\t\taccordion.trigger(event);\r\n\t\t}\r\n\r\n\t\tvar id = item.attr(\"id\");\r\n\t\tif (id !== undefined && location.hash === \"#\" + id) {\r\n\t\t\thistory.replaceState(null, document.title, location.pathname + location.search);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction expand(indexOrItem) {\r\n\treturn this.each(function () {\r\n\t\tvar accordion = $(this);\r\n\t\tvar opt = loadOptions(\"accordion\", accordion);\r\n\r\n\t\tvar items = accordion.children(\"div\");\r\n\t\tif (indexOrItem === undefined && !opt.exclusive) {\r\n\t\t\t// Expand all items\r\n\t\t\titems.each(function () {\r\n\t\t\t\taccordion.accordion.expand(this);\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar item;\r\n\t\tif ($.isNumeric(indexOrItem)) {\r\n\t\t\titem = items.eq(+indexOrItem);\r\n\t\t}\r\n\t\telse {\r\n\t\t\titem = $(indexOrItem);\r\n\t\t}\r\n\r\n\t\tvar content = item.children(\"div.ff-accordion-content\").first();\r\n\t\tcontent.css(\"height\", content[0].scrollHeight);   // animate to desired height\r\n\t\tfunction onTransitionEnd(event) {\r\n\t\t\tif (event.originalEvent.propertyName == \"height\") {\r\n\t\t\t\tcontent.css(\"height\", \"auto\");   // allow free layout again after animation has completed\r\n\t\t\t\tcontent.off(\"transitionend\", onTransitionEnd);\r\n\t\t\t\tcontent.removeClass(\"ff-fixed-height\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tcontent.on(\"transitionend\", onTransitionEnd);\r\n\t\titem.addClass(\"expanded\");\r\n\r\n\t\tlet event = $.Event(\"itemExpand\");\r\n\t\tevent.item = item;\r\n\t\taccordion.trigger(event);\r\n\r\n\t\tvar previousItemCollapsedHeight = 0;\r\n\t\tif (opt.exclusive) {\r\n\t\t\tlet passedExpandedItem = false;\r\n\t\t\titems.each(function () {\r\n\t\t\t\tif (this !== item[0]) {\r\n\t\t\t\t\tif (!passedExpandedItem)\r\n\t\t\t\t\t\tpreviousItemCollapsedHeight += $(this).children(\"div.ff-accordion-content\").height();\r\n\t\t\t\t\taccordion.accordion.collapse(this);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tpassedExpandedItem = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// If a previous item was collapsed, scroll so that the expanded header stays where it is on the screen\r\n\t\t//if (previousItemCollapsedHeight) {\r\n\t\t//\t$(\"html,body\").animate({ scrollTop: \"-=\" + previousItemCollapsedHeight }, 200);\r\n\t\t//}\r\n\t\t\r\n\t\t// TODO: At least keep the expanded header visible if a previous item was collapsed\r\n\r\n\t\t// TODO: Maybe also scroll to make the new content section visible as much as possible, while not pushing out its header (option)\r\n\r\n\t\tvar id = item.attr(\"id\");\r\n\t\tif (id !== undefined) {\r\n\t\t\thistory.replaceState(null, document.title, \"#\" + id);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"accordion\", accordion, {\r\n\tcollapse: collapse,\r\n\texpand: expand\r\n});\r\n$.fn.accordion.defaults = accordionDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar carouselClass = \"ff-carousel\";\r\nvar carouselIndicatorClass = \"ff-carousel-indicator\";\r\n\r\n// Defines default options for the carousel plugin.\r\nvar carouselDefaults = {\r\n\t// The index of the initially active item. Default: 0.\r\n\tactive: 0,\r\n\r\n\t// The number of items concurrently visible. Default: 1.\r\n\titems: 1,\r\n\r\n\t// Show an indicator dot each x items. Default: -1 means the same value as items.\r\n\tdotsEach: -1,\r\n\r\n\t// The margin between two items in pixels. Default: 0.\r\n\tgutter: 0,\r\n\r\n\t// Shows the indicator dots for the active item. Default: true.\r\n\tindicator: true,\r\n\r\n\t// Starts looping through all items automatically. Default: false.\r\n\tautoPlay: false,\r\n\r\n\t// Autoplay item switch interval in milliseconds. Default: 4000.\r\n\tautoPlayInterval: 4000,\r\n\r\n\t// Pauses autoplay while the carousel is hovered with the mouse. Default: true.\r\n\tpauseOnHover: true,\r\n\r\n\t// The mouse cursor to show during dragging. Default: None.\r\n\tdragCursor: undefined,\r\n\r\n\t// The animation between items. Default: slide-all.\r\n\t// Possible values: slide-all, slide-in, slide-out, fade, slide-fade\r\n\t// For more than one visible item, only slide-all is supported and automatically used.\r\n\tanimation: \"slide-all\",\r\n\r\n\t// Loops all items at the end instead of rewinding/restricting. Default: false.\r\n\t// TODO\r\n\tloop: false\r\n};\r\n\r\n// Converts each selected element into a carousel.\r\nfunction carousel(options) {\r\n\treturn this.each(function () {\r\n\t\tvar carousel = $(this);\r\n\t\tif (carousel.find(\".\" + carouselClass).length) return;   // Already done\r\n\t\tvar opt = initOptions(\"carousel\", carouselDefaults, carousel, {}, options);\r\n\r\n\t\tif (opt.items > 1 || opt.gutter > 0) opt.animation = \"slide-all\";\r\n\r\n\t\tvar stage = $(\"<div/>\").addClass(carouselClass);\r\n\r\n\t\topt._gutterWidth = (opt.items - 1) / opt.items * opt.gutter;\r\n\t\topt._gutterOffset = 1 / opt.items * opt.gutter;\r\n\t\topt._itemWidthPercent = 100 / opt.items;\r\n\t\topt._layout = layout;\r\n\r\n\t\tvar itemIndex = 0;\r\n\t\tvar maxItemHeight = 0;\r\n\t\tvar items = carousel.children();\r\n\t\tvar autoPlayTimeout;\r\n\t\tvar itemOffset, startItemOffset, prevItemOffset, dragDirection, itemOffsetMin, itemOffsetMax, itemWidth;\r\n\t\tvar currentTransition = \"\";\r\n\r\n\t\tif (opt.dotsEach === -1) opt.dotsEach = opt.items;\r\n\t\topt.dotsEach = minmax(opt.dotsEach, 0, opt.items);\r\n\r\n\t\t// Set up items positioning\r\n\t\titems.each$(function () {\r\n\t\t\tthis.css(\"width\", \"calc(\" + opt._itemWidthPercent + \"% - \" + opt._gutterWidth + \"px)\");\r\n\t\t\tmaxItemHeight = Math.max(maxItemHeight, this.outerHeight());\r\n\t\t\tthis.detach().appendTo(stage);\r\n\t\t\titemIndex++;\r\n\t\t});\r\n\t\tstage.appendTo(carousel);\r\n\t\tstage.css(\"height\", maxItemHeight);\r\n\r\n\t\t// Add controls\r\n\t\tif (opt.indicator) {\r\n\t\t\tvar indicator = $(\"<div/>\").addClass(carouselIndicatorClass).appendTo(carousel);\r\n\t\t\tvar indicatorCount = Math.ceil(items.length / opt.dotsEach) - (opt.items - opt.dotsEach);\r\n\t\t\tfor (let i = 0; i < indicatorCount; i++) {\r\n\t\t\t\tlet dot = $(\"<span tabindex='0'><span/></span>\").appendTo(indicator);\r\n\t\t\t\tlet fn = function () {\r\n\t\t\t\t\tcarousel.carousel.activeItem(i * opt.dotsEach);\r\n\t\t\t\t\tsuspendAutoplay();\r\n\t\t\t\t\tresumeAutoplay();\r\n\t\t\t\t};\r\n\t\t\t\tdot.click(fn);\r\n\t\t\t\tdot.keydown(function (event) {\r\n\t\t\t\t\tif (event.which === 13) {   // Enter\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\tfn();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcarousel.carousel.activeItem(opt.active);\r\n\r\n\t\tstage.draggable({\r\n\t\t\taxis: \"x\",\r\n\t\t\tdragCursor: opt.dragCursor\r\n\t\t});\r\n\t\tstage.on(\"draggablestart\", function (event) {\r\n\t\t\tvar dx = Math.abs(event.dragPoint.left - event.newPoint.left);\r\n\t\t\tvar dy = Math.abs(event.dragPoint.top - event.newPoint.top);\r\n\t\t\tif (dy > dx) {\r\n\t\t\t\t// Movement was mostly vertical, don't drag in that direction but leave scrolling intact\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\titemWidth = stage.width() / opt.items;\r\n\t\t\tprevItemOffset = startItemOffset = layout();\r\n\t\t\tvar lastPageFirstItem = Math.max(0, items.length - opt.items);\r\n\t\t\titemOffsetMin = -opt.active;\r\n\t\t\titemOffsetMax = lastPageFirstItem - opt.active;\r\n\t\t\topt._isDragging = true;\r\n\r\n\t\t\t// Disable transition and autoplay while dragging\r\n\t\t\tremoveTransition();\r\n\t\t\tsuspendAutoplay();\r\n\t\t});\r\n\t\tstage.on(\"draggablemove\", function (event) {\r\n\t\t\titemOffset = startItemOffset - (event.newPoint.left - event.elemRect.left) / itemWidth;\r\n\t\t\tdragDirection = itemOffset - prevItemOffset;\r\n\t\t\tprevItemOffset = itemOffset;\r\n\r\n\t\t\t// Don't move the stage anywhere! Just tell me how far the pointer is dragged and we'll\r\n\t\t\t// move something else (the items within the stage) to provide the expected visual feedback.\r\n\t\t\tevent.newPoint = event.elemRect;\r\n\r\n\t\t\t// Restrict dragging at start/end\r\n\t\t\tif (itemOffset < itemOffsetMin)\r\n\t\t\t\titemOffset = itemOffsetMin - elastic(itemOffsetMin - itemOffset);\r\n\t\t\tif (itemOffset > itemOffsetMax)\r\n\t\t\t\titemOffset = itemOffsetMax + elastic(itemOffset - itemOffsetMax);\r\n\r\n\t\t\tfunction elastic(exceeding) {\r\n\t\t\t\tvar max = 0.25;\r\n\t\t\t\t// This function has a slope of 1 for x = 0 and slowly approaches (but never reaches) max\r\n\t\t\t\treturn -max / (exceeding / max + 1) + max;\r\n\t\t\t}\r\n\r\n\t\t\tlayout(itemOffset);\r\n\t\t});\r\n\t\tstage.on(\"draggableend\", function (event) {\r\n\t\t\t// Restore transition and autoplay\r\n\t\t\taddTransition();\r\n\t\t\tresumeAutoplay();\r\n\t\t\topt._isDragging = false;\r\n\r\n\t\t\t// Snap to item, consider last drag direction\r\n\t\t\tvar itemIndex = opt.active + itemOffset;\r\n\t\t\tvar newDot = itemIndex / opt.dotsEach;\r\n\t\t\tif (dragDirection > 0)\r\n\t\t\t\tnewDot = Math.ceil(newDot);\r\n\t\t\telse\r\n\t\t\t\tnewDot = Math.floor(newDot);\r\n\t\t\tcarousel.carousel.activeItem(newDot * opt.dotsEach);\r\n\t\t});\r\n\r\n\t\t// Add transition after setting position of every item\r\n\t\tforceReflow();\r\n\t\taddTransition();\r\n\r\n\t\tvar autoplaySuspendLevel = 0;\r\n\t\tif (opt.autoPlay) {\r\n\t\t\tif (opt.pauseOnHover) {\r\n\t\t\t\tstage.mouseenter(suspendAutoplay);\r\n\t\t\t\tstage.mouseleave(resumeAutoplay);\r\n\t\t\t}\r\n\r\n\t\t\tautoPlayTimeout = setTimeout(next, opt.autoPlayInterval);\r\n\t\t}\r\n\r\n\t\tfunction suspendAutoplay() {\r\n\t\t\tautoPlayTimeout && clearTimeout(autoPlayTimeout);\r\n\t\t\tautoplaySuspendLevel++;\r\n\t\t}\r\n\r\n\t\tfunction resumeAutoplay(clearPending) {\r\n\t\t\tautoplaySuspendLevel--;\r\n\t\t\tif (opt.autoPlay && !autoplaySuspendLevel) {\r\n\t\t\t\tautoPlayTimeout = setTimeout(next, opt.autoPlayInterval * 2);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction next() {\r\n\t\t\tvar index = opt.active;\r\n\t\t\tindex += opt.dotsEach;\r\n\t\t\tif (index > items.length - opt.items) index = 0;\r\n\t\t\tcarousel.carousel.activeItem(index);\r\n\t\t\tautoPlayTimeout = setTimeout(next, opt.autoPlayInterval);\r\n\t\t}\r\n\r\n\t\tfunction removeTransition() {\r\n\t\t\tcurrentTransition = \"\";\r\n\t\t\titems.css(\"transition\", currentTransition);\r\n\t\t}\r\n\r\n\t\tfunction addTransition() {\r\n\t\t\tlet opacityTime = \"0.4s\";\r\n\t\t\tif (opt.animation === \"fade\")\r\n\t\t\t\topacityTime = \"0.8s\";\r\n\t\t\tcurrentTransition = \"left 0.4s ease-in-out, opacity \" + opacityTime + \" ease-in-out\";\r\n\t\t\titems.css(\"transition\", currentTransition);\r\n\t\t}\r\n\r\n\t\t// Modulo operation corrected for negative numbers.\r\n\t\tfunction mod(value, mod) {\r\n\t\t\twhile (value < 0) value += mod;\r\n\t\t\treturn value % mod;\r\n\t\t}\r\n\r\n\t\t// Item layouts for each animation type:\r\n\t\t// slide-all\r\n\t\t//   All items are positioned next to each other and moved simultaneously\r\n\t\t//   No z-index or opacity is used\r\n\t\t// slide-out\r\n\t\t//   There are two stacks next to each other\r\n\t\t//   The right stack is at left: 0 (visible in the stage), the left stack is directly next to it\r\n\t\t//   The active item and all following items are on the right (visible) stack, with z-index from front to back\r\n\t\t//   The previous items are on the left (invisible) stack\r\n\t\t//   Only one item can be moved to the other stack at a time\r\n\t\t// slide-in\r\n\t\t//   There are two stacks next to each other\r\n\t\t//   The left stack is at left: 0 (visible in the stage), the right stack is directly next to it\r\n\t\t//   The active item and all previous items are on the left (visible) stack, with z-index from back to front\r\n\t\t//   The following items are on the right (invisible) stack\r\n\t\t//   Only one item can be moved to the other stack at a time\r\n\t\t// fade\r\n\t\t//   All items are stacked above one another, at the same position (left: 0, in the stage)\r\n\t\t//   The visible item or the item that is becoming visible is on z-index 1, opacity is 1.\r\n\t\t//   The previously visible item or the item that is becoming invisible is on z-index 2, opacity is (becoming) 0, pointer-events is none.\r\n\t\t//   All other items are on z-index 0 with opacity 0.\r\n\t\t// slide-fade\r\n\t\t//   Based on slide-all but moving items by 1/10th of the stage width.\r\n\t\t//   The active/visible item has opacity 1, gradually changing to 0 for the adjacent and all other items.\r\n\r\n\t\t// Translates between an item offset and the current layout.\r\n\t\t// The getter is used to initialise the item offset when starting to drag during an ongoing transition.\r\n\t\t// The setter is used everywhere the items need to be laid out for a new active item or item offset.\r\n\t\tfunction layout(itemOffset) {\r\n\t\t\t// Getter\r\n\t\t\tif (itemOffset === undefined) {\r\n\t\t\t\tlet pos = [];\r\n\t\t\t\tlet allSame = true;\r\n\t\t\t\tswitch (opt.animation) {\r\n\t\t\t\t\tcase \"fade\":\r\n\t\t\t\t\t\tlet z1, z2, z2Opacity;\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tif (this.css(\"z-index\") == 1)\r\n\t\t\t\t\t\t\t\tz1 = index;\r\n\t\t\t\t\t\t\tif (this.css(\"z-index\") == 2) {\r\n\t\t\t\t\t\t\t\tz2 = index;\r\n\t\t\t\t\t\t\t\tz2Opacity = parseFloat(this.css(\"opacity\"));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t//console.log(\"get layout: z1=\" + z1 + \" z2=\" + z2 + \" z2Opacity=\" + z2Opacity + \" active=\" + opt.active);\r\n\t\t\t\t\t\tif (z2 !== undefined) {\r\n\t\t\t\t\t\t\tif (z1 > z2)   // Moving forward (a higher item index is in layer 1, becoming visible)\r\n\t\t\t\t\t\t\t\treturn z1 + (1 - z2Opacity) - opt.active - 1;\r\n\t\t\t\t\t\t\telse   // Moving backward\r\n\t\t\t\t\t\t\t\treturn z1 + z2Opacity - opt.active;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (z1 !== undefined) return z1 - opt.active;\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\tcase \"slide-in\":\r\n\t\t\t\t\t\tlet anyZero = false;\r\n\t\t\t\t\t\tlet firstGtZero = -1;\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tlet left = parseFloat(this.css(\"left\"));\r\n\t\t\t\t\t\t\tpos.push(left);\r\n\t\t\t\t\t\t\tif (left !== pos[0]) allSame = false;\r\n\t\t\t\t\t\t\tif (left === 0) anyZero = true;\r\n\t\t\t\t\t\t\tif (left > 0 && firstGtZero === -1) firstGtZero = index;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (allSame && pos[0] < 0) return items.length - 1 -pos[0] / itemWidth - opt.active;\r\n\t\t\t\t\t\tif (!anyZero) return -pos[0] / itemWidth - opt.active;\r\n\t\t\t\t\t\tif (firstGtZero > 0) return firstGtZero - pos[firstGtZero] / itemWidth - opt.active;\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\tcase \"slide-out\":\r\n\t\t\t\t\t\tlet anyPositive = false;\r\n\t\t\t\t\t\tlet firstZero = -1;\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tlet left = parseFloat(this.css(\"left\"));\r\n\t\t\t\t\t\t\tpos.push(left);\r\n\t\t\t\t\t\t\tif (left !== pos[0]) allSame = false;\r\n\t\t\t\t\t\t\tif (left >= 0) anyPositive = true;\r\n\t\t\t\t\t\t\tif (left === 0 && firstZero === -1) firstZero = index;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (allSame && pos[0] > 0) return -pos[0] / itemWidth - opt.active;\r\n\t\t\t\t\t\tif (!anyPositive) return items.length - 1 + -pos[pos.length - 1] / itemWidth - opt.active;\r\n\t\t\t\t\t\tif (firstZero > 0) return firstZero - 1 + -pos[firstZero - 1] / itemWidth - opt.active;\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\tcase \"slide-fade\":\r\n\t\t\t\t\t\tlet activeItemLeft2 = parseFloat(items.eq(opt.active).css(\"left\"));\r\n\t\t\t\t\t\treturn -activeItemLeft2 / (itemWidth / 10);\r\n\t\t\t\t\tcase \"slide-all\":\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tlet activeItemLeft = parseFloat(items.eq(opt.active).css(\"left\"));\r\n\t\t\t\t\t\treturn -activeItemLeft / itemWidth;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Setter\r\n\t\t\tswitch (opt.animation) {\r\n\t\t\t\tcase \"fade\":\r\n\t\t\t\t\tif (itemOffset !== 0) {\r\n\t\t\t\t\t\tlet fullyVisible = opt.active + Math.trunc(itemOffset);\r\n\t\t\t\t\t\tlet partiallyVisible = opt.active + Math.trunc(itemOffset) + Math.sign(itemOffset);\r\n\t\t\t\t\t\t//console.log(fullyVisible, partiallyVisible);\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tif (index === fullyVisible) {\r\n\t\t\t\t\t\t\t\tthis.css(\"z-index\", 1).css(\"opacity\", 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (index === partiallyVisible) {\r\n\t\t\t\t\t\t\t\tthis.css(\"z-index\", 2).css(\"opacity\", Math.abs(itemOffset) - Math.trunc(Math.abs(itemOffset)));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthis.css(\"z-index\", 0).css(\"opacity\", 0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlet z1, z2, z2Opacity;\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tif (this.css(\"z-index\") == 1)\r\n\t\t\t\t\t\t\t\tz1 = index;\r\n\t\t\t\t\t\t\tif (this.css(\"z-index\") == 2) {\r\n\t\t\t\t\t\t\t\tz2 = index;\r\n\t\t\t\t\t\t\t\tz2Opacity = parseFloat(this.css(\"opacity\"));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t//console.log(\"set layout: z1=\" + z1 + \" z2=\" + z2 + \" z2Opacity=\" + z2Opacity + \" active=\" + opt.active);\r\n\t\t\t\t\t\tif (opt.active === z1) {\r\n\t\t\t\t\t\t\titems.eq(z2).css(\"opacity\", 0).css(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (opt.active === z2) {\r\n\t\t\t\t\t\t\tremoveTransition();\r\n\t\t\t\t\t\t\titems.eq(z1).css(\"z-index\", 2).css(\"opacity\", 1 - z2Opacity);\r\n\t\t\t\t\t\t\titems.eq(z2).css(\"z-index\", 1).css(\"opacity\", 1).css(\"pointer-events\", \"\");\r\n\t\t\t\t\t\t\tforceReflow();\r\n\t\t\t\t\t\t\tif (!opt._isDragging) addTransition();\r\n\t\t\t\t\t\t\titems.eq(z1).css(\"opacity\", 0).css(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tlet currentVisible;\r\n\t\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\t\tif (this.css(\"z-index\") == 1)\r\n\t\t\t\t\t\t\t\t\tcurrentVisible = index;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tremoveTransition();\r\n\t\t\t\t\t\t\titems.eq(opt.active).css(\"z-index\", 1).css(\"opacity\", 1).css(\"pointer-events\", \"\");\r\n\t\t\t\t\t\t\tforceReflow();\r\n\t\t\t\t\t\t\tif (!opt._isDragging) addTransition();\r\n\t\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\t\tif (index === opt.active) {\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse if (index === currentVisible) {\r\n\t\t\t\t\t\t\t\t\tthis.css(\"z-index\", 2).css(\"opacity\", 0).css(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tthis.css(\"z-index\", 0).css(\"opacity\", 0).css(\"pointer-events\", \"\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet status = \"\";\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tstatus += index + \": z=\" + this.css(\"z-index\") + \" op=\" + this.css(\"opacity\") + (index === opt.active ? \" active\" : \"\") + \"\\n\";\r\n\t\t\t\t\t});\r\n\t\t\t\t\t//console.log(status);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"slide-in\":\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tlet left = opt.active + itemOffset <= items.length - 1 ?\r\n\t\t\t\t\t\t\tminmax((index - opt.active - itemOffset) * 100, 0, 100) :\r\n\t\t\t\t\t\t\t(items.length - 1 - opt.active - itemOffset) * 100;\r\n\t\t\t\t\t\tthis.css(\"left\", left + \"%\");\r\n\t\t\t\t\t\tthis.css(\"z-index\", index);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"slide-out\":\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tlet left = opt.active + itemOffset >= 0 ?\r\n\t\t\t\t\t\t\tminmax((index - opt.active - itemOffset) * 100, -100, 0) :\r\n\t\t\t\t\t\t\t(-opt.active - itemOffset) * 100;\r\n\t\t\t\t\t\tthis.css(\"left\", left + \"%\");\r\n\t\t\t\t\t\tthis.css(\"z-index\", items.length - 1 - index);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"slide-fade\":\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tlet percent = (index - opt.active) * 100 / 10;\r\n\t\t\t\t\t\tlet left = (index - opt.active) * opt._gutterOffset - itemOffset * stage.width() / 10;\r\n\t\t\t\t\t\tthis.css(\"left\", \"calc(\" + percent + \"% + \" + left + \"px)\");\r\n\t\t\t\t\t\tlet opacity = 1 - minmax(Math.abs(index - (opt.active + itemOffset)), 0, 1);\r\n\t\t\t\t\t\tthis.css(\"opacity\", opacity);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"slide-all\":\r\n\t\t\t\tdefault:\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tlet percent = (index - opt.active) * opt._itemWidthPercent;\r\n\t\t\t\t\t\tlet left = (index - opt.active) * opt._gutterOffset - itemOffset * stage.width() / opt.items;\r\n\t\t\t\t\t\tthis.css(\"left\", \"calc(\" + percent + \"% + \" + left + \"px)\");\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Gets the active item in a carousel.\r\n// indexOrItem: Sets the active item in each selected carousel, either by index or the element.\r\nfunction activeItem(indexOrItem) {\r\n\t// Getter\r\n\tif (indexOrItem === undefined) {\r\n\t\tvar carousel = this.first();\r\n\t\tif (carousel.length === 0) return;   // Nothing to do\r\n\t\tvar opt = loadOptions(\"carousel\", carousel);\r\n\t\treturn opt.active;\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar carousel = $(this);\r\n\t\tvar opt = loadOptions(\"carousel\", carousel);\r\n\t\tif (opt._isDragging) return;   // Ignore request while dragging\r\n\t\tvar items = carousel.find(\".\" + carouselClass).children();\r\n\t\tif (indexOrItem === Infinity) indexOrItem = items.length;   // Infinity can't be handled by Math.min\r\n\t\tvar index;\r\n\t\tif ($.isNumeric(indexOrItem)) {\r\n\t\t\tindex = +indexOrItem;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tindex = indexOrItem.index();\r\n\t\t}\r\n\r\n\t\tindex = minmax(index, 0, items.length - opt.items);\r\n\t\topt.active = index;\r\n\t\topt._layout(0);\r\n\t\tvar dots = carousel.find(\".\" + carouselIndicatorClass).children();\r\n\t\tdots.removeClass(\"active\").eq(Math.ceil(index / opt.dotsEach)).addClass(\"active\");\r\n\t\tcarousel.trigger(\"activeItemChange\");\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"carousel\", carousel, {\r\n\tactiveItem: activeItem\r\n});\r\n$.fn.carousel.defaults = carouselDefaults;\r\n","﻿import { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\n// This file uses its own scope to keep its helper functions private and make it reusable independently.\r\n// There are a few places where jQuery is used but they can easily be replaced with DOM calls if necessary.\r\n(function (undefined) {\r\n\t\"use strict\";\r\n\r\n\t// Parses any color value understood by a browser into an object with r, g, b, a properties.\r\n\tfunction Color(value) {\r\n\t\t// Allow calling without \"new\" keyword\r\n\t\tif (!(this instanceof Color))\r\n\t\t\treturn new Color(value);\r\n\r\n\t\tif (typeof value === \"string\") {\r\n\t\t\tthis.format = value.match(/^rgba?\\(/) ? \"CSS\" : \"HTML\";\r\n\r\n\t\t\t// Add \"#\" prefix if missing and the data is otherwise looking good (3/6/8 hex digits)\r\n\t\t\tif (value.match(/^\\s*[0-9A-Fa-f]{3}([0-9A-Fa-f]{3}([0-9A-Fa-f]{2})?)?\\s*$/)) value = \"#\" + value.trim();\r\n\r\n\t\t\t// Let the browser do the work\r\n\t\t\tvar color = $(\"<div/>\").css(\"color\", value).css(\"color\");\r\n\t\t\tvar match = color.match(/rgba?\\(\\s*([0-9.]+)\\s*,\\s*([0-9.]+)\\s*,\\s*([0-9.]+)\\s*(?:,\\s*([0-9.]+)\\s*)?\\)/);\r\n\t\t\tif (match) {\r\n\t\t\t\tthis.r = keep255(Number(match[1]));\r\n\t\t\t\tthis.g = keep255(Number(match[2]));\r\n\t\t\t\tthis.b = keep255(Number(match[3]));\r\n\t\t\t\tthis.a = match[4] !== undefined ? keep1(Number(match[4])) : 1;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Browser wasn't in the mood (probably Chrome with a named color), try harder\r\n\t\t\tvar context = $(\"<canvas width='1' height='1'/>\")[0].getContext(\"2d\");\r\n\t\t\tcontext.fillStyle = value;\r\n\t\t\tcontext.fillRect(0, 0, 1, 1);\r\n\t\t\tvar data = context.getImageData(0, 0, 1, 1).data;\r\n\t\t\tthis.r = data[0];\r\n\t\t\tthis.g = data[1];\r\n\t\t\tthis.b = data[2];\r\n\t\t\tthis.a = data[3] / 255;\r\n\t\t\t// If this is wrong, the named color probably doesn't exist, but we can't detect it\r\n\t\t}\r\n\r\n\t\tif (typeof value === \"number\") {\r\n\t\t\tthis.format = \"IntARGB\";\r\n\t\t\tthis.r = (value >> 16) & 0xff;\r\n\t\t\tthis.g = (value >> 8) & 0xff;\r\n\t\t\tthis.b = value & 0xff;\r\n\t\t\tvar a = (value >> 24) & 0xff;\r\n\t\t\tthis.a = a !== 0 ? round(a / 255, 3) : 1;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (typeof value === \"object\") {\r\n\t\t\tthis.format = value.format !== undefined ? value.format : \"Object\";\r\n\t\t\tthis.r = keep255(value.r);\r\n\t\t\tthis.g = keep255(value.g);\r\n\t\t\tthis.b = keep255(value.b);\r\n\t\t\tthis.a = value.a !== undefined ? keep1(value.a) : 1;\r\n\t\t\treturn;\r\n\t\t};\r\n\r\n\t\tconsole.error(\"Invalid color:\", value);\r\n\t}\r\n\r\n\t// Make it public\r\n\twindow.Color = Color;\r\n\r\n\t// Now add object methods\r\n\tvar Color_prototype = Color.prototype;\r\n\r\n\t// Formats the color in the format it was originally parsed from.\r\n\tColor_prototype.toString = function () {\r\n\t\tswitch (this.format) {\r\n\t\t\tcase \"IntARGB\":\r\n\t\t\t\treturn this.toIntARGB();\r\n\t\t\tcase \"HTML\":\r\n\t\t\t\treturn this.toHTML();\r\n\t\t\tcase \"CSS\":\r\n\t\t\tdefault:\r\n\t\t\t\treturn this.toCSS();\r\n\t\t}\r\n\t};\r\n\r\n\t// Formats a color object into a CSS rgb() string.\r\n\tColor_prototype.toCSS = function () {\r\n\t\tif (this.a === undefined || this.a === 1)\r\n\t\t\treturn \"rgb(\" + this.r + \", \" + this.g + \", \" + this.b + \")\";\r\n\t\treturn \"rgba(\" + this.r + \", \" + this.g + \", \" + this.b + \", \" + this.a + \")\";\r\n\t};\r\n\r\n\t// Formats a color object into an HTML hexadecimal string.\r\n\tColor_prototype.toHTML = function () {\r\n\t\tfunction conv(number) {\r\n\t\t\treturn (number < 16 ? \"0\" : \"\") +\r\n\t\t\t\tround(keep255(number)).toString(16).toLowerCase();\r\n\t\t}\r\n\r\n\t\tvar str = \"#\" + conv(this.r) + conv(this.g) + conv(this.b);\r\n\t\tif (this.a !== undefined && this.a !== 1) str += conv(this.a * 255);\r\n\t\treturn str;\r\n\t};\r\n\r\n\t// Converts a color object into an integer number like 0xAARRGGBB.\r\n\tColor_prototype.toIntARGB = function () {\r\n\t\treturn (this.a !== undefined ? round(keep1(this.a) * 255) : 255) << 24 |\r\n\t\t\tround(keep255(this.r)) << 16 |\r\n\t\t\tround(keep255(this.g)) << 8 |\r\n\t\t\tround(keep255(this.b));\r\n\t};\r\n\r\n\t// Calculates the HSL components from the RGB components in the color object.\r\n\tColor_prototype.updateHSL = function () {\r\n\t\tthis.r = keep255(this.r);\r\n\t\tthis.g = keep255(this.g);\r\n\t\tthis.b = keep255(this.b);\r\n\r\n\t\tvar r = this.r / 255;\r\n\t\tvar g = this.g / 255;\r\n\t\tvar b = this.b / 255;\r\n\t\tvar min = Math.min(r, g, b);\r\n\t\tvar max = Math.max(r, g, b);\r\n\r\n\t\tif (max === min)\r\n\t\t\tthis.h = 0;\r\n\t\telse if (max === r)\r\n\t\t\tthis.h = (60 * (g - b) / (max - min)) % 360;\r\n\t\telse if (max === g)\r\n\t\t\tthis.h = (60 * (b - r) / (max - min) + 120) % 360;\r\n\t\telse // if (max === b)\r\n\t\t\tthis.h = (60 * (r - g) / (max - min) + 240) % 360;\r\n\t\tif (this.h < 0)\r\n\t\t\tthis.h += 360;\r\n\r\n\t\tthis.s = 0;   // Just for the order of the properties\r\n\t\tthis.l = (max + min) / 2;\r\n\r\n\t\tif (max === min)\r\n\t\t\tthis.s = 0;\r\n\t\telse if (this.l <= 0.5)\r\n\t\t\tthis.s = (max - min) / (2 * this.l);\r\n\t\telse\r\n\t\t\tthis.s = (max - min) / (2 - 2 * this.l);\r\n\t\treturn this;\r\n\t};\r\n\r\n\t// Calculates the RGB components from the HSL components in the color object.\r\n\tColor_prototype.updateRGB = function () {\r\n\t\tthis.h = minmax(this.h, 0, 366);\r\n\t\tthis.s = keep1(this.s);\r\n\t\tthis.l = keep1(this.l);\r\n\r\n\t\tvar q = this.l < 0.5 ?\r\n\t\t\tthis.l * (1 + this.s) :\r\n\t\t\tthis.l + this.s - this.l * this.s;\r\n\t\tvar p = 2 * this.l - q;\r\n\t\tvar h = this.h / 360;   // Normalise hue to 0..1\r\n\t\tvar t = { r: h + 1 / 3, g: h, b: h - 1 / 3 };\r\n\r\n\t\tvar that = this;\r\n\t\t[\"r\", \"g\", \"b\"].forEach(function (c) {\r\n\t\t\tif (t[c] < 0) t[c]++;\r\n\t\t\tif (t[c] > 1) t[c]--;\r\n\t\t\tif (t[c] < 1 / 6)\r\n\t\t\t\tthat[c] = p + ((q - p) * 6 * t[c]);\r\n\t\t\telse if (t[c] < 1 / 2)\r\n\t\t\t\tthat[c] = q;\r\n\t\t\telse if (t[c] < 2 / 3)\r\n\t\t\t\tthat[c] = p + ((q - p) * 6 * (2 / 3 - t[c]));\r\n\t\t\telse\r\n\t\t\t\tthat[c] = p;\r\n\t\t\tthat[c] = round(that[c] * 255);\r\n\t\t});\r\n\t\tif (this.a === undefined) this.a = 1;\r\n\t\treturn this;\r\n\t};\r\n\r\n\t// Returns a blended color with the specified ratio from 0 (no change) to 1 (only other color).\r\n\tColor_prototype.blendWith = function (other, ratio, includeAlpha) {\r\n\t\tvar isHSL = this.h !== undefined || other.h !== undefined;\r\n\t\tvar color = Color(this);\r\n\t\tother = Color(other);\r\n\t\tratio = keep1(ratio);\r\n\t\t[\"r\", \"g\", \"b\"].forEach(function (c) {\r\n\t\t\tcolor[c] = keep255(round(extendFF(color[c]) + (extendFF(other[c]) - extendFF(color[c])) * ratio));\r\n\t\t});\r\n\t\tif (includeAlpha)\r\n\t\t\tcolor.a = round(color.a + (other.a - color.a) * ratio, 3);\r\n\t\tif (isHSL)\r\n\t\t\tcolor.updateHSL();\r\n\t\treturn color;\r\n\t};\r\n\r\n\t// Returns the inverted color.\r\n\tColor_prototype.invert = function () {\r\n\t\treturn processColor(this, false, function () {\r\n\t\t\tthis.r = 255 - keep255(this.r);\r\n\t\t\tthis.g = 255 - keep255(this.g);\r\n\t\t\tthis.b = 255 - keep255(this.b);\r\n\t\t});\r\n\t};\r\n\r\n\t// Returns the complementary color.\r\n\tColor_prototype.complement = function () {\r\n\t\treturn processColor(this, true, function () {\r\n\t\t\tthis.h = (this.h + 180) % 360;\r\n\t\t});\r\n\r\n\t\t// TODO: Add an option to return multiple complementary colors, as array\r\n\t};\r\n\r\n\t// Returns a color that is lighter by the factor between 0 (unchanged) and 1 (white).\r\n\tColor_prototype.lighten = function (factor) {\r\n\t\treturn processColor(this, true, function () {\r\n\t\t\tthis.l = keep1(this.l + keep1(factor) * (1 - this.l));\r\n\t\t});\r\n\t};\r\n\r\n\t// Returns a color that is darker by the factor between 0 (unchanged) and 1 (black).\r\n\tColor_prototype.darken = function (factor) {\r\n\t\treturn processColor(this, true, function () {\r\n\t\t\tthis.l = keep1(this.l * (1 - keep1(factor)));\r\n\t\t});\r\n\t};\r\n\r\n\t// TODO: Add functions to (de)saturate the color (similar to lighten and darken?)\r\n\r\n\t// Returns the grayscale color by perceived brightness.\r\n\tColor_prototype.gray = function () {\r\n\t\treturn processColor(this, false, function () {\r\n\t\t\tvar value = round(keep255(this.r) * 0.3 + keep255(this.g) * 0.59 + keep255(this.b) * 0.11);\r\n\t\t\tthis.r = value;\r\n\t\t\tthis.g = value;\r\n\t\t\tthis.b = value;\r\n\t\t\tthis.a = 1;\r\n\t\t});\r\n\t};\r\n\r\n\t// Returns a value indicating whether the specified color is dark.\r\n\tColor_prototype.isDark = function () {\r\n\t\treturn this.gray().r < 144;\r\n\t};\r\n\r\n\t// Returns white or black as suitable for the text color over the background color.\r\n\tColor_prototype.text = function () {\r\n\t\treturn processColor(this, false, function () {\r\n\t\t\tvar value = this.isDark() ? 255 : 0;\r\n\t\t\tthis.r = value;\r\n\t\t\tthis.g = value;\r\n\t\t\tthis.b = value;\r\n\t\t\tthis.a = 1;\r\n\t\t});\r\n\t};\r\n\r\n\tfunction processColor(color, hslMode, fn) {\r\n\t\tcolor = Color(color);   // Make a copy\r\n\t\tif (hslMode) color.updateHSL();\r\n\t\tfn.call(color);\r\n\t\tif (hslMode) color.updateRGB();\r\n\t\treturn color;\r\n\t}\r\n\r\n\tfunction extendFF(value) {\r\n\t\treturn value === 0xff ? 256 : value;\r\n\t}\r\n\r\n\tfunction keep1(value) {\r\n\t\treturn minmax(value, 0, 1);\r\n\t}\r\n\r\n\tfunction keep255(value) {\r\n\t\treturn minmax(value, 0, 255);\r\n\t}\r\n\r\n})();\r\n","﻿import { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\n// Gets the offset and dimensions of the first selected element.\r\n$.fn.rect = function () {\r\n\tvar offset = this.offset();\r\n\tvar width = this.outerWidth();\r\n\tvar height = this.outerHeight();\r\n\treturn {\r\n\t\ttop: offset.top,\r\n\t\tleft: offset.left,\r\n\t\tright: offset.left + width,\r\n\t\tbottom: offset.top + height,\r\n\t\twidth: width,\r\n\t\theight: height\r\n\t};\r\n};\r\n\r\n// Determines whether the selected element is visible.\r\n// value: Sets the visible state of the selected elements.\r\n$.fn.visible = function (value) {\r\n\t// Setter\r\n\tif (value !== undefined) {\r\n\t\treturn this.each(function () {\r\n\t\t\tif (value)\r\n\t\t\t\t$(this).show();\r\n\t\t\telse\r\n\t\t\t\t$(this).hide();\r\n\t\t});\r\n\t}\r\n\r\n\t// Getter\r\n\tif (this.length === 0) return;\r\n\treturn this.css(\"display\") !== \"none\";\r\n};\r\n\r\n// Determines whether the selected element is disabled.\r\n// value: Sets the disabled state of the selected elements and the associated label(s).\r\n$.fn.disabled = function (value) {\r\n\t// Setter\r\n\tif (value !== undefined) {\r\n\t\treturn this.each(function () {\r\n\t\t\tif (value)\r\n\t\t\t\t$(this).disable();\r\n\t\t\telse\r\n\t\t\t\t$(this).enable();\r\n\t\t});\r\n\t}\r\n\r\n\t// Getter\r\n\tif (this.length === 0) return;\r\n\t// Also explicitly check for the property to support the disabledchange hook\r\n\treturn this[0].disabled || this.attr(\"disabled\") !== undefined;\r\n};\r\n\r\n// Enables the selected elements and the associated label(s).\r\n$.fn.enable = function () {\r\n\treturn this.each$(function () {\r\n\t\tvar supportsDisabledProp = \"disabled\" in this[0];\r\n\t\tif (supportsDisabledProp) {\r\n\t\t\t// Set property so that the hook can trigger the change event.\r\n\t\t\t// This automatically removes the HTML attribute as well.\r\n\t\t\tthis.prop(\"disabled\", false);\r\n\t\t}\r\n\t\telse if (this.attr(\"disabled\") !== undefined) {\r\n\t\t\t// Don't set the property or it will be added where not supported.\r\n\t\t\t// Only remove HTML attribute to allow CSS styling other elements than inputs\r\n\t\t\tthis.removeAttr(\"disabled\");\r\n\t\t\t// Trigger the event manually\r\n\t\t\tthis.trigger(\"disabledchange\");\r\n\t\t}\r\n\r\n\t\tthis.parents(\"label\").enable();\r\n\t\tvar id = this.attr(\"id\");\r\n\t\tif (id)\r\n\t\t\t$(\"label[for='\" + id + \"']\").enable();\r\n\t});\r\n};\r\n\r\n// Disables the selected elements and the associated label(s).\r\n$.fn.disable = function () {\r\n\treturn this.each$(function () {\r\n\t\tvar supportsDisabledProp = \"disabled\" in this[0];\r\n\t\tif (supportsDisabledProp) {\r\n\t\t\t// Set property so that the hook can trigger the change event.\r\n\t\t\t// This automatically sets the HTML attribute as well.\r\n\t\t\tthis.prop(\"disabled\", true);\r\n\t\t}\r\n\t\telse if (this.attr(\"disabled\") === undefined) {\r\n\t\t\t// Don't set the property or it will be added where not supported.\r\n\t\t\t// Only set HTML attribute to allow CSS styling other elements than inputs\r\n\t\t\tthis.attr(\"disabled\", \"\");\r\n\t\t\t// Trigger the event manually\r\n\t\t\tthis.trigger(\"disabledchange\");\r\n\t\t}\r\n\r\n\t\tthis.parents(\"label\").disable();\r\n\t\tvar id = this.attr(\"id\");\r\n\t\tif (id)\r\n\t\t\t$(\"label[for='\" + id + \"']\").disable();\r\n\t});\r\n};\r\n\r\n// Toggles the disabled state of the selected elements and the associated label(s).\r\n$.fn.toggleDisabled = function () {\r\n\treturn this.each$(function () {\r\n\t\tif (this.disabled())\r\n\t\t\tthis.enable();\r\n\t\telse\r\n\t\t\tthis.disable();\r\n\t});\r\n};\r\n\r\n// Returns the first child of each selected element, in the fastest possible way.\r\n$.fn.firstChild = function () {\r\n\tvar ret = $();\r\n\tthis.each(function () {\r\n\t\tret = ret.add(this.firstElementChild);\r\n\t});\r\n\treturn ret;\r\n};\r\n\r\n// Determines the actual cursor of the first selected element. \"auto\" is returned as \"default\".\r\n$.fn.actualCursor = function () {\r\n\t// Most elements like <a>, <input>, <textarea> or <area> already compute their actual cursor\r\n\t// value so there's nothing to do.\r\n\tvar cursor = this.css(\"cursor\");\r\n\tif (cursor !== \"auto\" || cursor === undefined) return cursor;\r\n\r\n\t// \"auto\" is mostly used for inline text content. Ignore that and just return the default\r\n\t// cursor that is shown over the empty areas of that element.\r\n\treturn \"default\";\r\n};\r\n\r\n// Determines whether the specified font exists on the client.\r\n// TODO: This fails completely on any Android browser, see https://stackoverflow.com/q/48077942\r\n$.fontExists = function (font) {\r\n\t// Test each probe letter separately so that their differences can't cancel each other\r\n\tvar probes = [\"A\", \"j\", \"l\", \"Q\", \"W\", \"1\", \"^\", \"{\", \"&\", \"@\"];\r\n\t// Compare with different fonts, of which two different ones should be available everywhere\r\n\tvar refFonts = [\"Courier\", \"Times New Roman\", \"Arial\", \"Courier New\", \"Roboto\"];\r\n\tvar container = $(\"<span style='font-size: 100px; line-height: 100%; margin: 0; padding: 0; position: absolute; top: -1000px; left: -1000px;'/>\").appendTo($(\"body\"));\r\n\r\n\tfor (var i = 0; i < probes.length; i++) {\r\n\t\t// Extend the probe to make small differences more easily measured, using a prime factor :)\r\n\t\tlet probe = \"\";\r\n\t\tfor (var k = 0; k < 7; k++) {\r\n\t\t\tprobe += probes[i];\r\n\t\t}\r\n\t\tcontainer.text(probe);\r\n\t\tfor (var j = 0; j < refFonts.length; j++) {\r\n\t\t\tcontainer.css(\"font-family\", refFonts[j]);\r\n\t\t\tvar width = container.width();\r\n\t\t\tvar height = container.height();\r\n\t\t\tcontainer.css(\"font-family\", \"\\\"\" + font + \"\\\",\\\"\" + refFonts[j] + \"\\\"\");\r\n\t\t\tif (container.width() != width || container.height() != height) {\r\n\t\t\t\tcontainer.remove();\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tcontainer.remove();\r\n\treturn false;\r\n};\r\n\r\n// Adds a pointer event handler to the selected elements, with mouse and touch fallbacks as supported.\r\n// type: The event type (\"down\", \"move\", \"up\", \"cancel\"). Multiple types can be space-delimited.\r\n// handler: The event handler function.\r\n// capture: Specifies the capture option. If true, DOM addEventListener ist used instead of jQuery.\r\n// Returns a function that removes the event handler. Keep it and call it, there is no other way to remove it.\r\n$.fn.pointer = function (type, handler, capture) {\r\n\tvar add, remove, pointer, mouse, touch, touchType = type, mouseHandler, touchHandler;\r\n\tvar types = type.trim().split(/\\s+/);\r\n\r\n\t// Handle multiple types\r\n\tif (types.length > 1) {\r\n\t\t// Call self for each type and combine all event remover functions in a new function to return\r\n\t\tlet eventRemovers = [];\r\n\t\tlet that = this;\r\n\t\ttypes.forEach(function (type) {\r\n\t\t\teventRemovers.push($(that).pointer(type, handler, capture));\r\n\t\t});\r\n\t\treturn function () {\r\n\t\t\teventRemovers.forEach(function (eventRemover) { eventRemover(); });\r\n\t\t};\r\n\t}\r\n\r\n\t// Set up the functions to call and bind their context\r\n\tif (capture) {\r\n\t\t// Handle multiple selected elements\r\n\t\tif (this.length > 1) {\r\n\t\t\t// Call self for each element and combine all event remover functions in a new function to return\r\n\t\t\tlet eventRemovers = [];\r\n\t\t\tlet that = this;\r\n\t\t\tthis.each(function () {\r\n\t\t\t\teventRemovers.push($(that).pointer(type, handler, capture));\r\n\t\t\t});\r\n\t\t\treturn function () {\r\n\t\t\t\teventRemovers.forEach(function (eventRemover) { eventRemover(); });\r\n\t\t\t};\r\n\t\t}\r\n\t\tadd = this[0].addEventListener.bind(this[0]);\r\n\t\tremove = this[0].removeEventListener.bind(this[0]);\r\n\t}\r\n\telse {\r\n\t\tadd = this.on.bind(this);\r\n\t\tremove = this.off.bind(this);\r\n\t\tcapture = undefined;\r\n\t}\r\n\r\n\t// Fix touch event type names that are a little different\r\n\tswitch (type) {\r\n\t\tcase \"down\": touchType = \"start\"; break;\r\n\t\tcase \"up\": touchType = \"end\"; break;\r\n\t}\r\n\r\n\t// Determine the supported (and necessary) event types\r\n\tpointer = \"onpointer\" + type in window;\r\n\tif (!pointer) {\r\n\t\tmouse = \"onmouse\" + type in window;\r\n\t\ttouch = \"ontouch\" + touchType in window;\r\n\t}\r\n\r\n\t// Prepare adapted handlers for fallback event types\r\n\tif (mouse) mouseHandler = event => handleMouseEvent(handler, event);\r\n\tif (touch) touchHandler = event => handleTouchEvent(handler, event);\r\n\r\n\t// Add event handlers\r\n\tif (pointer) add(\"pointer\" + type, handler, capture);\r\n\tif (mouse) add(\"mouse\" + type, mouseHandler, capture);\r\n\tif (touch) add(\"touch\" + touchType, touchHandler, capture);\r\n\r\n\t// Return a function that removes all added event handlers, for the caller to call later\r\n\treturn function () {\r\n\t\tif (pointer) remove(\"pointer\" + type, handler, capture);\r\n\t\tif (mouse) remove(\"mouse\" + type, mouseHandler, capture);\r\n\t\tif (touch) remove(\"touch\" + touchType, touchHandler, capture);\r\n\t};\r\n};\r\n\r\n// Calls a pointer event handler for a mouse event.\r\nfunction handleMouseEvent(handler, event) {\r\n\tvar event2 = $.Event(event.type, event);\r\n\tevent2.pointerId = -event.button;\r\n\tevent2.pointerType = \"mouse\";\r\n\treturn handler(event2);\r\n}\r\n\r\n// Calls a pointer event handler for a touch event.\r\nfunction handleTouchEvent(handler, event) {\r\n\tfor (var index = 0; index < event.changedTouches.length; index++) {\r\n\t\tvar event2 = $.Event(event.type, event);\r\n\t\tevent2.pageX = event.changedTouches[index].pageX;\r\n\t\tevent2.pageY = event.changedTouches[index].pageY;\r\n\t\tevent2.pointerId = event.changedTouches[index].identifier;\r\n\t\tevent2.button = 0;\r\n\t\tevent2.pointerType = \"touch\";\r\n\t\tif (handler(event2) === false) return false;\r\n\t}\r\n}\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar draggableClass = \"ff-draggable\";\r\nvar resetAllCursorsClass = \"reset-all-cursors\";\r\n\r\n// Defines default options for the draggable plugin.\r\nvar draggableDefaults = {\r\n\t// The element(s) that can start a drag operation. Default: The element to drag.\r\n\thandle: undefined,\r\n\r\n\t// The element(s) that cannot start a drag operation. Default: None.\r\n\tcancel: undefined,\r\n\r\n\t// Constrains the drag movement along the \"x\" or \"y\" axis. Default: None.\r\n\taxis: undefined,\r\n\r\n\t// Constrains the drag movement inside the specified element or the \"parent\" of the dragged element. Default: None.\r\n\tcontainment: undefined,\r\n\r\n\t// The elements among which the dragged element will be pulled in the front. Default: None.\r\n\tstack: undefined,\r\n\r\n\t// The mouse cursor to show during dragging. Default: None.\r\n\tdragCursor: undefined,\r\n\r\n\t// A CSS class to add to the element while it's being dragged. Default: None.\r\n\tdragClass: undefined,\r\n\r\n\t// The grid to snap the dragged element to during dragging, as [x, y] in pixels. Default: [1, 1].\r\n\tgrid: undefined,\r\n\r\n\t// Indicates whether the window should scroll to keep the dragged element visible. Default: false.\r\n\tscroll: false\r\n};\r\n\r\n// Makes each selected element draggable.\r\nfunction draggable(options) {\r\n\treturn this.each(function () {\r\n\t\tvar elem = this;\r\n\t\tvar $elem = $(elem);\r\n\t\tif ($elem.hasClass(draggableClass)) return;   // Already done\r\n\t\t$elem.addClass(draggableClass);\r\n\t\tvar dragging, draggingCancelled, dragPoint, elemRect, minDragDistance, pointerId, htmlCursor;\r\n\t\tvar opt = initOptions(\"draggable\", draggableDefaults, $elem, {}, options);\r\n\r\n\t\tvar handle = opt.handle ? $elem.find(opt.handle) : $elem;\r\n\r\n\t\t// Allow Pointer API to work properly in Edge\r\n\t\tif (opt.axis === \"x\")\r\n\t\t\thandle.css(\"touch-action\", \"pan-y pinch-zoom\");\r\n\t\telse if (opt.axis === \"y\")\r\n\t\t\thandle.css(\"touch-action\", \"pan-x pinch-zoom\");\r\n\t\telse\r\n\t\t\thandle.css(\"touch-action\", \"pinch-zoom\");\r\n\r\n\t\tvar eventRemovers = [];\r\n\t\thandle.pointer(\"down\", function (event) {\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tif (dragging) return;\r\n\t\t\t\tdraggingCancelled = false;\r\n\t\t\t\tdragPoint = { left: event.pageX, top: event.pageY };\r\n\t\t\t\tpointerId = event.pointerId;\r\n\t\t\t\tminDragDistance = event.pointerType === \"touch\" ? 8 : 4;\r\n\t\t\t\teventRemovers.push($(window).pointer(\"move\", onMove, true));\r\n\t\t\t\teventRemovers.push($(window).pointer(\"up cancel\", onEnd, true));\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (opt.cancel) {\r\n\t\t\t$elem.find(opt.cancel).pointer(\"down\", function (event) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction onMove(event) {\r\n\t\t\tif (event.pointerId !== pointerId) return;   // Not my pointer\r\n\t\t\tif (draggingCancelled) return;   // Don't try again until the button was released\r\n\r\n\t\t\t// Consider starting a drag operation\r\n\t\t\tif (dragPoint && !dragging && !$elem.disabled()) {\r\n\t\t\t\tlet distance = Math.sqrt(Math.pow(event.pageX - dragPoint.left, 2) + Math.pow(event.pageY - dragPoint.top, 2));\r\n\t\t\t\tif (distance >= minDragDistance) {\r\n\t\t\t\t\telemRect = $elem.rect();\r\n\t\t\t\t\tlet event2 = $.Event(\"draggablestart\");\r\n\t\t\t\t\tevent2.dragPoint = dragPoint;\r\n\t\t\t\t\tevent2.newPoint = { left: event.pageX, top: event.pageY };\r\n\t\t\t\t\t$elem.trigger(event2);\r\n\t\t\t\t\tif (!event2.isDefaultPrevented()) {\r\n\t\t\t\t\t\tdragging = true;\r\n\t\t\t\t\t\topt.dragClass && $elem.addClass(opt.dragClass);\r\n\t\t\t\t\t\telem.setCapture && elem.setCapture();   // Firefox only (set cursor over entire desktop)\r\n\t\t\t\t\t\t$(\"html\").addClass(resetAllCursorsClass);   // All browsers (set cursor at least within page)\r\n\t\t\t\t\t\tif (opt.stack) {\r\n\t\t\t\t\t\t\tstackElements($(opt.stack), elem);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\thtmlCursor = document.documentElement.style.getPropertyValue(\"cursor\");\r\n\t\t\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", opt.dragCursor || $elem.actualCursor(), \"important\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tdraggingCancelled = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Handle an ongoing drag operation\r\n\t\t\tif (dragging) {\r\n\t\t\t\t// Start with the default drag movement position\r\n\t\t\t\tvar newPoint = {\r\n\t\t\t\t\ttop: elemRect.top + event.pageY - dragPoint.top,\r\n\t\t\t\t\tleft: elemRect.left + event.pageX - dragPoint.left\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Consider constraints\r\n\t\t\t\tif (opt.grid) {\r\n\t\t\t\t\tlet gridBase = $elem.parent().offset();\r\n\t\t\t\t\tnewPoint = {\r\n\t\t\t\t\t\ttop: Math.round((newPoint.top - gridBase.top) / opt.grid[1]) * opt.grid[1] + gridBase.top,\r\n\t\t\t\t\t\tleft: Math.round((newPoint.left - gridBase.left) / opt.grid[0]) * opt.grid[0] + gridBase.left\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.axis === \"x\") {\r\n\t\t\t\t\tnewPoint.top = elemRect.top;\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.axis === \"y\") {\r\n\t\t\t\t\tnewPoint.left = elemRect.left;\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.containment) {\r\n\t\t\t\t\tlet cont;\r\n\t\t\t\t\tif (opt.containment === \"parent\")\r\n\t\t\t\t\t\tcont = $elem.parent();\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tcont = $(opt.containment);\r\n\t\t\t\t\tif (cont.length !== 0) {\r\n\t\t\t\t\t\tlet contRect = cont.rect();\r\n\t\t\t\t\t\tlet stepX = opt.grid ? opt.grid[0] : 1;\r\n\t\t\t\t\t\tlet stepY = opt.grid ? opt.grid[1] : 1;\r\n\t\t\t\t\t\twhile (newPoint.left < contRect.left) newPoint.left += stepX;\r\n\t\t\t\t\t\twhile (newPoint.left + elemRect.width > contRect.right) newPoint.left -= stepX;\r\n\t\t\t\t\t\twhile (newPoint.top < contRect.top) newPoint.top += stepY;\r\n\t\t\t\t\t\twhile (newPoint.top + elemRect.height > contRect.bottom) newPoint.top -= stepY;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move element\r\n\t\t\t\tlet event2 = $.Event(\"draggablemove\");\r\n\t\t\t\tevent2.elemRect = elemRect;\r\n\t\t\t\tevent2.newPoint = newPoint;\r\n\t\t\t\t$elem.trigger(event2);\r\n\t\t\t\tif (!event2.isDefaultPrevented()) {\r\n\t\t\t\t\t$elem.offset(event2.newPoint);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Handle auto-scrolling\r\n\t\t\t\tif (opt.scroll) {\r\n\t\t\t\t\tscrollIntoView($elem.rect());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onEnd(event) {\r\n\t\t\tif (event.pointerId !== pointerId) return;   // Not my pointer\r\n\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tvar wasDragging = dragging;\r\n\t\t\t\tdragPoint = undefined;\r\n\t\t\t\tdragging = false;\r\n\t\t\t\tpointerId = undefined;\r\n\t\t\t\topt.dragClass && $elem.removeClass(opt.dragClass);\r\n\r\n\t\t\t\teventRemovers.forEach(function (eventRemover) { eventRemover(); });\r\n\t\t\t\teventRemovers = [];\r\n\r\n\t\t\t\tif (wasDragging) {\r\n\t\t\t\t\telem.releaseCapture && elem.releaseCapture();\r\n\t\t\t\t\t$(\"html\").removeClass(resetAllCursorsClass);\r\n\t\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", htmlCursor);\r\n\r\n\t\t\t\t\tlet event2 = $.Event(\"draggableend\");\r\n\t\t\t\t\tevent2.revert = function () {\r\n\t\t\t\t\t\t$elem.offset(elemRect);\r\n\t\t\t\t\t};\r\n\t\t\t\t\t$elem.trigger(event2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"draggable\", draggable);\r\n$.fn.draggable.defaults = draggableDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { forceReflow } from \"../util\";\r\n\r\nvar dropdownContainerClass = \"ff-dropdown-container\";\r\n\r\n// Defines default options for the dropdown plugin.\r\nvar dropdownDefaults = {\r\n\t// The placement of the dropdown relative to the target element. Default: None.\r\n\tplacement: undefined,\r\n\r\n\t// Indicates whether the dropdown is closed when clicking anywhere outside of it. Default: true.\r\n\tautoClose: true\r\n};\r\n\r\n// Opens a dropdown with the selected element and places it at the specified target element.\r\nfunction createDropdown(target, options) {\r\n\tvar dropdown = this.first();\r\n\tif (dropdown.length === 0) return this;   // Nothing to do\r\n\tif (dropdown.parent().hasClass(dropdownContainerClass)) return;   // Already open\r\n\tvar opt = initOptions(\"dropdown\", dropdownDefaults, dropdown, {}, options);\r\n\r\n\tvar autoPlacement = false;\r\n\tif (!opt.placement) {\r\n\t\topt.placement = \"bottom-left\";\r\n\t\tautoPlacement = true;\r\n\t}\r\n\telse if (opt.placement === \"right\") {\r\n\t\topt.placement = \"bottom-right\";\r\n\t\tautoPlacement = true;\r\n\t}\r\n\tvar optPlacement = opt.placement;\r\n\r\n\tvar container = $(\"<div/>\").addClass(dropdownContainerClass).appendTo(\"body\");\r\n\tif (dropdown.hasClass(\"bordered\")) {\r\n\t\tcontainer.addClass(\"bordered\");\r\n\t}\r\n\tdropdown.detach().appendTo(container);\r\n\r\n\tvar viewportWidth = $(window).width();\r\n\tvar viewportHeight = $(window).height();\r\n\tvar dropdownWidth = container.outerWidth();\r\n\tvar dropdownHeight = container.outerHeight();\r\n\tvar targetRect = $(target).rect();\r\n\r\n\t// Place at bottom side, align left, by default\r\n\tvar top = targetRect.bottom,\r\n\t\tleft = targetRect.left,\r\n\t\tdirection = \"bottom\";\r\n\r\n\tif (optPlacement.startsWith(\"top\")) {\r\n\t\ttop = targetRect.top - dropdownHeight;\r\n\t\tdirection = \"top\";\r\n\t}\r\n\telse if (optPlacement.startsWith(\"bottom\")) {\r\n\t\ttop = targetRect.bottom;\r\n\t\tdirection = \"bottom\";\r\n\t}\r\n\telse if (optPlacement.startsWith(\"left\")) {\r\n\t\tleft = targetRect.left - dropdownWidth;\r\n\t\tdirection = \"left\";\r\n\t}\r\n\telse if (optPlacement.startsWith(\"right\")) {\r\n\t\tleft = targetRect.right;\r\n\t\tdirection = \"right\";\r\n\t}\r\n\r\n\tif (optPlacement.endsWith(\"left\")) {\r\n\t\tleft = targetRect.left;\r\n\t}\r\n\telse if (optPlacement.endsWith(\"right\")) {\r\n\t\tleft = targetRect.right - dropdownWidth;\r\n\t}\r\n\telse if (optPlacement.endsWith(\"top\")) {\r\n\t\ttop = targetRect.top;\r\n\t}\r\n\telse if (optPlacement.endsWith(\"bottom\")) {\r\n\t\ttop = targetRect.bottom - dropdownHeight;\r\n\t}\r\n\r\n\tif (optPlacement === \"top-center\" || optPlacement === \"bottom-center\") {\r\n\t\tleft = (targetRect.left + targetRect.right) / 2 - dropdownWidth / 2;\r\n\t}\r\n\telse if (optPlacement === \"left-center\" || optPlacement === \"right-center\") {\r\n\t\ttop = (targetRect.top + targetRect.bottom) / 2 - dropdownHeight / 2;\r\n\t}\r\n\r\n\tif (autoPlacement && left + dropdownWidth > viewportWidth) {\r\n\t\tleft = viewportWidth - dropdownWidth;\r\n\t}\r\n\tif (autoPlacement && top + dropdownHeight > viewportHeight + $(window).scrollTop()) {\r\n\t\ttop = targetRect.top - dropdownHeight;\r\n\t\tdirection = \"top\";\r\n\t}\r\n\r\n\tcontainer.offset({ top: top, left: left })\r\n\t\t.addClass(\"animate-\" + direction);\r\n\tforceReflow();\r\n\tcontainer.addClass(\"open\");\r\n\r\n\t// Auto-close the dropdown when clicking outside of it\r\n\tif (opt.autoClose === undefined || opt.autoClose) {\r\n\t\tsetTimeout(function () {\r\n\t\t\t$(document).on(\"click.dropdown-close\", function (event) {\r\n\t\t\t\ttryClose();\r\n\t\t\t});\r\n\t\t}, 20);\r\n\t\tcontainer.click(function (event) {\r\n\t\t\t// Don't close the dropdown when clicking inside of it\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t});\r\n\t}\r\n\treturn this;\r\n\r\n\tfunction tryClose() {\r\n\t\tvar event = $.Event(\"dropdownclose\");\r\n\t\tdropdown.trigger(event);\r\n\t\tif (!event.isDefaultPrevented()) {\r\n\t\t\tdropdown.dropdown.close();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Closes the selected dropdown.\r\nfunction closeDropdown() {\r\n\tvar dropdown = this.first();\r\n\tif (dropdown.length === 0) return this;   // Nothing to do\r\n\tvar container = dropdown.parent();\r\n\tif (!container.hasClass(dropdownContainerClass)) return this;   // Dropdown is not open\r\n\t//var opt = loadOptions(\"dropdown\", dropdown);\r\n\r\n\t$(document).off(\"click.dropdown-close\");\r\n\tcontainer.removeClass(\"open\").addClass(\"closed\");\r\n\tcontainer.on(\"transitionend\", function () {\r\n\t\tdropdown.detach().appendTo(\"body\");\r\n\t\tcontainer.remove();\r\n\t});\r\n\treturn this;\r\n}\r\n\r\nregisterPlugin(\"dropdown\", createDropdown, {\r\n\tclose: closeDropdown\r\n});\r\n$.fn.dropdown.defaults = dropdownDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar inputWrapperClass = \"ff-input-wrapper\";\r\nvar repeatButtonClass = \"ff-repeat-button\";\r\nvar styleCheckboxClass = \"ff-checkbox\";\r\nvar treeStateClass = \"ff-threestate\";\r\nvar textareaWrapperClass = \"ff-textarea-wrapper\";\r\n\r\n// Makes each selected button trigger repeated click events while being pressed.\r\n// The button will not trigger a click event anymore but instead repeatclick events.\r\nfunction repeatButton() {\r\n\treturn this.each(function () {\r\n\t\tvar button = $(this);\r\n\t\tif (button.hasClass(repeatButtonClass)) return;   // Already done\r\n\t\tbutton.addClass(repeatButtonClass);\r\n\t\tvar timeout, ms;\r\n\t\tbutton.on(\"mousedown touchstart\", function (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tms = 500;\r\n\t\t\tclick();\r\n\t\t});\r\n\t\tbutton.on(\"mouseup mouseleave touchend touchcancel\", function (event) {\r\n\t\t\tif (timeout) {\r\n\t\t\t\tclearTimeout(timeout);\r\n\t\t\t\ttimeout = undefined;\r\n\t\t\t}\r\n\t\t\tms = undefined;\r\n\t\t});\r\n\t\tbutton.click(function (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\r\n\t\t// Triggers the button's click event and repeats the timeout\r\n\t\tfunction click() {\r\n\t\t\tbutton.trigger(\"repeatclick\");\r\n\t\t\ttimeout = setTimeout(click, ms);\r\n\t\t\tms = 50 + Math.round((ms - 50) * 0.8);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"repeatButton\", repeatButton);\r\n\r\n// Adds buttons to each selected input[type=number] element to decrement or increment the value.\r\nfunction spinner() {\r\n\treturn this.each(function () {\r\n\t\tvar input = $(this);\r\n\t\tif (input.parent().hasClass(inputWrapperClass)) return;   // Already done\r\n\r\n\t\t// Put a wrapper between the input and its parent\r\n\t\tvar wrapper = $(\"<div/>\").addClass(inputWrapperClass).attr(\"style\", input.attr(\"style\"));\r\n\t\tinput.replaceWith(wrapper).appendTo(wrapper);   // TODO: replaceWith removes the input. Choose an option that uses detach() instead\r\n\t\tinput.attr(\"autocomplete\", \"off\");\r\n\r\n\t\t// Add control buttons\r\n\t\tvar buttons = [];\r\n\t\tvar decButton = $(\"<button type='button'/>\").appendTo(wrapper).text(\"\\u2212\");   // &minus;\r\n\t\tbuttons.push(decButton);\r\n\t\tdecButton.on(\"repeatclick\", function (event) {\r\n\t\t\tif (input.disabled()) return;\r\n\t\t\tvar value = +input.val();\r\n\t\t\tvar min = input.attr(\"min\");\r\n\t\t\tvar max = input.attr(\"max\");\r\n\t\t\tvar stepBase = min !== undefined ? parseFloat(min) : 0;\r\n\t\t\tvar step = parseFloat(input.attr(\"step\") || 1);\r\n\t\t\tvalue = (Math.ceil((value - stepBase) / step) - 1) * step + stepBase;   // Set to next-smaller valid step\r\n\t\t\tif (min !== undefined && value < parseFloat(min)) value = min;\r\n\t\t\twhile (max !== undefined && value > parseFloat(max)) value -= step;\r\n\t\t\tinput.val(value);\r\n\t\t});\r\n\t\tdecButton.repeatButton();\r\n\t\tvar incButton = $(\"<button type='button'/>\").appendTo(wrapper).text(\"+\");\r\n\t\tbuttons.push(incButton);\r\n\t\tincButton.on(\"repeatclick\", function (event) {\r\n\t\t\tif (input.disabled()) return;\r\n\t\t\tvar value = +input.val();\r\n\t\t\tvar min = input.attr(\"min\");\r\n\t\t\tvar max = input.attr(\"max\");\r\n\t\t\tvar stepBase = min !== undefined ? parseFloat(min) : 0;\r\n\t\t\tvar step = parseFloat(input.attr(\"step\") || 1);\r\n\t\t\tvalue = (Math.floor((value - stepBase) / step) + 1) * step + stepBase;   // Set to next-greater valid step\r\n\t\t\tif (min !== undefined && value < parseFloat(min)) value = min;\r\n\t\t\twhile (max !== undefined && value > parseFloat(max)) value -= step;\r\n\t\t\tinput.val(value);\r\n\t\t});\r\n\t\tincButton.repeatButton();\r\n\t\tbindInputButtonsDisabled(input, buttons);\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"spinner\", spinner);\r\n\r\n// Converts each selected input[type=color] element into a text field with color picker button.\r\nfunction colorPicker() {\r\n\treturn this.each(function () {\r\n\t\tvar input = $(this);\r\n\t\tif (input.parent().hasClass(inputWrapperClass)) return;   // Already done\r\n\t\tvar lastColor;\r\n\r\n\t\t// Put a wrapper between the input and its parent\r\n\t\tvar wrapper = $(\"<div/>\").addClass(inputWrapperClass).attr(\"style\", input.attr(\"style\"));\r\n\t\tinput.replaceWith(wrapper).appendTo(wrapper);   // TODO: replaceWith removes the input. Choose an option that uses detach() instead\r\n\t\tinput.attr(\"type\", \"text\").attr(\"autocomplete\", \"off\");\r\n\r\n\t\t// Create picker dropdown\r\n\t\tvar dropdown = $(\"<div/>\").addClass(\"dropdown bordered ff-colorpicker\");\r\n\t\tdropdown.keydown(function (event) {\r\n\t\t\tif (event.keyCode >= 37 && event.keyCode <= 40) {   // Arrow keys\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tdropdown.find(\"button\").first().focus();\r\n\t\t\t\tdropdown.removeAttr(\"tabindex\");\r\n\t\t\t}\r\n\t\t\tif (event.keyCode === 27) {   // Esc\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tdropdown.dropdown.close();\r\n\t\t\t\tpickButton[0].focus();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Add control buttons\r\n\t\tvar buttons = [];\r\n\t\tvar pickButton = $(\"<button type='button'/>\").addClass(\"ff-colorbutton\").appendTo(wrapper);\r\n\t\tbuttons.push(pickButton);\r\n\t\tvar colorBox = $(\"<div/>\").appendTo(pickButton).text(\"\\u2026\");   // &hellip;\r\n\t\tinput.on(\"input change\", () => setColor(lastColor = input.val()));\r\n\t\tsetColor(lastColor = input.val());\r\n\r\n\t\t// Create dropdown contents\r\n\t\t// Add grey tones explicitly\r\n\t\tvar colors = [0x000000, 0x404040, 0x707070, 0xa0a0a0, 0xd0d0d0, 0xf0f0f0, 0xffffff];\r\n\t\t// Add colors with shades\r\n\t\t[\r\n\t\t\t0xff0000,   // red\r\n\t\t\t0xff8000,   // orange\r\n\t\t\t0xffc000,   // orangeyellow\r\n\t\t\t0xffe000,   // gold\r\n\t\t\t0xffff00,   // yellow\r\n\t\t\t0xc0ff00,   // greenyellow\r\n\t\t\t0x00ff00,   // green\r\n\t\t\t0x00ffc0,   // greencyan\r\n\t\t\t0x00ffff,   // cyan\r\n\t\t\t0x00c0ff,   // bluecyan\r\n\t\t\t0x0080ff,   // lightblue\r\n\t\t\t0x0000ff,   // blue\r\n\t\t\t0x8000ff,   // purple\r\n\t\t\t0xc000ff,   // violet\r\n\t\t\t0xff00ff    // magenta\r\n\t\t].forEach(function (baseColor_) {\r\n\t\t\tvar baseColor = Color(baseColor_);\r\n\t\t\t[0.75, 0.5, 0.25].forEach(factor => colors.push(baseColor.blendWith(0x000000, factor)));\r\n\t\t\tcolors.push(baseColor.toHTML());\r\n\t\t\t[0.5, 0.75, 0.875].forEach(factor => colors.push(baseColor.blendWith(0xffffff, factor)));\r\n\t\t});\r\n\t\tvar buttonRow;\r\n\t\tcolors.forEach(function (color, index) {\r\n\t\t\tcolor = Color(color);\r\n\t\t\tcolor.format = \"HTML\";\r\n\t\t\tif (index % 7 === 0)\r\n\t\t\t\tbuttonRow = $(\"<div/>\").appendTo(dropdown);\r\n\t\t\tvar button = $(\"<button type='button'/>\").css(\"background\", color).data(\"color\", String(color)).appendTo(buttonRow);\r\n\t\t\tif (color.isDark()) button.addClass(\"dark\");\r\n\t\t\tbutton.click(function (event) {\r\n\t\t\t\tsetColor(lastColor = color, true);\r\n\t\t\t\tdropdown.dropdown.close();\r\n\t\t\t\tpickButton[0].focus();\r\n\t\t\t});\r\n\t\t\tbutton.focus(function (event) {\r\n\t\t\t\tdropdown.find(\"button.active\").removeClass(\"active\");\r\n\t\t\t\tbutton.addClass(\"active\");\r\n\t\t\t\tsetColor(color, true);\r\n\t\t\t});\r\n\t\t\tbutton.keydown(function (event) {\r\n\t\t\t\tvar activeButton = dropdown.find(\"button.active\");\r\n\t\t\t\tvar newButton;\r\n\r\n\t\t\t\tswitch (event.keyCode) {\r\n\t\t\t\t\tcase 37:   // Left\r\n\t\t\t\t\t\tnewButton = activeButton.prev();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 39:   // Right\r\n\t\t\t\t\t\tnewButton = activeButton.next();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 40:   // Down\r\n\t\t\t\t\t\tnewButton = activeButton.parent().next().children().eq(activeButton.index());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 38:   // Up\r\n\t\t\t\t\t\tnewButton = activeButton.parent().prev().children().eq(activeButton.index());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 27:   // Esc\r\n\t\t\t\t\t\tsetColor(lastColor, true);\r\n\t\t\t\t\t\tdropdown.dropdown.close();\r\n\t\t\t\t\t\tpickButton[0].focus();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 13:   // Enter\r\n\t\t\t\t\t\tbutton.click();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn;   // Not handled\r\n\t\t\t\t}\r\n\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tnewButton && newButton[0] && newButton[0].focus();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tpickButton.click(function (event) {\r\n\t\t\tvar currentColor = input.val();\r\n\t\t\tvar activeButton;\r\n\t\t\tdropdown.find(\"button\").each$(function () {\r\n\t\t\t\tvar active = this.data(\"color\") === currentColor;\r\n\t\t\t\tthis.toggleClass(\"active\", active);\r\n\t\t\t\tif (active) activeButton = this[0];\r\n\t\t\t});\r\n\r\n\t\t\tdropdown.dropdown(pickButton, { placement: \"right\" });\r\n\t\t\tif (activeButton) {\r\n\t\t\t\tactiveButton.focus();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdropdown.attr(\"tabindex\", \"-1\");\r\n\t\t\t\tdropdown.focus();\r\n\t\t\t}\r\n\t\t});\r\n\t\tbindInputButtonsDisabled(input, buttons);\r\n\r\n\t\tfunction setColor(color, toInput) {\r\n\t\t\tif (toInput) input.val(color);\r\n\t\t\tcolorBox.css(\"background\", color);\r\n\t\t\tcolorBox.css(\"color\", Color(color).text());\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"colorPicker\", colorPicker);\r\n\r\n// Applies the enhanced style on the selected checkbox and radio input elements.\r\nfunction styleCheckbox() {\r\n\treturn this.each(function () {\r\n\t\tvar input = $(this);\r\n\t\tif (input.hasClass(styleCheckboxClass)) return;   // Already done\r\n\t\tif (!input.is(\"input[type=checkbox], input[type=radio]\")) return;   // Wrong element\r\n\r\n\t\tif (input.parents(\"label\").length === 0) {\r\n\t\t\t// Styled input needs a label around it to remain clickable\r\n\t\t\tinput.wrap(\"<label class='empty'></label>\");\r\n\t\t}\r\n\t\tinput.addClass(styleCheckboxClass).after($(\"<span/>\"));\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"styleCheckbox\", styleCheckbox);\r\n\r\n// Makes each selected checkbox cycle through indeterminate (third) state on clicking.\r\nfunction threeState() {\r\n\treturn this.each(function () {\r\n\t\tvar input = $(this);\r\n\t\tif (input.hasClass(treeStateClass)) return;   // Already done\r\n\t\tif (!input.is(\"input[type=checkbox]\")) return;   // Wrong element\r\n\t\tinput.addClass(treeStateClass);\r\n\r\n\t\tvar cb = input[0];\r\n\t\t// Based on: https://css-tricks.com/indeterminate-checkboxes/\r\n\t\tinput.click(function (event) {\r\n\t\t\t// indeterminate is unset when the user clicks to change the checked state.\r\n\t\t\t// readonly (ineffective for checkboxes) is used to backup the previous indeterminate state.\r\n\t\t\t// In this event, checked is already updated to the new desired state.\r\n\t\t\tif (cb.checked && !cb.readOnly) {\r\n\t\t\t\t// Was unchecked and not readonly (indeterminate) -> uncheck and make indeterminate\r\n\t\t\t\tcb.checked = false;\r\n\t\t\t\tcb.readOnly = cb.indeterminate = true;\r\n\t\t\t}\r\n\t\t\telse if (cb.readOnly) {\r\n\t\t\t\t// Was readonly (indeterminate) -> check and forget indeterminate state (unset readonly)\r\n\t\t\t\tcb.checked = true;   // Firefox and Chrome are already checked here, Edge is not\r\n\t\t\t\tcb.readOnly = false;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"threeState\", threeState);\r\n\r\n// Makes each selected textarea element automatically adjust its height to its content.\r\nfunction autoHeight(minRows, maxRows, extraRows) {\r\n\tminRows = minRows || 3;\r\n\treturn this.each(function () {\r\n\t\tvar textarea = $(this);\r\n\t\tif (textarea.parent().hasClass(textareaWrapperClass)) return;   // Already done\r\n\r\n\t\t// Put a wrapper between the textarea and its parent, and host a new shadow element in\r\n\t\t// the wrapper as well. The textarea is set to fill the container, and the shadow\r\n\t\t// element provides the size for the wrapper.\r\n\t\tvar wrapper = $(\"<div/>\").addClass(textareaWrapperClass).attr(\"style\", textarea.attr(\"style\"));\r\n\t\ttextarea.replaceWith(wrapper).appendTo(wrapper);   // TODO: replaceWith removes the input. Choose an option that uses detach() instead\r\n\t\tvar shadowContent = $(\"<div/>\").appendTo(wrapper);\r\n\r\n\t\tvar outerHeightOffset = textarea.outerHeight() - textarea.height();\r\n\t\tvar lineHeight = parseFloat(textarea.css(\"line-height\"));\r\n\t\tif (lineHeight) {\r\n\t\t\tshadowContent.css(\"min-height\", minRows * lineHeight + outerHeightOffset);\r\n\t\t\tif (maxRows) {\r\n\t\t\t\tshadowContent.css(\"max-height\", maxRows * lineHeight + outerHeightOffset);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttextarea.on(\"input.autoheight\", updateShadow);\r\n\t\tupdateShadow();\r\n\r\n\t\tfunction updateShadow() {\r\n\t\t\t// Copy textarea contents; browser will calculate correct height of shadow copy,\r\n\t\t\t// which will make overall wrapper taller, which will make textarea taller.\r\n\t\t\t// Also make sure the last line break is visible.\r\n\t\t\t// Add an extra line break to convince the browser that the textarea doesn't need a scrollbar.\r\n\t\t\tvar text = textarea.val().replace(/\\n$/, \"\\n.\");\r\n\t\t\tif (extraRows)\r\n\t\t\t\ttext += \"\\n.\".repeat(extraRows);\r\n\t\t\tshadowContent.text(text);\r\n\r\n\t\t\t// Copy all layout-relevant styles from textarea to shadow element, in case they've changed\r\n\t\t\t[\r\n\t\t\t\t\"border-bottom-style\", \"border-bottom-width\",\r\n\t\t\t\t\"border-left-style\", \"border-left-width\",\r\n\t\t\t\t\"border-right-style\", \"border-right-width\",\r\n\t\t\t\t\"border-top-style\", \"border-top-width\",\r\n\t\t\t\t\"font-family\", \"font-feature-settings\", \"font-kerning\", \"font-size\", \"font-stretch\", \"font-style\",\r\n\t\t\t\t\"font-variant\", \"font-variant-alternates\", \"font-variant-caps\", \"font-variant-east-asian\",\r\n\t\t\t\t\"font-variant-ligatures\", \"font-variant-numeric\", \"font-variant-position\", \"font-weight\",\r\n\t\t\t\t\"hyphens\", \"letter-spacing\", \"line-height\",\r\n\t\t\t\t\"padding-bottom\", \"padding-left\", \"padding-right\", \"padding-top\",\r\n\t\t\t\t\"text-transform\", \"word-break\", \"word-spacing\"\r\n\t\t\t].forEach(copyStyle);\r\n\t\t}\r\n\r\n\t\tfunction copyStyle(name) {\r\n\t\t\tshadowContent.css(name, textarea.css(name));\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"autoHeight\", autoHeight);\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\n\r\n// Converts each selected list element into a menu. Submenus are opened for nested lists.\r\nfunction menu() {\r\n\treturn this.each(function () {\r\n\t\tvar menu = $(this);\r\n\t\tvar isVertical = menu.hasClass(\"vertical\");\r\n\t\tvar itemsWithSubmenu = menu.children(\"li\").has(\"ul\");\r\n\t\titemsWithSubmenu.each(function () {\r\n\t\t\tvar item = $(this);\r\n\t\t\titem.addClass(\"ff-has-submenu\");\r\n\t\t\tvar submenu = item.children(\"ul\").first();\r\n\t\t\tif (submenu.hasClass(\"ff-submenu\")) return;   // Already done\r\n\t\t\tsubmenu.addClass(\"ff-submenu dropdown\");\r\n\r\n\t\t\t// Open submenu on click\r\n\t\t\titem.children(\"a\").first().click(function (event) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tif (item.disabled()) return;\r\n\t\t\t\tvar ddOpt = {};\r\n\t\t\t\tif (isVertical) {\r\n\t\t\t\t\tddOpt[\"placement\"] = \"right-top\";\r\n\t\t\t\t}\r\n\t\t\t\tsubmenu.dropdown(item, ddOpt);\r\n\t\t\t\titem.addClass(\"open\");\r\n\t\t\t\tsubmenu.one(\"dropdownclose\", function () {\r\n\t\t\t\t\titem.removeClass(\"open\");\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Prepare separators\r\n\t\t\tsubmenu.children(\"li\").each$(function () {\r\n\t\t\t\tif (this.text() === \"-\") {\r\n\t\t\t\t\tthis.text(\"\");\r\n\t\t\t\t\tthis.addClass(\"separator\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"menu\", menu);\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar messageCloseButtonClass = \"ff-message-close-button\";\r\n\r\n// Makes each selected message div element closable by adding a close button to it.\r\nfunction closableMessage() {\r\n\treturn this.each(function () {\r\n\t\tvar message = $(this);\r\n\t\tif (message.find(\".\" + messageCloseButtonClass).length !== 0) return;   // Already added\r\n\r\n\t\t// Add close button\r\n\t\tvar closeButton = $(\"<a/>\").addClass(messageCloseButtonClass).attr(\"href\", \"#\").appendTo(message);\r\n\t\tmessage.addClass(\"closable\");\r\n\t\tcloseButton.click(function (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tmessage.closableMessage.close();\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\n// Closes each selected message div and removes it from the document.\r\nfunction closeMessage() {\r\n\treturn this.each(function () {\r\n\t\tvar message = $(this);\r\n\t\tmessage.addClass(\"ff-closed\");\r\n\t\tmessage.on(\"transitionend\", function () {\r\n\t\t\tmessage.remove();\r\n\t\t});\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"closableMessage\", closableMessage, {\r\n\tclose: closeMessage\r\n});\r\n","import { forceReflow } from \"./util\";\r\n\r\nvar backgroundDimmerClass = \"ff-background-dimmer\";\r\nvar dimmingClass = \"ff-dimming\";\r\nvar dimmedClass = \"ff-dimmed\";\r\n\r\n// Dims the entire document by adding an overlay.\r\nexport function dimBackground(noinput) {\r\n\tif ($(\"body > div.\" + backgroundDimmerClass + \":not(.closing)\").length !== 0) return;   // Already there\r\n\t$(\"body\").addClass(dimmingClass).addClass(dimmedClass);\r\n\tvar backgroundLayer = $(\"<div/>\")\r\n\t\t.addClass(backgroundDimmerClass)\r\n\t\t.appendTo(\"body\");\r\n\tnoinput && backgroundLayer.addClass(\"noinput\");\r\n\tforceReflow();\r\n\tbackgroundLayer.css(\"opacity\", \"1\");\r\n}\r\n\r\n// Removes the overlay from the document. The overlay is already click-through during its\r\n// fade-out transition.\r\nexport function undimBackground() {\r\n\tvar backgroundLayer = $(\"body > div.\" + backgroundDimmerClass);\r\n\tif (backgroundLayer.length === 0) return;   // Not there\r\n\tvar $body = $(\"body\");\r\n\t$body.removeClass(dimmedClass);\r\n\tbackgroundLayer.addClass(\"closing\").css(\"opacity\", \"0\");\r\n\tbackgroundLayer.on(\"transitionend\", function () {\r\n\t\tif (!$body.hasClass(dimmedClass)) {\r\n\t\t\t// No other layer appeared in the meantime\r\n\t\t\t$body.removeClass(dimmingClass);\r\n\t\t}\r\n\t\tbackgroundLayer.remove();\r\n\t});\r\n}\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\nimport { dimBackground, undimBackground } from \"../dimmer\";\r\n\r\nvar modalEventNamespace = \".ff-modal\";\r\nvar modalClass = \"ff-modal-container\";\r\nvar modalCloseButtonClass = \"ff-modal-close-button\";\r\n\r\n// Defines default options for the modal plugin.\r\nvar modalDefaults = {\r\n\t// Indicates whether the modal is closed when clicking anywhere outside of it or pressing Esc.\r\n\t// This also shows a close button in the model overlay. Default: true.\r\n\tcancellable: true,\r\n\t\r\n\t// The tooltip text for the close button. Default: empty.\r\n\tcloseTooltip: \"\",\r\n\t\r\n\t// Indicates whether the page background is dimmed while the modal is open. Default: true.\r\n\tdimBackground: true\r\n};\r\n\r\n// Opens a modal with the selected element.\r\nfunction modal(options) {\r\n\tvar modal = this.first();\r\n\tif (modal.length === 0) return this;   // Nothing to do\r\n\tif (modal.parent().hasClass(modalClass)) return this;   // Already open\r\n\tvar opt = initOptions(\"modal\", modalDefaults, modal, {}, options);\r\n\tif (opt.dimBackground)\r\n\t\tdimBackground();\r\n\r\n\tvar container = $(\"<div/>\").addClass(modalClass).appendTo(\"body\");\r\n\tmodal.detach().appendTo(container);\r\n\tmodal.find(\":focusable\").first().focus().blur();\r\n\r\n\tpreventScrolling();\r\n\r\n\t// Prevent moving the focus out of the modal\r\n\t$(document).on(\"focusin\" + modalEventNamespace, function (event) {\r\n\t\tif ($(event.target).parents().filter(modal).length === 0) {\r\n\t\t\t// The focused element's ancestors do not include the modal, so the focus went out\r\n\t\t\t// of the modal. Bring it back.\r\n\t\t\tmodal.find(\":focusable\").first().focus();\r\n\t\t\tevent.preventDefault();\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\tvar closeButton;\r\n\tif (opt.cancellable) {\r\n\t\t// Close on pressing the Escape key or clicking outside the modal\r\n\t\t$(document).on(\"keydown\" + modalEventNamespace, function (event) {\r\n\t\t\tif (event.keyCode === 27) {   // Escape\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tmodal.modal.close();\r\n\t\t\t}\r\n\t\t});\r\n\t\tcontainer.click(function (event) {\r\n\t\t\tif (event.button === 0 && event.target === this) {\r\n\t\t\t\tmodal.modal.close();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Add default close button\r\n\t\tcloseButton = $(\"<a/>\").addClass(modalCloseButtonClass).attr(\"href\", \"#\").appendTo(modal);\r\n\t\tif (opt.closeTooltip)\r\n\t\t\tcloseButton[0].title = opt.closeTooltip;\r\n\t\tcloseButton.click(function (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tmodal.modal.close();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n// Closes the selected modal.\r\nfunction closeModal() {\r\n\tvar modal = this.first();\r\n\tif (modal.length === 0) return this;   // Nothing to do\r\n\tvar container = modal.parent();\r\n\tif (!container.hasClass(modalClass)) return this;   // Modal is not open\r\n\tvar opt = loadOptions(\"modal\", modal);\r\n\tvar closeButton = modal.find(\".\" + modalCloseButtonClass).first();\r\n\r\n\tpreventScrolling(false);\r\n\t$(document).off(\"focusin\" + modalEventNamespace);\r\n\t$(document).off(\"keydown\" + modalEventNamespace);\r\n\tmodal.detach().appendTo(\"body\");\r\n\tcontainer.remove();\r\n\tif (closeButton)\r\n\t\tcloseButton.remove();\r\n\tif (opt.dimBackground)\r\n\t\tundimBackground();\r\n\treturn this;\r\n}\r\n\r\nregisterPlugin(\"modal\", modal, {\r\n\tclose: closeModal\r\n});\r\n$.fn.modal.defaults = modalDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\nimport { dimBackground, undimBackground } from \"../dimmer\";\r\n\r\nvar offCanvasEventNamespace = \".ff-off-canvas\";\r\nvar offCanvasClass = \"ff-off-canvas\";\r\n\r\n// Defines default options for the off-canvas plugin.\r\nvar offCanvasDefaults = {\r\n\t// Indicates whether the user can close the off-canvas panel by clicking anywhere outside of it or pressing the Escape key. Default: true.\r\n\tcancellable: true,\r\n\r\n\t// The side from which the off-canvas opens (left, right). Default: left.\r\n\tedge: \"left\",\r\n\r\n\t// Push the page content to the side when showing the off-canvas panel. Default: 1.\r\n\t// 0 doesn't push, 1 pushes the full panel width.\r\n\tpush: 1\r\n};\r\n\r\n// Opens an off-canvas with the selected element.\r\nfunction offCanvas(options) {\r\n\tvar offCanvas = this.first();\r\n\tif (offCanvas.length === 0) return this;   // Nothing to do\r\n\tif (offCanvas.hasClass(offCanvasClass)) return this;   // Already open\r\n\tvar opt = initOptions(\"offCanvas\", offCanvasDefaults, offCanvas, {}, options);\r\n\r\n\toffCanvas.addClass(offCanvasClass);\r\n\toffCanvas.detach().appendTo(\"body\");\r\n\r\n\tif ([\"left\", \"right\"].indexOf(opt.edge) === -1)\r\n\t\topt.edge = \"left\";\r\n\tif (opt.edge === \"left\") opt._opposite = \"right\";\r\n\telse if (opt.edge === \"right\") opt._opposite = \"left\";\r\n\r\n\tvar html = $(\"html\");\r\n\tvar width = offCanvas.outerWidth();\r\n\r\n\topt._htmlStyle = {\r\n\t\ttransition: html.css(\"transition\"),\r\n\t\toverflowX: html.css(\"overflow-x\")\r\n\t};\r\n\r\n\t$(window).on(\"resize\" + offCanvasEventNamespace, function () {\r\n\t\toffCanvas.offCanvas.close();\r\n\t});\r\n\r\n\t//$(window).on(\"resize\" + offCanvasEventNamespace, function () {   // TODO Failing workaround for Chrome/Android, see https://bugs.chromium.org/p/chromium/issues/detail?id=801621\r\n\t//\toffCanvas.css(\"height\", $(window).height());\r\n\t//});\r\n\t//offCanvas.css(\"height\", $(window).height());\r\n\r\n\t// Initialise position\r\n\toffCanvas.css(opt.edge, -width);\r\n\toffCanvas.css(opt._opposite, \"\");\r\n\tforceReflow();\r\n\toffCanvas.css(\"transition\", opt.edge + \" 0.4s\");\r\n\thtml.css(\"transition\", \"margin 0.4s\");\r\n\thtml.css(\"overflow-x\", \"hidden\");\r\n\r\n\t// Now start the transition to the opened state\r\n\toffCanvas.css(opt.edge, 0);\r\n\thtml.css(\"margin-\" + opt.edge, width * opt.push);\r\n\thtml.css(\"margin-\" + opt._opposite, -width * opt.push);\r\n\r\n\tdimBackground(true);\r\n\r\n\toffCanvas.find(\":focusable\").first().focus().blur();\r\n\r\n\tpreventScrolling();\r\n\r\n\t// Prevent moving the focus out of the offCanvas\r\n\t$(document).on(\"focusin\" + offCanvasEventNamespace, function (event) {\r\n\t\tif ($(event.target).parents().filter(offCanvas).length === 0) {\r\n\t\t\t// The focused element's ancestors do not include the offCanvas, so the focus went out\r\n\t\t\t// of the offCanvas. Bring it back.\r\n\t\t\toffCanvas.find(\":focusable\").first().focus();\r\n\t\t\tevent.preventDefault();\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\t// Close on pressing the Escape key or clicking outside the offCanvas\r\n\tif (opt.cancellable) {\r\n\t\t$(document).on(\"keydown\" + offCanvasEventNamespace, function (event) {\r\n\t\t\tif (event.keyCode === 27) {   // Escape\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\toffCanvas.offCanvas.close();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsetTimeout(function () {\r\n\t\t\t$(document).on(\"click\" + offCanvasEventNamespace, function (event) {\r\n\t\t\t\tif (event.button === 0) {\r\n\t\t\t\t\toffCanvas.offCanvas.close();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}, 20);\r\n\t\toffCanvas.on(\"click\" + offCanvasEventNamespace, function (event) {\r\n\t\t\t// Don't close the off-canvas when clicking inside of it\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t});\r\n\t}\r\n\r\n\toffCanvas.trigger(\"offcanvasopen\");\r\n\treturn this;\r\n}\r\n\r\n// Closes the selected off-canvas.\r\nfunction closeOffCanvas() {\r\n\tvar offCanvas = this.first();\r\n\tif (offCanvas.length === 0) return this;   // Nothing to do\r\n\tif (!offCanvas.hasClass(offCanvasClass)) return this;   // offCanvas is not open\r\n\tvar opt = loadOptions(\"offCanvas\", offCanvas);\r\n\r\n\tvar html = $(\"html\");\r\n\tvar width = offCanvas.outerWidth();\r\n\r\n\t// Start the transition back to the closed state\r\n\toffCanvas.css(opt.edge, -width);\r\n\thtml.css(\"margin-\" + opt.edge, 0);\r\n\thtml.css(\"margin-\" + opt._opposite, 0);\r\n\r\n\tpreventScrolling(false);\r\n\t$(document).off(\"focusin\" + offCanvasEventNamespace);\r\n\t$(document).off(\"keydown\" + offCanvasEventNamespace);\r\n\t$(document).off(\"click\" + offCanvasEventNamespace);\r\n\t$(window).off(\"resize\" + offCanvasEventNamespace);\r\n\toffCanvas.off(\"click\" + offCanvasEventNamespace);\r\n\tundimBackground();\r\n\toffCanvas.one(\"transitionend\", function () {\r\n\t\toffCanvas.removeClass(offCanvasClass);\r\n\t\thtml.css(opt._htmlStyle);\r\n\t});\r\n\toffCanvas.trigger(\"offcanvasclose\");\r\n\treturn this;\r\n}\r\n\r\nregisterPlugin(\"offCanvas\", offCanvas, {\r\n\tclose: closeOffCanvas\r\n});\r\n$.fn.offCanvas.defaults = offCanvasDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, installDisabledchangeHook } from \"../util\";\r\n\r\nvar resizableClass = \"ff-resizable\";\r\n\r\n// Defines default options for the resizable plugin.\r\nvar resizableDefaults = {\r\n\t// The aspect ratio (x/y) to maintain during resizing, or true to maintain the initial aspect ratio. Default: None.\r\n\taspectRatio: undefined,\r\n\r\n\t// The resizing handles to use. Can be \"all\" or a combination of \"n,ne,e,se,s,sw,w,nw\". Default: All.\r\n\thandles: undefined,\r\n\r\n\t// Constrains the resizing inside the specified element or the \"parent\" of the resized element. Default: None.\r\n\tcontainment: undefined,\r\n\r\n\t// The grid to snap the resized element to during resizing, as [x, y] in pixels. Default: [1, 1].\r\n\tgrid: undefined,\r\n\r\n\t// The minimum width to keep during resizing. Default: None.\r\n\tminWidth: undefined,\r\n\r\n\t// The minimum height to keep during resizing. Default: None.\r\n\tminHeight: undefined,\r\n\r\n\t// The maximum width to keep during resizing. Default: None.\r\n\tmaxWidth: undefined,\r\n\r\n\t// The maximum height to keep during resizing. Default: None.\r\n\tmaxHeight: undefined\r\n};\r\n\r\n// Makes each selected element resizable.\r\nfunction resizable(options) {\r\n\treturn this.each(function () {\r\n\t\tvar elem = this;\r\n\t\tvar $elem = $(elem);\r\n\t\tif ($elem.hasClass(resizableClass)) return;   // Already done\r\n\t\t$elem.addClass(resizableClass);\r\n\t\tvar htmlCursor;\r\n\t\tvar handleElements = $();\r\n\t\tvar opt = initOptions(\"resizable\", resizableDefaults, $elem, {}, options);\r\n\r\n\t\tvar aspectRatio = opt.aspectRatio;\r\n\t\tif (aspectRatio === true || aspectRatio === \"true\") aspectRatio = $elem.outerWidth() / $elem.outerHeight();\r\n\t\tif ($.isNumeric(aspectRatio)) aspectRatio = parseFloat(aspectRatio);\r\n\t\tif (aspectRatio === 0 || !isFinite(aspectRatio) || !$.isNumber(aspectRatio)) aspectRatio = undefined;\r\n\r\n\t\tif ($elem.css(\"position\") === \"static\")\r\n\t\t\t$elem.css(\"position\", \"relative\");\r\n\r\n\t\tvar optHandles = opt.handles;\r\n\t\tif (optHandles === undefined)\r\n\t\t\toptHandles = \"all\";\r\n\t\tif (optHandles === \"all\")\r\n\t\t\toptHandles = \"n,ne,e,se,s,sw,w,nw\";\r\n\t\tif ($.isString(optHandles))\r\n\t\t\toptHandles = optHandles.replace(/\\s/g, \"\").toLowerCase().split(\",\");\r\n\t\topt.handles = optHandles;\r\n\r\n\t\tvar vCursor = \"ns-resize\";\r\n\t\tvar hCursor = \"ew-resize\";\r\n\t\tvar nwCursor = \"nwse-resize\";\r\n\t\tvar neCursor = \"nesw-resize\";\r\n\r\n\t\tif (opt.handleAddClass === \"box\") {\r\n\t\t\tif (optHandles.indexOf(\"n\") !== -1)\r\n\t\t\t\taddHandle({ left: \"calc(50% - 4px)\", top: -9 }, vCursor, true, true);   // Top edge\r\n\t\t\tif (optHandles.indexOf(\"e\") !== -1)\r\n\t\t\t\taddHandle({ right: -9, top: \"calc(50% - 4px)\" }, hCursor, false, false);   // Right edge\r\n\t\t\tif (optHandles.indexOf(\"s\") !== -1)\r\n\t\t\t\taddHandle({ left: \"calc(50% - 4px)\", bottom: -9 }, vCursor, true, false);   // Bottom edge\r\n\t\t\tif (optHandles.indexOf(\"w\") !== -1)\r\n\t\t\t\taddHandle({ left: -9, top: \"calc(50% - 4px)\" }, hCursor, false, true);   // Left edge\r\n\r\n\t\t\tif (optHandles.indexOf(\"ne\") !== -1)\r\n\t\t\t\taddHandle({ top: -9, right: -9 }, neCursor, false, false, true, true);   // Top right corner\r\n\t\t\tif (optHandles.indexOf(\"se\") !== -1)\r\n\t\t\t\taddHandle({ bottom: -9, right: -9 }, nwCursor, false, false, true, false);   // Bottom right corner\r\n\t\t\tif (optHandles.indexOf(\"sw\") !== -1)\r\n\t\t\t\taddHandle({ bottom: -9, left: -9 }, neCursor, false, true, true, false);   // Bottom left corner\r\n\t\t\tif (optHandles.indexOf(\"nw\") !== -1)\r\n\t\t\t\taddHandle({ top: -9, left: -9 }, nwCursor, false, true, true, true);   // Top left corner\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (optHandles.indexOf(\"n\") !== -1)\r\n\t\t\t\taddHandle({ left: 5, right: 5, top: -5, height: 10 }, vCursor, true, true);   // Top edge\r\n\t\t\tif (optHandles.indexOf(\"e\") !== -1)\r\n\t\t\t\taddHandle({ top: 5, bottom: 5, right: -5, width: 10 }, hCursor, false, false);   // Right edge\r\n\t\t\tif (optHandles.indexOf(\"s\") !== -1)\r\n\t\t\t\taddHandle({ left: 5, right: 5, bottom: -5, height: 10 }, vCursor, true, false);   // Bottom edge\r\n\t\t\tif (optHandles.indexOf(\"w\") !== -1)\r\n\t\t\t\taddHandle({ top: 5, bottom: 5, left: -5, width: 10 }, hCursor, false, true);   // Left edge\r\n\r\n\t\t\tif (optHandles.indexOf(\"ne\") !== -1)\r\n\t\t\t\taddHandle({ right: -5, top: -5, width: 10, height: 10 }, neCursor, false, false, true, true);   // Top right corner\r\n\t\t\tif (optHandles.indexOf(\"se\") !== -1)\r\n\t\t\t\taddHandle({ right: -5, bottom: -5, width: 10, height: 10 }, nwCursor, false, false, true, false);   // Bottom right corner\r\n\t\t\tif (optHandles.indexOf(\"sw\") !== -1)\r\n\t\t\t\taddHandle({ left: -5, bottom: -5, width: 10, height: 10 }, neCursor, false, true, true, false);   // Bottom left corner\r\n\t\t\tif (optHandles.indexOf(\"nw\") !== -1)\r\n\t\t\t\taddHandle({ left: -5, top: -5, width: 10, height: 10 }, nwCursor, false, true, true, true);   // Top left corner\r\n\t\t}\r\n\r\n\t\tinstallDisabledchangeHook();\r\n\t\t$elem.on(\"disabledchange\", function () {\r\n\t\t\thandleElements.visible(!$elem.disabled());\r\n\t\t});\r\n\r\n\t\tfunction addHandle(style, cursor, vertical, negative, vertical2, negative2) {\r\n\t\t\tvar handle = $(\"<div/>\")\r\n\t\t\t\t.addClass(\"ff-resizable-handle \" + opt.handleAddClass)\r\n\t\t\t\t.css(style)\r\n\t\t\t\t.css(\"position\", \"absolute\")\r\n\t\t\t\t.css(\"cursor\", cursor);\r\n\t\t\t$elem.append(handle);\r\n\t\t\thandleElements = handleElements.add(handle);\r\n\t\t\thandle.draggable();\r\n\t\t\thandle.on(\"draggablestart\", function (event) {\r\n\t\t\t\thtmlCursor = document.documentElement.style.getPropertyValue(\"cursor\");\r\n\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", cursor, \"important\");\r\n\t\t\t});\r\n\t\t\thandle.on(\"draggablemove\", function (event) {\r\n\t\t\t\tevent.preventDefault();   // The handles already move with the element, don't touch their position\r\n\t\t\t\tresize(handle, event.newPoint, vertical, negative);\r\n\t\t\t\tif (vertical2 !== undefined)\r\n\t\t\t\t\tresize(handle, event.newPoint, vertical2, negative2);\r\n\t\t\t});\r\n\t\t\thandle.on(\"draggableend\", function (event) {\r\n\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", htmlCursor);\r\n\t\t\t});\r\n\t\t\treturn handle;\r\n\t\t}\r\n\r\n\t\tfunction resize(handle, newPoint, vertical, negative) {\r\n\t\t\tvar side = vertical ? \"top\" : \"left\";\r\n\t\t\tvar extent = vertical ? \"Height\" : \"Width\";\r\n\t\t\tvar extentLower = extent.toLowerCase();\r\n\t\t\tvar delta = newPoint[side] - handle.offset()[side];\r\n\t\t\tif (negative) delta = -delta;\r\n\r\n\t\t\tvar newElemOffset = $elem.offset();\r\n\t\t\tvar step = opt.grid ? opt.grid[vertical ? 1 : 0] : 1;\r\n\r\n\t\t\tif (opt.grid) {\r\n\t\t\t\tlet gridBase = $elem.parent().offset();\r\n\t\t\t\tif (negative) {\r\n\t\t\t\t\tdelta = newElemOffset[side] - (Math.round(((newElemOffset[side] - delta) - gridBase[side]) / step) * step + gridBase[side]);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlet length = $elem[\"outer\" + extent]();\r\n\t\t\t\t\tdelta = Math.round(((newElemOffset[side] + length + delta) - gridBase[side]) / step) * step + gridBase[side] - (newElemOffset[side] + length);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar newLength = $elem[\"outer\" + extent]() + delta;\r\n\r\n\t\t\tlet minLength = Math.max($elem[\"outer\" + extent]() - $elem[extentLower](), opt[\"min\" + extent] || 0);\r\n\t\t\twhile (newLength < minLength) {\r\n\t\t\t\tdelta += step;\r\n\t\t\t\tnewLength += step;\r\n\t\t\t}\r\n\t\t\tlet maxLength = opt[\"max\" + extent];\r\n\t\t\twhile (maxLength && newLength > maxLength) {\r\n\t\t\t\tdelta -= step;\r\n\t\t\t\tnewLength -= step;\r\n\t\t\t}\r\n\r\n\t\t\tif (negative) newElemOffset[side] -= delta;\r\n\r\n\t\t\tif (opt.containment) {\r\n\t\t\t\tlet cont;\r\n\t\t\t\tif (opt.containment === \"parent\")\r\n\t\t\t\t\tcont = $elem.parent();\r\n\t\t\t\telse\r\n\t\t\t\t\tcont = $(opt.containment);\r\n\t\t\t\tif (cont.length !== 0) {\r\n\t\t\t\t\tlet contRect = cont.rect();\r\n\t\t\t\t\tif (negative) {\r\n\t\t\t\t\t\twhile (newElemOffset[side] < contRect[side]) {\r\n\t\t\t\t\t\t\tnewElemOffset[side] += step;\r\n\t\t\t\t\t\t\tdelta -= step;\r\n\t\t\t\t\t\t\tnewLength -= step;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\twhile (newElemOffset[side] + newLength > contRect[side] + contRect[extentLower]) {\r\n\t\t\t\t\t\t\tdelta -= step;\r\n\t\t\t\t\t\t\tnewLength -= step;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t$elem[\"outer\" + extent](newLength);\r\n\t\t\tif (negative) $elem.offset(newElemOffset);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"resizable\", resizable);\r\n$.fn.resizable.defaults = resizableDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, installDisabledchangeHook } from \"../util\";\r\n\r\nvar rangeClass = \"ff-range\";\r\nvar ticksClass = \"ff-ticks\";\r\nvar handleClass = \"ff-handle\";\r\nvar resetAllCursorsClass = \"reset-all-cursors\";\r\n\r\n// Defines default options for the slider plugin.\r\nvar sliderDefaults = {\r\n\t// The orientation of the slider, either \"h\" or \"v\". Default: \"h\".\r\n\torientation: \"h\",\r\n\r\n\t// The current value of the slider. Default: 0.\r\n\tvalue: 0,\r\n\r\n\t// The current values of the slider. Overrides the single value option. Default: null.\r\n\tvalues: null,\r\n\r\n\t// The minimum value of the slider range. Default: 0.\r\n\tmin: 0,\r\n\r\n\t// The maximum value of the slider range. Default: 100.\r\n\tmax: 100,\r\n\r\n\t// The base value of the range rectangle (\"min\", \"max\", any value e.g. 0). Default: \"min\".\r\n\trangeBase: 0,\r\n\r\n\t// The large step of the slider. Default: 10.\r\n\tlargeStep: 10,\r\n\r\n\t// The small step of the slider. Default: 1.\r\n\tsmallStep: 1,\r\n\r\n\t// Indicates whether the large step ticks are visible. Default: true.\r\n\tlargeTicks: true,\r\n\r\n\t// Indicates whether the small step ticks are visible. Default: false.\r\n\tsmallTicks: false,\r\n\r\n\t// Indicates whether the large step ticks have their value as label. Default: true.\r\n\tlargeTickLabels: true,\r\n\r\n\t// Indicates whether the small step ticks have their value as label. Default: false.\r\n\tsmallTickLabels: false,\r\n\r\n\t// The location of the tick marks in the slider (\"topleft\", \"bottomright\", \"both\", \"none\"). Default: \"topleft\".\r\n\ttickPlacement: \"topleft\",\r\n\r\n\t// The number of slider handles. Default: 1.\r\n\thandleCount: 1,\r\n\r\n\t// How multiple handles interact with each other while dragging (\"locked\", \"push\", \"free\"). Default: \"locked\".\r\n\thandleInteractionMode: \"locked\",\r\n\r\n\t// Overflow the range if the two handles have the same value. Default: false.\r\n\trangeOverflowEqual: false,\r\n\r\n\t// Individual ranges. Overrides the rangeBase option and two-handle range behaviour. Default: null.\r\n\t// Each range object has the properties: start, end, overflowEqual, color, className.\r\n\t// start and end can be fixed values, \"min\"/\"max\", or zero-based handle references prefixed with \"#\".\r\n\tranges: null,\r\n\r\n\t// Indicates whether the slider has a logarithmic scale. Default: false.\r\n\tlogarithmic: false,   // TODO\r\n\r\n\t// The mouse cursor to show during dragging the slider. Default: None.\r\n\tdragCursor: undefined\r\n};\r\n\r\n// Creates a slider widget.\r\nfunction slider(options) {\r\n\treturn this.each(function () {\r\n\t\tvar slider = $(this);\r\n\t\tif (slider.children(\"div.\" + handleClass).length !== 0) return;   // Already done\r\n\t\tvar opt = initOptions(\"slider\", sliderDefaults, slider, {}, options);\r\n\t\tvar htmlCursor, draggedHandleCursor;\r\n\t\tvar dragHandleOffset = [], dragHandlePointerId = [];\r\n\t\tvar lastTouchedHandleIndex = 0;\r\n\t\tvar isVertical = opt.orientation === \"v\";\r\n\t\tvar sliderBorder;\r\n\t\tvar initialTabindex;\r\n\r\n\t\topt._setValue = setValue;\r\n\r\n\t\tif (!opt.values) opt.values = [opt.value];\r\n\t\tif (opt.max < opt.min) opt.max = opt.min;\r\n\t\tif (opt.handleCount < 1) opt.handleCount = 1;\r\n\r\n\t\t// Create 1 pair of ranges by default; more only if individually specified\r\n\t\tvar ranges = [];\r\n\t\tfor (let index = 0; index < Math.max(1, opt.ranges && opt.ranges.length); index++) {\r\n\t\t\tranges[index * 2] = $(\"<div/>\").addClass(rangeClass).appendTo(slider);\r\n\t\t\tranges[index * 2 + 1] = $(\"<div/>\").addClass(rangeClass).appendTo(slider);\r\n\t\t}\r\n\t\tif (opt.ranges) {\r\n\t\t\topt.ranges.forEach(function (rangeItem, index) {\r\n\t\t\t\tif (rangeItem.color) {\r\n\t\t\t\t\tranges[index * 2].css(\"background\", rangeItem.color);\r\n\t\t\t\t\tranges[index * 2 + 1].css(\"background\", rangeItem.color);\r\n\t\t\t\t}\r\n\t\t\t\tif (rangeItem.className) {\r\n\t\t\t\t\tranges[index * 2].addClass(rangeItem.className);\r\n\t\t\t\t\tranges[index * 2 + 1].addClass(rangeItem.className);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Create ticks layer, it will contain the actual ticks with their labels\r\n\t\tvar ticks = $(\"<div/>\").addClass(ticksClass).appendTo(slider);\r\n\r\n\t\t// Create handles\r\n\t\t// Also keep them in a jQuery collection to add events to\r\n\t\tvar handles = [], $handles = $();\r\n\t\tfor (let index = 0; index < opt.handleCount; index++) {\r\n\t\t\thandles[index] = $(\"<div/>\").addClass(handleClass).appendTo(slider);\r\n\t\t\t$handles = $handles.add(handles[index]);\r\n\t\t}\r\n\r\n\t\t// Use precision to avoid ugly JavaScript floating point rounding issues\r\n\t\t// (like 35 * 0.01 = 0.35000000000000003)\r\n\t\tvar decimals = -Math.floor(Math.log10(opt.smallStep));\r\n\r\n\t\tvar rangeBaseValue = opt.rangeBase;\r\n\t\tif (rangeBaseValue === \"min\") rangeBaseValue = opt.min;\r\n\t\tif (rangeBaseValue === \"max\") rangeBaseValue = opt.max;\r\n\t\trangeBaseValue = minmax(rangeBaseValue, opt.min, opt.max);\r\n\t\tvar rangeBasePos = Math.round((rangeBaseValue - opt.min) / (opt.max - opt.min) * 10000) / 100;\r\n\r\n\t\tvar startAttr, endAttr;\r\n\t\tvar handleLength;   // Length of the handle in drag direction\r\n\r\n\t\tif (isVertical) {\r\n\t\t\tstartAttr = \"bottom\";\r\n\t\t\tendAttr = \"top\";\r\n\t\t\tslider.addClass(\"vertical\");\r\n\t\t\tsliderBorder = (slider.outerHeight() - slider.innerHeight()) / 2;\r\n\t\t\thandleLength = handles[0].outerHeight();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstartAttr = \"left\";\r\n\t\t\tendAttr = \"right\";\r\n\t\t\tslider.removeClass(\"vertical\");\r\n\t\t\tsliderBorder = (slider.outerWidth() - slider.innerWidth()) / 2;\r\n\t\t\thandleLength = handles[0].outerWidth();\r\n\t\t}\r\n\t\tfor (let index = 0; index < opt.handleCount; index++) {\r\n\t\t\tresetDragHandleOffset(index);\r\n\t\t\tsetValue(index, opt.values[index]);\r\n\t\t}\r\n\r\n\t\t// Draw ticks\r\n\t\tif (opt.smallTicks || opt.largeTicks) {\r\n\t\t\tvar minTick = Math.ceil(opt.min / opt.smallStep) * opt.smallStep;\r\n\t\t\tfor (let value = minTick; value <= opt.max; value += opt.smallStep) {\r\n\t\t\t\tvalue = round(value, decimals);\r\n\t\t\t\tlet large = value / opt.largeStep === Math.trunc(value / opt.largeStep);\r\n\t\t\t\tif (!large && !opt.smallTicks) continue;\r\n\r\n\t\t\t\tlet pos = Math.round((value - opt.min) / (opt.max - opt.min) * 10000) / 100;\r\n\t\t\t\tlet tickArr = $();\r\n\t\t\t\tif (opt.tickPlacement === \"both\" || opt.tickPlacement === \"topleft\") {\r\n\t\t\t\t\ttickArr = tickArr.add($(\"<div/>\").css(startAttr, pos + \"%\").appendTo(ticks));\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.tickPlacement === \"both\" || opt.tickPlacement === \"bottomright\") {\r\n\t\t\t\t\ttickArr = tickArr.add($(\"<div/>\").addClass(\"opposite\").css(startAttr, pos + \"%\").appendTo(ticks));\r\n\t\t\t\t}\r\n\t\t\t\tif (large) {\r\n\t\t\t\t\ttickArr.addClass(\"large\");\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.smallTickLabels || opt.largeTickLabels && large) {\r\n\t\t\t\t\ttickArr.attr(\"data-label\", value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Allow Pointer API to work properly in Edge\r\n\t\tslider.css(\"touch-action\", \"none\");\r\n\r\n\t\tvar eventRemovers = [];\r\n\t\t$handles.pointer(\"down\", function (event) {\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\t// Select touched handle\r\n\t\t\tvar handle = $(event.target).closest(\".\" + handleClass);\r\n\t\t\tvar index = $.inArray(handle[0], $handles);\r\n\t\t\tif (index === -1) {\r\n\t\t\t\tconsole.warn(\"Clicked handle not found\");\r\n\t\t\t\treturn;   // Should not happen: handle not found\r\n\t\t\t}\r\n\r\n\t\t\t// Remember where the handle was dragged (probably not exactly the center)\r\n\t\t\tif (isVertical)\r\n\t\t\t\tdragHandleOffset[index] = handles[index].offset().top + handles[index].outerHeight() - event.pageY;\r\n\t\t\telse\r\n\t\t\t\tdragHandleOffset[index] = event.pageX - handles[index].offset().left;\r\n\r\n\t\t\tdraggedHandleCursor = handles[index].actualCursor();\r\n\t\t});\r\n\t\tslider.pointer(\"down\", function (event) {\r\n\t\t\tif (slider.disabled()) return;\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tslider.focus();\r\n\r\n\t\t\t\tvar isFirstDrag = true;\r\n\t\t\t\tdragHandlePointerId.forEach(function (item) {\r\n\t\t\t\t\tif (item !== undefined) isFirstDrag = false;\r\n\t\t\t\t});\r\n\t\t\t\tif (isFirstDrag)\r\n\t\t\t\t\tslider.trigger(\"firstdragstart\");\r\n\r\n\t\t\t\t// Select touched or nearest handle and remember by pointerId\r\n\t\t\t\tvar handle = $(event.target).closest(\".\" + handleClass);\r\n\t\t\t\tvar index = $.inArray(handle[0], $handles);\r\n\t\t\t\tif (index === -1) {\r\n\t\t\t\t\t// Not clicked on a handle.\r\n\t\t\t\t\t// Find nearest handle, prefer same direction (for locked handles on the same value)\r\n\t\t\t\t\tvar pointerValue = getValueFromEvent(event);\r\n\t\t\t\t\tvar minValueDistance = Infinity;\r\n\t\t\t\t\topt.values.forEach(function (value, valueIndex) {\r\n\t\t\t\t\t\tvar valueDistance = Math.abs(value - pointerValue);\r\n\t\t\t\t\t\tif (valueDistance < minValueDistance ||\r\n\t\t\t\t\t\t\tpointerValue > value && valueDistance <= minValueDistance) {\r\n\t\t\t\t\t\t\tminValueDistance = valueDistance;\r\n\t\t\t\t\t\t\tindex = valueIndex;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tdragHandlePointerId[index] = event.pointerId;\r\n\t\t\t\tlastTouchedHandleIndex = index;\r\n\r\n\t\t\t\thandles[index].addClass(\"pressed\");\r\n\t\t\t\tonMove(event);\r\n\r\n\t\t\t\tif (isFirstDrag) {\r\n\t\t\t\t\tslider.setCapture && slider.setCapture();   // Firefox only (set cursor over entire desktop)\r\n\t\t\t\t\t$(\"html\").addClass(resetAllCursorsClass);   // All browsers (set cursor at least within page)\r\n\t\t\t\t\thtmlCursor = document.documentElement.style.getPropertyValue(\"cursor\");\r\n\t\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", opt.dragCursor || draggedHandleCursor || slider.actualCursor(), \"important\");\r\n\r\n\t\t\t\t\teventRemovers.push($(window).pointer(\"move\", onMove, true));\r\n\t\t\t\t\teventRemovers.push($(window).pointer(\"up cancel\", onEnd, true));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Make the element focusable if not already specified\r\n\t\tinitialTabindex = slider.attr(\"tabindex\");\r\n\t\tif (initialTabindex === undefined) {\r\n\t\t\tinitialTabindex = \"0\";\r\n\t\t\tslider.attr(\"tabindex\", initialTabindex);\r\n\t\t}\r\n\r\n\t\t// Make the element unfocusable when disabled\r\n\t\tinstallDisabledchangeHook();\r\n\t\tslider.on(\"disabledchange\", function () {\r\n\t\t\tif (slider.disabled()) {\r\n\t\t\t\tslider.removeAttr(\"tabindex\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tslider.attr(\"tabindex\", initialTabindex);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tslider.keydown(onKeydown);\r\n\r\n\t\t// TODO: Trigger \"remove\" event for DOM elements being removed, like jQuery UI overrides $.cleanData (once!)\r\n\t\t// TODO: slider.on(\"remove\", /* cancel current drag operation and remove all events */) - also in other widgets!\r\n\r\n\t\tfunction onMove(event) {\r\n\t\t\t// Select dragged handle from pointerId\r\n\t\t\tvar index = dragHandlePointerId.indexOf(event.pointerId);\r\n\t\t\tif (index === -1) return;   // Not my pointer\r\n\r\n\t\t\tvar value = getValueFromEvent(event);\r\n\r\n\t\t\tif (opt.handleCount > 1) {\r\n\t\t\t\tswitch (opt.handleInteractionMode) {\r\n\t\t\t\t\tcase \"locked\":\r\n\t\t\t\t\t\tif (index > 0 && value < opt.values[index - 1])\r\n\t\t\t\t\t\t\tvalue = opt.values[index - 1];\r\n\t\t\t\t\t\tif (index < opt.handleCount - 1 && value > opt.values[index + 1])\r\n\t\t\t\t\t\t\tvalue = opt.values[index + 1];\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"push\":\r\n\t\t\t\t\t\tfor (let otherIndex = index - 1; otherIndex >= 0; otherIndex--) {\r\n\t\t\t\t\t\t\tif (value < opt.values[otherIndex])\r\n\t\t\t\t\t\t\t\tsetValue(otherIndex, value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (let otherIndex = index + 1; otherIndex < opt.handleCount; otherIndex++) {\r\n\t\t\t\t\t\t\tif (value > opt.values[otherIndex])\r\n\t\t\t\t\t\t\t\tsetValue(otherIndex, value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tsetValue(index, value);\r\n\t\t}\r\n\r\n\t\tfunction onEnd(event) {\r\n\t\t\t// Select dragged handle from pointerId\r\n\t\t\tvar index = dragHandlePointerId.indexOf(event.pointerId);\r\n\t\t\tif (index === -1) return;   // Not my pointer\r\n\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tdragHandlePointerId[index] = undefined;\r\n\t\t\t\thandles[index].removeClass(\"pressed\");\r\n\t\t\t\tresetDragHandleOffset(index);\r\n\r\n\t\t\t\tvar isLastDrag = true;\r\n\t\t\t\tdragHandlePointerId.forEach(function (item) {\r\n\t\t\t\t\tif (item !== undefined) isLastDrag = false;\r\n\t\t\t\t});\r\n\t\t\t\tif (isLastDrag) {\r\n\t\t\t\t\tslider.releaseCapture && slider.releaseCapture();\r\n\t\t\t\t\t$(\"html\").removeClass(resetAllCursorsClass);\r\n\t\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", htmlCursor);\r\n\r\n\t\t\t\t\teventRemovers.forEach(function (eventRemover) { eventRemover(); });\r\n\t\t\t\t\teventRemovers = [];\r\n\r\n\t\t\t\t\tslider.trigger(\"lastdragend\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onKeydown(event) {\r\n\t\t\tif (slider.disabled()) return;\r\n\t\t\tif (event.keyCode === 40 || event.keyCode === 37) {   // Down, Left\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tsetValue(lastTouchedHandleIndex, opt.values[lastTouchedHandleIndex] - (event.shiftKey ? opt.largeStep : opt.smallStep));\r\n\t\t\t}\r\n\t\t\tif (event.keyCode === 38 || event.keyCode === 39) {   // Up, Right\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tsetValue(lastTouchedHandleIndex, opt.values[lastTouchedHandleIndex] + (event.shiftKey ? opt.largeStep : opt.smallStep));\r\n\t\t\t}\r\n\t\t\tif (event.keyCode === 36) {   // Home\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tsetValue(lastTouchedHandleIndex, opt.min);\r\n\t\t\t}\r\n\t\t\tif (event.keyCode === 35) {   // End\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tsetValue(lastTouchedHandleIndex, opt.max);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Gets the slider value from the coordinates of a pointer event.\r\n\t\tfunction getValueFromEvent(event) {\r\n\t\t\t// Select dragged handle from pointerId\r\n\t\t\tvar index = dragHandlePointerId.indexOf(event.pointerId);\r\n\r\n\t\t\t// Assume center click if pointer is unknown\r\n\t\t\tvar myDragHandleOffset = handleLength / 2;\r\n\t\t\tif (index !== -1) myDragHandleOffset = dragHandleOffset[index];\r\n\r\n\t\t\tvar sliderRect = slider.rect();\r\n\t\t\tvar pointerPosIntoSlider;   // Distance from min end of the slider to the pointer\r\n\t\t\tvar sliderLength;   // Length of the slider in drag direction\r\n\t\t\tif (isVertical) {\r\n\t\t\t\tpointerPosIntoSlider = sliderRect.bottom - sliderBorder - event.pageY;\r\n\t\t\t\tsliderLength = slider.innerHeight();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tpointerPosIntoSlider = event.pageX - sliderRect.left - sliderBorder;\r\n\t\t\t\tsliderLength = slider.innerWidth();\r\n\t\t\t}\r\n\r\n\t\t\tvar handleCenterPos = pointerPosIntoSlider - myDragHandleOffset + handleLength / 2;   // Position of the handle's center\r\n\t\t\tvar value = handleCenterPos / sliderLength * (opt.max - opt.min) + opt.min;   // Selected value\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Sets a slider value and triggers the change event. Also moves the handle.\r\n\t\tfunction setValue(index, value) {\r\n\t\t\tvalue = minmax(value, opt.min, opt.max);\r\n\t\t\tvalue = Math.round(value / opt.smallStep) * opt.smallStep;   // Snap to steps\r\n\t\t\tvalue = round(value, decimals);\r\n\t\t\tmoveHandle(index, value);\r\n\t\t\tif (value !== opt.values[index]) {\r\n\t\t\t\topt.values[index] = value;\r\n\t\t\t\tslider.trigger(\"valuechange\");   // TODO: Indicate the changed value index\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Moves a handle to the specified slider value and updates the ranges.\r\n\t\tfunction moveHandle(index, value) {\r\n\t\t\tvar pos = getPosFromValue(value);\r\n\t\t\thandles[index].css(startAttr, \"calc(\" + pos + \"% - \" + (handleLength / 2) + \"px)\");\r\n\r\n\t\t\t// Also update ranges\r\n\t\t\tif (opt.ranges) {\r\n\t\t\t\topt.ranges.forEach(function (rangeItem, rangeIndex) {\r\n\t\t\t\t\tvar start = rangeItem.start, startHandleIndex;\r\n\t\t\t\t\tif (start === \"min\") {\r\n\t\t\t\t\t\tstart = opt.min;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (start === \"max\") {\r\n\t\t\t\t\t\tstart = opt.max;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (start[0] === \"#\") {\r\n\t\t\t\t\t\tstartHandleIndex = Number(start.substr(1));\r\n\t\t\t\t\t\tstart = startHandleIndex === index ? value : opt.values[startHandleIndex];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar end = rangeItem.end, endHandleIndex;\r\n\t\t\t\t\tif (end === \"min\") {\r\n\t\t\t\t\t\tend = opt.min;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (end === \"max\") {\r\n\t\t\t\t\t\tend = opt.max;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (end[0] === \"#\") {\r\n\t\t\t\t\t\tendHandleIndex = Number(end.substr(1));\r\n\t\t\t\t\t\tend = endHandleIndex === index ? value : opt.values[endHandleIndex];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar startPos = getPosFromValue(start);\r\n\t\t\t\t\tvar endPos = getPosFromValue(end);\r\n\t\t\t\t\tvar overflowEqual = rangeItem.overflowEqual ||\r\n\t\t\t\t\t\tstartHandleIndex !== undefined && endHandleIndex !== undefined && endHandleIndex < startHandleIndex;\r\n\t\t\t\t\tsetRange(rangeIndex, startPos, endPos, overflowEqual);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse if (opt.handleCount === 1) {\r\n\t\t\t\tif (pos < rangeBasePos)\r\n\t\t\t\t\tsetRange(0, pos, rangeBasePos);\r\n\t\t\t\telse\r\n\t\t\t\t\tsetRange(0, rangeBasePos, pos);\r\n\t\t\t}\r\n\t\t\telse if (opt.handleCount === 2) {\r\n\t\t\t\tvar pos0 = index === 0 ? pos : getPosFromValue(opt.values[0]);\r\n\t\t\t\tvar pos1 = index === 1 ? pos : getPosFromValue(opt.values[1]);\r\n\t\t\t\tsetRange(0, pos0, pos1, opt.rangeOverflowEqual);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Sets the size of a range element for a start and end value, supporting overflow.\r\n\t\tfunction setRange(index, start, end, overflowEqual) {\r\n\t\t\tif (start < end || start === end && !overflowEqual) {\r\n\t\t\t\t// Only one contiguous range, hide the second element\r\n\t\t\t\tranges[index * 2].css(startAttr, start + \"%\");\r\n\t\t\t\tranges[index * 2].css(endAttr, (100 - end) + \"%\");\r\n\t\t\t\tranges[index * 2 + 1].css(startAttr, \"0%\");\r\n\t\t\t\tranges[index * 2 + 1].css(endAttr, \"100%\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Overflow range, split in two elements from either end of the slider\r\n\t\t\t\tranges[index * 2].css(startAttr, \"0%\");\r\n\t\t\t\tranges[index * 2].css(endAttr, (100 - end) + \"%\");\r\n\t\t\t\tranges[index * 2 + 1].css(startAttr, start + \"%\");\r\n\t\t\t\tranges[index * 2 + 1].css(endAttr, \"0%\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Returns the relative position in percent from the slider value.\r\n\t\tfunction getPosFromValue(value) {\r\n\t\t\tvar pos = Math.round((value - opt.min) / (opt.max - opt.min) * 10000) / 100;\r\n\t\t\treturn pos;\r\n\t\t}\r\n\r\n\t\t// Resets the drag offset as if the handle was dragged exactly in the middle.\r\n\t\tfunction resetDragHandleOffset(index) {\r\n\t\t\tdragHandleOffset[index] = handleLength / 2;\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Gets the current slider value.\r\n// value: Sets the slider value.\r\nfunction sliderValue(value) {\r\n\treturn this.slider.multivalue(0, value);\r\n}\r\n\r\n// Gets the current value of the specified slider handle.\r\n// value: Sets the value of the specified slider handle.\r\nfunction sliderMultiValue(index, value) {\r\n\t// Getter\r\n\tif (value === undefined) {\r\n\t\tvar slider = this.first();\r\n\t\tif (slider.length === 0) return;   // Nothing to do\r\n\t\tvar opt = loadOptions(\"slider\", slider);\r\n\t\treturn opt.values[index];\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar slider = $(this);\r\n\t\tvar opt = loadOptions(\"slider\", slider);\r\n\t\topt._setValue(index, value);\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"slider\", slider, {\r\n\tvalue: sliderValue,\r\n\tmultivalue: sliderMultiValue\r\n});\r\n$.fn.slider.defaults = sliderDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar sortableClass = \"ff-sortable\";\r\nvar sortablePlaceholderClass = \"ff-sortable-placeholder\";\r\n\r\n// Defines default options for the draggable plugin.\r\nvar sortableDefaults = {\r\n\t// The element(s) that can start a drag operation. Default: The element to drag.\r\n\thandle: undefined,\r\n\r\n\t// The element(s) that cannot start a drag operation. Default: None.\r\n\tcancel: undefined,\r\n\r\n\t// Constrains the drag movement along the \"x\" or \"y\" axis. Default: None.\r\n\taxis: undefined,\r\n\r\n\t// Constrains the drag movement inside the specified element or the \"parent\" of the dragged element. Default: None.\r\n\tcontainment: undefined,\r\n\r\n\t// The elements among which the dragged element will be pulled in the front, or true to stack all sortable children. Default: None.\r\n\tstack: undefined,\r\n\r\n\t// The mouse cursor to show during dragging. Default: None.\r\n\tdragCursor: undefined,\r\n\r\n\t// A CSS class to add to the element while it's being dragged. Default: None.\r\n\tdragClass: undefined,\r\n\r\n\t// Indicates whether the window should scroll to keep the dragged element visible. Default: false.\r\n\tscroll: false\r\n};\r\n\r\n// Makes the child elements in each selected element sortable by drag&drop.\r\nfunction sortable(options) {\r\n\treturn this.each(function () {\r\n\t\tvar elem = this;\r\n\t\tvar $elem = $(elem);\r\n\t\tif ($elem.hasClass(sortableClass)) return;   // Already done\r\n\t\t$elem.addClass(sortableClass);\r\n\t\tvar opt = initOptions(\"sortable\", sortableDefaults, $elem, {}, options);\r\n\t\topt._prepareChild = prepareChild;\r\n\r\n\t\t// Remove text nodes between children which cause layout issues when dragging\r\n\t\t$elem.contents().filter(function () {\r\n\t\t\treturn this.nodeType === 3;\r\n\t\t}).remove();\r\n\r\n\t\tvar isVertical = isBlockDisplay($elem.firstChild().css(\"display\"));\r\n\t\tvar flowStart = isVertical ? \"top\" : \"left\";\r\n\t\tvar flowEnd = isVertical ? \"bottom\" : \"right\";\r\n\t\tvar crossStart = isVertical ? \"left\" : \"top\";\r\n\t\tvar crossEnd = isVertical ? \"right\" : \"bottom\";\r\n\r\n\t\t$elem.children().each(prepareChild);\r\n\t\t\r\n\t\tfunction prepareChild() {\r\n\t\t\tvar child = $(this);\r\n\t\t\tvar placeholder, initialChildAfterElement, placeholderAfterElement, betweenChildren;\r\n\t\t\tvar stack = opt.stack;\r\n\t\t\tif (stack === true)\r\n\t\t\t\tstack = $elem.children();\r\n\r\n\t\t\tchild.draggable({\r\n\t\t\t\thandle: opt.handle,\r\n\t\t\t\tcancel: opt.cancel,\r\n\t\t\t\taxis: opt.axis,\r\n\t\t\t\tcontainment: opt.containment,\r\n\t\t\t\tstack: stack,\r\n\t\t\t\tdragCursor: opt.dragCursor,\r\n\t\t\t\tdragClass: opt.dragClass,\r\n\t\t\t\tscroll: opt.scroll\r\n\t\t\t});\r\n\t\t\tchild.on(\"draggablestart\", function (event) {\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tlet event2 = $.Event(\"sortablestart\");\r\n\t\t\t\tchild.trigger(event2);\r\n\t\t\t\tif (event2.isDefaultPrevented()) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remember where the element was before it was dragged, so it can be moved back there\r\n\t\t\t\tinitialChildAfterElement = child.prev();\r\n\t\t\t\tif (initialChildAfterElement.length === 0)\r\n\t\t\t\t\tinitialChildAfterElement = null;\r\n\r\n\t\t\t\tvar rect = child.rect();\r\n\r\n\t\t\t\t// Create the placeholder element that will take the place of the dragged element\r\n\t\t\t\tplaceholder = $(\"<\" + this.nodeName + \"/>\")\r\n\t\t\t\t\t.addClass(sortablePlaceholderClass)   // TODO: Also add all classes of child\r\n\t\t\t\t\t.text(\"\\xa0\")\r\n\t\t\t\t\t.css({ width: rect.width, height: rect.height });\r\n\r\n\t\t\t\t// Insert the placeholder where the dragged element is, and take that out of the layout flow\r\n\t\t\t\tchild.after(placeholder);\r\n\t\t\t\tchild.css({ position: \"absolute\", width: rect.width, height: rect.height });\r\n\t\t\t\tupdateChildren();\r\n\t\t\t});\r\n\t\t\tchild.on(\"draggablemove\", function (event) {\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tlet event2 = $.Event(\"sortablemove\");\r\n\t\t\t\tchild.trigger(event2);\r\n\t\t\t\tif (event2.isDefaultPrevented()) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find the center points of the dragged element, both at the start and end in flow direction\r\n\t\t\t\tvar rect = child.rect();\r\n\t\t\t\tvar childStartCenter = center(rect);\r\n\t\t\t\tchildStartCenter[flowStart] = rect[flowStart];\r\n\t\t\t\tvar childEndCenter = center(rect);\r\n\t\t\t\tchildEndCenter[flowStart] = rect[flowEnd];\r\n\r\n\t\t\t\tvar minStartDistance = Infinity;\r\n\t\t\t\tvar minEndDistance = Infinity;\r\n\t\t\t\tvar newPlaceholderAfterElementStart;\r\n\t\t\t\tvar newPlaceholderAfterElementEnd;\r\n\r\n\t\t\t\t// Iterate betweenChildren to find the closest line connecting two elements\r\n\t\t\t\tbetweenChildren.forEach(function (x) {\r\n\t\t\t\t\tvar startDistance = distToSegment(childStartCenter, x.p1, x.p2);\r\n\t\t\t\t\tif (startDistance < minStartDistance) {\r\n\t\t\t\t\t\tminStartDistance = startDistance;\r\n\t\t\t\t\t\tnewPlaceholderAfterElementStart = x.after;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar endDistance = distToSegment(childEndCenter, x.p1, x.p2);\r\n\t\t\t\t\tif (endDistance < minEndDistance) {\r\n\t\t\t\t\t\tminEndDistance = endDistance;\r\n\t\t\t\t\t\tnewPlaceholderAfterElementEnd = x.after;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Find the suggested new placeholder location that's different from the current...\r\n\t\t\t\t// TODO: If a short item is dragged over a long item at the beginning of a row and its placeholder still fits into the previous row, this flickers\r\n\t\t\t\t// * Visualise the generated lines between the items to get an idea of what the code sees\r\n\t\t\t\t//console.log(\"start is after center of \" + $(newPlaceholderAfterElementStart).text());\r\n\t\t\t\t//console.log(\"end is after center of \" + $(newPlaceholderAfterElementEnd).text());\r\n\t\t\t\tvar newPlaceholderAfterElement;\r\n\t\t\t\tif (newPlaceholderAfterElementStart !== placeholderAfterElement)\r\n\t\t\t\t\tnewPlaceholderAfterElement = newPlaceholderAfterElementStart;\r\n\t\t\t\tif (newPlaceholderAfterElementEnd !== placeholderAfterElement)\r\n\t\t\t\t\tnewPlaceholderAfterElement = newPlaceholderAfterElementEnd;\r\n\r\n\t\t\t\t// ...and move it there\r\n\t\t\t\tif (newPlaceholderAfterElement !== undefined) {\r\n\t\t\t\t\tvar eventCancelled = false;\r\n\t\t\t\t\tif (placeholderAfterElement !== undefined) {\r\n\t\t\t\t\t\tlet event2 = $.Event(\"sortablechange\");\r\n\t\t\t\t\t\tevent2.after = newPlaceholderAfterElement;\r\n\t\t\t\t\t\tchild.trigger(event2);\r\n\t\t\t\t\t\teventCancelled = event2.isDefaultPrevented();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!eventCancelled) {\r\n\t\t\t\t\t\tif (!newPlaceholderAfterElement)\r\n\t\t\t\t\t\t\tplaceholder.detach().insertBefore($elem.firstChild());\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tplaceholder.detach().insertAfter(newPlaceholderAfterElement);\r\n\t\t\t\t\t\tplaceholderAfterElement = newPlaceholderAfterElement;\r\n\t\t\t\t\t\tupdateChildren();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tchild.on(\"draggableend\", function (event) {\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tchild.css({ position: \"\", width: \"\", height: \"\", top: \"\", left: \"\" });\r\n\t\t\t\tplaceholder.replaceWith(child);\r\n\t\t\t\tplaceholder = undefined;\r\n\t\t\t\tbetweenChildren = undefined;\r\n\r\n\t\t\t\tlet event2 = $.Event(\"sortableend\");\r\n\t\t\t\tevent2.after = placeholderAfterElement;\r\n\t\t\t\tchild.trigger(event2);\r\n\t\t\t\tif (event2.isDefaultPrevented()) {\r\n\t\t\t\t\tif (!initialChildAfterElement)\r\n\t\t\t\t\t\tchild.detach().insertBefore($elem.firstChild());\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tchild.detach().insertAfter(initialChildAfterElement);\r\n\t\t\t\t}\r\n\t\t\t\tinitialChildAfterElement = undefined;\r\n\t\t\t});\r\n\r\n\t\t\tfunction updateChildren() {\r\n\t\t\t\tbetweenChildren = [];\r\n\t\t\t\tvar rowElements = [];\r\n\t\t\t\tvar rowMin, rowMax, currentPos, elem = null;\r\n\t\t\t\t$elem.children().each(function () {\r\n\t\t\t\t\tif (this !== child[0]) {\r\n\t\t\t\t\t\tvar rect = $(this).rect();\r\n\t\t\t\t\t\tif (rect[flowStart] + 0.1 < currentPos) {   // Need to compensate for rounding issues from the 4th decimal in Chrome/Edge/IE\r\n\t\t\t\t\t\t\t// This element is in a new row\r\n\t\t\t\t\t\t\taddRow();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Remember the width of a row\r\n\t\t\t\t\t\tif (rowMin === undefined || rect[crossStart] < rowMin) rowMin = rect[crossStart];\r\n\t\t\t\t\t\tif (rowMax === undefined || rect[crossEnd] < rowMax) rowMax = rect[crossEnd];\r\n\r\n\t\t\t\t\t\t// Remember how far the row has been used\r\n\t\t\t\t\t\tcurrentPos = rect[flowEnd];\r\n\r\n\t\t\t\t\t\tif (this !== placeholder[0]) elem = this;\r\n\t\t\t\t\t\trowElements.push({ elem: elem, rect: rect });\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Don't forget the last row\r\n\t\t\t\taddRow();\r\n\r\n\t\t\t\tfunction addRow() {\r\n\t\t\t\t\tvar rowCenter = (rowMin + rowMax) / 2;\r\n\r\n\t\t\t\t\t// Add line before the first element in the row\r\n\t\t\t\t\tbetweenChildren.push({\r\n\t\t\t\t\t\t// far away\r\n\t\t\t\t\t\tp1: createPoint(-10000, rowCenter),\r\n\t\t\t\t\t\t// the first row element's center\r\n\t\t\t\t\t\tp2: createPoint(center(rowElements[0].rect)[flowStart], rowCenter),\r\n\t\t\t\t\t\t// the position after the last element of the previous row, if any\r\n\t\t\t\t\t\tafter: betweenChildren.length > 0 ? betweenChildren[betweenChildren.length - 1].after : null\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Now add lines after each element in the row\r\n\t\t\t\t\trowElements.forEach(function (x, i) {\r\n\t\t\t\t\t\tbetweenChildren.push({\r\n\t\t\t\t\t\t\t// the current row element's center\r\n\t\t\t\t\t\t\tp1: createPoint(center(x.rect)[flowStart], rowCenter),\r\n\t\t\t\t\t\t\t// the next row element's center, if any; otherwise far away\r\n\t\t\t\t\t\t\tp2: createPoint(i < rowElements.length - 1 ? center(rowElements[i + 1].rect)[flowStart] : 10000, rowCenter),\r\n\t\t\t\t\t\t\t// the position after the current row element\r\n\t\t\t\t\t\t\tafter: x.elem\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Reset values for the new row\r\n\t\t\t\t\trowMin = rowMax = currentPos = undefined;\r\n\t\t\t\t\trowElements = [];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Returns an absolute point with \"left\" and \"top\" coordinates for the current orientation.\r\n\t\tfunction createPoint(flow, cross) {\r\n\t\t\tvar p = {};\r\n\t\t\tp[flowStart] = flow;\r\n\t\t\tp[crossStart] = cross;\r\n\t\t\treturn p;\r\n\t\t}\r\n\t});\r\n\r\n\t// Returns the center point of the specified rectangle.\r\n\tfunction center(rect) {\r\n\t\treturn {\r\n\t\t\ttop: rect.top + rect.height / 2,\r\n\t\t\tleft: rect.left + rect.width / 2\r\n\t\t};\r\n\t}\r\n\r\n\t// Determines whether the specified CSS display value defines a block instead of an inline.\r\n\tfunction isBlockDisplay(value) {\r\n\t\treturn [\"block\", \"flex\", \"grid\", \"list-item\", \"table\", \"table-footer-group\", \"table-header-group\", \"table-row\", \"table-row-group\"].indexOf(value) !== -1;\r\n\t}\r\n\r\n\t// Source: https://jsfiddle.net/beentaken/9k1sf6p2/ (modified)\r\n\tfunction dist2(v, w) {\r\n\t\treturn (v.left - w.left) ** 2 + (v.top - w.top) ** 2;\r\n\t}\r\n\r\n\tfunction distToSegmentSquared(p, v, w) {\r\n\t\tvar l2 = dist2(v, w);\r\n\t\tif (l2 == 0) return dist2(p, v);\r\n\t\tvar t = ((p.left - v.left) * (w.left - v.left) + (p.top - v.top) * (w.top - v.top)) / l2;\r\n\t\tif (t < 0) return dist2(p, v);\r\n\t\tif (t > 1) return dist2(p, w);\r\n\t\treturn dist2(p, { left: v.left + t * (w.left - v.left), top: v.top + t * (w.top - v.top) });\r\n\t}\r\n\r\n\tfunction distToSegment(p, v, w) {\r\n\t\treturn Math.sqrt(distToSegmentSquared(p, v, w));\r\n\t}\r\n}\r\n\r\nfunction addChild(child) {\r\n\tvar sortable = $(this);\r\n\tvar opt = loadOptions(\"sortable\", sortable);\r\n\topt._prepareChild.call(child);\r\n}\r\n\r\nregisterPlugin(\"sortable\", sortable, {\r\n\taddChild: addChild\r\n});\r\n$.fn.sortable.defaults = sortableDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar tabHeadersClass = \"ff-tab-headers\";\r\nvar tabPagesClass = \"ff-tab-pages\";\r\n\r\n// Converts all div elements in each selected element into tab pages.\r\n// The tab page headers are read from the div elements' title attribute.\r\nfunction tabs() {\r\n\treturn this.each(function () {\r\n\t\tvar container = $(this);\r\n\t\tif (container.children(\"div.\" + tabHeadersClass).length !== 0) return;   // Already done\r\n\r\n\t\tvar pageDivs = $(this).children(\"div\");\r\n\t\tvar activePage = pageDivs.filter(\".active\").first();\r\n\t\tvar headers = $(\"<div/>\").addClass(tabHeadersClass).appendTo(container);\r\n\t\tvar pages = $(\"<div/>\").addClass(tabPagesClass).appendTo(container);\r\n\t\tpageDivs.each(function () {\r\n\t\t\tvar header = $(\"<a/>\").attr(\"href\", \"#\").attr(\"tabindex\", \"-1\").text($(this).attr(\"title\")).appendTo(headers);\r\n\t\t\tvar page = $(this).removeAttr(\"title\").detach().appendTo(pages);\r\n\t\t\tif (activePage.length === 0 || activePage[0] === page[0]) {\r\n\t\t\t\theader.addClass(\"active\").removeAttr(\"tabindex\");\r\n\t\t\t\tpage.addClass(\"active\");\r\n\t\t\t\tactivePage = page;\r\n\t\t\t}\r\n\t\t\theader.click(function (event) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tcontainer.tabs.activeTab(page);\r\n\t\t\t});\r\n\t\t\theader.keydown(function (event) {\r\n\t\t\t\tif (event.which === 37) {   // Left\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.prev().focus().click();\r\n\t\t\t\t}\r\n\t\t\t\tif (event.which === 39) {   // Right\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.next().focus().click();\r\n\t\t\t\t}\r\n\t\t\t\tif (event.which === 36) {   // Home\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.parent().children().first().focus().click();\r\n\t\t\t\t}\r\n\t\t\t\tif (event.which === 35) {   // End\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.parent().children().last().focus().click();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n}\r\n\r\n// Gets the active page in a tab container.\r\n// indexOrPage: Sets the active page in each selected tab container, either by index or the page.\r\nfunction activeTab(indexOrPage) {\r\n\t// Getter\r\n\tif (indexOrPage === undefined) {\r\n\t\treturn this.find(\"div.\" + tabPagesClass + \" > .active\").first();\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar container = $(this);\r\n\t\tvar headers = container.children(\"div.\" + tabHeadersClass).first();\r\n\t\tvar pages = container.find(\"div.\" + tabPagesClass).first();\r\n\t\tvar index, page;\r\n\t\tif ($.isNumeric(indexOrPage)) {\r\n\t\t\tindex = +indexOrPage;\r\n\t\t\tpage = pages.children().eq(index);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tindex = indexOrPage.index();\r\n\t\t\tpage = indexOrPage;\r\n\t\t}\r\n\r\n\t\tif (page && !page.hasClass(\"active\")) {\r\n\t\t\theaders.children().attr(\"tabindex\", \"-1\");\r\n\t\t\theaders.children(\".active\").removeClass(\"active\");\r\n\t\t\theaders.children().eq(index).addClass(\"active\").removeAttr(\"tabindex\");\r\n\t\t\tpages.children(\".active\").removeClass(\"active\");\r\n\t\t\tpage.addClass(\"active\");\r\n\t\t\tcontainer.trigger(\"activeTabChange\");\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"tabs\", tabs, {\r\n\tactiveTab: activeTab\r\n});\r\n","﻿// Automatically apply all controls now. Must be loaded at the end of the document.\r\n// Doing it now is faster than waiting for the DOM ready event, and when loaded at the end of the\r\n// document, all relevant DOM parts are already there.\r\n\r\n$.fn.frontfire = function (prefix) {\r\n\tif (prefix === undefined) prefix = \"\";\r\n\r\n\tthis.find(prefix + \".accordion\").accordion();\r\n\tthis.find(prefix + \".carousel\").carousel();\r\n\t// TODO: dropdown\r\n\tthis.find(prefix + \"input[type=number]\").spinner();\r\n\tthis.find(prefix + \"input[type=color]\").colorPicker();\r\n\tthis.find(prefix + \"input[type=checkbox], input[type=radio]\").styleCheckbox();\r\n\tthis.find(prefix + \"input[type=checkbox].three-state\").threeState();\r\n\tthis.find(prefix + \"textarea.auto-height\").autoHeight();\r\n\tthis.find(prefix + \".menu\").menu();\r\n\tthis.find(prefix + \".critical.closable, .error.closable, .warning.closable, .information.closable, .success.closable\").closableMessage();\r\n\t// TODO: modal\r\n\tthis.find(prefix + \".slider\").slider();\r\n\tthis.find(prefix + \".sortable\").sortable();\r\n\tthis.find(prefix + \".tabs\").tabs();\r\n\treturn this;\r\n};\r\n\r\n$(document).frontfire(\":not(.no-autostart)\");\r\n"]}