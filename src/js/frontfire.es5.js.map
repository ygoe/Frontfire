{"version":3,"sources":["compatibility.js","util.js","jquery-extras.js","jquery-ui.js","plugin.js","modules/accordion.js","modules/carousel.js","modules/color.js","modules/dom.js","modules/draggable.js","modules/dropdown.js","modules/input.js","modules/menu.js","modules/message.js","dimmer.js","modules/modal.js","modules/offcanvas.js","modules/progressbar.js","modules/resizable.js","modules/selectable.js","modules/slider.js","modules/sortable.js","modules/tabs.js","modules/autostart.js","frontfire.js"],"names":[],"mappings":"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","file":"frontfire.es5.js","sourcesContent":["﻿// Bring older browsers to a usable level\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/includes#Polyfill\r\nif (!String.prototype.includes) {\r\n\tString.prototype.includes = function (search, start) {\r\n\t\tif (typeof start !== \"number\") start = 0;\r\n\t\tif (start + search.length > this.length) return false;\r\n\t\treturn this.indexOf(search, start) !== -1;\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith#Polyfill\r\nif (!String.prototype.startsWith) {\r\n\tString.prototype.startsWith = function (search, pos) {\r\n\t\treturn this.substr(!pos || pos < 0 ? 0 : +pos, search.length) === search;\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith#Polyfill\r\nif (!String.prototype.endsWith) {\r\n\tString.prototype.endsWith = function (search, this_len) {\r\n\t\tif (this_len === undefined || this_len > this.length) this_len = this.length;\r\n\t\treturn this.substring(this_len - search.length, this_len) === search;\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/padEnd#Polyfill\r\nif (!String.prototype.padEnd) {\r\n\tString.prototype.padEnd = function padEnd(targetLength, padString) {\r\n\t\ttargetLength = targetLength >> 0; //floor if number or convert non-number to 0;\r\n\t\tpadString = String(padString || ' ');\r\n\t\tif (this.length > targetLength) return String(this);\r\n\t\ttargetLength = targetLength - this.length;\r\n\t\tif (targetLength > padString.length)\r\n\t\t\tpadString += padString.repeat(targetLength / padString.length); //append to original to ensure we are longer than needed\r\n\t\treturn String(this) + padString.slice(0, targetLength);\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/padStart#Polyfill\r\nif (!String.prototype.padStart) {\r\n\tString.prototype.padStart = function padStart(targetLength, padString) {\r\n\t\ttargetLength = targetLength >> 0; //floor if number or convert non-number to 0;\r\n\t\tpadString = String(padString || ' ');\r\n\t\tif (this.length > targetLength) return String(this);\r\n\t\ttargetLength = targetLength - this.length;\r\n\t\tif (targetLength > padString.length)\r\n\t\t\tpadString += padString.repeat(targetLength / padString.length); //append to original to ensure we are longer than needed\r\n\t\treturn padString.slice(0, targetLength) + String(this);\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/repeat#Polyfill\r\nif (!String.prototype.repeat) {\r\n\tString.prototype.repeat = function(count) {\r\n\t\t'use strict';\r\n\t\tif (this == null) {\r\n\t\t\tthrow new TypeError('can\\'t convert ' + this + ' to object');\r\n\t\t}\r\n\t\tvar str = '' + this;\r\n\t\tcount = +count;\r\n\t\tif (count != count) {\r\n\t\t\tcount = 0;\r\n\t\t}\r\n\t\tif (count < 0) {\r\n\t\t\tthrow new RangeError('repeat count must be non-negative');\r\n\t\t}\r\n\t\tif (count == Infinity) {\r\n\t\t\tthrow new RangeError('repeat count must be less than infinity');\r\n\t\t}\r\n\t\tcount = Math.floor(count);\r\n\t\tif (str.length == 0 || count == 0) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\t\t// Ensuring count is a 31-bit integer allows us to heavily optimize the\r\n\t\t// main part. But anyway, most current (August 2014) browsers can't handle\r\n\t\t// strings 1 << 28 chars or longer, so:\r\n\t\tif (str.length * count >= 1 << 28) {\r\n\t\t\tthrow new RangeError('repeat count must not overflow maximum string size');\r\n\t\t}\r\n\t\tvar rpt = '';\r\n\t\tfor (var i = 0; i < count; i++) {\r\n\t\t\trpt += str;\r\n\t\t}\r\n\t\treturn rpt;\r\n\t}\r\n}\r\n\r\n// Source: https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/Math/trunc#Polyfill\r\nMath.trunc = Math.trunc || (x => x - x % 1);\r\n\r\n// Source: https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/Math/log10#Polyfill\r\nMath.log10 = Math.log10 || (x => Math.log(x) * Math.LOG10E);\r\n","// Returns the value in the range between min and max.\r\nexport function minmax(value, min, max) {\r\n\treturn Math.max(min, Math.min(value, max));\r\n}\r\n\r\n// Returns the value rounded to the specified number of decimals.\r\nexport function round(value, decimals) {\r\n\tif (decimals === undefined) decimals = 0;\r\n\tvar precision = Math.pow(10, decimals);\r\n\treturn Math.round(value * precision) / precision;\r\n}\r\n\r\n// Forces a browser layout reflow. This can be used to start CSS transitions on new elements.\r\nexport function forceReflow() {\r\n\t// Try two different methods\r\n\tvar body = $(\"body\");\r\n\tbody.css(\"display\");\r\n\tbody.offset();\r\n}\r\n\r\n// Installs a jQuery hook if it isn't installed yet. Existing hooks are chained to the new hook.\r\n//\r\n// hooks: The hooks collection, like $.attrHooks or $.propHooks\r\n// name: The name of the hooked entry\r\n// id: The internal ID with which an already installed hook can be recognised\r\n// get: The get function (optional)\r\n// set: The set function (optional)\r\nfunction installHook(hooks, name, id, get, set) {\r\n\t// Explanation: https://blog.rodneyrehm.de/archives/11-jQuery-Hooks.html\r\n\tvar hookInstalled = name in hooks &&\r\n\t\t\"ffId\" in hooks[name] &&\r\n\t\thooks[name].ffId === id;\r\n\tif (!hookInstalled) {\r\n\t\tvar prevHook = hooks[name];\r\n\t\thooks[name] = {\r\n\t\t\tffId: id,\r\n\t\t\tget: function (a, b, c) {\r\n\t\t\t\tif (get) {\r\n\t\t\t\t\tvar result = get(a, b, c);\r\n\t\t\t\t\tif (result !== null)\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t\tif (prevHook && prevHook.get)\r\n\t\t\t\t\treturn prevHook.get(a, b, c);\r\n\t\t\t\treturn null;\r\n\t\t\t},\r\n\t\t\tset: function (a, b, c) {\r\n\t\t\t\tif (set) {\r\n\t\t\t\t\tvar result = set(a, b, c);\r\n\t\t\t\t\tif (result !== undefined)\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t\tif (prevHook && prevHook.set)\r\n\t\t\t\t\treturn prevHook.set(a, b, c);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\n// Installs a hook that triggers the \"disabledchange\" event for input elements.\r\nexport function installDisabledchangeHook() {\r\n\tinstallHook(\r\n\t\t$.propHooks, \"disabled\", \"disabledchange\",\r\n\t\tundefined,\r\n\t\tfunction (elem, value, name) {\r\n\t\t\tif (elem.disabled !== value) {\r\n\t\t\t\telem.disabled = value;   // Set before triggering change event\r\n\t\t\t\t$(elem).trigger(\"disabledchange\");\r\n\t\t\t}\r\n\t\t});\r\n}\r\n\r\n// Binds the disabled state of the input element to the associated buttons.\r\nexport function bindInputButtonsDisabled(input, buttons) {\r\n\t// When the input element was disabled or enabled, also update other elements\r\n\tinstallDisabledchangeHook();\r\n\tvar handler = function () {\r\n\t\tif (input.disabled()) {\r\n\t\t\tinput.disable();   // Disable everything related as well (label etc.)\r\n\t\t\tbuttons.forEach(button => button.disable());\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinput.enable();   // Enable everything related as well (label etc.)\r\n\t\t\tbuttons.forEach(button => button.enable());\r\n\t\t}\r\n\t};\r\n\tinput.on(\"disabledchange\", handler);\r\n\r\n\t// Setup disabled state initially.\r\n\t// Also enable elements. If they were disabled and the page is reloaded, their state\r\n\t// may be restored halfway. This setup brings everything in the same state.\r\n\thandler();\r\n}\r\n\r\n// Scrolls the window so that the rectangle is fully visible.\r\nexport function scrollIntoView(rect) {\r\n\tvar cont = $(window);\r\n\tvar viewportWidth = cont.width() - 1;\r\n\tvar viewportHeight = cont.height() - 1;\r\n\tvar scrollTop = cont.scrollTop();\r\n\tvar scrollLeft = cont.scrollLeft();\r\n\r\n\tif (rect.top < scrollTop) {\r\n\t\tcont.scrollTop(rect.top);\r\n\t}\r\n\tif (rect.bottom > scrollTop + viewportHeight) {\r\n\t\tcont.scrollTop(scrollTop + (rect.bottom - (scrollTop + viewportHeight)));\r\n\t}\r\n\tif (rect.left < scrollLeft) {\r\n\t\tcont.scrollLeft(rect.left);\r\n\t}\r\n\tif (rect.right > scrollLeft + viewportWidth) {\r\n\t\tcont.scrollLeft(scrollLeft + (rect.right - (scrollLeft + viewportWidth)));\r\n\t}\r\n}\r\n\r\n// Prevents scrolling the document.\r\n//\r\n// state: Enable or disable the scrolling prevention.\r\nexport function preventScrolling(state) {\r\n\tvar $document = $(document), $html = $(\"html\");\r\n\tif (state || state === undefined) {\r\n\t\tvar scrollTop = $document.scrollTop();\r\n\t\tvar scrollLeft = $document.scrollLeft();\r\n\t\t$document.on(\"scroll.ff-prevent-scrolling\", function () {\r\n\t\t\t$document.scrollTop(scrollTop);\r\n\t\t\t$document.scrollLeft(scrollLeft);\r\n\t\t});\r\n\t\t$html.css(\"touch-action\", \"none\");\r\n\t}\r\n\telse {\r\n\t\t$document.off(\"scroll.ff-prevent-scrolling\");\r\n\t\t$html.css(\"touch-action\", \"\");\r\n\t}\r\n}\r\n\r\n// Stacks the selected elements and moved one element to the top.\r\nexport function stackElements(stackedElems, topElem) {\r\n\t// Find all selected stackable elements and sort them by:\r\n\t//   currently dragging, then z-index, then DOM index\r\n\t// and assign their new z-index\r\n\tstackedElems = stackedElems\r\n\t\t.map(function (index, el) {\r\n\t\t\tvar zIndex = parseInt($(el).css(\"z-index\"));\r\n\t\t\tif (!$.isNumeric(zIndex))\r\n\t\t\t\tzIndex = stackedElems.length;\r\n\t\t\treturn { elem: el, dragElem: el === topElem ? 1 : 0, index: index, zIndex: zIndex };\r\n\t\t})\r\n\t\t.sort(function (a, b) {\r\n\t\t\tif (a.dragElem !== b.dragElem) return a.dragElem - b.dragElem;\r\n\t\t\tif (a.zIndex !== b.zIndex) return a.zIndex - b.zIndex;\r\n\t\t\treturn a.index - b.index;\r\n\t\t});\r\n\tif (stackedElems.length !== 0) {\r\n\t\tvar maxZIndex = Math.max.apply(Math, stackedElems.toArray().map(o => o.zIndex));\r\n\t\tstackedElems.each(function (index) {\r\n\t\t\t$(this.elem).css(\"z-index\", maxZIndex - (stackedElems.length - 1) + index);\r\n\t\t});\r\n\t}\r\n}\r\n","import { bindInputButtonsDisabled, forceReflow } from \"./util\";\r\n\r\n$.bindInputButtonsDisabled = bindInputButtonsDisabled;\r\n$.forceReflow = forceReflow;\r\n\r\n// Define some more helper functions as jQuery plugins. Similar functions already exist in\r\n// jQuery and these complement the set.\r\n\r\n// A variant of $.each that uses $(this) as the called function's context instead of this.\r\n$.fn.each$ = function (fn) {\r\n\treturn this.each(function (index, element) {\r\n\t\treturn fn.call($(this), index, element);\r\n\t});\r\n};\r\n\r\n// Variable tests\r\n\r\n// Determines whether the value is set (i. e. not undefined or null).\r\n$.isSet = value => typeof value !== \"undefined\" && value !== null;\r\n\r\n// Determines whether the value is boolean.\r\n$.isBoolean = value => typeof value === \"boolean\";\r\n\r\n// Determines whether the value is a number.\r\n$.isNumber = value => typeof value === \"number\";\r\n\r\n// Determines whether the value is a string.\r\n$.isString = value => typeof value === \"string\";\r\n\r\n// Determines whether the value is an even number.\r\n$.isEven = value => $.isNumber(value) && value % 2 === 0;\r\n\r\n// Determines whether the value is an odd number.\r\n$.isOdd = value => $.isNumber(value) && value % 2 === 1;\r\n\r\n// Operating system tests\r\n\r\n// Determines whether the client operating system is Android.\r\n$.isAndroid = () => !!navigator.userAgent.match(/Android/);\r\n\r\n// Determines whether the client operating system is iOS.\r\n$.isIos = () => !!navigator.platform.match(/iPhone|iPad|iPod/);\r\n\r\n// Determines whether the client operating system is Linux (not Android).\r\n$.isLinux = () => !!navigator.platform.match(/Linux/) && !$.isAndroid();\r\n\r\n// Determines whether the client operating system is macOS.\r\n$.isMac = () => !!navigator.platform.match(/Mac/);\r\n\r\n// Determines whether the client operating system is Windows.\r\n$.isWindows = () => !!navigator.platform.match(/Win/);\r\n\r\nif ($.isAndroid()) {\r\n\t$(\"html\").addClass(\"simple-dimmer\");\r\n}\r\n\r\n// Browser tests\r\n// Source: https://stackoverflow.com/a/9851769\r\n\r\n// Determines whether the browser has a Blink engine.\r\n$.isBlink = () => ($.isChrome() || $.isOpera()) && !!window.CSS;\r\n\r\n// Determines whether the browser is Chrome.\r\n$.isChrome = () => !!window.chrome && !!window.chrome.webstore;\r\n\r\n// Determines whether the browser is Edge.\r\n$.isEdge = () => !$.isInternetExplorer() && !!window.StyleMedia;\r\n\r\n// Determines whether the browser is Firefox.\r\n$.isFirefox = () => typeof InstallTrigger !== 'undefined';\r\n\r\n// Determines whether the browser is Internet Explorer.\r\n$.isInternetExplorer = () => /*@cc_on!@*/false || !!document.documentMode;\r\n\r\n// Determines whether the browser is Opera.\r\n$.isOpera = () => (!!window.opr && !!opr.addons) || !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;\r\n\r\n// Determines whether the browser is Safari.\r\n$.isSafari = () => /constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === \"[object SafariRemoteNotification]\"; })(!window['safari'] || (typeof safari !== 'undefined' && safari.pushNotification));\r\n","/*! jQuery UI - v1.12.1 - 2017-12-25\r\n* http://jqueryui.com\r\n* Includes: focusable.js\r\n* Copyright jQuery Foundation and other contributors; Licensed MIT */\r\n\r\n// NOTE: This file was modified to not include unnecessary jQuery UI stuff.\r\n// IE8 support removed, which was introduced in\r\n// * https://bugs.jqueryui.com/ticket/14596\r\n// * https://github.com/jquery/jquery-ui/commit/d3025968f349c37a8ca41bfc63ee1b37d9d7354f\r\n\r\n/*\r\n * jQuery UI Focusable 1.12.1\r\n * http://jqueryui.com\r\n *\r\n * Copyright jQuery Foundation and other contributors\r\n * Released under the MIT license.\r\n * http://jquery.org/license\r\n */\r\n\r\n//>>label: :focusable Selector\r\n//>>group: Core\r\n//>>description: Selects elements which can be focused.\r\n//>>docs: http://api.jqueryui.com/focusable-selector/\r\n\r\n\r\n\r\n// Selectors\r\nvar focusable = function( element, hasTabindex ) {\r\n\tvar map, mapName, img, focusableIfVisible, fieldset,\r\n\t\tnodeName = element.nodeName.toLowerCase();\r\n\r\n\tif ( \"area\" === nodeName ) {\r\n\t\tmap = element.parentNode;\r\n\t\tmapName = map.name;\r\n\t\tif ( !element.href || !mapName || map.nodeName.toLowerCase() !== \"map\" ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\timg = $( \"img[usemap='#\" + mapName + \"']\" );\r\n\t\treturn img.length > 0 && img.is( \":visible\" );\r\n\t}\r\n\r\n\tif ( /^(input|select|textarea|button|object)$/.test( nodeName ) ) {\r\n\t\tfocusableIfVisible = !element.disabled;\r\n\r\n\t\tif ( focusableIfVisible ) {\r\n\r\n\t\t\t// Form controls within a disabled fieldset are disabled.\r\n\t\t\t// However, controls within the fieldset's legend do not get disabled.\r\n\t\t\t// Since controls generally aren't placed inside legends, we skip\r\n\t\t\t// this portion of the check.\r\n\t\t\tfieldset = $( element ).closest( \"fieldset\" )[ 0 ];\r\n\t\t\tif ( fieldset ) {\r\n\t\t\t\tfocusableIfVisible = !fieldset.disabled;\r\n\t\t\t}\r\n\t\t}\r\n\t} else if ( \"a\" === nodeName ) {\r\n\t\tfocusableIfVisible = element.href || hasTabindex;\r\n\t} else {\r\n\t\tfocusableIfVisible = hasTabindex;\r\n\t}\r\n\r\n\treturn focusableIfVisible && $( element ).is( \":visible\" ) && $( element ).css( \"visibility\" ) === \"visible\";\r\n};\r\n\r\n$.extend( $.expr[ \":\" ], {\r\n\tfocusable: function( element ) {\r\n\t\treturn focusable( element, $.attr( element, \"tabindex\" ) !== undefined );\r\n\t}\r\n} );\r\n","// Registers a jQuery plugin.\r\n//\r\n// name: The name of the plugin.\r\n// create: The plugin create function.\r\n// obj: An object containing additional operation functions.\r\nexport function registerPlugin(name, create, obj) {\r\n\t// Define a new property for each jQuery object in which the plugin is accessible.\r\n\t// This property getter is called whenever the plugin or one of its additional functions is called.\r\n\tObject.defineProperty($.fn, name, {\r\n\t\tget: function () {\r\n\t\t\t// Plugin default function\r\n\t\t\t// Returned to make this property callable\r\n\t\t\tvar ret = create;\r\n\r\n\t\t\t// Plugin additional functions, added to the returned function\r\n\t\t\t// Bound to whoever has called this property to pass on \"this\" to the next function\r\n\t\t\tfor (let key in obj) {\r\n\t\t\t\tif ($.isFunction(obj[key])) {\r\n\t\t\t\t\tret[key] = obj[key].bind(this);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Determines the options to use for a plugin.\r\n//\r\n// name: The plugin name.\r\n// defaults: The plugin's default options. Only properties defined in here are considered for data attributes.\r\n// elem: The element to find data attributes in. Options are stored here, too.\r\n// converters: An object that specifies a conversion function for each special data attribute.\r\n// params: The options specified to the plugin function.\r\nexport function initOptions(name, defaults, elem, converters, params) {\r\n\tparams = params || {};\r\n\r\n\t// Start with the defaults\r\n\tvar opts = $.extend({}, defaults);\r\n\r\n\t// Look for a combined HTML data-opt attribute containing a JSON object\r\n\tvar optValue = $(elem).data(\"opt\");\r\n\tif (optValue !== undefined) {\r\n\t\ttry {\r\n\t\t\toptValue = (new Function(\"return \" + optValue + \";\"))();\r\n\t\t\topts = $.extend(opts, optValue);\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tconsole.error(\"ERROR: data-opt value for \" + name + \" cannot be parsed:\", optValue, err);\r\n\t\t}\r\n\t}\r\n\r\n\t// Then overwrite with individual HTML data attributes\r\n\tfor (let key in defaults) {\r\n\t\t// Only do the work if it's not overridden again by params\r\n\t\tif (params[key] === undefined) {\r\n\t\t\tlet elemDataValue = $(elem).data(\"opt-\" + key);\r\n\t\t\tif (elemDataValue !== undefined) {\r\n\t\t\t\tif ($.isFunction(converters[key])) {\r\n\t\t\t\t\topts[key] = converters[key](elemDataValue);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\topts[key] = elemDataValue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Finally overwrite with params\r\n\t$.extend(opts, params);\r\n\r\n\t// Keep options in DOM element's data\r\n\t$(elem).data(\"ff-\" + name + \"-options\", opts);\r\n\r\n\treturn opts;\r\n}\r\n\r\n// Loads plugin options for additional plugin functions.\r\n//\r\n// name: The plugin name.\r\n// elem: The element to find data attributes in. Options are stored here, too.\r\nexport function loadOptions(name, elem) {\r\n\treturn $(elem).data(\"ff-\" + name + \"-options\") || {};\r\n}\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow } from \"../util\";\r\n\r\nvar accordionClass = \"ff-accordion\";\r\n\r\n// Defines default options for the accordion plugin.\r\nvar accordionDefaults = {\r\n\t// Exclusive mode allows only one item to be expanded at a time. Default: false.\r\n\texclusive: false,\r\n\t// Offset to consider when scrolling to an item, when there are fixed elements at the top. Default: 0.\r\n\tscrollOffset: 0,\r\n\t// Element whose height to consider when scrolling to an item. Both offsets are added. Default: null.\r\n\tscrollOffsetElement: null\r\n};\r\n\r\n// Converts all div elements in each selected element into accordion pages.\r\nfunction accordion(options) {\r\n\treturn this.each(function () {\r\n\t\tvar accordion = $(this);\r\n\t\tif (accordion.hasClass(accordionClass)) return;   // Already done\r\n\t\tvar opt = initOptions(\"accordion\", accordionDefaults, accordion, {}, options);\r\n\r\n\t\taccordion.addClass(accordionClass);\r\n\t\tvar items = $(this).children(\"div\");\r\n\t\titems.each$(function () {\r\n\t\t\tvar item = this;\r\n\t\t\tvar header = item.children(\"div\").first();\r\n\t\t\tvar content = item.children(\"div\").last();\r\n\r\n\t\t\theader.css(\"transition\", \"none\");\r\n\t\t\theader.addClass(\"ff-accordion-header\");\r\n\t\t\tforceReflow();\r\n\t\t\theader.css(\"transition\", \"\");\r\n\t\t\theader.attr(\"tabindex\", \"0\");\r\n\r\n\t\t\tcontent.addClass(\"ff-accordion-content\");\r\n\t\t\t\r\n\t\t\theader.click(function () {\r\n\t\t\t\tif (content[0].clientHeight) {\r\n\t\t\t\t\taccordion.accordion.collapse(item);\r\n\t\t\t\t} else {\r\n\t\t\t\t\taccordion.accordion.expand(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\theader.keydown(function (event) {\r\n\t\t\t\tif (event.which === 13) {   // Enter\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.click();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tvar id = item.attr(\"id\");\r\n\t\t\tif (id !== undefined && location.hash === \"#\" + id) {\r\n\t\t\t\t// Manually set item expanded\r\n\t\t\t\titem.addClass(\"expanded\");\r\n\t\t\t\tcontent.css(\"height\", \"auto\");\r\n\t\t\t\t$(function() {\r\n\t\t\t\t\tlet offset = opt.scrollOffset || 0;\r\n\t\t\t\t\tif (opt.scrollOffsetElement) {\r\n\t\t\t\t\t\toffset += $(opt.scrollOffsetElement).height();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$(\"html,body\").animate({ scrollTop: item.offset().top - offset });\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcontent.css(\"transition\", \"none\");\r\n\t\t\t\taccordion.accordion.collapse(item);\r\n\t\t\t\tforceReflow();\r\n\t\t\t\tcontent.css(\"transition\", \"\");\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction collapse(indexOrItem) {\r\n\treturn this.each(function () {\r\n\t\tvar accordion = $(this);\r\n\t\tvar opt = loadOptions(\"accordion\", accordion);\r\n\r\n\t\tvar items = accordion.children(\"div\");\r\n\t\tif (indexOrItem === undefined) {\r\n\t\t\t// Collapse all items\r\n\t\t\titems.each(function () {\r\n\t\t\t\taccordion.accordion.collapse(this);\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar item;\r\n\t\tif ($.isNumeric(indexOrItem)) {\r\n\t\t\titem = items.eq(+indexOrItem);\r\n\t\t}\r\n\t\telse {\r\n\t\t\titem = $(indexOrItem);\r\n\t\t}\r\n\r\n\t\tvar content = item.children(\"div.ff-accordion-content\").first();\r\n\t\tif (!content.hasClass(\"ff-fixed-height\")) {\r\n\t\t\tcontent.css(\"height\", content[0].scrollHeight);   // explicitly set to current value\r\n\t\t\tforceReflow();\r\n\t\t\tcontent.css(\"height\", 0);   // now animate to 0\r\n\t\t\tcontent.addClass(\"ff-fixed-height\");\r\n\t\t\titem.removeClass(\"expanded\");\r\n\r\n\t\t\tlet event = $.Event(\"itemCollapse\");\r\n\t\t\tevent.item = item;\r\n\t\t\taccordion.trigger(event);\r\n\t\t}\r\n\r\n\t\tvar id = item.attr(\"id\");\r\n\t\tif (id !== undefined && location.hash === \"#\" + id) {\r\n\t\t\thistory.replaceState(null, document.title, location.pathname + location.search);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction expand(indexOrItem) {\r\n\treturn this.each(function () {\r\n\t\tvar accordion = $(this);\r\n\t\tvar opt = loadOptions(\"accordion\", accordion);\r\n\r\n\t\tvar items = accordion.children(\"div\");\r\n\t\tif (indexOrItem === undefined && !opt.exclusive) {\r\n\t\t\t// Expand all items\r\n\t\t\titems.each(function () {\r\n\t\t\t\taccordion.accordion.expand(this);\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar item;\r\n\t\tif ($.isNumeric(indexOrItem)) {\r\n\t\t\titem = items.eq(+indexOrItem);\r\n\t\t}\r\n\t\telse {\r\n\t\t\titem = $(indexOrItem);\r\n\t\t}\r\n\r\n\t\tvar content = item.children(\"div.ff-accordion-content\").first();\r\n\t\tif (content[0].clientHeight) {\r\n\t\t\treturn;   // Already expanded\r\n\t\t}\r\n\t\tcontent.css(\"height\", content[0].scrollHeight);   // animate to desired height\r\n\t\tfunction onTransitionEnd(event) {\r\n\t\t\tif (event.originalEvent.propertyName == \"height\") {\r\n\t\t\t\tcontent.css(\"height\", \"auto\");   // allow free layout again after animation has completed\r\n\t\t\t\tcontent.off(\"transitionend\", onTransitionEnd);\r\n\t\t\t\tcontent.removeClass(\"ff-fixed-height\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tcontent.on(\"transitionend\", onTransitionEnd);\r\n\t\titem.addClass(\"expanded\");\r\n\r\n\t\tlet event = $.Event(\"itemExpand\");\r\n\t\tevent.item = item;\r\n\t\taccordion.trigger(event);\r\n\r\n\t\tvar previousItemCollapsedHeight = 0;\r\n\t\tif (opt.exclusive) {\r\n\t\t\tlet passedExpandedItem = false;\r\n\t\t\titems.each(function () {\r\n\t\t\t\tif (this !== item[0]) {\r\n\t\t\t\t\tif (!passedExpandedItem)\r\n\t\t\t\t\t\tpreviousItemCollapsedHeight += $(this).children(\"div.ff-accordion-content\").height();\r\n\t\t\t\t\taccordion.accordion.collapse(this);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tpassedExpandedItem = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// If a previous item was collapsed, scroll so that the expanded header stays where it is on the screen\r\n\t\t//if (previousItemCollapsedHeight) {\r\n\t\t//\t$(\"html,body\").animate({ scrollTop: \"-=\" + previousItemCollapsedHeight }, 200);\r\n\t\t//}\r\n\t\t\r\n\t\t// TODO: At least keep the expanded header visible if a previous item was collapsed\r\n\r\n\t\t// TODO: Maybe also scroll to make the new content section visible as much as possible, while not pushing out its header (option)\r\n\r\n\t\tvar id = item.attr(\"id\");\r\n\t\tif (id !== undefined) {\r\n\t\t\thistory.replaceState(null, document.title, \"#\" + id);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"accordion\", accordion, {\r\n\tcollapse: collapse,\r\n\texpand: expand\r\n});\r\n$.fn.accordion.defaults = accordionDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar carouselClass = \"ff-carousel\";\r\nvar carouselIndicatorClass = \"ff-carousel-indicator\";\r\n\r\n// Defines default options for the carousel plugin.\r\nvar carouselDefaults = {\r\n\t// The index of the initially active item. Default: 0.\r\n\tactive: 0,\r\n\r\n\t// The number of items concurrently visible. Default: 1.\r\n\titems: 1,\r\n\r\n\t// Show an indicator dot each x items. Default: -1 means the same value as items.\r\n\tdotsEach: -1,\r\n\r\n\t// The margin between two items in pixels. Default: 0.\r\n\tgutter: 0,\r\n\r\n\t// Shows the indicator dots for the active item. Default: true.\r\n\tindicator: true,\r\n\r\n\t// Starts looping through all items automatically. Default: false.\r\n\tautoPlay: false,\r\n\r\n\t// Autoplay item switch interval in milliseconds. Default: 4000.\r\n\tautoPlayInterval: 4000,\r\n\r\n\t// Pauses autoplay while the carousel is hovered with the mouse. Default: true.\r\n\tpauseOnHover: true,\r\n\r\n\t// The mouse cursor to show during dragging. Default: None.\r\n\tdragCursor: undefined,\r\n\r\n\t// The animation between items. Default: slide-all.\r\n\t// Possible values: slide-all, slide-in, slide-out, fade, slide-fade\r\n\t// For more than one visible item, only slide-all is supported and automatically used.\r\n\tanimation: \"slide-all\",\r\n\r\n\t// Loops all items at the end instead of rewinding/restricting. Default: false.\r\n\t// TODO\r\n\tloop: false\r\n};\r\n\r\n// Converts each selected element into a carousel.\r\nfunction carousel(options) {\r\n\treturn this.each(function () {\r\n\t\tvar carousel = $(this);\r\n\t\tif (carousel.find(\".\" + carouselClass).length) return;   // Already done\r\n\t\tvar opt = initOptions(\"carousel\", carouselDefaults, carousel, {}, options);\r\n\r\n\t\tif (opt.items > 1 || opt.gutter > 0) opt.animation = \"slide-all\";\r\n\r\n\t\tvar stage = $(\"<div/>\").addClass(carouselClass);\r\n\r\n\t\topt._gutterWidth = (opt.items - 1) / opt.items * opt.gutter;\r\n\t\topt._gutterOffset = 1 / opt.items * opt.gutter;\r\n\t\topt._itemWidthPercent = 100 / opt.items;\r\n\t\topt._layout = layout;\r\n\r\n\t\tvar itemIndex = 0;\r\n\t\tvar maxItemHeight = 0;\r\n\t\tvar items = carousel.children();\r\n\t\tvar autoPlayTimeout;\r\n\t\tvar itemOffset, startItemOffset, prevItemOffset, dragDirection, itemOffsetMin, itemOffsetMax, itemWidth;\r\n\t\tvar currentTransition = \"\";\r\n\r\n\t\tif (opt.dotsEach === -1) opt.dotsEach = opt.items;\r\n\t\topt.dotsEach = minmax(opt.dotsEach, 0, opt.items);\r\n\r\n\t\t// Set up items positioning\r\n\t\titems.each$(function () {\r\n\t\t\tthis.css(\"width\", \"calc(\" + opt._itemWidthPercent + \"% - \" + opt._gutterWidth + \"px)\");\r\n\t\t\tmaxItemHeight = Math.max(maxItemHeight, this.outerHeight());\r\n\t\t\tthis.detach().appendTo(stage);\r\n\t\t\titemIndex++;\r\n\t\t});\r\n\t\tstage.appendTo(carousel);\r\n\t\tstage.css(\"height\", maxItemHeight);\r\n\r\n\t\t// Add controls\r\n\t\tif (opt.indicator) {\r\n\t\t\tvar indicator = $(\"<div/>\").addClass(carouselIndicatorClass).appendTo(carousel);\r\n\t\t\tvar indicatorCount = Math.ceil(items.length / opt.dotsEach) - (opt.items - opt.dotsEach);\r\n\t\t\tfor (let i = 0; i < indicatorCount; i++) {\r\n\t\t\t\tlet dot = $(\"<span tabindex='0'><span/></span>\").appendTo(indicator);\r\n\t\t\t\tlet fn = function () {\r\n\t\t\t\t\tcarousel.carousel.activeItem(i * opt.dotsEach);\r\n\t\t\t\t\tsuspendAutoplay();\r\n\t\t\t\t\tresumeAutoplay();\r\n\t\t\t\t};\r\n\t\t\t\tdot.click(fn);\r\n\t\t\t\tdot.keydown(function (event) {\r\n\t\t\t\t\tif (event.which === 13) {   // Enter\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\tfn();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcarousel.carousel.activeItem(opt.active);\r\n\r\n\t\tstage.draggable({\r\n\t\t\taxis: \"x\",\r\n\t\t\tdragCursor: opt.dragCursor\r\n\t\t});\r\n\t\tstage.on(\"draggablestart\", function (event) {\r\n\t\t\tvar dx = Math.abs(event.dragPoint.left - event.newPoint.left);\r\n\t\t\tvar dy = Math.abs(event.dragPoint.top - event.newPoint.top);\r\n\t\t\tif (dy > dx) {\r\n\t\t\t\t// Movement was mostly vertical, don't drag in that direction but leave scrolling intact\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\titemWidth = stage.width() / opt.items;\r\n\t\t\tprevItemOffset = startItemOffset = layout();\r\n\t\t\tvar lastPageFirstItem = Math.max(0, items.length - opt.items);\r\n\t\t\titemOffsetMin = -opt.active;\r\n\t\t\titemOffsetMax = lastPageFirstItem - opt.active;\r\n\t\t\topt._isDragging = true;\r\n\r\n\t\t\t// Disable transition and autoplay while dragging\r\n\t\t\tremoveTransition();\r\n\t\t\tsuspendAutoplay();\r\n\t\t});\r\n\t\tstage.on(\"draggablemove\", function (event) {\r\n\t\t\titemOffset = startItemOffset - (event.newPoint.left - event.elemRect.left) / itemWidth;\r\n\t\t\tdragDirection = itemOffset - prevItemOffset;\r\n\t\t\tprevItemOffset = itemOffset;\r\n\r\n\t\t\t// Don't move the stage anywhere! Just tell me how far the pointer is dragged and we'll\r\n\t\t\t// move something else (the items within the stage) to provide the expected visual feedback.\r\n\t\t\tevent.newPoint = event.elemRect;\r\n\r\n\t\t\t// Restrict dragging at start/end\r\n\t\t\tif (itemOffset < itemOffsetMin)\r\n\t\t\t\titemOffset = itemOffsetMin - elastic(itemOffsetMin - itemOffset);\r\n\t\t\tif (itemOffset > itemOffsetMax)\r\n\t\t\t\titemOffset = itemOffsetMax + elastic(itemOffset - itemOffsetMax);\r\n\r\n\t\t\tfunction elastic(exceeding) {\r\n\t\t\t\tvar max = 0.25;\r\n\t\t\t\t// This function has a slope of 1 for x = 0 and slowly approaches (but never reaches) max\r\n\t\t\t\treturn -max / (exceeding / max + 1) + max;\r\n\t\t\t}\r\n\r\n\t\t\tlayout(itemOffset);\r\n\t\t});\r\n\t\tstage.on(\"draggableend\", function (event) {\r\n\t\t\t// Restore transition and autoplay\r\n\t\t\taddTransition();\r\n\t\t\tresumeAutoplay();\r\n\t\t\topt._isDragging = false;\r\n\r\n\t\t\t// Snap to item, consider last drag direction\r\n\t\t\tvar itemIndex = opt.active + itemOffset;\r\n\t\t\tvar newDot = itemIndex / opt.dotsEach;\r\n\t\t\tif (dragDirection > 0)\r\n\t\t\t\tnewDot = Math.ceil(newDot);\r\n\t\t\telse\r\n\t\t\t\tnewDot = Math.floor(newDot);\r\n\t\t\tcarousel.carousel.activeItem(newDot * opt.dotsEach);\r\n\t\t});\r\n\r\n\t\t// Add transition after setting position of every item\r\n\t\tforceReflow();\r\n\t\taddTransition();\r\n\r\n\t\tvar autoplaySuspendLevel = 0;\r\n\t\tif (opt.autoPlay) {\r\n\t\t\tif (opt.pauseOnHover) {\r\n\t\t\t\tstage.mouseenter(suspendAutoplay);\r\n\t\t\t\tstage.mouseleave(resumeAutoplay);\r\n\t\t\t}\r\n\r\n\t\t\tautoPlayTimeout = setTimeout(next, opt.autoPlayInterval);\r\n\t\t}\r\n\r\n\t\tfunction suspendAutoplay() {\r\n\t\t\tautoPlayTimeout && clearTimeout(autoPlayTimeout);\r\n\t\t\tautoplaySuspendLevel++;\r\n\t\t}\r\n\r\n\t\tfunction resumeAutoplay(clearPending) {\r\n\t\t\tautoplaySuspendLevel--;\r\n\t\t\tif (opt.autoPlay && !autoplaySuspendLevel) {\r\n\t\t\t\tautoPlayTimeout = setTimeout(next, opt.autoPlayInterval * 2);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction next() {\r\n\t\t\tvar index = opt.active;\r\n\t\t\tindex += opt.dotsEach;\r\n\t\t\tif (index > items.length - opt.items) index = 0;\r\n\t\t\tcarousel.carousel.activeItem(index);\r\n\t\t\tautoPlayTimeout = setTimeout(next, opt.autoPlayInterval);\r\n\t\t}\r\n\r\n\t\tfunction removeTransition() {\r\n\t\t\tcurrentTransition = \"\";\r\n\t\t\titems.css(\"transition\", currentTransition);\r\n\t\t}\r\n\r\n\t\tfunction addTransition() {\r\n\t\t\tlet opacityTime = \"0.4s\";\r\n\t\t\tif (opt.animation === \"fade\")\r\n\t\t\t\topacityTime = \"0.8s\";\r\n\t\t\tcurrentTransition = \"left 0.4s ease-in-out, opacity \" + opacityTime + \" ease-in-out\";\r\n\t\t\titems.css(\"transition\", currentTransition);\r\n\t\t}\r\n\r\n\t\t// Modulo operation corrected for negative numbers.\r\n\t\tfunction mod(value, mod) {\r\n\t\t\twhile (value < 0) value += mod;\r\n\t\t\treturn value % mod;\r\n\t\t}\r\n\r\n\t\t// Item layouts for each animation type:\r\n\t\t// slide-all\r\n\t\t//   All items are positioned next to each other and moved simultaneously\r\n\t\t//   No z-index or opacity is used\r\n\t\t// slide-out\r\n\t\t//   There are two stacks next to each other\r\n\t\t//   The right stack is at left: 0 (visible in the stage), the left stack is directly next to it\r\n\t\t//   The active item and all following items are on the right (visible) stack, with z-index from front to back\r\n\t\t//   The previous items are on the left (invisible) stack\r\n\t\t//   Only one item can be moved to the other stack at a time\r\n\t\t// slide-in\r\n\t\t//   There are two stacks next to each other\r\n\t\t//   The left stack is at left: 0 (visible in the stage), the right stack is directly next to it\r\n\t\t//   The active item and all previous items are on the left (visible) stack, with z-index from back to front\r\n\t\t//   The following items are on the right (invisible) stack\r\n\t\t//   Only one item can be moved to the other stack at a time\r\n\t\t// fade\r\n\t\t//   All items are stacked above one another, at the same position (left: 0, in the stage)\r\n\t\t//   The visible item or the item that is becoming visible is on z-index 1, opacity is 1.\r\n\t\t//   The previously visible item or the item that is becoming invisible is on z-index 2, opacity is (becoming) 0, pointer-events is none.\r\n\t\t//   All other items are on z-index 0 with opacity 0.\r\n\t\t// slide-fade\r\n\t\t//   Based on slide-all but moving items by 1/10th of the stage width.\r\n\t\t//   The active/visible item has opacity 1, gradually changing to 0 for the adjacent and all other items.\r\n\r\n\t\t// Translates between an item offset and the current layout.\r\n\t\t// The getter is used to initialise the item offset when starting to drag during an ongoing transition.\r\n\t\t// The setter is used everywhere the items need to be laid out for a new active item or item offset.\r\n\t\tfunction layout(itemOffset) {\r\n\t\t\t// Getter\r\n\t\t\tif (itemOffset === undefined) {\r\n\t\t\t\tlet pos = [];\r\n\t\t\t\tlet allSame = true;\r\n\t\t\t\tswitch (opt.animation) {\r\n\t\t\t\t\tcase \"fade\":\r\n\t\t\t\t\t\tlet z1, z2, z2Opacity;\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tif (this.css(\"z-index\") == 1)\r\n\t\t\t\t\t\t\t\tz1 = index;\r\n\t\t\t\t\t\t\tif (this.css(\"z-index\") == 2) {\r\n\t\t\t\t\t\t\t\tz2 = index;\r\n\t\t\t\t\t\t\t\tz2Opacity = parseFloat(this.css(\"opacity\"));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t//console.log(\"get layout: z1=\" + z1 + \" z2=\" + z2 + \" z2Opacity=\" + z2Opacity + \" active=\" + opt.active);\r\n\t\t\t\t\t\tif (z2 !== undefined) {\r\n\t\t\t\t\t\t\tif (z1 > z2)   // Moving forward (a higher item index is in layer 1, becoming visible)\r\n\t\t\t\t\t\t\t\treturn z1 + (1 - z2Opacity) - opt.active - 1;\r\n\t\t\t\t\t\t\telse   // Moving backward\r\n\t\t\t\t\t\t\t\treturn z1 + z2Opacity - opt.active;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (z1 !== undefined) return z1 - opt.active;\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\tcase \"slide-in\":\r\n\t\t\t\t\t\tlet anyZero = false;\r\n\t\t\t\t\t\tlet firstGtZero = -1;\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tlet left = parseFloat(this.css(\"left\"));\r\n\t\t\t\t\t\t\tpos.push(left);\r\n\t\t\t\t\t\t\tif (left !== pos[0]) allSame = false;\r\n\t\t\t\t\t\t\tif (left === 0) anyZero = true;\r\n\t\t\t\t\t\t\tif (left > 0 && firstGtZero === -1) firstGtZero = index;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (allSame && pos[0] < 0) return items.length - 1 -pos[0] / itemWidth - opt.active;\r\n\t\t\t\t\t\tif (!anyZero) return -pos[0] / itemWidth - opt.active;\r\n\t\t\t\t\t\tif (firstGtZero > 0) return firstGtZero - pos[firstGtZero] / itemWidth - opt.active;\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\tcase \"slide-out\":\r\n\t\t\t\t\t\tlet anyPositive = false;\r\n\t\t\t\t\t\tlet firstZero = -1;\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tlet left = parseFloat(this.css(\"left\"));\r\n\t\t\t\t\t\t\tpos.push(left);\r\n\t\t\t\t\t\t\tif (left !== pos[0]) allSame = false;\r\n\t\t\t\t\t\t\tif (left >= 0) anyPositive = true;\r\n\t\t\t\t\t\t\tif (left === 0 && firstZero === -1) firstZero = index;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (allSame && pos[0] > 0) return -pos[0] / itemWidth - opt.active;\r\n\t\t\t\t\t\tif (!anyPositive) return items.length - 1 + -pos[pos.length - 1] / itemWidth - opt.active;\r\n\t\t\t\t\t\tif (firstZero > 0) return firstZero - 1 + -pos[firstZero - 1] / itemWidth - opt.active;\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\tcase \"slide-fade\":\r\n\t\t\t\t\t\tlet activeItemLeft2 = parseFloat(items.eq(opt.active).css(\"left\"));\r\n\t\t\t\t\t\treturn -activeItemLeft2 / (itemWidth / 10);\r\n\t\t\t\t\tcase \"slide-all\":\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tlet activeItemLeft = parseFloat(items.eq(opt.active).css(\"left\"));\r\n\t\t\t\t\t\treturn -activeItemLeft / itemWidth;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Setter\r\n\t\t\tswitch (opt.animation) {\r\n\t\t\t\tcase \"fade\":\r\n\t\t\t\t\tif (itemOffset !== 0) {\r\n\t\t\t\t\t\tlet fullyVisible = opt.active + Math.trunc(itemOffset);\r\n\t\t\t\t\t\tlet partiallyVisible = opt.active + Math.trunc(itemOffset) + Math.sign(itemOffset);\r\n\t\t\t\t\t\t//console.log(fullyVisible, partiallyVisible);\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tif (index === fullyVisible) {\r\n\t\t\t\t\t\t\t\tthis.css(\"z-index\", 1).css(\"opacity\", 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (index === partiallyVisible) {\r\n\t\t\t\t\t\t\t\tthis.css(\"z-index\", 2).css(\"opacity\", Math.abs(itemOffset) - Math.trunc(Math.abs(itemOffset)));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthis.css(\"z-index\", 0).css(\"opacity\", 0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlet z1, z2, z2Opacity;\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tif (this.css(\"z-index\") == 1)\r\n\t\t\t\t\t\t\t\tz1 = index;\r\n\t\t\t\t\t\t\tif (this.css(\"z-index\") == 2) {\r\n\t\t\t\t\t\t\t\tz2 = index;\r\n\t\t\t\t\t\t\t\tz2Opacity = parseFloat(this.css(\"opacity\"));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t//console.log(\"set layout: z1=\" + z1 + \" z2=\" + z2 + \" z2Opacity=\" + z2Opacity + \" active=\" + opt.active);\r\n\t\t\t\t\t\tif (opt.active === z1) {\r\n\t\t\t\t\t\t\titems.eq(z2).css(\"opacity\", 0).css(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (opt.active === z2) {\r\n\t\t\t\t\t\t\tremoveTransition();\r\n\t\t\t\t\t\t\titems.eq(z1).css(\"z-index\", 2).css(\"opacity\", 1 - z2Opacity);\r\n\t\t\t\t\t\t\titems.eq(z2).css(\"z-index\", 1).css(\"opacity\", 1).css(\"pointer-events\", \"\");\r\n\t\t\t\t\t\t\tforceReflow();\r\n\t\t\t\t\t\t\tif (!opt._isDragging) addTransition();\r\n\t\t\t\t\t\t\titems.eq(z1).css(\"opacity\", 0).css(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tlet currentVisible;\r\n\t\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\t\tif (this.css(\"z-index\") == 1)\r\n\t\t\t\t\t\t\t\t\tcurrentVisible = index;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tremoveTransition();\r\n\t\t\t\t\t\t\titems.eq(opt.active).css(\"z-index\", 1).css(\"opacity\", 1).css(\"pointer-events\", \"\");\r\n\t\t\t\t\t\t\tforceReflow();\r\n\t\t\t\t\t\t\tif (!opt._isDragging) addTransition();\r\n\t\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\t\tif (index === opt.active) {\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse if (index === currentVisible) {\r\n\t\t\t\t\t\t\t\t\tthis.css(\"z-index\", 2).css(\"opacity\", 0).css(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tthis.css(\"z-index\", 0).css(\"opacity\", 0).css(\"pointer-events\", \"\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet status = \"\";\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tstatus += index + \": z=\" + this.css(\"z-index\") + \" op=\" + this.css(\"opacity\") + (index === opt.active ? \" active\" : \"\") + \"\\n\";\r\n\t\t\t\t\t});\r\n\t\t\t\t\t//console.log(status);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"slide-in\":\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tlet left = opt.active + itemOffset <= items.length - 1 ?\r\n\t\t\t\t\t\t\tminmax((index - opt.active - itemOffset) * 100, 0, 100) :\r\n\t\t\t\t\t\t\t(items.length - 1 - opt.active - itemOffset) * 100;\r\n\t\t\t\t\t\tthis.css(\"left\", left + \"%\");\r\n\t\t\t\t\t\tthis.css(\"z-index\", index);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"slide-out\":\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tlet left = opt.active + itemOffset >= 0 ?\r\n\t\t\t\t\t\t\tminmax((index - opt.active - itemOffset) * 100, -100, 0) :\r\n\t\t\t\t\t\t\t(-opt.active - itemOffset) * 100;\r\n\t\t\t\t\t\tthis.css(\"left\", left + \"%\");\r\n\t\t\t\t\t\tthis.css(\"z-index\", items.length - 1 - index);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"slide-fade\":\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tlet percent = (index - opt.active) * 100 / 10;\r\n\t\t\t\t\t\tlet left = (index - opt.active) * opt._gutterOffset - itemOffset * stage.width() / 10;\r\n\t\t\t\t\t\tthis.css(\"left\", \"calc(\" + percent + \"% + \" + left + \"px)\");\r\n\t\t\t\t\t\tlet opacity = 1 - minmax(Math.abs(index - (opt.active + itemOffset)), 0, 1);\r\n\t\t\t\t\t\tthis.css(\"opacity\", opacity);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"slide-all\":\r\n\t\t\t\tdefault:\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tlet percent = (index - opt.active) * opt._itemWidthPercent;\r\n\t\t\t\t\t\tlet left = (index - opt.active) * opt._gutterOffset - itemOffset * stage.width() / opt.items;\r\n\t\t\t\t\t\tthis.css(\"left\", \"calc(\" + percent + \"% + \" + left + \"px)\");\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Gets the active item in a carousel.\r\n//\r\n// indexOrItem: Sets the active item in each selected carousel, either by index or the element.\r\nfunction activeItem(indexOrItem) {\r\n\t// Getter\r\n\tif (indexOrItem === undefined) {\r\n\t\tvar carousel = this.first();\r\n\t\tif (carousel.length === 0) return;   // Nothing to do\r\n\t\tvar opt = loadOptions(\"carousel\", carousel);\r\n\t\treturn opt.active;\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar carousel = $(this);\r\n\t\tvar opt = loadOptions(\"carousel\", carousel);\r\n\t\tif (opt._isDragging) return;   // Ignore request while dragging\r\n\t\tvar items = carousel.find(\".\" + carouselClass).children();\r\n\t\tif (indexOrItem === Infinity) indexOrItem = items.length;   // Infinity can't be handled by Math.min\r\n\t\tvar index;\r\n\t\tif ($.isNumeric(indexOrItem)) {\r\n\t\t\tindex = +indexOrItem;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tindex = indexOrItem.index();\r\n\t\t}\r\n\r\n\t\tindex = minmax(index, 0, items.length - opt.items);\r\n\t\topt.active = index;\r\n\t\topt._layout(0);\r\n\t\tvar dots = carousel.find(\".\" + carouselIndicatorClass).children();\r\n\t\tdots.removeClass(\"active\").eq(Math.ceil(index / opt.dotsEach)).addClass(\"active\");\r\n\t\tcarousel.trigger(\"activeItemChange\");\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"carousel\", carousel, {\r\n\tactiveItem: activeItem\r\n});\r\n$.fn.carousel.defaults = carouselDefaults;\r\n","﻿import { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\n// This file uses its own scope to keep its helper functions private and make it reusable independently.\r\n// There are a few places where jQuery is used but they can easily be replaced with DOM calls if necessary.\r\n(function (undefined) {\r\n\t\"use strict\";\r\n\r\n\t// Parses any color value understood by a browser into an object with r, g, b, a properties.\r\n\tfunction Color(value) {\r\n\t\t// Allow calling without \"new\" keyword\r\n\t\tif (!(this instanceof Color))\r\n\t\t\treturn new Color(value);\r\n\r\n\t\tif (typeof value === \"string\") {\r\n\t\t\tif (value === \"\") {\r\n\t\t\t\tthis.format = \"CSS\";\r\n\t\t\t\tthis.r = this.g = this.b = this.a = 0;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.format = value.match(/^rgba?\\(/) ? \"CSS\" : \"HTML\";\r\n\r\n\t\t\t// Add \"#\" prefix if missing and the data is otherwise looking good (3/6/8 hex digits)\r\n\t\t\tif (value.match(/^\\s*[0-9A-Fa-f]{3}([0-9A-Fa-f]{3}([0-9A-Fa-f]{2})?)?\\s*$/)) value = \"#\" + value.trim();\r\n\r\n\t\t\t// Let the browser do the work\r\n\t\t\tvar color = $(\"<div/>\").css(\"color\", value).css(\"color\");\r\n\t\t\tvar match = color.match(/rgba?\\(\\s*([0-9.]+)\\s*,\\s*([0-9.]+)\\s*,\\s*([0-9.]+)\\s*(?:,\\s*([0-9.]+)\\s*)?\\)/);\r\n\t\t\tif (match) {\r\n\t\t\t\tthis.r = keep255(Number(match[1]));\r\n\t\t\t\tthis.g = keep255(Number(match[2]));\r\n\t\t\t\tthis.b = keep255(Number(match[3]));\r\n\t\t\t\tthis.a = match[4] !== undefined ? keep1(Number(match[4])) : 1;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Browser wasn't in the mood (probably Chrome with a named color), try harder\r\n\t\t\tvar context = $(\"<canvas width='1' height='1'/>\")[0].getContext(\"2d\");\r\n\t\t\tcontext.fillStyle = value;\r\n\t\t\tcontext.fillRect(0, 0, 1, 1);\r\n\t\t\tvar data = context.getImageData(0, 0, 1, 1).data;\r\n\t\t\tthis.r = data[0];\r\n\t\t\tthis.g = data[1];\r\n\t\t\tthis.b = data[2];\r\n\t\t\tthis.a = data[3] / 255;\r\n\t\t\t// If this is wrong, the named color probably doesn't exist, but we can't detect it\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (typeof value === \"number\") {\r\n\t\t\tthis.format = \"IntARGB\";\r\n\t\t\tthis.r = (value >> 16) & 0xff;\r\n\t\t\tthis.g = (value >> 8) & 0xff;\r\n\t\t\tthis.b = value & 0xff;\r\n\t\t\tvar a = (value >> 24) & 0xff;\r\n\t\t\tthis.a = a !== 0 ? round(a / 255, 3) : 1;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (typeof value === \"object\") {\r\n\t\t\tthis.format = value.format !== undefined ? value.format : \"Object\";\r\n\t\t\tthis.r = keep255(value.r);\r\n\t\t\tthis.g = keep255(value.g);\r\n\t\t\tthis.b = keep255(value.b);\r\n\t\t\tthis.a = value.a !== undefined ? keep1(value.a) : 1;\r\n\t\t\treturn;\r\n\t\t};\r\n\r\n\t\tconsole.error(\"Invalid color:\", value);\r\n\t}\r\n\r\n\t// Make it public\r\n\twindow.Color = Color;\r\n\r\n\t// Now add object methods\r\n\tvar Color_prototype = Color.prototype;\r\n\r\n\t// Formats the color in the format it was originally parsed from.\r\n\tColor_prototype.toString = function () {\r\n\t\tswitch (this.format) {\r\n\t\t\tcase \"IntARGB\":\r\n\t\t\t\treturn this.toIntARGB();\r\n\t\t\tcase \"HTML\":\r\n\t\t\t\treturn this.toHTML();\r\n\t\t\tcase \"CSS\":\r\n\t\t\tdefault:\r\n\t\t\t\treturn this.toCSS();\r\n\t\t}\r\n\t};\r\n\r\n\t// Formats a color object into a CSS rgb() string.\r\n\tColor_prototype.toCSS = function () {\r\n\t\tif (this.a === undefined || this.a === 1)\r\n\t\t\treturn \"rgb(\" + this.r + \", \" + this.g + \", \" + this.b + \")\";\r\n\t\treturn \"rgba(\" + this.r + \", \" + this.g + \", \" + this.b + \", \" + this.a + \")\";\r\n\t};\r\n\r\n\t// Formats a color object into an HTML hexadecimal string.\r\n\tColor_prototype.toHTML = function () {\r\n\t\tfunction conv(number) {\r\n\t\t\treturn (number < 16 ? \"0\" : \"\") +\r\n\t\t\t\tround(keep255(number)).toString(16).toLowerCase();\r\n\t\t}\r\n\r\n\t\tvar str = \"#\" + conv(this.r) + conv(this.g) + conv(this.b);\r\n\t\tif (this.a !== undefined && this.a !== 1) str += conv(this.a * 255);\r\n\t\treturn str;\r\n\t};\r\n\r\n\t// Converts a color object into an integer number like 0xAARRGGBB.\r\n\tColor_prototype.toIntARGB = function () {\r\n\t\treturn (this.a !== undefined ? round(keep1(this.a) * 255) : 255) << 24 |\r\n\t\t\tround(keep255(this.r)) << 16 |\r\n\t\t\tround(keep255(this.g)) << 8 |\r\n\t\t\tround(keep255(this.b));\r\n\t};\r\n\r\n\t// Calculates the HSL components from the RGB components in the color object.\r\n\tColor_prototype.updateHSL = function () {\r\n\t\tthis.r = keep255(this.r);\r\n\t\tthis.g = keep255(this.g);\r\n\t\tthis.b = keep255(this.b);\r\n\r\n\t\tvar r = this.r / 255;\r\n\t\tvar g = this.g / 255;\r\n\t\tvar b = this.b / 255;\r\n\t\tvar min = Math.min(r, g, b);\r\n\t\tvar max = Math.max(r, g, b);\r\n\r\n\t\tif (max === min)\r\n\t\t\tthis.h = 0;\r\n\t\telse if (max === r)\r\n\t\t\tthis.h = (60 * (g - b) / (max - min)) % 360;\r\n\t\telse if (max === g)\r\n\t\t\tthis.h = (60 * (b - r) / (max - min) + 120) % 360;\r\n\t\telse // if (max === b)\r\n\t\t\tthis.h = (60 * (r - g) / (max - min) + 240) % 360;\r\n\t\tif (this.h < 0)\r\n\t\t\tthis.h += 360;\r\n\r\n\t\tthis.s = 0;   // Just for the order of the properties\r\n\t\tthis.l = (max + min) / 2;\r\n\r\n\t\tif (max === min)\r\n\t\t\tthis.s = 0;\r\n\t\telse if (this.l <= 0.5)\r\n\t\t\tthis.s = (max - min) / (2 * this.l);\r\n\t\telse\r\n\t\t\tthis.s = (max - min) / (2 - 2 * this.l);\r\n\t\treturn this;\r\n\t};\r\n\r\n\t// Calculates the RGB components from the HSL components in the color object.\r\n\tColor_prototype.updateRGB = function () {\r\n\t\tthis.h = minmax(this.h, 0, 366);\r\n\t\tthis.s = keep1(this.s);\r\n\t\tthis.l = keep1(this.l);\r\n\r\n\t\tvar q = this.l < 0.5 ?\r\n\t\t\tthis.l * (1 + this.s) :\r\n\t\t\tthis.l + this.s - this.l * this.s;\r\n\t\tvar p = 2 * this.l - q;\r\n\t\tvar h = this.h / 360;   // Normalise hue to 0..1\r\n\t\tvar t = { r: h + 1 / 3, g: h, b: h - 1 / 3 };\r\n\r\n\t\tvar that = this;\r\n\t\t[\"r\", \"g\", \"b\"].forEach(function (c) {\r\n\t\t\tif (t[c] < 0) t[c]++;\r\n\t\t\tif (t[c] > 1) t[c]--;\r\n\t\t\tif (t[c] < 1 / 6)\r\n\t\t\t\tthat[c] = p + ((q - p) * 6 * t[c]);\r\n\t\t\telse if (t[c] < 1 / 2)\r\n\t\t\t\tthat[c] = q;\r\n\t\t\telse if (t[c] < 2 / 3)\r\n\t\t\t\tthat[c] = p + ((q - p) * 6 * (2 / 3 - t[c]));\r\n\t\t\telse\r\n\t\t\t\tthat[c] = p;\r\n\t\t\tthat[c] = round(that[c] * 255);\r\n\t\t});\r\n\t\tif (this.a === undefined) this.a = 1;\r\n\t\treturn this;\r\n\t};\r\n\r\n\t// Returns a blended color with the specified ratio from 0 (no change) to 1 (only other color).\r\n\tColor_prototype.blendWith = function (other, ratio, includeAlpha) {\r\n\t\tvar isHSL = this.h !== undefined || other.h !== undefined;\r\n\t\tvar color = Color(this);\r\n\t\tother = Color(other);\r\n\t\tratio = keep1(ratio);\r\n\t\t[\"r\", \"g\", \"b\"].forEach(function (c) {\r\n\t\t\tcolor[c] = keep255(round(extendFF(color[c]) + (extendFF(other[c]) - extendFF(color[c])) * ratio));\r\n\t\t});\r\n\t\tif (includeAlpha)\r\n\t\t\tcolor.a = round(color.a + (other.a - color.a) * ratio, 3);\r\n\t\tif (isHSL)\r\n\t\t\tcolor.updateHSL();\r\n\t\treturn color;\r\n\t};\r\n\r\n\t// Returns the inverted color.\r\n\tColor_prototype.invert = function () {\r\n\t\treturn processColor(this, false, function () {\r\n\t\t\tthis.r = 255 - keep255(this.r);\r\n\t\t\tthis.g = 255 - keep255(this.g);\r\n\t\t\tthis.b = 255 - keep255(this.b);\r\n\t\t});\r\n\t};\r\n\r\n\t// Returns the complementary color.\r\n\tColor_prototype.complement = function () {\r\n\t\treturn processColor(this, true, function () {\r\n\t\t\tthis.h = (this.h + 180) % 360;\r\n\t\t});\r\n\r\n\t\t// TODO: Add an option to return multiple complementary colors, as array\r\n\t};\r\n\r\n\t// Returns a color that is lighter by the factor between 0 (unchanged) and 1 (white).\r\n\tColor_prototype.lighten = function (factor) {\r\n\t\treturn processColor(this, true, function () {\r\n\t\t\tthis.l = keep1(this.l + keep1(factor) * (1 - this.l));\r\n\t\t});\r\n\t};\r\n\r\n\t// Returns a color that is darker by the factor between 0 (unchanged) and 1 (black).\r\n\tColor_prototype.darken = function (factor) {\r\n\t\treturn processColor(this, true, function () {\r\n\t\t\tthis.l = keep1(this.l * (1 - keep1(factor)));\r\n\t\t});\r\n\t};\r\n\r\n\t// TODO: Add functions to (de)saturate the color (similar to lighten and darken?)\r\n\r\n\t// Returns a color with a changed alpha value between 0 (transparent) and 1 (opaque).\r\n\tColor_prototype.alpha = function (alpha) {\r\n\t\treturn processColor(this, true, function () {\r\n\t\t\tthis.a = keep1(alpha);\r\n\t\t});\r\n\t};\r\n\r\n\t// Returns the grayscale color by perceived brightness.\r\n\tColor_prototype.gray = function () {\r\n\t\treturn processColor(this, false, function () {\r\n\t\t\tvar value = round(keep255(this.r) * 0.3 + keep255(this.g) * 0.59 + keep255(this.b) * 0.11);\r\n\t\t\tthis.r = value;\r\n\t\t\tthis.g = value;\r\n\t\t\tthis.b = value;\r\n\t\t\tthis.a = 1;\r\n\t\t});\r\n\t};\r\n\r\n\t// Returns a value indicating whether the specified color is dark.\r\n\tColor_prototype.isDark = function () {\r\n\t\treturn this.gray().r < 144;\r\n\t};\r\n\r\n\t// Returns white or black as suitable for the text color over the background color.\r\n\tColor_prototype.text = function () {\r\n\t\treturn processColor(this, false, function () {\r\n\t\t\tvar value = this.isDark() ? 255 : 0;\r\n\t\t\tthis.r = value;\r\n\t\t\tthis.g = value;\r\n\t\t\tthis.b = value;\r\n\t\t\tthis.a = 1;\r\n\t\t});\r\n\t};\r\n\r\n\tfunction processColor(color, hslMode, fn) {\r\n\t\tcolor = Color(color);   // Make a copy\r\n\t\tif (hslMode) color.updateHSL();\r\n\t\tfn.call(color);\r\n\t\tif (hslMode) color.updateRGB();\r\n\t\treturn color;\r\n\t}\r\n\r\n\tfunction extendFF(value) {\r\n\t\treturn value === 0xff ? 256 : value;\r\n\t}\r\n\r\n\tfunction keep1(value) {\r\n\t\treturn minmax(value, 0, 1);\r\n\t}\r\n\r\n\tfunction keep255(value) {\r\n\t\treturn minmax(value, 0, 255);\r\n\t}\r\n\r\n})();\r\n","﻿import { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\n// Gets the offset and dimensions of the first selected element.\r\n//\r\n// relative: true to return the position relative to the offset parent, false for page position.\r\n$.fn.rect = function (relative) {\r\n\tvar offset = relative ? this.position() : this.offset();\r\n\tvar width = this.outerWidth();\r\n\tvar height = this.outerHeight();\r\n\treturn {\r\n\t\ttop: offset.top,\r\n\t\tleft: offset.left,\r\n\t\tright: offset.left + width,\r\n\t\tbottom: offset.top + height,\r\n\t\twidth: width,\r\n\t\theight: height\r\n\t};\r\n};\r\n\r\n// Determines whether the selected element is visible.\r\n//\r\n// value: Sets the visible state of the selected elements.\r\n$.fn.visible = function (value) {\r\n\t// Setter\r\n\tif (value !== undefined) {\r\n\t\treturn this.each(function () {\r\n\t\t\tif (value)\r\n\t\t\t\t$(this).show();\r\n\t\t\telse\r\n\t\t\t\t$(this).hide();\r\n\t\t});\r\n\t}\r\n\r\n\t// Getter\r\n\tif (this.length === 0) return;\r\n\treturn this.css(\"display\") !== \"none\";\r\n};\r\n\r\n// Determines whether the selected element is disabled.\r\n//\r\n// value: Sets the disabled state of the selected elements and the associated label(s).\r\n$.fn.disabled = function (value) {\r\n\t// Setter\r\n\tif (value !== undefined) {\r\n\t\treturn this.each(function () {\r\n\t\t\tif (value)\r\n\t\t\t\t$(this).disable();\r\n\t\t\telse\r\n\t\t\t\t$(this).enable();\r\n\t\t});\r\n\t}\r\n\r\n\t// Getter\r\n\tif (this.length === 0) return;\r\n\t// Also explicitly check for the property to support the disabledchange hook\r\n\treturn this[0].disabled || this.attr(\"disabled\") !== undefined;\r\n};\r\n\r\n// Enables the selected elements and the associated label(s).\r\n$.fn.enable = function () {\r\n\treturn this.each$(function () {\r\n\t\tvar supportsDisabledProp = \"disabled\" in this[0];\r\n\t\tif (supportsDisabledProp) {\r\n\t\t\t// Set property so that the hook can trigger the change event.\r\n\t\t\t// This automatically removes the HTML attribute as well.\r\n\t\t\tthis.prop(\"disabled\", false);\r\n\t\t}\r\n\t\telse if (this.attr(\"disabled\") !== undefined) {\r\n\t\t\t// Don't set the property or it will be added where not supported.\r\n\t\t\t// Only remove HTML attribute to allow CSS styling other elements than inputs\r\n\t\t\tthis.removeAttr(\"disabled\");\r\n\t\t\t// Trigger the event manually\r\n\t\t\tthis.trigger(\"disabledchange\");\r\n\t\t}\r\n\r\n\t\tthis.parents(\"label\").enable();\r\n\t\tvar id = this.attr(\"id\");\r\n\t\tif (id)\r\n\t\t\t$(\"label[for='\" + id + \"']\").enable();\r\n\t\t\r\n\t\t// Find previous .label sibling up on the .form-row level\r\n\t\tlet refNode = this;\r\n\t\twhile (refNode.parent().length > 0 && !refNode.parent().hasClass(\"form-row\"))\r\n\t\t\trefNode = refNode.parent();\r\n\t\tlet label = refNode.prev();\r\n\t\tif (label.hasClass(\"label\"))\r\n\t\t\tlabel.enable();\r\n\t});\r\n};\r\n\r\n// Disables the selected elements and the associated label(s).\r\n$.fn.disable = function () {\r\n\treturn this.each$(function () {\r\n\t\tvar supportsDisabledProp = \"disabled\" in this[0];\r\n\t\tif (supportsDisabledProp) {\r\n\t\t\t// Set property so that the hook can trigger the change event.\r\n\t\t\t// This automatically sets the HTML attribute as well.\r\n\t\t\tthis.prop(\"disabled\", true);\r\n\t\t}\r\n\t\telse if (this.attr(\"disabled\") === undefined) {\r\n\t\t\t// Don't set the property or it will be added where not supported.\r\n\t\t\t// Only set HTML attribute to allow CSS styling other elements than inputs\r\n\t\t\tthis.attr(\"disabled\", \"\");\r\n\t\t\t// Trigger the event manually\r\n\t\t\tthis.trigger(\"disabledchange\");\r\n\t\t}\r\n\r\n\t\tthis.parents(\"label\").disable();\r\n\t\tvar id = this.attr(\"id\");\r\n\t\tif (id)\r\n\t\t\t$(\"label[for='\" + id + \"']\").disable();\r\n\t\t\r\n\t\t// Find previous .label sibling up on the .form-row level\r\n\t\tlet refNode = this;\r\n\t\twhile (refNode.parent().length > 0 && !refNode.parent().hasClass(\"form-row\"))\r\n\t\t\trefNode = refNode.parent();\r\n\t\tlet label = refNode.prev();\r\n\t\tif (label.hasClass(\"label\"))\r\n\t\t\tlabel.disable();\r\n\t});\r\n};\r\n\r\n// Toggles the disabled state of the selected elements and the associated label(s).\r\n$.fn.toggleDisabled = function () {\r\n\treturn this.each$(function () {\r\n\t\tif (this.disabled())\r\n\t\t\tthis.enable();\r\n\t\telse\r\n\t\t\tthis.disable();\r\n\t});\r\n};\r\n\r\n// Returns the first child of each selected element, in the fastest possible way.\r\n$.fn.firstChild = function () {\r\n\tvar ret = $();\r\n\tthis.each(function () {\r\n\t\tret = ret.add(this.firstElementChild);\r\n\t});\r\n\treturn ret;\r\n};\r\n\r\n// Determines the actual cursor of the first selected element. \"auto\" is returned as \"default\".\r\n$.fn.actualCursor = function () {\r\n\t// Most elements like <a>, <input>, <textarea> or <area> already compute their actual cursor\r\n\t// value so there's nothing to do.\r\n\tvar cursor = this.css(\"cursor\");\r\n\tif (cursor !== \"auto\" || cursor === undefined) return cursor;\r\n\r\n\t// \"auto\" is mostly used for inline text content. Ignore that and just return the default\r\n\t// cursor that is shown over the empty areas of that element.\r\n\treturn \"default\";\r\n};\r\n\r\n// Determines whether the specified font exists on the client.\r\n// TODO: This fails completely on any Android browser, see https://stackoverflow.com/q/48077942\r\n$.fontExists = function (font) {\r\n\t// Test each probe letter separately so that their differences can't cancel each other\r\n\tvar probes = [\"A\", \"j\", \"l\", \"Q\", \"W\", \"1\", \"^\", \"{\", \"&\", \"@\"];\r\n\t// Compare with different fonts, of which two different ones should be available everywhere\r\n\tvar refFonts = [\"Courier\", \"Times New Roman\", \"Arial\", \"Courier New\", \"Roboto\"];\r\n\tvar container = $(\"<span style='font-size: 100px; line-height: 100%; margin: 0; padding: 0; position: absolute; top: -1000px; left: -1000px;'/>\").appendTo($(\"body\"));\r\n\r\n\tfor (var i = 0; i < probes.length; i++) {\r\n\t\t// Extend the probe to make small differences more easily measured, using a prime factor :)\r\n\t\tlet probe = \"\";\r\n\t\tfor (var k = 0; k < 7; k++) {\r\n\t\t\tprobe += probes[i];\r\n\t\t}\r\n\t\tcontainer.text(probe);\r\n\t\tfor (var j = 0; j < refFonts.length; j++) {\r\n\t\t\tcontainer.css(\"font-family\", refFonts[j]);\r\n\t\t\tvar width = container.width();\r\n\t\t\tvar height = container.height();\r\n\t\t\tcontainer.css(\"font-family\", \"\\\"\" + font + \"\\\",\\\"\" + refFonts[j] + \"\\\"\");\r\n\t\t\tif (container.width() != width || container.height() != height) {\r\n\t\t\t\tcontainer.remove();\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tcontainer.remove();\r\n\treturn false;\r\n};\r\n\r\n// Adds a pointer event handler to the selected elements, with mouse and touch fallbacks as supported.\r\n//\r\n// type: The event type (\"down\", \"move\", \"up\", \"cancel\"). Multiple types can be space-delimited.\r\n// handler: The event handler function.\r\n// capture: Specifies the capture option. If true, DOM addEventListener ist used instead of jQuery.\r\n// Returns a function that removes the event handler. Keep it and call it, there is no other way to remove it.\r\n$.fn.pointer = function (type, handler, capture) {\r\n\tvar add, remove, pointer, mouse, touch, touchType = type, mouseHandler, touchHandler;\r\n\tvar types = type.trim().split(/\\s+/);\r\n\r\n\t// Handle multiple types\r\n\tif (types.length > 1) {\r\n\t\t// Call self for each type and combine all event remover functions in a new function to return\r\n\t\tlet eventRemovers = [];\r\n\t\tlet that = this;\r\n\t\ttypes.forEach(function (type) {\r\n\t\t\teventRemovers.push($(that).pointer(type, handler, capture));\r\n\t\t});\r\n\t\treturn function () {\r\n\t\t\teventRemovers.forEach(function (eventRemover) { eventRemover(); });\r\n\t\t};\r\n\t}\r\n\r\n\t// Set up the functions to call and bind their context\r\n\tif (capture) {\r\n\t\t// Handle multiple selected elements\r\n\t\tif (this.length > 1) {\r\n\t\t\t// Call self for each element and combine all event remover functions in a new function to return\r\n\t\t\tlet eventRemovers = [];\r\n\t\t\tlet that = this;\r\n\t\t\tthis.each(function () {\r\n\t\t\t\teventRemovers.push($(that).pointer(type, handler, capture));\r\n\t\t\t});\r\n\t\t\treturn function () {\r\n\t\t\t\teventRemovers.forEach(function (eventRemover) { eventRemover(); });\r\n\t\t\t};\r\n\t\t}\r\n\t\tadd = this[0].addEventListener.bind(this[0]);\r\n\t\tremove = this[0].removeEventListener.bind(this[0]);\r\n\t}\r\n\telse {\r\n\t\tadd = this.on.bind(this);\r\n\t\tremove = this.off.bind(this);\r\n\t\tcapture = undefined;\r\n\t}\r\n\r\n\t// Fix touch event type names that are a little different\r\n\tswitch (type) {\r\n\t\tcase \"down\": touchType = \"start\"; break;\r\n\t\tcase \"up\": touchType = \"end\"; break;\r\n\t}\r\n\r\n\t// Determine the supported (and necessary) event types\r\n\tpointer = \"onpointer\" + type in window;\r\n\tif (!pointer) {\r\n\t\tmouse = \"onmouse\" + type in window;\r\n\t\ttouch = \"ontouch\" + touchType in window;\r\n\t}\r\n\r\n\t// Prepare adapted handlers for fallback event types\r\n\tif (mouse) mouseHandler = event => handleMouseEvent(handler, event);\r\n\tif (touch) touchHandler = event => handleTouchEvent(handler, event);\r\n\r\n\t// Add event handlers\r\n\tif (pointer) add(\"pointer\" + type, handler, capture);\r\n\tif (mouse) add(\"mouse\" + type, mouseHandler, capture);\r\n\tif (touch) add(\"touch\" + touchType, touchHandler, capture);\r\n\r\n\t// Return a function that removes all added event handlers, for the caller to call later\r\n\treturn function () {\r\n\t\tif (pointer) remove(\"pointer\" + type, handler, capture);\r\n\t\tif (mouse) remove(\"mouse\" + type, mouseHandler, capture);\r\n\t\tif (touch) remove(\"touch\" + touchType, touchHandler, capture);\r\n\t};\r\n};\r\n\r\n// Calls a pointer event handler for a mouse event.\r\nfunction handleMouseEvent(handler, event) {\r\n\tvar event2 = $.Event(event.type, event);\r\n\tevent2.pointerId = -event.button;\r\n\tevent2.pointerType = \"mouse\";\r\n\treturn handler(event2);\r\n}\r\n\r\n// Calls a pointer event handler for a touch event.\r\nfunction handleTouchEvent(handler, event) {\r\n\tfor (var index = 0; index < event.changedTouches.length; index++) {\r\n\t\tvar event2 = $.Event(event.type, event);\r\n\t\tevent2.pageX = event.changedTouches[index].pageX;\r\n\t\tevent2.pageY = event.changedTouches[index].pageY;\r\n\t\tevent2.pointerId = event.changedTouches[index].identifier;\r\n\t\tevent2.button = 0;\r\n\t\tevent2.pointerType = \"touch\";\r\n\t\tif (handler(event2) === false) return false;\r\n\t}\r\n}\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar draggableClass = \"ff-draggable\";\r\nvar resetAllCursorsClass = \"reset-all-cursors\";\r\n\r\n// Defines default options for the draggable plugin.\r\nvar draggableDefaults = {\r\n\t// The element(s) that can start a drag operation. Default: The element to drag.\r\n\thandle: undefined,\r\n\r\n\t// The element(s) that cannot start a drag operation. Default: None.\r\n\tcancel: undefined,\r\n\r\n\t// Constrains the drag movement along the \"x\" or \"y\" axis. Default: None.\r\n\taxis: undefined,\r\n\r\n\t// Constrains the drag movement inside the specified element or the \"parent\" of the dragged element or the \"viewport\". Default: None.\r\n\tcontainment: undefined,\r\n\r\n\t// The elements among which the dragged element will be pulled in the front. Default: None.\r\n\tstack: undefined,\r\n\r\n\t// The mouse cursor to show during dragging. Default: None.\r\n\tdragCursor: undefined,\r\n\r\n\t// A CSS class to add to the element while it's being dragged. Default: None.\r\n\tdragClass: undefined,\r\n\r\n\t// The grid to snap the dragged element to during dragging, as [x, y] in pixels. Default: [1, 1].\r\n\tgrid: undefined,\r\n\r\n\t// Indicates whether the window should scroll to keep the dragged element visible. Default: false.\r\n\tscroll: false\r\n};\r\n\r\n// Makes each selected element draggable.\r\nfunction draggable(options) {\r\n\treturn this.each(function () {\r\n\t\tvar elem = this;\r\n\t\tvar $elem = $(elem);\r\n\t\tif ($elem.hasClass(draggableClass)) return;   // Already done\r\n\t\t$elem.addClass(draggableClass);\r\n\t\tvar dragging, draggingCancelled, dragPoint, elemRect, minDragDistance, pointerId, htmlCursor;\r\n\t\tvar opt = initOptions(\"draggable\", draggableDefaults, $elem, {}, options);\r\n\t\tlet $window = $(window);\r\n\r\n\t\tvar handle = opt.handle ? $elem.find(opt.handle) : $elem;\r\n\t\topt.handleElem = handle;\r\n\r\n\t\t// Allow Pointer API to work properly in Edge\r\n\t\topt.originalTouchAction = handle.css(\"touch-action\");\r\n\t\tif (opt.axis === \"x\")\r\n\t\t\thandle.css(\"touch-action\", \"pan-y pinch-zoom\");\r\n\t\telse if (opt.axis === \"y\")\r\n\t\t\thandle.css(\"touch-action\", \"pan-x pinch-zoom\");\r\n\t\telse\r\n\t\t\thandle.css(\"touch-action\", \"pinch-zoom\");\r\n\r\n\t\topt.eventRemovers = [];\r\n\t\tvar eventRemovers = [];\r\n\t\topt.eventRemovers.push(handle.pointer(\"down\", function (event) {\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tif (dragging) return;\r\n\t\t\t\tdraggingCancelled = false;\r\n\t\t\t\tdragPoint = { left: event.pageX, top: event.pageY };\r\n\t\t\t\tpointerId = event.pointerId;\r\n\t\t\t\tminDragDistance = event.pointerType === \"touch\" ? 8 : 4;\r\n\t\t\t\teventRemovers.push($window.pointer(\"move\", onMove, true));\r\n\t\t\t\teventRemovers.push($window.pointer(\"up cancel\", onEnd, true));\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tif (opt.cancel) {\r\n\t\t\topt.eventRemovers.push($elem.find(opt.cancel).pointer(\"down\", function (event) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\tfunction onMove(event) {\r\n\t\t\tif (event.pointerId !== pointerId) return;   // Not my pointer\r\n\t\t\tif (draggingCancelled) return;   // Don't try again until the button was released\r\n\r\n\t\t\t// Consider starting a drag operation\r\n\t\t\tif (dragPoint && !dragging && !$elem.disabled()) {\r\n\t\t\t\tlet distance = Math.sqrt(Math.pow(event.pageX - dragPoint.left, 2) + Math.pow(event.pageY - dragPoint.top, 2));\r\n\t\t\t\tif (distance >= minDragDistance) {\r\n\t\t\t\t\telemRect = $elem.rect();\r\n\t\t\t\t\tlet event2 = $.Event(\"draggablestart\");\r\n\t\t\t\t\tevent2.dragPoint = dragPoint;\r\n\t\t\t\t\tevent2.newPoint = { left: event.pageX, top: event.pageY };\r\n\t\t\t\t\t$elem.trigger(event2);\r\n\t\t\t\t\tif (!event2.isDefaultPrevented()) {\r\n\t\t\t\t\t\tdragging = true;\r\n\t\t\t\t\t\topt.dragClass && $elem.addClass(opt.dragClass);\r\n\t\t\t\t\t\telem.setCapture && elem.setCapture();   // Firefox only (set cursor over entire desktop)\r\n\t\t\t\t\t\t$(\"html\").addClass(resetAllCursorsClass);   // All browsers (set cursor at least within page)\r\n\t\t\t\t\t\tif (opt.stack) {\r\n\t\t\t\t\t\t\tstackElements($(opt.stack), elem);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\thtmlCursor = document.documentElement.style.getPropertyValue(\"cursor\");\r\n\t\t\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", opt.dragCursor || $elem.actualCursor(), \"important\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tdraggingCancelled = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Handle an ongoing drag operation\r\n\t\t\tif (dragging) {\r\n\t\t\t\t// Start with the default drag movement position\r\n\t\t\t\tvar newPoint = {\r\n\t\t\t\t\ttop: elemRect.top + event.pageY - dragPoint.top,\r\n\t\t\t\t\tleft: elemRect.left + event.pageX - dragPoint.left\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Consider constraints\r\n\t\t\t\tif (opt.grid) {\r\n\t\t\t\t\tlet gridBase = $elem.parent().offset();\r\n\t\t\t\t\tnewPoint = {\r\n\t\t\t\t\t\ttop: Math.round((newPoint.top - gridBase.top) / opt.grid[1]) * opt.grid[1] + gridBase.top,\r\n\t\t\t\t\t\tleft: Math.round((newPoint.left - gridBase.left) / opt.grid[0]) * opt.grid[0] + gridBase.left\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.axis === \"x\") {\r\n\t\t\t\t\tnewPoint.top = elemRect.top;\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.axis === \"y\") {\r\n\t\t\t\t\tnewPoint.left = elemRect.left;\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.containment) {\r\n\t\t\t\t\tlet cont, contRect;\r\n\t\t\t\t\tif (opt.containment === \"parent\") {\r\n\t\t\t\t\t\tcont = $elem.parent();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (opt.containment === \"viewport\") {\r\n\t\t\t\t\t\tlet scrollTop = $window.scrollTop();\r\n\t\t\t\t\t\tlet scrollLeft = $window.scrollLeft();\r\n\t\t\t\t\t\tcontRect = {\r\n\t\t\t\t\t\t\ttop: 0 + scrollTop,\r\n\t\t\t\t\t\t\tleft: 0 + scrollLeft,\r\n\t\t\t\t\t\t\tbottom: $window.height() + scrollTop,\r\n\t\t\t\t\t\t\tright: $window.width() + scrollLeft\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tcont = $(opt.containment);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (cont && cont.length > 0) {\r\n\t\t\t\t\t\tcontRect = cont.rect();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (contRect) {\r\n\t\t\t\t\t\tlet stepX = opt.grid ? opt.grid[0] : 1;\r\n\t\t\t\t\t\tlet stepY = opt.grid ? opt.grid[1] : 1;\r\n\t\t\t\t\t\twhile (newPoint.left < contRect.left) newPoint.left += stepX;\r\n\t\t\t\t\t\twhile (newPoint.left + elemRect.width > contRect.right) newPoint.left -= stepX;\r\n\t\t\t\t\t\twhile (newPoint.top < contRect.top) newPoint.top += stepY;\r\n\t\t\t\t\t\twhile (newPoint.top + elemRect.height > contRect.bottom) newPoint.top -= stepY;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move element\r\n\t\t\t\tlet event2 = $.Event(\"draggablemove\");\r\n\t\t\t\tevent2.elemRect = elemRect;\r\n\t\t\t\tevent2.newPoint = newPoint;\r\n\t\t\t\t$elem.trigger(event2);\r\n\t\t\t\tif (!event2.isDefaultPrevented()) {\r\n\t\t\t\t\t$elem.offset(event2.newPoint);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Handle auto-scrolling\r\n\t\t\t\tif (opt.scroll) {\r\n\t\t\t\t\tscrollIntoView($elem.rect());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onEnd(event) {\r\n\t\t\tif (event.pointerId !== pointerId) return;   // Not my pointer\r\n\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tvar wasDragging = dragging;\r\n\t\t\t\tdragPoint = undefined;\r\n\t\t\t\tdragging = false;\r\n\t\t\t\tpointerId = undefined;\r\n\t\t\t\topt.dragClass && $elem.removeClass(opt.dragClass);\r\n\r\n\t\t\t\teventRemovers.forEach(eventRemover => eventRemover());\r\n\t\t\t\teventRemovers = [];\r\n\r\n\t\t\t\tif (wasDragging) {\r\n\t\t\t\t\telem.releaseCapture && elem.releaseCapture();\r\n\t\t\t\t\t$(\"html\").removeClass(resetAllCursorsClass);\r\n\t\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", htmlCursor);\r\n\r\n\t\t\t\t\tlet event2 = $.Event(\"draggableend\");\r\n\t\t\t\t\tevent2.revert = function () {\r\n\t\t\t\t\t\t$elem.offset(elemRect);\r\n\t\t\t\t\t};\r\n\t\t\t\t\t$elem.trigger(event2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Removes the draggable features from the elements.\r\nfunction remove() {\r\n\treturn this.each(function () {\r\n\t\tvar elem = this;\r\n\t\tvar $elem = $(elem);\r\n\t\tif (!$elem.hasClass(draggableClass)) return;\r\n\t\t$elem.removeClass(draggableClass);\r\n\t\tvar opt = loadOptions(\"draggable\", $elem);\r\n\t\topt.handleElem.css(\"touch-action\", opt.originalTouchAction);\r\n\t\topt.eventRemovers.forEach(eventRemover => eventRemover());\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"draggable\", draggable, {\r\n\tremove: remove\r\n});\r\n$.fn.draggable.defaults = draggableDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { forceReflow } from \"../util\";\r\n\r\nvar dropdownContainerClass = \"ff-dropdown-container\";\r\n\r\n// Defines default options for the dropdown plugin.\r\nvar dropdownDefaults = {\r\n\t// The placement of the dropdown relative to the target element. Default: None.\r\n\tplacement: undefined,\r\n\r\n\t// Indicates whether the dropdown is closed when clicking anywhere outside of it. Default: true.\r\n\tautoClose: true,\r\n\t\r\n\t// Indicates whether the dropdown is closed when the window is resized. Default: true.\r\n\tcloseOnResize: true,\r\n\t\r\n\t// Indicates whether the dropdown is closed when the document is hidden. Default: true.\r\n\tcloseOnHide: true,\r\n\t\r\n\t// The maximum height of the dropdown, in pixels. Default: 0 (no limit).\r\n\tmaxHeight: 0,\r\n\r\n\t// Indicates whether the dropdown has fixed position instead of absolute. Default: false.\r\n\tfixed: false\r\n};\r\n\r\n// Opens a dropdown with the selected element and places it at the specified target element.\r\nfunction createDropdown(target, options) {\r\n\tvar dropdown = this.first();\r\n\tif (dropdown.length === 0) return this;   // Nothing to do\r\n\tif (dropdown.parent().hasClass(dropdownContainerClass)) return;   // Already open\r\n\tvar opt = initOptions(\"dropdown\", dropdownDefaults, dropdown, {}, options);\r\n\r\n\tvar autoPlacement = false;\r\n\tif (!opt.placement) {\r\n\t\topt.placement = \"bottom-left\";\r\n\t\tautoPlacement = true;\r\n\t}\r\n\telse if (opt.placement === \"right\") {\r\n\t\topt.placement = \"bottom-right\";\r\n\t\tautoPlacement = true;\r\n\t}\r\n\tvar optPlacement = opt.placement;\r\n\r\n\t// Measure before adding the dropdown to the document (which may add a scrollbar, virtually)\r\n\tvar $window = $(window);\r\n\tvar viewportWidth = $window.width() - 1;\r\n\tvar viewportHeight = $window.height() - 1;\r\n\tvar scrollTop = $window.scrollTop();\r\n\tvar scrollLeft = $window.scrollLeft();\r\n\tvar targetRect = $(target).rect();\r\n\tvar isReducedHeight = false;\r\n\tvar isRightAligned = false;\r\n\tvar isHorizontallyCentered = false;\r\n\r\n\tvar container = $(\"<div/>\").addClass(dropdownContainerClass).appendTo(\"body\");\r\n\tif (opt.fixed) {\r\n\t\tcontainer.css(\"position\", \"fixed\");\r\n\t}\r\n\tif (dropdown.hasClass(\"bordered\")) {\r\n\t\tcontainer.addClass(\"bordered\");\r\n\t}\r\n\tif ($(document.body).hasClass(\"ff-dimmed\")) {\r\n\t\tcontainer.addClass(\"no-dim\");\r\n\t}\r\n\tdropdown.appendTo(container);\r\n\r\n\t// Now measure the container with its contents\r\n\tvar dropdownWidth = container.outerWidth();\r\n\tvar dropdownHeight = container.outerHeight();\r\n\r\n\t// Limit height if specified, has effect on placement\r\n\tif (opt.maxHeight && opt.maxHeight < dropdownHeight) {\r\n\t\tdropdownHeight = opt.maxHeight;\r\n\t\tcontainer.outerHeight(dropdownHeight);\r\n\t\tisReducedHeight = true;\r\n\t}\r\n\r\n\t// Place at bottom side, align left, by default\r\n\tvar top = targetRect.bottom,\r\n\t\tleft = targetRect.left,\r\n\t\tdirection = \"bottom\";\r\n\r\n\tif (optPlacement.startsWith(\"top\")) {\r\n\t\ttop = targetRect.top - dropdownHeight;\r\n\t\tdirection = \"top\";\r\n\t}\r\n\telse if (optPlacement.startsWith(\"bottom\")) {\r\n\t\ttop = targetRect.bottom;\r\n\t\tdirection = \"bottom\";\r\n\t}\r\n\telse if (optPlacement.startsWith(\"left\")) {\r\n\t\tleft = targetRect.left - dropdownWidth;\r\n\t\tdirection = \"left\";\r\n\t\tisRightAligned = true;\r\n\t}\r\n\telse if (optPlacement.startsWith(\"right\")) {\r\n\t\tleft = targetRect.right;\r\n\t\tdirection = \"right\";\r\n\t}\r\n\r\n\tif (optPlacement.endsWith(\"left\")) {\r\n\t\tleft = targetRect.left;\r\n\t}\r\n\telse if (optPlacement.endsWith(\"right\")) {\r\n\t\tleft = targetRect.right - dropdownWidth;\r\n\t\tisRightAligned = true;\r\n\t}\r\n\telse if (optPlacement.endsWith(\"top\")) {\r\n\t\ttop = targetRect.top;\r\n\t}\r\n\telse if (optPlacement.endsWith(\"bottom\")) {\r\n\t\ttop = targetRect.bottom - dropdownHeight;\r\n\t}\r\n\r\n\tif (optPlacement === \"top-center\" || optPlacement === \"bottom-center\") {\r\n\t\tleft = (targetRect.left + targetRect.right) / 2 - dropdownWidth / 2;\r\n\t\tisHorizontallyCentered = true;\r\n\t}\r\n\telse if (optPlacement === \"left-center\" || optPlacement === \"right-center\") {\r\n\t\ttop = (targetRect.top + targetRect.bottom) / 2 - dropdownHeight / 2;\r\n\t}\r\n\r\n\tif (autoPlacement && left + dropdownWidth > viewportWidth) {\r\n\t\tleft = viewportWidth - dropdownWidth;\r\n\t}\r\n\tif (autoPlacement && top + dropdownHeight > viewportHeight + scrollTop) {\r\n\t\tlet topSpace = targetRect.top - scrollTop;\r\n\t\tlet bottomSpace = viewportHeight + scrollTop - targetRect.bottom;\r\n\t\tif (topSpace > bottomSpace) {\r\n\t\t\ttop = targetRect.top - dropdownHeight;\r\n\t\t\tdirection = \"top\";\r\n\t\t}\r\n\t}\r\n\t\r\n\tlet availableHeight;\r\n\tif (direction === \"top\") {\r\n\t\tavailableHeight = targetRect.top - scrollTop;\r\n\t}\r\n\telse if (direction === \"bottom\") {\r\n\t\tavailableHeight = viewportHeight + scrollTop - targetRect.bottom;\r\n\t}\r\n\telse {\r\n\t\tavailableHeight = viewportHeight;\r\n\t}\r\n\tif (dropdownHeight > availableHeight) {\r\n\t\tdropdownHeight = availableHeight;\r\n\t\tcontainer.outerHeight(dropdownHeight);\r\n\t\tisReducedHeight = true;\r\n\t\tif (direction === \"top\")\r\n\t\t\ttop = targetRect.top - dropdownHeight;\r\n\t}\r\n\r\n\tif (direction === \"left\" || direction === \"right\") {\r\n\t\tif (top + dropdownHeight > viewportHeight + scrollTop) {\r\n\t\t\ttop = viewportHeight + scrollTop - dropdownHeight;\r\n\t\t}\r\n\t\telse if (top < scrollTop) {\r\n\t\t\ttop = scrollTop;\r\n\t\t}\r\n\t}\r\n\telse if (direction === \"top\" || direction === \"bottom\") {\r\n\t\tif (left + dropdownWidth > viewportWidth + scrollLeft) {\r\n\t\t\tleft = viewportWidth + scrollLeft - dropdownWidth;\r\n\t\t}\r\n\t\telse if (left < scrollLeft) {\r\n\t\t\tleft = scrollLeft;\r\n\t\t}\r\n\t}\r\n\t\r\n\tif (isReducedHeight) {\r\n\t\tlet scrollbarWidth = container[0].offsetWidth - container[0].clientWidth;\r\n\t\tif (scrollbarWidth > 0) {\r\n\t\t\tdropdownWidth += scrollbarWidth;\r\n\t\t\tcontainer.outerWidth(dropdownWidth);\r\n\t\t\tif (isRightAligned) {\r\n\t\t\t\tleft -= scrollbarWidth;\r\n\t\t\t}\r\n\t\t\telse if (isHorizontallyCentered) {\r\n\t\t\t\tleft -= scrollbarWidth / 2;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcontainer.offset({ top: top, left: left })\r\n\t\t.addClass(\"animate-\" + direction);\r\n\tforceReflow();\r\n\tcontainer.addClass(\"open\");\r\n\r\n\t// Auto-close the dropdown when clicking outside of it\r\n\tif (opt.autoClose === undefined || opt.autoClose) {\r\n\t\tsetTimeout(function () {\r\n\t\t\t$(document).on(\"click.dropdown-close\", function (event) {\r\n\t\t\t\ttryClose();\r\n\t\t\t});\r\n\t\t}, 20);\r\n\t\tcontainer.click(function (event) {\r\n\t\t\t// Don't close the dropdown when clicking inside of it\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t});\r\n\t}\r\n\t\r\n\tif (opt.closeOnResize === undefined || opt.closeOnResize) {\r\n\t\t$window.on(\"resize.dropdown\", tryClose);\r\n\t}\r\n\t\r\n\tif (opt.closeOnHide === undefined || opt.closeOnHide) {\r\n\t\t$(document).on(\"visibilitychange.dropdown\", function () {\r\n\t\t\tif (document.hidden)\r\n\t\t\t\ttryClose();\r\n\t\t});\r\n\t}\r\n\treturn this;\r\n\r\n\tfunction tryClose() {\r\n\t\tvar event = $.Event(\"dropdownclose\");\r\n\t\tdropdown.trigger(event);\r\n\t\tif (!event.isDefaultPrevented()) {\r\n\t\t\tdropdown.dropdown.close(true);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Determines whether the dropdown is currently open.\r\n//\r\nfunction isDropdownOpen() {\r\n\tvar dropdown = this.first();\r\n\tif (dropdown.length === 0) return this;   // Nothing to do\r\n\tvar container = dropdown.parent();\r\n\treturn container.hasClass(dropdownContainerClass);\r\n}\r\n\r\n// Closes the selected dropdown.\r\n//\r\n// closeEventTriggered: For internal use.\r\nfunction closeDropdown(closeEventTriggered) {\r\n\tvar dropdown = this.first();\r\n\tif (dropdown.length === 0) return this;   // Nothing to do\r\n\tvar container = dropdown.parent();\r\n\tif (!container.hasClass(dropdownContainerClass)) return this;   // Dropdown is not open\r\n\t//var opt = loadOptions(\"dropdown\", dropdown);\r\n\r\n\t$(document).off(\"click.dropdown-close\");\r\n\tcontainer.removeClass(\"open\").addClass(\"closed\");\r\n\tcontainer.on(\"transitionend\", function () {\r\n\t\tdropdown.appendTo(\"body\");\r\n\t\tcontainer.remove();\r\n\t});\r\n\tif (!closeEventTriggered) {\r\n\t\tvar event = $.Event(\"dropdownclose\");\r\n\t\tdropdown.trigger(event);\r\n\t}\r\n\t$(window).off(\"resize.dropdown\");\r\n\t$(document).off(\"visibilitychange.dropdown\");\r\n\treturn this;\r\n}\r\n\r\nregisterPlugin(\"dropdown\", createDropdown, {\r\n\tisOpen: isDropdownOpen,\r\n\tclose: closeDropdown\r\n});\r\n$.fn.dropdown.defaults = dropdownDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar inputWrapperClass = \"ff-input-wrapper\";\r\nvar repeatButtonClass = \"ff-repeat-button\";\r\nvar styleCheckboxClass = \"ff-checkbox\";\r\nvar treeStateClass = \"ff-threestate\";\r\nvar textareaWrapperClass = \"ff-textarea-wrapper\";\r\n\r\n// Makes each selected button trigger repeated click events while being pressed.\r\n// The button will not trigger a click event anymore but instead repeatclick events.\r\nfunction repeatButton() {\r\n\treturn this.each(function () {\r\n\t\tvar button = $(this);\r\n\t\tif (button.hasClass(repeatButtonClass)) return;   // Already done\r\n\t\tbutton.addClass(repeatButtonClass);\r\n\t\tvar timeout, ms;\r\n\t\tbutton.on(\"mousedown touchstart\", function (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tms = 500;\r\n\t\t\tclick();\r\n\t\t});\r\n\t\tbutton.on(\"mouseup mouseleave touchend touchcancel\", function (event) {\r\n\t\t\tif (timeout) {\r\n\t\t\t\tclearTimeout(timeout);\r\n\t\t\t\ttimeout = undefined;\r\n\t\t\t}\r\n\t\t\tms = undefined;\r\n\t\t});\r\n\t\tbutton.click(function (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\r\n\t\t// Triggers the button's click event and repeats the timeout\r\n\t\tfunction click() {\r\n\t\t\tbutton.trigger(\"repeatclick\");\r\n\t\t\ttimeout = setTimeout(click, ms);\r\n\t\t\tms = 50 + Math.round((ms - 50) * 0.8);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"repeatButton\", repeatButton);\r\n\r\n// Adds buttons to each selected input[type=number] element to decrement or increment the value.\r\nfunction spinner() {\r\n\treturn this.each(function () {\r\n\t\tvar input = $(this);\r\n\t\tif (input.parent().hasClass(inputWrapperClass)) return;   // Already done\r\n\r\n\t\t// Put a wrapper between the input and its parent\r\n\t\tvar wrapper = $(\"<div/>\").addClass(inputWrapperClass).attr(\"style\", input.attr(\"style\"));\r\n\t\tinput.before(wrapper).appendTo(wrapper);\r\n\t\tinput.attr(\"autocomplete\", \"off\");\r\n\r\n\t\t// Add control buttons\r\n\t\tvar buttons = [];\r\n\t\tvar decButton = $(\"<button type='button'/>\").appendTo(wrapper).attr(\"tabindex\", \"-1\").text(\"\\u2212\");   // &minus;\r\n\t\tbuttons.push(decButton);\r\n\t\tdecButton.on(\"repeatclick\", function (event) {\r\n\t\t\tif (input.disabled()) return;\r\n\t\t\tvar value = +input.val();\r\n\t\t\tvar min = input.attr(\"min\");\r\n\t\t\tvar max = input.attr(\"max\");\r\n\t\t\tvar stepBase = min !== undefined ? +min : 0;\r\n\t\t\tlet match = input.attr(\"step\") ? input.attr(\"step\").match(/^\\s*\\*(.*)/) : false;\r\n\t\t\tif (match) {\r\n\t\t\t\tlet factor = +match[1] || 10;\r\n\t\t\t\tif ((min === undefined || value / factor >= min) && (max === undefined || value / factor <= max))\r\n\t\t\t\t\tvalue /= factor;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar step = +input.attr(\"step\") || 1;\r\n\t\t\t\tvar corr = step / 1000;   // Correct JavaScript's imprecise numbers\r\n\t\t\t\tvalue = (Math.ceil((value - stepBase - corr) / step) - 1) * step + stepBase;   // Set to next-smaller valid step\r\n\t\t\t\tif (min !== undefined && value < +min) value = +min;\r\n\t\t\t\twhile (max !== undefined && value > +max) value -= step;\r\n\t\t\t}\r\n\t\t\tlet valueStr = value.toFixed(10).replace(/0+$/, \"\").replace(/[.,]$/, \"\");   // Correct JavaScript's imprecise numbers again\r\n\t\t\tinput.val(valueStr);\r\n\t\t\tinput.trigger(\"input\").change();\r\n\t\t});\r\n\t\tdecButton.repeatButton();\r\n\t\tvar incButton = $(\"<button type='button'/>\").appendTo(wrapper).attr(\"tabindex\", \"-1\").text(\"+\");\r\n\t\tbuttons.push(incButton);\r\n\t\tincButton.on(\"repeatclick\", function (event) {\r\n\t\t\tif (input.disabled()) return;\r\n\t\t\tvar value = +input.val();\r\n\t\t\tvar min = input.attr(\"min\");\r\n\t\t\tvar max = input.attr(\"max\");\r\n\t\t\tvar stepBase = min !== undefined ? +min : 0;\r\n\t\t\tlet match = input.attr(\"step\") ? input.attr(\"step\").match(/^\\s*\\*(.*)/) : false;\r\n\t\t\tif (match) {\r\n\t\t\t\tlet factor = +match[1] || 10;\r\n\t\t\t\tif ((min === undefined || value * factor >= min) && (max === undefined || value * factor <= max))\r\n\t\t\t\t\tvalue *= factor;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar step = +input.attr(\"step\") || 1;\r\n\t\t\t\tvar corr = step / 1000;   // Correct JavaScript's imprecise numbers\r\n\t\t\t\tvalue = (Math.floor((value - stepBase + corr) / step) + 1) * step + stepBase;   // Set to next-greater valid step\r\n\t\t\t\tif (min !== undefined && value < +min) value = +min;\r\n\t\t\t\twhile (max !== undefined && value > +max) value -= step;\r\n\t\t\t}\r\n\t\t\tlet valueStr = +value.toFixed(10).replace(/0+$/, \"\").replace(/[.,]$/, \"\");   // Correct JavaScript's imprecise numbers again\r\n\t\t\tinput.val(valueStr);\r\n\t\t\tinput.trigger(\"input\").change();\r\n\t\t});\r\n\t\tincButton.repeatButton();\r\n\t\tbindInputButtonsDisabled(input, buttons);\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"spinner\", spinner);\r\n\r\n// Converts each selected input[type=color] element into a text field with color picker button.\r\nfunction colorPicker() {\r\n\treturn this.each(function () {\r\n\t\tvar input = $(this);\r\n\t\tif (input.parent().hasClass(inputWrapperClass)) return;   // Already done\r\n\t\tvar lastColor;\r\n\r\n\t\tinput.attr(\"type\", \"text\").attr(\"autocomplete\", \"off\");\r\n\r\n\t\t// Put a wrapper between the input and its parent\r\n\t\tvar wrapper = $(\"<div/>\").addClass(inputWrapperClass).attr(\"style\", input.attr(\"style\"));\r\n\t\tinput.before(wrapper).appendTo(wrapper);\r\n\r\n\t\t// Create picker dropdown\r\n\t\tvar dropdown = $(\"<div/>\").addClass(\"dropdown bordered ff-colorpicker\");\r\n\t\tdropdown.keydown(function (event) {\r\n\t\t\tif (event.keyCode >= 37 && event.keyCode <= 40) {   // Arrow keys\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tdropdown.find(\"button\").first().focus();\r\n\t\t\t\tdropdown.removeAttr(\"tabindex\");\r\n\t\t\t}\r\n\t\t\tif (event.keyCode === 27) {   // Esc\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tdropdown.dropdown.close();\r\n\t\t\t\tpickButton[0].focus();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Add control buttons\r\n\t\tvar buttons = [];\r\n\t\tvar pickButton = $(\"<button type='button'/>\").addClass(\"ff-colorbutton\").appendTo(wrapper);\r\n\t\tbuttons.push(pickButton);\r\n\t\tvar colorBox = $(\"<div/>\").appendTo(pickButton).text(\"\\u2026\");   // &hellip;\r\n\t\tinput.on(\"input change\", () => setColor(lastColor = input.val()));\r\n\t\tsetColor(lastColor = input.val());\r\n\r\n\t\t// Create dropdown contents\r\n\t\t// Add grey tones explicitly\r\n\t\tvar colors = [0x000000, 0x404040, 0x707070, 0xa0a0a0, 0xd0d0d0, 0xf0f0f0, 0xffffff];\r\n\t\t// Add colors with shades\r\n\t\t[\r\n\t\t\t0xff0000,   // red\r\n\t\t\t0xff8000,   // orange\r\n\t\t\t0xffc000,   // orangeyellow\r\n\t\t\t0xffe000,   // gold\r\n\t\t\t0xffff00,   // yellow\r\n\t\t\t0xc0ff00,   // greenyellow\r\n\t\t\t0x00ff00,   // green\r\n\t\t\t0x00ffc0,   // greencyan\r\n\t\t\t0x00ffff,   // cyan\r\n\t\t\t0x00c0ff,   // bluecyan\r\n\t\t\t0x0080ff,   // lightblue\r\n\t\t\t0x0000ff,   // blue\r\n\t\t\t0x8000ff,   // purple\r\n\t\t\t0xc000ff,   // violet\r\n\t\t\t0xff00ff    // magenta\r\n\t\t].forEach(function (baseColor_) {\r\n\t\t\tvar baseColor = Color(baseColor_);\r\n\t\t\t[0.75, 0.5, 0.25].forEach(factor => colors.push(baseColor.blendWith(0x000000, factor)));\r\n\t\t\tcolors.push(baseColor.toHTML());\r\n\t\t\t[0.5, 0.75, 0.875].forEach(factor => colors.push(baseColor.blendWith(0xffffff, factor)));\r\n\t\t});\r\n\t\tvar buttonRow;\r\n\t\tcolors.forEach(function (color, index) {\r\n\t\t\tcolor = Color(color);\r\n\t\t\tcolor.format = \"HTML\";\r\n\t\t\tif (index % 7 === 0)\r\n\t\t\t\tbuttonRow = $(\"<div/>\").appendTo(dropdown);\r\n\t\t\tvar button = $(\"<button type='button'/>\").css(\"background\", color).data(\"color\", String(color)).appendTo(buttonRow);\r\n\t\t\tif (color.isDark()) button.addClass(\"dark\");\r\n\t\t\tbutton.click(function (event) {\r\n\t\t\t\tsetColor(lastColor = color, true);\r\n\t\t\t\tdropdown.dropdown.close();\r\n\t\t\t\tpickButton[0].focus();\r\n\t\t\t});\r\n\t\t\tbutton.focus(function (event) {\r\n\t\t\t\tdropdown.find(\"button.active\").removeClass(\"active\");\r\n\t\t\t\tbutton.addClass(\"active\");\r\n\t\t\t\tsetColor(color, true);\r\n\t\t\t});\r\n\t\t\tbutton.keydown(function (event) {\r\n\t\t\t\tvar activeButton = dropdown.find(\"button.active\");\r\n\t\t\t\tvar newButton;\r\n\r\n\t\t\t\tswitch (event.keyCode) {\r\n\t\t\t\t\tcase 37:   // Left\r\n\t\t\t\t\t\tnewButton = activeButton.prev();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 39:   // Right\r\n\t\t\t\t\t\tnewButton = activeButton.next();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 40:   // Down\r\n\t\t\t\t\t\tnewButton = activeButton.parent().next().children().eq(activeButton.index());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 38:   // Up\r\n\t\t\t\t\t\tnewButton = activeButton.parent().prev().children().eq(activeButton.index());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 27:   // Esc\r\n\t\t\t\t\t\tsetColor(lastColor, true);\r\n\t\t\t\t\t\tdropdown.dropdown.close();\r\n\t\t\t\t\t\tpickButton[0].focus();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 13:   // Enter\r\n\t\t\t\t\t\tbutton.click();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn;   // Not handled\r\n\t\t\t\t}\r\n\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tnewButton && newButton[0] && newButton[0].focus();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tpickButton.click(function (event) {\r\n\t\t\tvar currentColor = input.val();\r\n\t\t\tvar activeButton;\r\n\t\t\tdropdown.find(\"button\").each$(function () {\r\n\t\t\t\tvar active = this.data(\"color\") === currentColor;\r\n\t\t\t\tthis.toggleClass(\"active\", active);\r\n\t\t\t\tif (active) activeButton = this[0];\r\n\t\t\t});\r\n\r\n\t\t\tdropdown.dropdown(pickButton, { placement: \"right\" });\r\n\t\t\tif (activeButton) {\r\n\t\t\t\tactiveButton.focus();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdropdown.attr(\"tabindex\", \"-1\");\r\n\t\t\t\tdropdown.focus();\r\n\t\t\t}\r\n\t\t});\r\n\t\tbindInputButtonsDisabled(input, buttons);\r\n\r\n\t\tfunction setColor(color, toInput) {\r\n\t\t\tif (toInput && input.val() != color) {\r\n\t\t\t\tinput.val(color).trigger(\"input\").change();\r\n\t\t\t}\r\n\t\t\tcolorBox.css(\"background\", color);\r\n\t\t\tcolorBox.css(\"color\", Color(color).text());\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"colorPicker\", colorPicker);\r\n\r\n// Applies the enhanced style on the selected checkbox and radio input elements.\r\nfunction styleCheckbox() {\r\n\treturn this.each(function () {\r\n\t\tvar input = $(this);\r\n\t\tif (input.hasClass(styleCheckboxClass)) return;   // Already done\r\n\t\tif (!input.is(\"input[type=checkbox], input[type=radio]\")) return;   // Wrong element\r\n\r\n\t\tif (input.parents(\"label\").length === 0) {\r\n\t\t\t// Styled input needs a label around it to remain clickable\r\n\t\t\tinput.wrap(\"<label class='empty'></label>\");\r\n\t\t}\r\n\t\tinput.addClass(styleCheckboxClass).after($(\"<span/>\"));\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"styleCheckbox\", styleCheckbox);\r\n\r\n// Makes each selected checkbox cycle through indeterminate (third) state on clicking.\r\nfunction threeState() {\r\n\treturn this.each(function () {\r\n\t\tvar input = $(this);\r\n\t\tif (input.hasClass(treeStateClass)) return;   // Already done\r\n\t\tif (!input.is(\"input[type=checkbox]\")) return;   // Wrong element\r\n\t\tinput.addClass(treeStateClass);\r\n\r\n\t\tvar cb = input[0];\r\n\t\t// Based on: https://css-tricks.com/indeterminate-checkboxes/\r\n\t\tinput.click(function (event) {\r\n\t\t\t// indeterminate is unset when the user clicks to change the checked state.\r\n\t\t\t// readonly (ineffective for checkboxes) is used to backup the previous indeterminate state.\r\n\t\t\t// In this event, checked is already updated to the new desired state.\r\n\t\t\tif (cb.checked && !cb.readOnly) {\r\n\t\t\t\t// Was unchecked and not readonly (indeterminate) -> uncheck and make indeterminate\r\n\t\t\t\tcb.checked = false;\r\n\t\t\t\tcb.readOnly = cb.indeterminate = true;\r\n\t\t\t}\r\n\t\t\telse if (cb.readOnly) {\r\n\t\t\t\t// Was readonly (indeterminate) -> check and forget indeterminate state (unset readonly)\r\n\t\t\t\tcb.checked = true;   // Firefox and Chrome are already checked here, Edge is not\r\n\t\t\t\tcb.readOnly = false;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"threeState\", threeState);\r\n\r\n// Makes each selected textarea element automatically adjust its height to its content.\r\nfunction autoHeight(minRows, maxRows, extraRows) {\r\n\tminRows = minRows || 3;\r\n\treturn this.each(function () {\r\n\t\tvar textarea = $(this);\r\n\t\tif (textarea.parent().hasClass(textareaWrapperClass)) return;   // Already done\r\n\r\n\t\t// Put a wrapper between the textarea and its parent, and host a new shadow element in\r\n\t\t// the wrapper as well. The textarea is set to fill the container, and the shadow\r\n\t\t// element provides the size for the wrapper.\r\n\t\tvar wrapper = $(\"<div/>\").addClass(textareaWrapperClass).attr(\"style\", textarea.attr(\"style\"));\r\n\t\ttextarea.before(wrapper).appendTo(wrapper);\r\n\t\tvar shadowContent = $(\"<div/>\").appendTo(wrapper);\r\n\r\n\t\tvar outerHeightOffset = textarea.outerHeight() - textarea.height();\r\n\t\tvar lineHeight = parseFloat(textarea.css(\"line-height\"));\r\n\t\tif (lineHeight) {\r\n\t\t\tshadowContent.css(\"min-height\", minRows * lineHeight + outerHeightOffset);\r\n\t\t\tif (maxRows) {\r\n\t\t\t\tshadowContent.css(\"max-height\", maxRows * lineHeight + outerHeightOffset);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttextarea.on(\"input.autoheight\", updateShadow);\r\n\t\tupdateShadow();\r\n\r\n\t\tfunction updateShadow() {\r\n\t\t\t// Copy textarea contents; browser will calculate correct height of shadow copy,\r\n\t\t\t// which will make overall wrapper taller, which will make textarea taller.\r\n\t\t\t// Also make sure the last line break is visible.\r\n\t\t\t// Add an extra line break to convince the browser that the textarea doesn't need a scrollbar.\r\n\t\t\tvar text = textarea.val().replace(/\\n$/, \"\\n.\");\r\n\t\t\tif (extraRows)\r\n\t\t\t\ttext += \"\\n.\".repeat(extraRows);\r\n\t\t\tshadowContent.text(text);\r\n\r\n\t\t\t// Copy all layout-relevant styles from textarea to shadow element, in case they've changed\r\n\t\t\t[\r\n\t\t\t\t\"border-bottom-style\", \"border-bottom-width\",\r\n\t\t\t\t\"border-left-style\", \"border-left-width\",\r\n\t\t\t\t\"border-right-style\", \"border-right-width\",\r\n\t\t\t\t\"border-top-style\", \"border-top-width\",\r\n\t\t\t\t\"font-family\", \"font-feature-settings\", \"font-kerning\", \"font-size\", \"font-stretch\", \"font-style\",\r\n\t\t\t\t\"font-variant\", \"font-variant-alternates\", \"font-variant-caps\", \"font-variant-east-asian\",\r\n\t\t\t\t\"font-variant-ligatures\", \"font-variant-numeric\", \"font-variant-position\", \"font-weight\",\r\n\t\t\t\t\"hyphens\", \"letter-spacing\", \"line-height\",\r\n\t\t\t\t\"padding-bottom\", \"padding-left\", \"padding-right\", \"padding-top\",\r\n\t\t\t\t\"text-transform\", \"word-break\", \"word-spacing\"\r\n\t\t\t].forEach(copyStyle);\r\n\t\t}\r\n\r\n\t\tfunction copyStyle(name) {\r\n\t\t\tshadowContent.css(name, textarea.css(name));\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"autoHeight\", autoHeight);\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\n\r\n// Converts each selected list element into a menu. Submenus are opened for nested lists.\r\nfunction menu() {\r\n\treturn this.each(function () {\r\n\t\tvar menu = $(this);\r\n\t\tvar isVertical = menu.hasClass(\"vertical\");\r\n\t\tvar itemsWithSubmenu = menu.children(\"li\").has(\"ul\");\r\n\t\titemsWithSubmenu.each(function () {\r\n\t\t\tvar item = $(this);\r\n\t\t\titem.addClass(\"ff-has-submenu\");\r\n\t\t\tvar submenu = item.children(\"ul\").first();\r\n\t\t\tif (submenu.hasClass(\"ff-submenu\")) return;   // Already done\r\n\t\t\tsubmenu.addClass(\"ff-submenu dropdown\");\r\n\t\t\tif (item.closest(\"nav\").length > 0)\r\n\t\t\t\tsubmenu.addClass(\"nav\");\r\n\r\n\t\t\t// Open submenu on click\r\n\t\t\titem.children(\"a\").first().click(function (event) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tif (item.disabled()) return;\r\n\t\t\t\tvar ddOpt = {};\r\n\t\t\t\tif (isVertical) {\r\n\t\t\t\t\tddOpt[\"placement\"] = \"right-top\";\r\n\t\t\t\t}\r\n\t\t\t\tsubmenu.dropdown(item, ddOpt);\r\n\t\t\t\titem.addClass(\"open\");\r\n\t\t\t\tsubmenu.one(\"dropdownclose\", function () {\r\n\t\t\t\t\titem.removeClass(\"open\");\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Prepare separators\r\n\t\t\tsubmenu.children(\"li\").each$(function () {\r\n\t\t\t\tif (this.text() === \"-\") {\r\n\t\t\t\t\tthis.text(\"\");\r\n\t\t\t\t\tthis.addClass(\"separator\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t// Close submenu when clicking on one of its items\r\n\t\t\tsubmenu.find(\"li > a:not(.stay-open)\").each$(function () {\r\n\t\t\t\tthis.click(function () {\r\n\t\t\t\t\tsubmenu.dropdown.close();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\t// Replace # href with a true no-op\r\n\t\tmenu.find(\"li > a[href='#']\").attr(\"href\", \"javascript:\");\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"menu\", menu);\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar messageCloseButtonClass = \"ff-message-close-button\";\r\n\r\n// Makes each selected message div element closable by adding a close button to it.\r\nfunction closableMessage() {\r\n\treturn this.each(function () {\r\n\t\tvar message = $(this);\r\n\t\tif (message.find(\".\" + messageCloseButtonClass).length !== 0) return;   // Already added\r\n\r\n\t\t// Add close button\r\n\t\tvar closeButton = $(\"<a/>\").addClass(messageCloseButtonClass).attr(\"href\", \"#\").appendTo(message);\r\n\t\tmessage.addClass(\"closable\");\r\n\t\tcloseButton.click(function (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tmessage.closableMessage.close();\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\n// Closes each selected message div and removes it from the document.\r\nfunction closeMessage() {\r\n\treturn this.each(function () {\r\n\t\tvar message = $(this);\r\n\t\tmessage.addClass(\"ff-closed\");\r\n\t\tmessage.on(\"transitionend\", function () {\r\n\t\t\tmessage.remove();\r\n\t\t});\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"closableMessage\", closableMessage, {\r\n\tclose: closeMessage\r\n});\r\n","import { forceReflow } from \"./util\";\r\n\r\nvar backgroundDimmerClass = \"ff-background-dimmer\";\r\nvar dimmingClass = \"ff-dimming\";\r\nvar dimmedClass = \"ff-dimmed\";\r\n\r\nvar dimCount = 0;\r\n\r\n// Dims the entire document by adding an overlay.\r\nexport function dimBackground(noinput) {\r\n\tdimCount++;\r\n\tif ($(\"body > div.\" + backgroundDimmerClass + \":not(.closing)\").length !== 0) return;   // Already there\r\n\tvar existingBackgroundLayer = $(\"body > div.\" + backgroundDimmerClass);\r\n\tif (existingBackgroundLayer.length === 0)\r\n\t\t$(\"body\").trigger(\"dim\");\r\n\t$(\"body\").addClass(dimmingClass).addClass(dimmedClass);\r\n\tvar backgroundLayer = $(\"<div/>\")\r\n\t\t.addClass(backgroundDimmerClass)\r\n\t\t.appendTo(\"body\");\r\n\tnoinput && backgroundLayer.addClass(\"noinput\");\r\n\tforceReflow();\r\n\tbackgroundLayer.css(\"opacity\", \"1\");\r\n}\r\n\r\n// Removes the overlay from the document. The overlay is already click-through during its\r\n// fade-out transition.\r\nexport function undimBackground() {\r\n\tvar backgroundLayer = $(\"body > div.\" + backgroundDimmerClass);\r\n\tif (backgroundLayer.length === 0) return;   // Not there\r\n\tdimCount--;\r\n\tif (dimCount > 0) return false;   // Not the last one, keep it dimmed\r\n\tvar $body = $(\"body\");\r\n\t$body.removeClass(dimmedClass);\r\n\tbackgroundLayer.addClass(\"closing\").css(\"opacity\", \"0\");\r\n\tbackgroundLayer.on(\"transitionend\", function () {\r\n\t\tif (!$body.hasClass(dimmedClass)) {\r\n\t\t\t// No other layer appeared in the meantime\r\n\t\t\t$body.removeClass(dimmingClass);\r\n\t\t\t$(\"body\").trigger(\"undim\");\r\n\t\t}\r\n\t\tbackgroundLayer.remove();\r\n\t});\r\n\treturn true;\r\n}\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\nimport { dimBackground, undimBackground } from \"../dimmer\";\r\n\r\nvar modalEventNamespace = \".ff-modal\";\r\nvar modalClass = \"ff-modal-container\";\r\nvar modalCloseButtonClass = \"ff-modal-close-button\";\r\n\r\nvar modalLevel = 0;\r\n\r\n// Defines default options for the modal plugin.\r\nvar modalDefaults = {\r\n\t// Indicates whether the modal is closed when clicking anywhere outside of it or pressing Esc.\r\n\t// This also shows a close button in the model overlay. Default: true.\r\n\tcancellable: true,\r\n\t\r\n\t// The tooltip text for the close button. Default: empty.\r\n\tcloseTooltip: \"\",\r\n\t\r\n\t// Indicates whether the page background is dimmed while the modal is open. Default: true.\r\n\tdimBackground: true\r\n};\r\n\r\n// Opens a modal with the selected element.\r\nfunction modal(options) {\r\n\tvar modal = this.first();\r\n\tif (modal.length === 0) return this;   // Nothing to do\r\n\tif (modal.parent().hasClass(modalClass)) return this;   // Already open\r\n\tmodalLevel++;\r\n\tvar opt = initOptions(\"modal\", modalDefaults, modal, {}, options);\r\n\topt.level = modalLevel;\r\n\tif (opt.dimBackground && modalLevel === 1)\r\n\t\tdimBackground();\r\n\r\n\tvar container = $(\"<div/>\").addClass(modalClass).appendTo(\"body\");\r\n\tmodal.appendTo(container);\r\n\tmodal.find(\":focusable\").first().focus().blur();\r\n\r\n\tif (modalLevel === 1)\r\n\t\tpreventScrolling();\r\n\r\n\t// Prevent moving the focus out of the modal\r\n\t$(document).on(\"focusin\" + modalEventNamespace + \"-\" + opt.level, function (event) {\r\n\t\tif (opt.level === modalLevel) {\r\n\t\t\t// This is the top-most modal now, handle the focus event\r\n\t\t\tif ($(event.target).parents().filter(modal).length === 0) {\r\n\t\t\t\t// The focused element's ancestors do not include the modal, so the focus went out\r\n\t\t\t\t// of the modal. Bring it back.\r\n\t\t\t\tmodal.find(\":focusable\").first().focus();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tvar closeButton;\r\n\tif (opt.cancellable) {\r\n\t\t// Close on pressing the Escape key or clicking outside the modal\r\n\t\t$(document).on(\"keydown\" + modalEventNamespace + \"-\" + opt.level, function (event) {\r\n\t\t\tif (event.keyCode === 27) {   // Escape\r\n\t\t\t\tif (modalLevel === opt.level) {   // There might be another modal on top\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tmodal.modal.close();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tcontainer.click(function (event) {\r\n\t\t\tif (event.button === 0 && event.target === this) {\r\n\t\t\t\tmodal.modal.close();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Add default close button\r\n\t\tcloseButton = $(\"<a/>\").addClass(modalCloseButtonClass).attr(\"href\", \"#\").appendTo(modal);\r\n\t\tif (opt.closeTooltip)\r\n\t\t\tcloseButton[0].title = opt.closeTooltip;\r\n\t\tcloseButton.click(function (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tmodal.modal.close();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n// Closes the selected modal.\r\nfunction closeModal() {\r\n\tvar modal = this.first();\r\n\tif (modal.length === 0) return this;   // Nothing to do\r\n\tvar container = modal.parent();\r\n\tif (!container.hasClass(modalClass)) return this;   // Modal is not open\r\n\tmodalLevel--;\r\n\tvar opt = loadOptions(\"modal\", modal);\r\n\tvar closeButton = modal.find(\".\" + modalCloseButtonClass).first();\r\n\r\n\tif (!modalLevel)\r\n\t\tpreventScrolling(false);\r\n\t$(document).off(\"focusin\" + modalEventNamespace + \"-\" + opt.level);\r\n\t$(document).off(\"keydown\" + modalEventNamespace + \"-\" + opt.level);\r\n\tmodal.appendTo(\"body\");\r\n\tcontainer.remove();\r\n\tif (closeButton)\r\n\t\tcloseButton.remove();\r\n\tif (opt.dimBackground && !modalLevel)\r\n\t\tundimBackground();\r\n\r\n\tlet event = $.Event(\"close\");\r\n\tmodal.trigger(event);\r\n\treturn this;\r\n}\r\n\r\nregisterPlugin(\"modal\", modal, {\r\n\tclose: closeModal\r\n});\r\n$.fn.modal.defaults = modalDefaults;\r\n\r\n// Shows a standard message box modal with content and buttons.\r\n//\r\n// options.content: (jQuery) The message content to display.\r\n// options.html: (String) The message HTML content to display.\r\n// options.text: (String) The message text to display.\r\n// options.buttons: (Array) The buttons to display in the modal.\r\n// options.buttons[].text: (String) The button text.\r\n// options.buttons[].icon: (String) The CSS class of an <i> element displayed before the text.\r\n// options.buttons[].className: (String) Additional CSS classes for the button.\r\n// options.buttons[].result: The result value of the button.\r\n// options.resultHandler: (Function) The modal response handler. It is passed the button handler's return value, or false if cancelled.\r\n//\r\n// If a string is passed as first argument, it is displayed as text with an OK button.\r\n$.modal = function (options) {\r\n\tif (typeof options === \"string\") {\r\n\t\toptions = {\r\n\t\t\ttext: options,\r\n\t\t\tbuttons: \"OK\"\r\n\t\t};\r\n\t}\r\n\t\r\n\tlet modal = $(\"<div/>\")\r\n\t\t.addClass(\"modal\");\r\n\tlet content = $(\"<div/>\")\r\n\t\t.css(\"overflow\", \"auto\")\r\n\t\t.css(\"max-height\", \"calc(100vh - 80px - 5em)\")   // padding of modal, height of buttons\r\n\t\t.appendTo(modal);\r\n\tif (options.content)\r\n\t\tcontent.append(options.content)\r\n\telse if (options.html)\r\n\t\tcontent.html(options.html)\r\n\telse if (options.text)\r\n\t\tcontent.text(options.text)\r\n\r\n\tlet buttons = options.buttons;\r\n\tif (typeof buttons === \"string\") {\r\n\t\tswitch (buttons) {\r\n\t\t\tcase \"OK\":\r\n\t\t\t\tbuttons = [\r\n\t\t\t\t\t{ text: \"OK\", className: \"default\", result: true }\r\n\t\t\t\t];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"OK cancel\":\r\n\t\t\t\tbuttons = [\r\n\t\t\t\t\t{ text: \"OK\", className: \"default\", result: true },\r\n\t\t\t\t\t{ text: \"Cancel\", className: \"transparent\", result: false }\r\n\t\t\t\t];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"YES no\":\r\n\t\t\t\tbuttons = [\r\n\t\t\t\t\t{ text: \"Yes\", className: \"default\", result: true },\r\n\t\t\t\t\t{ text: \"No\", result: false }\r\n\t\t\t\t];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"yes NO\":\r\n\t\t\t\tbuttons = [\r\n\t\t\t\t\t{ text: \"Yes\", result: true },\r\n\t\t\t\t\t{ text: \"No\", className: \"default\", result: false }\r\n\t\t\t\t];\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbuttons = [];\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tlet buttonsElement;\r\n\tlet buttonPressed = false;\r\n\tif (buttons && buttons.length > 0) {\r\n\t\tbuttonsElement = $(\"<div/>\")\r\n\t\t\t.addClass(\"buttons\")\r\n\t\t\t.appendTo(modal);\r\n\t\tbuttons.forEach(function (button) {\r\n\t\t\tlet buttonElement = $(\"<button/>\")\r\n\t\t\t\t.addClass(button.className)\r\n\t\t\t\t.appendTo(buttonsElement);\r\n\t\t\tif (button.icon)\r\n\t\t\t\tbuttonElement.append($(\"<i/>\").addClass(button.icon));\r\n\t\t\tif (button.icon && button.text)\r\n\t\t\t\tbuttonElement.append(\" \");\r\n\t\t\tif (button.text)\r\n\t\t\t\tbuttonElement.append(button.text);\r\n\t\t\tbuttonElement.click(function (event) {\r\n\t\t\t\tbuttonPressed = true;\r\n\t\t\t\tmodal.modal.close();\r\n\t\t\t\tif (options.resultHandler)\r\n\t\t\t\t\toptions.resultHandler(button.result);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\tmodal.modal(options);\r\n\tif (buttonsElement)\r\n\t\tbuttonsElement.find(\"button.default\").first().focus();\r\n\tif (options.resultHandler) {\r\n\t\tmodal.on(\"close\", function () {\r\n\t\t\tif (!buttonPressed)\r\n\t\t\t\toptions.resultHandler();\r\n\t\t});\r\n\t}\r\n}\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\nimport { dimBackground, undimBackground } from \"../dimmer\";\r\n\r\nvar offCanvasEventNamespace = \".ff-off-canvas\";\r\nvar offCanvasClass = \"ff-off-canvas\";\r\n\r\n// Defines default options for the off-canvas plugin.\r\nvar offCanvasDefaults = {\r\n\t// Indicates whether the user can close the off-canvas panel by clicking anywhere outside of it or pressing the Escape key. Default: true.\r\n\tcancellable: true,\r\n\r\n\t// The side from which the off-canvas opens (left, right). Default: left.\r\n\tedge: \"left\",\r\n\r\n\t// Push the page content to the side when showing the off-canvas panel. Default: 1.\r\n\t// 0 doesn't push, 1 pushes the full panel width.\r\n\tpush: 1\r\n};\r\n\r\n// Opens an off-canvas with the selected element.\r\nfunction offCanvas(options) {\r\n\tvar offCanvas = this.first();\r\n\tif (offCanvas.length === 0) return this;   // Nothing to do\r\n\tif (offCanvas.hasClass(offCanvasClass)) return this;   // Already open\r\n\tvar opt = initOptions(\"offCanvas\", offCanvasDefaults, offCanvas, {}, options);\r\n\r\n\toffCanvas.addClass(offCanvasClass);\r\n\toffCanvas.detach().appendTo(\"body\");\r\n\r\n\tif ([\"left\", \"right\"].indexOf(opt.edge) === -1)\r\n\t\topt.edge = \"left\";\r\n\tif (opt.edge === \"left\") opt._opposite = \"right\";\r\n\telse if (opt.edge === \"right\") opt._opposite = \"left\";\r\n\r\n\tvar html = $(\"html\");\r\n\tvar width = offCanvas.outerWidth();\r\n\r\n\topt._htmlStyle = {\r\n\t\ttransition: html.css(\"transition\"),\r\n\t\toverflowX: html.css(\"overflow-x\")\r\n\t};\r\n\r\n\t$(window).on(\"resize\" + offCanvasEventNamespace, function () {\r\n\t\toffCanvas.offCanvas.close();\r\n\t});\r\n\r\n\t//$(window).on(\"resize\" + offCanvasEventNamespace, function () {   // TODO Failing workaround for Chrome/Android, see https://bugs.chromium.org/p/chromium/issues/detail?id=801621\r\n\t//\toffCanvas.css(\"height\", $(window).height());\r\n\t//});\r\n\t//offCanvas.css(\"height\", $(window).height());\r\n\r\n\t// Initialise position\r\n\toffCanvas.css(opt.edge, -width);\r\n\toffCanvas.css(opt._opposite, \"\");\r\n\tforceReflow();\r\n\toffCanvas.css(\"transition\", opt.edge + \" 0.4s\");\r\n\thtml.css(\"transition\", \"margin 0.4s\");\r\n\thtml.css(\"overflow-x\", \"hidden\");\r\n\r\n\t// Now start the transition to the opened state\r\n\toffCanvas.css(opt.edge, 0);\r\n\thtml.css(\"margin-\" + opt.edge, width * opt.push);\r\n\thtml.css(\"margin-\" + opt._opposite, -width * opt.push);\r\n\r\n\tdimBackground(true);\r\n\r\n\toffCanvas.find(\":focusable\").first().focus().blur();\r\n\r\n\tpreventScrolling();\r\n\r\n\t// Prevent moving the focus out of the offCanvas\r\n\t$(document).on(\"focusin\" + offCanvasEventNamespace, function (event) {\r\n\t\tif ($(event.target).parents().filter(offCanvas).length === 0) {\r\n\t\t\t// The focused element's ancestors do not include the offCanvas, so the focus went out\r\n\t\t\t// of the offCanvas. Bring it back.\r\n\t\t\toffCanvas.find(\":focusable\").first().focus();\r\n\t\t\tevent.preventDefault();\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\t// Close on pressing the Escape key or clicking outside the offCanvas\r\n\tif (opt.cancellable) {\r\n\t\t$(document).on(\"keydown\" + offCanvasEventNamespace, function (event) {\r\n\t\t\tif (event.keyCode === 27) {   // Escape\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\toffCanvas.offCanvas.close();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsetTimeout(function () {\r\n\t\t\t$(document).on(\"click\" + offCanvasEventNamespace, function (event) {\r\n\t\t\t\tif (event.button === 0) {\r\n\t\t\t\t\toffCanvas.offCanvas.close();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}, 20);\r\n\t\toffCanvas.on(\"click\" + offCanvasEventNamespace, function (event) {\r\n\t\t\t// Don't close the off-canvas when clicking inside of it\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t});\r\n\t}\r\n\r\n\toffCanvas.trigger(\"offcanvasopen\");\r\n\treturn this;\r\n}\r\n\r\n// Closes the selected off-canvas.\r\nfunction closeOffCanvas() {\r\n\tvar offCanvas = this.first();\r\n\tif (offCanvas.length === 0) return this;   // Nothing to do\r\n\tif (!offCanvas.hasClass(offCanvasClass)) return this;   // offCanvas is not open\r\n\tvar opt = loadOptions(\"offCanvas\", offCanvas);\r\n\r\n\tvar html = $(\"html\");\r\n\tvar width = offCanvas.outerWidth();\r\n\r\n\t// Start the transition back to the closed state\r\n\toffCanvas.css(opt.edge, -width);\r\n\thtml.css(\"margin-\" + opt.edge, 0);\r\n\thtml.css(\"margin-\" + opt._opposite, 0);\r\n\r\n\tpreventScrolling(false);\r\n\t$(document).off(\"focusin\" + offCanvasEventNamespace);\r\n\t$(document).off(\"keydown\" + offCanvasEventNamespace);\r\n\t$(document).off(\"click\" + offCanvasEventNamespace);\r\n\t$(window).off(\"resize\" + offCanvasEventNamespace);\r\n\toffCanvas.off(\"click\" + offCanvasEventNamespace);\r\n\tundimBackground();\r\n\toffCanvas.one(\"transitionend\", function () {\r\n\t\toffCanvas.removeClass(offCanvasClass);\r\n\t\thtml.css(opt._htmlStyle);\r\n\t});\r\n\toffCanvas.trigger(\"offcanvasclose\");\r\n\treturn this;\r\n}\r\n\r\nregisterPlugin(\"offCanvas\", offCanvas, {\r\n\tclose: closeOffCanvas\r\n});\r\n$.fn.offCanvas.defaults = offCanvasDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow } from \"../util\";\r\n\r\nvar progressbarClass = \"ff-progressbar\";\r\n\r\n// Defines default options for the progressbar plugin.\r\nvar progressbarDefaults = {\r\n\t// The minimum value of the progress bar. Default: 0.\r\n\tmin: 0,\r\n\r\n\t// The maximum value of the progress bar. Default: 100.\r\n\tmax: 100,\r\n\t\r\n\t// The current progress value. Default: 0.\r\n\tvalue: 0,\r\n\t\r\n\t// The string to display before the value in the progress bar. Default: \"\".\r\n\tvaluePrefix: \"\",\r\n\t\r\n\t// The string to display after the value in the progress bar. Default: \"\".\r\n\tvalueSuffix: \"\"\r\n};\r\n\r\n// Shows a progressbar on the element.\r\nfunction progressbar(options) {\r\n\treturn this.each(function () {\r\n\t\tvar $elem = $(this);\r\n\t\tif ($elem.hasClass(progressbarClass)) return;   // Already done\r\n\t\t$elem.addClass(progressbarClass);\r\n\t\tvar opt = initOptions(\"progressbar\", progressbarDefaults, $elem, {}, options);\r\n\t\topt._setValue = setValue;\r\n\r\n\t\tlet bar = $(\"<div/>\")\r\n\t\t\t.addClass(\"ff-bar\")\r\n\t\t\t.appendTo($elem);\r\n\t\tlet number = $(\"<span/>\")\r\n\t\t\t.appendTo(bar);\r\n\t\tsetValue(opt.value);\r\n\t\t\r\n\t\t// Sets a progress bar value and triggers the change event.\r\n\t\tfunction setValue(value) {\r\n\t\t\tvalue = minmax(value, opt.min, opt.max);\r\n\t\t\tlet relWidth = (value - opt.min) / (opt.max - opt.min);\r\n\t\t\tbar.css(\"width\", (relWidth * 100) + \"%\");\r\n\t\t\tnumber.text(opt.valuePrefix + value + opt.valueSuffix);\r\n\t\t\tnumber.toggleClass(\"outside\", number.width() + 8 > relWidth * $elem.width());\r\n\t\t\t\r\n\t\t\tif (value !== opt.value) {\r\n\t\t\t\topt.value = value;\r\n\t\t\t\t$elem.trigger(\"valuechange\");\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Gets the current progress bar value.\r\n//\r\n// value: Sets the progress value.\r\nfunction progressbarValue(value) {\r\n\t// Getter\r\n\tif (value === undefined) {\r\n\t\tvar progressbar = this.first();\r\n\t\tif (progressbar.length === 0) return;   // Nothing to do\r\n\t\tvar opt = loadOptions(\"progressbar\", progressbar);\r\n\t\treturn opt.value;\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar progressbar = $(this);\r\n\t\tvar opt = loadOptions(\"progressbar\", progressbar);\r\n\t\topt._setValue(value);\r\n\t});\r\n}\r\n\r\n// Gets the value prefix.\r\n//\r\n// prefix: Sets the value prefix.\r\nfunction valuePrefix(prefix) {\r\n\t// Getter\r\n\tif (prefix === undefined) {\r\n\t\tvar progressbar = this.first();\r\n\t\tif (progressbar.length === 0) return;   // Nothing to do\r\n\t\tvar opt = loadOptions(\"progressbar\", progressbar);\r\n\t\treturn opt.valuePrefix;\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar progressbar = $(this);\r\n\t\tvar opt = loadOptions(\"progressbar\", progressbar);\r\n\t\topt.valuePrefix = prefix;\r\n\t\topt._setValue(opt.value);\r\n\t});\r\n}\r\n\r\n// Gets the value suffix.\r\n//\r\n// suffix: Sets the value suffix.\r\nfunction valueSuffix(suffix) {\r\n\t// Getter\r\n\tif (suffix === undefined) {\r\n\t\tvar progressbar = this.first();\r\n\t\tif (progressbar.length === 0) return;   // Nothing to do\r\n\t\tvar opt = loadOptions(\"progressbar\", progressbar);\r\n\t\treturn opt.valueSuffix;\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar progressbar = $(this);\r\n\t\tvar opt = loadOptions(\"progressbar\", progressbar);\r\n\t\topt.valueSuffix = suffix;\r\n\t\topt._setValue(opt.value);\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"progressbar\", progressbar, {\r\n\tvalue: progressbarValue,\r\n\tvaluePrefix: valuePrefix,\r\n\tvalueSuffix: valueSuffix\r\n});\r\n$.fn.progressbar.defaults = progressbarDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, installDisabledchangeHook } from \"../util\";\r\n\r\nvar resizableClass = \"ff-resizable\";\r\n\r\n// Defines default options for the resizable plugin.\r\nvar resizableDefaults = {\r\n\t// The aspect ratio (x/y) to maintain during resizing, or true to maintain the initial aspect ratio. Default: None.\r\n\taspectRatio: undefined,\r\n\r\n\t// The resizing handles to use. Can be \"all\" or a combination of \"n,ne,e,se,s,sw,w,nw\". Default: All.\r\n\thandles: undefined,\r\n\t\r\n\t// The width of the default handles. Default: 10.\r\n\thandleWidth: 10,\r\n\r\n\t// Constrains the resizing inside the specified element or the \"parent\" of the resized element or the \"viewport\". Default: None.\r\n\tcontainment: undefined,\r\n\r\n\t// The grid to snap the resized element to during resizing, as [x, y] in pixels. Default: [1, 1].\r\n\tgrid: undefined,\r\n\r\n\t// The minimum width to keep during resizing. Default: None.\r\n\tminWidth: undefined,\r\n\r\n\t// The minimum height to keep during resizing. Default: None.\r\n\tminHeight: undefined,\r\n\r\n\t// The maximum width to keep during resizing. Default: None.\r\n\tmaxWidth: undefined,\r\n\r\n\t// The maximum height to keep during resizing. Default: None.\r\n\tmaxHeight: undefined,\r\n\r\n\t// Indicates whether the window should scroll to keep the resized edge visible. Default: false.\r\n\tscroll: false\r\n};\r\n\r\n// Makes each selected element resizable.\r\nfunction resizable(options) {\r\n\treturn this.each(function () {\r\n\t\tvar elem = this;\r\n\t\tvar $elem = $(elem);\r\n\t\tif ($elem.hasClass(resizableClass)) return;   // Already done\r\n\t\t$elem.addClass(resizableClass);\r\n\t\tvar htmlCursor;\r\n\t\tvar handleElements = $();\r\n\t\tvar opt = initOptions(\"resizable\", resizableDefaults, $elem, {}, options);\r\n\t\tlet $window = $(window);\r\n\r\n\t\tvar aspectRatio = opt.aspectRatio;\r\n\t\tif (aspectRatio === true || aspectRatio === \"true\") aspectRatio = $elem.outerWidth() / $elem.outerHeight();\r\n\t\tif ($.isNumeric(aspectRatio)) aspectRatio = parseFloat(aspectRatio);\r\n\t\tif (aspectRatio === 0 || !isFinite(aspectRatio) || !$.isNumber(aspectRatio)) aspectRatio = undefined;\r\n\r\n\t\tif ($elem.css(\"position\") === \"static\") {\r\n\t\t\topt.wasPositionStatic = true;\r\n\t\t\t$elem.css(\"position\", \"relative\");\r\n\t\t}\r\n\r\n\t\tvar optHandles = opt.handles;\r\n\t\tif (optHandles === undefined)\r\n\t\t\toptHandles = \"all\";\r\n\t\tif (optHandles === \"all\")\r\n\t\t\toptHandles = \"n,ne,e,se,s,sw,w,nw\";\r\n\t\tif ($.isString(optHandles))\r\n\t\t\toptHandles = optHandles.replace(/\\s/g, \"\").toLowerCase().split(\",\");\r\n\t\topt.handles = optHandles;\r\n\r\n\t\tvar vCursor = \"ns-resize\";\r\n\t\tvar hCursor = \"ew-resize\";\r\n\t\tvar nwCursor = \"nwse-resize\";\r\n\t\tvar neCursor = \"nesw-resize\";\r\n\r\n\t\tif (opt.handleAddClass === \"box\") {\r\n\t\t\tif (optHandles.indexOf(\"n\") !== -1)\r\n\t\t\t\taddHandle({ left: \"calc(50% - 4px)\", top: -9 }, vCursor, true, true);   // Top edge\r\n\t\t\tif (optHandles.indexOf(\"e\") !== -1)\r\n\t\t\t\taddHandle({ right: -9, top: \"calc(50% - 4px)\" }, hCursor, false, false);   // Right edge\r\n\t\t\tif (optHandles.indexOf(\"s\") !== -1)\r\n\t\t\t\taddHandle({ left: \"calc(50% - 4px)\", bottom: -9 }, vCursor, true, false);   // Bottom edge\r\n\t\t\tif (optHandles.indexOf(\"w\") !== -1)\r\n\t\t\t\taddHandle({ left: -9, top: \"calc(50% - 4px)\" }, hCursor, false, true);   // Left edge\r\n\r\n\t\t\tif (optHandles.indexOf(\"ne\") !== -1)\r\n\t\t\t\taddHandle({ top: -9, right: -9 }, neCursor, false, false, true, true);   // Top right corner\r\n\t\t\tif (optHandles.indexOf(\"se\") !== -1)\r\n\t\t\t\taddHandle({ bottom: -9, right: -9 }, nwCursor, false, false, true, false);   // Bottom right corner\r\n\t\t\tif (optHandles.indexOf(\"sw\") !== -1)\r\n\t\t\t\taddHandle({ bottom: -9, left: -9 }, neCursor, false, true, true, false);   // Bottom left corner\r\n\t\t\tif (optHandles.indexOf(\"nw\") !== -1)\r\n\t\t\t\taddHandle({ top: -9, left: -9 }, nwCursor, false, true, true, true);   // Top left corner\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet w = opt.handleWidth;\r\n\t\t\tif (optHandles.indexOf(\"n\") !== -1)\r\n\t\t\t\taddHandle({ left: w / 2, right: w / 2, top: -w / 2, height: w }, vCursor, true, true);   // Top edge\r\n\t\t\tif (optHandles.indexOf(\"e\") !== -1)\r\n\t\t\t\taddHandle({ top: w / 2, bottom: w / 2, right: -w / 2, width: w }, hCursor, false, false);   // Right edge\r\n\t\t\tif (optHandles.indexOf(\"s\") !== -1)\r\n\t\t\t\taddHandle({ left: w / 2, right: w / 2, bottom: -w / 2, height: w }, vCursor, true, false);   // Bottom edge\r\n\t\t\tif (optHandles.indexOf(\"w\") !== -1)\r\n\t\t\t\taddHandle({ top: w / 2, bottom: w / 2, left: -w / 2, width: w }, hCursor, false, true);   // Left edge\r\n\r\n\t\t\tif (optHandles.indexOf(\"ne\") !== -1)\r\n\t\t\t\taddHandle({ right: -w / 2, top: -w / 2, width: w, height: w }, neCursor, false, false, true, true);   // Top right corner\r\n\t\t\tif (optHandles.indexOf(\"se\") !== -1)\r\n\t\t\t\taddHandle({ right: -w / 2, bottom: -w / 2, width: w, height: w }, nwCursor, false, false, true, false);   // Bottom right corner\r\n\t\t\tif (optHandles.indexOf(\"sw\") !== -1)\r\n\t\t\t\taddHandle({ left: -w / 2, bottom: -w / 2, width: w, height: w }, neCursor, false, true, true, false);   // Bottom left corner\r\n\t\t\tif (optHandles.indexOf(\"nw\") !== -1)\r\n\t\t\t\taddHandle({ left: -w / 2, top: -w / 2, width: w, height: w }, nwCursor, false, true, true, true);   // Top left corner\r\n\t\t}\r\n\r\n\t\tinstallDisabledchangeHook();\r\n\t\t$elem.on(\"disabledchange.resizable\", function () {\r\n\t\t\thandleElements.visible(!$elem.disabled());\r\n\t\t});\r\n\r\n\t\tfunction addHandle(style, cursor, vertical, negative, vertical2, negative2) {\r\n\t\t\tvar handle = $(\"<div/>\")\r\n\t\t\t\t.addClass(\"ff-resizable-handle \" + opt.handleAddClass)\r\n\t\t\t\t.css(style)\r\n\t\t\t\t.css(\"position\", \"absolute\")\r\n\t\t\t\t.css(\"cursor\", cursor);\r\n\t\t\t$elem.append(handle);\r\n\t\t\thandleElements = handleElements.add(handle);\r\n\t\t\thandle.draggable({ scroll: opt.scroll });\r\n\t\t\thandle.on(\"draggablestart\", function (event) {\r\n\t\t\t\tevent.stopPropagation();   // Don't trigger for the resized (parent) element\r\n\t\t\t\tlet event2 = $.Event(\"resizablestart\");\r\n\t\t\t\tevent2.vertical = vertical;\r\n\t\t\t\tevent2.negative = negative;\r\n\t\t\t\tevent2.edge = vertical ? (negative ? \"top\" : \"bottom\") : (negative ? \"left\" : \"right\");\r\n\t\t\t\t$elem.trigger(event2);\r\n\t\t\t\tif (!event2.isDefaultPrevented()) {\r\n\t\t\t\t\thtmlCursor = document.documentElement.style.getPropertyValue(\"cursor\");\r\n\t\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", cursor, \"important\");\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\thandle.on(\"draggablemove\", function (event) {\r\n\t\t\t\tevent.stopPropagation();   // Don't trigger for the resized (parent) element\r\n\t\t\t\tevent.preventDefault();   // The handles already move with the element, don't touch their position\r\n\t\t\t\tresize(handle, event.newPoint, vertical, negative);\r\n\t\t\t\tif (vertical2 !== undefined)\r\n\t\t\t\t\tresize(handle, event.newPoint, vertical2, negative2);\r\n\t\t\t});\r\n\t\t\thandle.on(\"draggableend\", function (event) {\r\n\t\t\t\tevent.stopPropagation();   // Don't trigger for the resized (parent) element\r\n\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", htmlCursor);\r\n\t\t\t\tlet event2 = $.Event(\"resizableend\");\r\n\t\t\t\tevent2.vertical = vertical;\r\n\t\t\t\tevent2.negative = negative;\r\n\t\t\t\tevent2.edge = vertical ? (negative ? \"top\" : \"bottom\") : (negative ? \"left\" : \"right\");\r\n\t\t\t\t$elem.trigger(event2);\r\n\t\t\t});\r\n\t\t\treturn handle;\r\n\t\t}\r\n\r\n\t\tfunction resize(handle, newPoint, vertical, negative) {\r\n\t\t\tvar side = vertical ? \"top\" : \"left\";\r\n\t\t\tvar extent = vertical ? \"Height\" : \"Width\";\r\n\t\t\tvar extentLower = extent.toLowerCase();\r\n\t\t\tvar delta = newPoint[side] - handle.offset()[side];\r\n\t\t\tif (negative) delta = -delta;\r\n\r\n\t\t\tvar newElemOffset = $elem.offset();\r\n\t\t\tvar step = opt.grid ? opt.grid[vertical ? 1 : 0] : 1;\r\n\r\n\t\t\tif (opt.grid) {\r\n\t\t\t\tlet gridBase = $elem.parent().offset();\r\n\t\t\t\tif (negative) {\r\n\t\t\t\t\tdelta = newElemOffset[side] - (Math.round(((newElemOffset[side] - delta) - gridBase[side]) / step) * step + gridBase[side]);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlet length = $elem[\"outer\" + extent]();\r\n\t\t\t\t\tdelta = Math.round(((newElemOffset[side] + length + delta) - gridBase[side]) / step) * step + gridBase[side] - (newElemOffset[side] + length);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar newLength = $elem[\"outer\" + extent]() + delta;\r\n\r\n\t\t\tlet minLength = Math.max($elem[\"outer\" + extent]() - $elem[extentLower](), opt[\"min\" + extent] || 0);\r\n\t\t\twhile (newLength < minLength) {\r\n\t\t\t\tdelta += step;\r\n\t\t\t\tnewLength += step;\r\n\t\t\t}\r\n\t\t\tlet maxLength = opt[\"max\" + extent];\r\n\t\t\twhile (maxLength && newLength > maxLength) {\r\n\t\t\t\tdelta -= step;\r\n\t\t\t\tnewLength -= step;\r\n\t\t\t}\r\n\r\n\t\t\tif (negative) newElemOffset[side] -= delta;\r\n\r\n\t\t\tif (opt.containment) {\r\n\t\t\t\tlet cont, contRect;\r\n\t\t\t\tif (opt.containment === \"parent\") {\r\n\t\t\t\t\tcont = $elem.parent();\r\n\t\t\t\t}\r\n\t\t\t\telse if (opt.containment === \"viewport\") {\r\n\t\t\t\t\tlet scrollTop = $window.scrollTop();\r\n\t\t\t\t\tlet scrollLeft = $window.scrollLeft();\r\n\t\t\t\t\tcontRect = {\r\n\t\t\t\t\t\ttop: 0 + scrollTop,\r\n\t\t\t\t\t\tleft: 0 + scrollLeft,\r\n\t\t\t\t\t\theight: $window.height(),\r\n\t\t\t\t\t\twidth: $window.width()\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tcont = $(opt.containment);\r\n\t\t\t\t}\r\n\t\t\t\tif (cont && cont.length > 0) {\r\n\t\t\t\t\tcontRect = cont.rect();\r\n\t\t\t\t}\r\n\t\t\t\tif (contRect) {\r\n\t\t\t\t\tif (negative) {\r\n\t\t\t\t\t\twhile (newElemOffset[side] < contRect[side]) {\r\n\t\t\t\t\t\t\tnewElemOffset[side] += step;\r\n\t\t\t\t\t\t\tdelta -= step;\r\n\t\t\t\t\t\t\tnewLength -= step;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\twhile (newElemOffset[side] + newLength > contRect[side] + contRect[extentLower]) {\r\n\t\t\t\t\t\t\tdelta -= step;\r\n\t\t\t\t\t\t\tnewLength -= step;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet event2 = $.Event(\"resizing\");\r\n\t\t\tevent2.vertical = vertical;\r\n\t\t\tevent2.negative = negative;\r\n\t\t\tevent2.edge = vertical ? (negative ? \"top\" : \"bottom\") : (negative ? \"left\" : \"right\");\r\n\t\t\tevent2.newLength = newLength;\r\n\t\t\tevent2.newPosition = newElemOffset[side];\r\n\t\t\t$elem.trigger(event2);\r\n\t\t\tif (!event2.isDefaultPrevented()) {\r\n\t\t\t\t$elem[\"outer\" + extent](event2.newLength);\r\n\t\t\t\tnewElemOffset[side] = event2.newPosition;\r\n\t\t\t\tif (negative) $elem.offset(newElemOffset);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Removes the resizing features from the elements.\r\nfunction remove() {\r\n\treturn this.each(function () {\r\n\t\tvar elem = this;\r\n\t\tvar $elem = $(elem);\r\n\t\tif (!$elem.hasClass(resizableClass)) return;\r\n\t\t$elem.removeClass(resizableClass);\r\n\t\tvar opt = loadOptions(\"resizable\", $elem);\r\n\t\tif (opt.wasPositionStatic)\r\n\t\t\t$elem.css(\"position\", \"static\");\r\n\t\t$elem.find(\".ff-resizable-handle\").remove();\r\n\t\t$elem.off(\"disabledchange.resizable\");\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"resizable\", resizable, {\r\n\tremove: remove\r\n});\r\n$.fn.resizable.defaults = resizableDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow } from \"../util\";\r\n\r\nvar selectableClass = \"ff-selectable\";\r\n\r\n// Defines default options for the selectable plugin.\r\nvar selectableDefaults = {\r\n\t// Indicates whether multiple items can be selected. Default: false.\r\n\tmulti: false,\r\n\r\n\t// Indicates whether a single click toggles the selection of an item. Default: false.\r\n\ttoggle: false\r\n};\r\n\r\n// Makes the child elements in each selected element selectable.\r\nfunction selectable(options) {\r\n\treturn this.each(function () {\r\n\t\tvar elem = this;\r\n\t\tvar $elem = $(elem);\r\n\t\tif ($elem.hasClass(selectableClass)) return;   // Already done\r\n\t\t$elem.addClass(selectableClass);\r\n\t\tvar opt = initOptions(\"selectable\", selectableDefaults, $elem, {}, options);\r\n\t\topt._prepareChild = prepareChild;\r\n\r\n\t\t$elem.children().each(prepareChild);\r\n\t\t\r\n\t\tfunction prepareChild() {\r\n\t\t\tvar child = $(this);\r\n\t\t\tchild.click(function (event) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t\tlet ctrlKey = !!event.originalEvent.ctrlKey;\r\n\t\t\t\tif (!opt.multi) ctrlKey = false;\r\n\t\t\t\tif (opt.toggle) ctrlKey = true;\r\n\t\t\t\tlet changed = false;\r\n\t\t\t\tif (ctrlKey) {\r\n\t\t\t\t\tchild.toggleClass(\"selected\");\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (!child.hasClass(\"selected\")) {\r\n\t\t\t\t\t\t$elem.children().removeClass(\"selected\");\r\n\t\t\t\t\t\tchild.addClass(\"selected\");\r\n\t\t\t\t\t\tchanged = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (changed) {\r\n\t\t\t\t\t$elem.trigger(\"selectionchange\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Notifies the selectable plugin about a new child that needs to be initialized.\r\nfunction addChild(child) {\r\n\tvar selectable = $(this);\r\n\tvar opt = loadOptions(\"selectable\", selectable);\r\n\topt._prepareChild.call(child);\r\n}\r\n\r\n// Notifies the selectable plugin about a removed child that may affect the selection.\r\nfunction removeChild(child) {\r\n\tvar selectable = $(this);\r\n\tif (child.hasClass(\"selected\")) {\r\n\t\tselectable.trigger(\"selectionchange\");\r\n\t}\r\n}\r\n\r\n// Returns the currently selected elements.\r\nfunction getSelection() {\r\n\tvar selectable = $(this);\r\n\treturn selectable.children(\".selected\");\r\n}\r\n\r\nregisterPlugin(\"selectable\", selectable, {\r\n\taddChild: addChild,\r\n\tremoveChild: removeChild,\r\n\tgetSelection: getSelection\r\n});\r\n$.fn.selectable.defaults = selectableDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, installDisabledchangeHook } from \"../util\";\r\n\r\nvar rangeClass = \"ff-range\";\r\nvar ticksClass = \"ff-ticks\";\r\nvar handleClass = \"ff-handle\";\r\nvar resetAllCursorsClass = \"reset-all-cursors\";\r\n\r\n// Defines default options for the slider plugin.\r\nvar sliderDefaults = {\r\n\t// The orientation of the slider, either \"h\" or \"v\". Default: \"h\".\r\n\torientation: \"h\",\r\n\r\n\t// The current value of the slider. Default: 0.\r\n\tvalue: 0,\r\n\r\n\t// The current values of the slider. Overrides the single value option. Default: null.\r\n\tvalues: null,\r\n\r\n\t// The minimum value of the slider range. Default: 0.\r\n\tmin: 0,\r\n\r\n\t// The maximum value of the slider range. Default: 100.\r\n\tmax: 100,\r\n\r\n\t// The base value of the range rectangle (\"min\", \"max\", any value e.g. 0). Default: \"min\".\r\n\trangeBase: 0,\r\n\r\n\t// The large step of the slider. Default: 10.\r\n\tlargeStep: 10,\r\n\r\n\t// The small step of the slider. Default: 1.\r\n\tsmallStep: 1,\r\n\r\n\t// Indicates whether the large step ticks are visible. Default: true.\r\n\tlargeTicks: true,\r\n\r\n\t// Indicates whether the small step ticks are visible. Default: false.\r\n\tsmallTicks: false,\r\n\r\n\t// Indicates whether the large step ticks have their value as label. Default: true.\r\n\tlargeTickLabels: true,\r\n\r\n\t// Indicates whether the small step ticks have their value as label. Default: false.\r\n\tsmallTickLabels: false,\r\n\r\n\t// The location of the tick marks in the slider (\"topleft\", \"bottomright\", \"both\", \"none\"). Default: \"topleft\".\r\n\ttickPlacement: \"topleft\",\r\n\r\n\t// The number of slider handles. Default: 1.\r\n\thandleCount: 1,\r\n\r\n\t// How multiple handles interact with each other while dragging (\"locked\", \"push\", \"free\"). Default: \"locked\".\r\n\thandleInteractionMode: \"locked\",\r\n\r\n\t// Overflow the range if the two handles have the same value. Default: false.\r\n\trangeOverflowEqual: false,\r\n\r\n\t// Individual ranges. Overrides the rangeBase option and two-handle range behaviour. Default: null.\r\n\t// Each range object has the properties: start, end, overflowEqual, color, className.\r\n\t// start and end can be fixed values, \"min\"/\"max\", or zero-based handle references prefixed with \"#\".\r\n\tranges: null,\r\n\r\n\t// Indicates whether the slider has a logarithmic scale. Default: false.\r\n\tlogarithmic: false,   // TODO\r\n\r\n\t// The mouse cursor to show during dragging the slider. Default: None.\r\n\tdragCursor: undefined\r\n};\r\n\r\n// Creates a slider widget.\r\nfunction slider(options) {\r\n\treturn this.each(function () {\r\n\t\tvar slider = $(this);\r\n\t\tif (slider.children(\"div.\" + handleClass).length !== 0) return;   // Already done\r\n\t\tvar opt = initOptions(\"slider\", sliderDefaults, slider, {}, options);\r\n\t\tvar htmlCursor, draggedHandleCursor;\r\n\t\tvar dragHandleOffset = [], dragHandlePointerId = [];\r\n\t\tvar lastTouchedHandleIndex = 0;\r\n\t\tvar isVertical = opt.orientation === \"v\";\r\n\t\tvar sliderBorder;\r\n\t\tvar initialTabindex;\r\n\r\n\t\topt._setValue = setValue;\r\n\r\n\t\tif (!opt.values) opt.values = [opt.value];\r\n\t\tif (opt.max < opt.min) opt.max = opt.min;\r\n\t\tif (opt.handleCount < 1) opt.handleCount = 1;\r\n\r\n\t\t// Create 1 pair of ranges by default; more only if individually specified\r\n\t\tvar ranges = [];\r\n\t\tfor (let index = 0; index < Math.max(1, opt.ranges && opt.ranges.length); index++) {\r\n\t\t\tranges[index * 2] = $(\"<div/>\").addClass(rangeClass).appendTo(slider);\r\n\t\t\tranges[index * 2 + 1] = $(\"<div/>\").addClass(rangeClass).appendTo(slider);\r\n\t\t}\r\n\t\tif (opt.ranges) {\r\n\t\t\topt.ranges.forEach(function (rangeItem, index) {\r\n\t\t\t\tif (rangeItem.color) {\r\n\t\t\t\t\tranges[index * 2].css(\"background\", rangeItem.color);\r\n\t\t\t\t\tranges[index * 2 + 1].css(\"background\", rangeItem.color);\r\n\t\t\t\t}\r\n\t\t\t\tif (rangeItem.className) {\r\n\t\t\t\t\tranges[index * 2].addClass(rangeItem.className);\r\n\t\t\t\t\tranges[index * 2 + 1].addClass(rangeItem.className);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Create ticks layer, it will contain the actual ticks with their labels\r\n\t\tvar ticks = $(\"<div/>\").addClass(ticksClass).appendTo(slider);\r\n\r\n\t\t// Create handles\r\n\t\t// Also keep them in a jQuery collection to add events to\r\n\t\tvar handles = [], $handles = $();\r\n\t\tfor (let index = 0; index < opt.handleCount; index++) {\r\n\t\t\thandles[index] = $(\"<div/>\").addClass(handleClass).appendTo(slider);\r\n\t\t\t$handles = $handles.add(handles[index]);\r\n\t\t}\r\n\r\n\t\t// Use precision to avoid ugly JavaScript floating point rounding issues\r\n\t\t// (like 35 * 0.01 = 0.35000000000000003)\r\n\t\tvar decimals = -Math.floor(Math.log10(opt.smallStep));\r\n\r\n\t\tvar rangeBaseValue = opt.rangeBase;\r\n\t\tif (rangeBaseValue === \"min\") rangeBaseValue = opt.min;\r\n\t\tif (rangeBaseValue === \"max\") rangeBaseValue = opt.max;\r\n\t\trangeBaseValue = minmax(rangeBaseValue, opt.min, opt.max);\r\n\t\tvar rangeBasePos = Math.round((rangeBaseValue - opt.min) / (opt.max - opt.min) * 10000) / 100;\r\n\r\n\t\tvar startAttr, endAttr;\r\n\t\tvar handleLength;   // Length of the handle in drag direction\r\n\r\n\t\tif (isVertical) {\r\n\t\t\tstartAttr = \"bottom\";\r\n\t\t\tendAttr = \"top\";\r\n\t\t\tslider.addClass(\"vertical\");\r\n\t\t\tsliderBorder = (slider.outerHeight() - slider.innerHeight()) / 2;\r\n\t\t\thandleLength = handles[0].outerHeight();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstartAttr = \"left\";\r\n\t\t\tendAttr = \"right\";\r\n\t\t\tslider.removeClass(\"vertical\");\r\n\t\t\tsliderBorder = (slider.outerWidth() - slider.innerWidth()) / 2;\r\n\t\t\thandleLength = handles[0].outerWidth();\r\n\t\t}\r\n\t\tfor (let index = 0; index < opt.handleCount; index++) {\r\n\t\t\tresetDragHandleOffset(index);\r\n\t\t\tsetValue(index, opt.values[index]);\r\n\t\t}\r\n\r\n\t\t// Draw ticks\r\n\t\tif (opt.smallTicks || opt.largeTicks) {\r\n\t\t\tvar minTick = Math.ceil(opt.min / opt.smallStep) * opt.smallStep;\r\n\t\t\tfor (let value = minTick; value <= opt.max; value += opt.smallStep) {\r\n\t\t\t\tvalue = round(value, decimals);\r\n\t\t\t\tlet large = value / opt.largeStep === Math.trunc(value / opt.largeStep);\r\n\t\t\t\tif (!large && !opt.smallTicks) continue;\r\n\r\n\t\t\t\tlet pos = Math.round((value - opt.min) / (opt.max - opt.min) * 10000) / 100;\r\n\t\t\t\tlet tickArr = $();\r\n\t\t\t\tif (opt.tickPlacement === \"both\" || opt.tickPlacement === \"topleft\") {\r\n\t\t\t\t\ttickArr = tickArr.add($(\"<div/>\").css(startAttr, pos + \"%\").appendTo(ticks));\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.tickPlacement === \"both\" || opt.tickPlacement === \"bottomright\") {\r\n\t\t\t\t\ttickArr = tickArr.add($(\"<div/>\").addClass(\"opposite\").css(startAttr, pos + \"%\").appendTo(ticks));\r\n\t\t\t\t}\r\n\t\t\t\tif (large) {\r\n\t\t\t\t\ttickArr.addClass(\"large\");\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.smallTickLabels || opt.largeTickLabels && large) {\r\n\t\t\t\t\ttickArr.attr(\"data-label\", value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Allow Pointer API to work properly in Edge\r\n\t\tslider.css(\"touch-action\", \"none\");\r\n\r\n\t\tvar eventRemovers = [];\r\n\t\t$handles.pointer(\"down\", function (event) {\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\t// Select touched handle\r\n\t\t\tvar handle = $(event.target).closest(\".\" + handleClass);\r\n\t\t\tvar index = $.inArray(handle[0], $handles);\r\n\t\t\tif (index === -1) {\r\n\t\t\t\tconsole.warn(\"Clicked handle not found\");\r\n\t\t\t\treturn;   // Should not happen: handle not found\r\n\t\t\t}\r\n\r\n\t\t\t// Remember where the handle was dragged (probably not exactly the center)\r\n\t\t\tif (isVertical)\r\n\t\t\t\tdragHandleOffset[index] = handles[index].offset().top + handles[index].outerHeight() - event.pageY;\r\n\t\t\telse\r\n\t\t\t\tdragHandleOffset[index] = event.pageX - handles[index].offset().left;\r\n\r\n\t\t\tdraggedHandleCursor = handles[index].actualCursor();\r\n\t\t});\r\n\t\tslider.pointer(\"down\", function (event) {\r\n\t\t\tif (slider.disabled()) return;\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tslider.focus();\r\n\r\n\t\t\t\tvar isFirstDrag = true;\r\n\t\t\t\tdragHandlePointerId.forEach(function (item) {\r\n\t\t\t\t\tif (item !== undefined) isFirstDrag = false;\r\n\t\t\t\t});\r\n\t\t\t\tif (isFirstDrag)\r\n\t\t\t\t\tslider.trigger(\"firstdragstart\");\r\n\r\n\t\t\t\t// Select touched or nearest handle and remember by pointerId\r\n\t\t\t\tvar handle = $(event.target).closest(\".\" + handleClass);\r\n\t\t\t\tvar index = $.inArray(handle[0], $handles);\r\n\t\t\t\tif (index === -1) {\r\n\t\t\t\t\t// Not clicked on a handle.\r\n\t\t\t\t\t// Find nearest handle, prefer same direction (for locked handles on the same value)\r\n\t\t\t\t\tvar pointerValue = getValueFromEvent(event);\r\n\t\t\t\t\tvar minValueDistance = Infinity;\r\n\t\t\t\t\topt.values.forEach(function (value, valueIndex) {\r\n\t\t\t\t\t\tvar valueDistance = Math.abs(value - pointerValue);\r\n\t\t\t\t\t\tif (valueDistance < minValueDistance ||\r\n\t\t\t\t\t\t\tpointerValue > value && valueDistance <= minValueDistance) {\r\n\t\t\t\t\t\t\tminValueDistance = valueDistance;\r\n\t\t\t\t\t\t\tindex = valueIndex;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tdragHandlePointerId[index] = event.pointerId;\r\n\t\t\t\tlastTouchedHandleIndex = index;\r\n\r\n\t\t\t\thandles[index].addClass(\"pressed\");\r\n\t\t\t\tonMove(event);\r\n\r\n\t\t\t\tif (isFirstDrag) {\r\n\t\t\t\t\tslider.setCapture && slider.setCapture();   // Firefox only (set cursor over entire desktop)\r\n\t\t\t\t\t$(\"html\").addClass(resetAllCursorsClass);   // All browsers (set cursor at least within page)\r\n\t\t\t\t\thtmlCursor = document.documentElement.style.getPropertyValue(\"cursor\");\r\n\t\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", opt.dragCursor || draggedHandleCursor || slider.actualCursor(), \"important\");\r\n\r\n\t\t\t\t\teventRemovers.push($(window).pointer(\"move\", onMove, true));\r\n\t\t\t\t\teventRemovers.push($(window).pointer(\"up cancel\", onEnd, true));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Make the element focusable if not already specified\r\n\t\tinitialTabindex = slider.attr(\"tabindex\");\r\n\t\tif (initialTabindex === undefined) {\r\n\t\t\tinitialTabindex = \"0\";\r\n\t\t\tslider.attr(\"tabindex\", initialTabindex);\r\n\t\t}\r\n\r\n\t\t// Make the element unfocusable when disabled\r\n\t\tinstallDisabledchangeHook();\r\n\t\tslider.on(\"disabledchange\", function () {\r\n\t\t\tif (slider.disabled()) {\r\n\t\t\t\tslider.removeAttr(\"tabindex\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tslider.attr(\"tabindex\", initialTabindex);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tslider.keydown(onKeydown);\r\n\r\n\t\t// TODO: Trigger \"remove\" event for DOM elements being removed, like jQuery UI overrides $.cleanData (once!)\r\n\t\t// TODO: slider.on(\"remove\", /* cancel current drag operation and remove all events */) - also in other widgets!\r\n\r\n\t\tfunction onMove(event) {\r\n\t\t\t// Select dragged handle from pointerId\r\n\t\t\tvar index = dragHandlePointerId.indexOf(event.pointerId);\r\n\t\t\tif (index === -1) return;   // Not my pointer\r\n\r\n\t\t\tvar value = getValueFromEvent(event);\r\n\r\n\t\t\tif (opt.handleCount > 1) {\r\n\t\t\t\tswitch (opt.handleInteractionMode) {\r\n\t\t\t\t\tcase \"locked\":\r\n\t\t\t\t\t\tif (index > 0 && value < opt.values[index - 1])\r\n\t\t\t\t\t\t\tvalue = opt.values[index - 1];\r\n\t\t\t\t\t\tif (index < opt.handleCount - 1 && value > opt.values[index + 1])\r\n\t\t\t\t\t\t\tvalue = opt.values[index + 1];\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"push\":\r\n\t\t\t\t\t\tfor (let otherIndex = index - 1; otherIndex >= 0; otherIndex--) {\r\n\t\t\t\t\t\t\tif (value < opt.values[otherIndex])\r\n\t\t\t\t\t\t\t\tsetValue(otherIndex, value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (let otherIndex = index + 1; otherIndex < opt.handleCount; otherIndex++) {\r\n\t\t\t\t\t\t\tif (value > opt.values[otherIndex])\r\n\t\t\t\t\t\t\t\tsetValue(otherIndex, value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tsetValue(index, value);\r\n\t\t}\r\n\r\n\t\tfunction onEnd(event) {\r\n\t\t\t// Select dragged handle from pointerId\r\n\t\t\tvar index = dragHandlePointerId.indexOf(event.pointerId);\r\n\t\t\tif (index === -1) return;   // Not my pointer\r\n\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tdragHandlePointerId[index] = undefined;\r\n\t\t\t\thandles[index].removeClass(\"pressed\");\r\n\t\t\t\tresetDragHandleOffset(index);\r\n\r\n\t\t\t\tvar isLastDrag = true;\r\n\t\t\t\tdragHandlePointerId.forEach(function (item) {\r\n\t\t\t\t\tif (item !== undefined) isLastDrag = false;\r\n\t\t\t\t});\r\n\t\t\t\tif (isLastDrag) {\r\n\t\t\t\t\tslider.releaseCapture && slider.releaseCapture();\r\n\t\t\t\t\t$(\"html\").removeClass(resetAllCursorsClass);\r\n\t\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", htmlCursor);\r\n\r\n\t\t\t\t\teventRemovers.forEach(function (eventRemover) { eventRemover(); });\r\n\t\t\t\t\teventRemovers = [];\r\n\r\n\t\t\t\t\tslider.trigger(\"lastdragend\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onKeydown(event) {\r\n\t\t\tif (slider.disabled()) return;\r\n\t\t\tif (event.keyCode === 40 || event.keyCode === 37) {   // Down, Left\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tsetValue(lastTouchedHandleIndex, opt.values[lastTouchedHandleIndex] - (event.shiftKey ? opt.largeStep : opt.smallStep));\r\n\t\t\t}\r\n\t\t\tif (event.keyCode === 38 || event.keyCode === 39) {   // Up, Right\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tsetValue(lastTouchedHandleIndex, opt.values[lastTouchedHandleIndex] + (event.shiftKey ? opt.largeStep : opt.smallStep));\r\n\t\t\t}\r\n\t\t\tif (event.keyCode === 36) {   // Home\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tsetValue(lastTouchedHandleIndex, opt.min);\r\n\t\t\t}\r\n\t\t\tif (event.keyCode === 35) {   // End\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tsetValue(lastTouchedHandleIndex, opt.max);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Gets the slider value from the coordinates of a pointer event.\r\n\t\tfunction getValueFromEvent(event) {\r\n\t\t\t// Select dragged handle from pointerId\r\n\t\t\tvar index = dragHandlePointerId.indexOf(event.pointerId);\r\n\r\n\t\t\t// Assume center click if pointer is unknown\r\n\t\t\tvar myDragHandleOffset = handleLength / 2;\r\n\t\t\tif (index !== -1) myDragHandleOffset = dragHandleOffset[index];\r\n\r\n\t\t\tvar sliderRect = slider.rect();\r\n\t\t\tvar pointerPosIntoSlider;   // Distance from min end of the slider to the pointer\r\n\t\t\tvar sliderLength;   // Length of the slider in drag direction\r\n\t\t\tif (isVertical) {\r\n\t\t\t\tpointerPosIntoSlider = sliderRect.bottom - sliderBorder - event.pageY;\r\n\t\t\t\tsliderLength = slider.innerHeight();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tpointerPosIntoSlider = event.pageX - sliderRect.left - sliderBorder;\r\n\t\t\t\tsliderLength = slider.innerWidth();\r\n\t\t\t}\r\n\r\n\t\t\tvar handleCenterPos = pointerPosIntoSlider - myDragHandleOffset + handleLength / 2;   // Position of the handle's center\r\n\t\t\tvar value = handleCenterPos / sliderLength * (opt.max - opt.min) + opt.min;   // Selected value\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Sets a slider value and triggers the change event. Also moves the handle.\r\n\t\tfunction setValue(index, value) {\r\n\t\t\tvalue = minmax(value, opt.min, opt.max);\r\n\t\t\tvalue = Math.round(value / opt.smallStep) * opt.smallStep;   // Snap to steps\r\n\t\t\tvalue = round(value, decimals);\r\n\t\t\tmoveHandle(index, value);\r\n\t\t\tif (value !== opt.values[index]) {\r\n\t\t\t\topt.values[index] = value;\r\n\t\t\t\tslider.trigger(\"valuechange\");   // TODO: Indicate the changed value index\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Moves a handle to the specified slider value and updates the ranges.\r\n\t\tfunction moveHandle(index, value) {\r\n\t\t\tvar pos = getPosFromValue(value);\r\n\t\t\thandles[index].css(startAttr, \"calc(\" + pos + \"% - \" + (handleLength / 2) + \"px)\");\r\n\r\n\t\t\t// Also update ranges\r\n\t\t\tif (opt.ranges) {\r\n\t\t\t\topt.ranges.forEach(function (rangeItem, rangeIndex) {\r\n\t\t\t\t\tvar start = rangeItem.start, startHandleIndex;\r\n\t\t\t\t\tif (start === \"min\") {\r\n\t\t\t\t\t\tstart = opt.min;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (start === \"max\") {\r\n\t\t\t\t\t\tstart = opt.max;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (start[0] === \"#\") {\r\n\t\t\t\t\t\tstartHandleIndex = Number(start.substr(1));\r\n\t\t\t\t\t\tstart = startHandleIndex === index ? value : opt.values[startHandleIndex];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar end = rangeItem.end, endHandleIndex;\r\n\t\t\t\t\tif (end === \"min\") {\r\n\t\t\t\t\t\tend = opt.min;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (end === \"max\") {\r\n\t\t\t\t\t\tend = opt.max;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (end[0] === \"#\") {\r\n\t\t\t\t\t\tendHandleIndex = Number(end.substr(1));\r\n\t\t\t\t\t\tend = endHandleIndex === index ? value : opt.values[endHandleIndex];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar startPos = getPosFromValue(start);\r\n\t\t\t\t\tvar endPos = getPosFromValue(end);\r\n\t\t\t\t\tvar overflowEqual = rangeItem.overflowEqual ||\r\n\t\t\t\t\t\tstartHandleIndex !== undefined && endHandleIndex !== undefined && endHandleIndex < startHandleIndex;\r\n\t\t\t\t\tsetRange(rangeIndex, startPos, endPos, overflowEqual);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse if (opt.handleCount === 1) {\r\n\t\t\t\tif (pos < rangeBasePos)\r\n\t\t\t\t\tsetRange(0, pos, rangeBasePos);\r\n\t\t\t\telse\r\n\t\t\t\t\tsetRange(0, rangeBasePos, pos);\r\n\t\t\t}\r\n\t\t\telse if (opt.handleCount === 2) {\r\n\t\t\t\tvar pos0 = index === 0 ? pos : getPosFromValue(opt.values[0]);\r\n\t\t\t\tvar pos1 = index === 1 ? pos : getPosFromValue(opt.values[1]);\r\n\t\t\t\tsetRange(0, pos0, pos1, opt.rangeOverflowEqual);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Sets the size of a range element for a start and end value, supporting overflow.\r\n\t\tfunction setRange(index, start, end, overflowEqual) {\r\n\t\t\tif (start < end || start === end && !overflowEqual) {\r\n\t\t\t\t// Only one contiguous range, hide the second element\r\n\t\t\t\tranges[index * 2].css(startAttr, start + \"%\");\r\n\t\t\t\tranges[index * 2].css(endAttr, (100 - end) + \"%\");\r\n\t\t\t\tranges[index * 2 + 1].css(startAttr, \"0%\");\r\n\t\t\t\tranges[index * 2 + 1].css(endAttr, \"100%\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Overflow range, split in two elements from either end of the slider\r\n\t\t\t\tranges[index * 2].css(startAttr, \"0%\");\r\n\t\t\t\tranges[index * 2].css(endAttr, (100 - end) + \"%\");\r\n\t\t\t\tranges[index * 2 + 1].css(startAttr, start + \"%\");\r\n\t\t\t\tranges[index * 2 + 1].css(endAttr, \"0%\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Returns the relative position in percent from the slider value.\r\n\t\tfunction getPosFromValue(value) {\r\n\t\t\tvar pos = Math.round((value - opt.min) / (opt.max - opt.min) * 10000) / 100;\r\n\t\t\treturn pos;\r\n\t\t}\r\n\r\n\t\t// Resets the drag offset as if the handle was dragged exactly in the middle.\r\n\t\tfunction resetDragHandleOffset(index) {\r\n\t\t\tdragHandleOffset[index] = handleLength / 2;\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Gets the current slider value.\r\n//\r\n// value: Sets the slider value.\r\nfunction sliderValue(value) {\r\n\treturn this.slider.multivalue(0, value);\r\n}\r\n\r\n// Gets the current value of the specified slider handle.\r\n//\r\n// value: Sets the value of the specified slider handle.\r\nfunction sliderMultiValue(index, value) {\r\n\t// Getter\r\n\tif (value === undefined) {\r\n\t\tvar slider = this.first();\r\n\t\tif (slider.length === 0) return;   // Nothing to do\r\n\t\tvar opt = loadOptions(\"slider\", slider);\r\n\t\treturn opt.values[index];\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar slider = $(this);\r\n\t\tvar opt = loadOptions(\"slider\", slider);\r\n\t\topt._setValue(index, value);\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"slider\", slider, {\r\n\tvalue: sliderValue,\r\n\tmultivalue: sliderMultiValue\r\n});\r\n$.fn.slider.defaults = sliderDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar sortableClass = \"ff-sortable\";\r\nvar sortablePlaceholderClass = \"ff-sortable-placeholder\";\r\n\r\n// Defines default options for the sortable plugin.\r\nvar sortableDefaults = {\r\n\t// The element(s) that can start a drag operation. Default: The element to drag.\r\n\thandle: undefined,\r\n\r\n\t// The element(s) that cannot start a drag operation. Default: None.\r\n\tcancel: undefined,\r\n\r\n\t// Constrains the drag movement along the \"x\" or \"y\" axis. Default: None.\r\n\taxis: undefined,\r\n\r\n\t// Constrains the drag movement inside the specified element or the \"parent\" of the dragged element. Default: None.\r\n\tcontainment: undefined,\r\n\r\n\t// The elements among which the dragged element will be pulled in the front, or true to stack all sortable children. Default: None.\r\n\tstack: undefined,\r\n\r\n\t// The mouse cursor to show during dragging. Default: None.\r\n\tdragCursor: undefined,\r\n\r\n\t// A CSS class to add to the element while it's being dragged. Default: None.\r\n\tdragClass: undefined,\r\n\r\n\t// Indicates whether the window should scroll to keep the dragged element visible. Default: false.\r\n\tscroll: false\r\n};\r\n\r\n// Makes the child elements in each selected element sortable by drag&drop.\r\nfunction sortable(options) {\r\n\treturn this.each(function () {\r\n\t\tvar elem = this;\r\n\t\tvar $elem = $(elem);\r\n\t\tif ($elem.hasClass(sortableClass)) return;   // Already done\r\n\t\t$elem.addClass(sortableClass);\r\n\t\tvar opt = initOptions(\"sortable\", sortableDefaults, $elem, {}, options);\r\n\t\topt._prepareChild = prepareChild;\r\n\r\n\t\t// Remove text nodes between children which cause layout issues when dragging\r\n\t\t$elem.contents().filter(function () {\r\n\t\t\treturn this.nodeType === 3;\r\n\t\t}).remove();\r\n\r\n\t\tvar isVertical = isBlockDisplay($elem.firstChild().css(\"display\"));\r\n\t\tvar flowStart = isVertical ? \"top\" : \"left\";\r\n\t\tvar flowEnd = isVertical ? \"bottom\" : \"right\";\r\n\t\tvar crossStart = isVertical ? \"left\" : \"top\";\r\n\t\tvar crossEnd = isVertical ? \"right\" : \"bottom\";\r\n\r\n\t\t$elem.children().each(prepareChild);\r\n\t\t\r\n\t\tfunction prepareChild() {\r\n\t\t\tvar child = $(this);\r\n\t\t\tvar placeholder, initialChildAfterElement, placeholderAfterElement, betweenChildren, initialChildIndex;\r\n\t\t\tvar stack = opt.stack;\r\n\t\t\tif (stack === true)\r\n\t\t\t\tstack = $elem.children();\r\n\r\n\t\t\tchild.draggable({\r\n\t\t\t\thandle: opt.handle,\r\n\t\t\t\tcancel: opt.cancel,\r\n\t\t\t\taxis: opt.axis,\r\n\t\t\t\tcontainment: opt.containment,\r\n\t\t\t\tstack: stack,\r\n\t\t\t\tdragCursor: opt.dragCursor,\r\n\t\t\t\tdragClass: opt.dragClass,\r\n\t\t\t\tscroll: opt.scroll\r\n\t\t\t});\r\n\t\t\tchild.on(\"draggablestart\", function (event) {\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tlet event2 = $.Event(\"sortablestart\");\r\n\t\t\t\tchild.trigger(event2);\r\n\t\t\t\tif (event2.isDefaultPrevented()) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remember where the element was before it was dragged, so it can be moved back there\r\n\t\t\t\tinitialChildAfterElement = child.prev();\r\n\t\t\t\tif (initialChildAfterElement.length === 0)\r\n\t\t\t\t\tinitialChildAfterElement = null;\r\n\t\t\t\tinitialChildIndex = child.index();\r\n\r\n\t\t\t\tlet rect = child.rect();\r\n\r\n\t\t\t\t// Fix the size of table row cells while dragging\r\n\t\t\t\tif (child[0].nodeName === \"TR\") {\r\n\t\t\t\t\tlet table = child.closest(\"table\").find(\"tr\").first().children(\"td, th\").each$(function () {\r\n\t\t\t\t\t\tthis.data(\"width-before-drag\", this[0].style.width || \"\");\r\n\t\t\t\t\t\tthis.css(\"width\", this.outerWidth());\r\n\t\t\t\t\t});\r\n\t\t\t\t\tchild.children(\"td, th\").each$(function () {\r\n\t\t\t\t\t\tthis.css(\"width\", this.outerWidth());\r\n\t\t\t\t\t});\r\n\t\t\t\t\tchild.css(\"min-width\", child.outerWidth() + 1);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// Create the placeholder element that will take the place of the dragged element\r\n\t\t\t\tplaceholder = $(\"<\" + child[0].nodeName + \"/>\")\r\n\t\t\t\t\t.addClass(child[0].className)\r\n\t\t\t\t\t.addClass(sortablePlaceholderClass)\r\n\t\t\t\t\t.text(\"\\xa0\")\r\n\t\t\t\t\t.css({ width: rect.width, height: rect.height });\r\n\t\t\t\tif (child[0].nodeName === \"TR\") {\r\n\t\t\t\t\tlet colCount = child.children(\"td, th\")\r\n\t\t\t\t\t\t.map(td => $(td).attr(\"colspan\") || 1)\r\n\t\t\t\t\t\t.get()   // Convert jQuery array to Array\r\n\t\t\t\t\t\t.reduce((a, b) => a + b);\r\n\t\t\t\t\tplaceholder.append($(\"<td/>\").attr(\"colspan\", colCount));\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Insert the placeholder where the dragged element is, and take that out of the layout flow\r\n\t\t\t\tchild.after(placeholder);\r\n\t\t\t\tchild.css({ position: \"absolute\", width: rect.width, height: rect.height });\r\n\t\t\t\tupdateChildren();\r\n\t\t\t});\r\n\t\t\tchild.on(\"draggablemove\", function (event) {\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tlet event2 = $.Event(\"sortablemove\");\r\n\t\t\t\tchild.trigger(event2);\r\n\t\t\t\tif (event2.isDefaultPrevented()) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find the center points of the dragged element, both at the start and end in flow direction\r\n\t\t\t\tvar rect = child.rect();\r\n\t\t\t\tvar childStartCenter = center(rect);\r\n\t\t\t\tchildStartCenter[flowStart] = rect[flowStart];\r\n\t\t\t\tvar childEndCenter = center(rect);\r\n\t\t\t\tchildEndCenter[flowStart] = rect[flowEnd];\r\n\r\n\t\t\t\tvar minStartDistance = Infinity;\r\n\t\t\t\tvar minEndDistance = Infinity;\r\n\t\t\t\tvar newPlaceholderAfterElementStart;\r\n\t\t\t\tvar newPlaceholderAfterElementEnd;\r\n\r\n\t\t\t\t// Iterate betweenChildren to find the closest line connecting two elements\r\n\t\t\t\tbetweenChildren.forEach(function (x) {\r\n\t\t\t\t\tvar startDistance = distToSegment(childStartCenter, x.p1, x.p2);\r\n\t\t\t\t\tif (startDistance < minStartDistance) {\r\n\t\t\t\t\t\tminStartDistance = startDistance;\r\n\t\t\t\t\t\tnewPlaceholderAfterElementStart = x.after;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar endDistance = distToSegment(childEndCenter, x.p1, x.p2);\r\n\t\t\t\t\tif (endDistance < minEndDistance) {\r\n\t\t\t\t\t\tminEndDistance = endDistance;\r\n\t\t\t\t\t\tnewPlaceholderAfterElementEnd = x.after;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Find the suggested new placeholder location that's different from the current...\r\n\t\t\t\t// TODO: If a short item is dragged over a long item at the beginning of a row and its placeholder still fits into the previous row, this flickers\r\n\t\t\t\t// * Visualise the generated lines between the items to get an idea of what the code sees\r\n\t\t\t\t//console.log(\"start is after center of \" + $(newPlaceholderAfterElementStart).text());\r\n\t\t\t\t//console.log(\"end is after center of \" + $(newPlaceholderAfterElementEnd).text());\r\n\t\t\t\tvar newPlaceholderAfterElement;\r\n\t\t\t\tif (newPlaceholderAfterElementStart !== placeholderAfterElement)\r\n\t\t\t\t\tnewPlaceholderAfterElement = newPlaceholderAfterElementStart;\r\n\t\t\t\tif (newPlaceholderAfterElementEnd !== placeholderAfterElement)\r\n\t\t\t\t\tnewPlaceholderAfterElement = newPlaceholderAfterElementEnd;\r\n\r\n\t\t\t\t// ...and move it there\r\n\t\t\t\tif (newPlaceholderAfterElement !== undefined) {\r\n\t\t\t\t\tvar eventCancelled = false;\r\n\t\t\t\t\tif (placeholderAfterElement !== undefined) {\r\n\t\t\t\t\t\tlet event2 = $.Event(\"sortablechange\");\r\n\t\t\t\t\t\tevent2.after = newPlaceholderAfterElement;\r\n\t\t\t\t\t\tchild.trigger(event2);\r\n\t\t\t\t\t\teventCancelled = event2.isDefaultPrevented();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!eventCancelled) {\r\n\t\t\t\t\t\tif (!newPlaceholderAfterElement)\r\n\t\t\t\t\t\t\tplaceholder.detach().insertBefore($elem.firstChild());\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tplaceholder.detach().insertAfter(newPlaceholderAfterElement);\r\n\t\t\t\t\t\tplaceholderAfterElement = newPlaceholderAfterElement;\r\n\t\t\t\t\t\tupdateChildren();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tchild.on(\"draggableend\", function (event) {\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tchild.css({ position: \"\", width: \"\", height: \"\", top: \"\", left: \"\" });\r\n\t\t\t\tplaceholder.replaceWith(child);\r\n\t\t\t\tplaceholder = undefined;\r\n\t\t\t\tbetweenChildren = undefined;\r\n\r\n\t\t\t\t// Reset the size of table row cells\r\n\t\t\t\tif (child[0].nodeName === \"TR\") {\r\n\t\t\t\t\tlet table = child.closest(\"table\").find(\"tr\").first().children(\"td, th\").each$(function () {\r\n\t\t\t\t\t\tthis.css(\"width\", this.data(\"width-before-drag\"));\r\n\t\t\t\t\t\tthis.data(\"width-before-drag\", null);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tchild.children(\"td, th\").each$(function () {\r\n\t\t\t\t\t\tthis.css(\"width\", \"\");\r\n\t\t\t\t\t});\r\n\t\t\t\t\tchild.css(\"width\", \"\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet event2 = $.Event(\"sortableend\");\r\n\t\t\t\tevent2.initialIndex = initialChildIndex;\r\n\t\t\t\tevent2.newIndex = child.index();\r\n\t\t\t\tevent2.after = placeholderAfterElement;\r\n\t\t\t\tchild.trigger(event2);\r\n\t\t\t\tif (event2.isDefaultPrevented()) {\r\n\t\t\t\t\tif (!initialChildAfterElement)\r\n\t\t\t\t\t\tchild.detach().insertBefore($elem.firstChild());\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tchild.detach().insertAfter(initialChildAfterElement);\r\n\t\t\t\t}\r\n\t\t\t\tinitialChildAfterElement = undefined;\r\n\t\t\t});\r\n\r\n\t\t\tfunction updateChildren() {\r\n\t\t\t\tbetweenChildren = [];\r\n\t\t\t\tvar rowElements = [];\r\n\t\t\t\tvar rowMin, rowMax, currentPos, elem = null;\r\n\t\t\t\t$elem.children().each(function () {\r\n\t\t\t\t\tif (this !== child[0]) {\r\n\t\t\t\t\t\tvar rect = $(this).rect();\r\n\t\t\t\t\t\tif (rect[flowStart] + 0.1 < currentPos) {   // Need to compensate for rounding issues from the 4th decimal in Chrome/Edge/IE\r\n\t\t\t\t\t\t\t// This element is in a new row\r\n\t\t\t\t\t\t\taddRow();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Remember the width of a row\r\n\t\t\t\t\t\tif (rowMin === undefined || rect[crossStart] < rowMin) rowMin = rect[crossStart];\r\n\t\t\t\t\t\tif (rowMax === undefined || rect[crossEnd] < rowMax) rowMax = rect[crossEnd];\r\n\r\n\t\t\t\t\t\t// Remember how far the row has been used\r\n\t\t\t\t\t\tcurrentPos = rect[flowEnd];\r\n\r\n\t\t\t\t\t\tif (this !== placeholder[0]) elem = this;\r\n\t\t\t\t\t\trowElements.push({ elem: elem, rect: rect });\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Don't forget the last row\r\n\t\t\t\taddRow();\r\n\r\n\t\t\t\tfunction addRow() {\r\n\t\t\t\t\tvar rowCenter = (rowMin + rowMax) / 2;\r\n\r\n\t\t\t\t\t// Add line before the first element in the row\r\n\t\t\t\t\tbetweenChildren.push({\r\n\t\t\t\t\t\t// far away\r\n\t\t\t\t\t\tp1: createPoint(-10000, rowCenter),\r\n\t\t\t\t\t\t// the first row element's center\r\n\t\t\t\t\t\tp2: createPoint(center(rowElements[0].rect)[flowStart], rowCenter),\r\n\t\t\t\t\t\t// the position after the last element of the previous row, if any\r\n\t\t\t\t\t\tafter: betweenChildren.length > 0 ? betweenChildren[betweenChildren.length - 1].after : null\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Now add lines after each element in the row\r\n\t\t\t\t\trowElements.forEach(function (x, i) {\r\n\t\t\t\t\t\tbetweenChildren.push({\r\n\t\t\t\t\t\t\t// the current row element's center\r\n\t\t\t\t\t\t\tp1: createPoint(center(x.rect)[flowStart], rowCenter),\r\n\t\t\t\t\t\t\t// the next row element's center, if any; otherwise far away\r\n\t\t\t\t\t\t\tp2: createPoint(i < rowElements.length - 1 ? center(rowElements[i + 1].rect)[flowStart] : 10000, rowCenter),\r\n\t\t\t\t\t\t\t// the position after the current row element\r\n\t\t\t\t\t\t\tafter: x.elem\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Reset values for the new row\r\n\t\t\t\t\trowMin = rowMax = currentPos = undefined;\r\n\t\t\t\t\trowElements = [];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Returns an absolute point with \"left\" and \"top\" coordinates for the current orientation.\r\n\t\tfunction createPoint(flow, cross) {\r\n\t\t\tvar p = {};\r\n\t\t\tp[flowStart] = flow;\r\n\t\t\tp[crossStart] = cross;\r\n\t\t\treturn p;\r\n\t\t}\r\n\t});\r\n\r\n\t// Returns the center point of the specified rectangle.\r\n\tfunction center(rect) {\r\n\t\treturn {\r\n\t\t\ttop: rect.top + rect.height / 2,\r\n\t\t\tleft: rect.left + rect.width / 2\r\n\t\t};\r\n\t}\r\n\r\n\t// Determines whether the specified CSS display value defines a block instead of an inline.\r\n\tfunction isBlockDisplay(value) {\r\n\t\treturn [\"block\", \"flex\", \"grid\", \"list-item\", \"table\", \"table-footer-group\", \"table-header-group\", \"table-row\", \"table-row-group\"].indexOf(value) !== -1;\r\n\t}\r\n\r\n\t// Source: https://jsfiddle.net/beentaken/9k1sf6p2/ (modified)\r\n\tfunction dist2(v, w) {\r\n\t\treturn (v.left - w.left) ** 2 + (v.top - w.top) ** 2;\r\n\t}\r\n\r\n\tfunction distToSegmentSquared(p, v, w) {\r\n\t\tvar l2 = dist2(v, w);\r\n\t\tif (l2 == 0) return dist2(p, v);\r\n\t\tvar t = ((p.left - v.left) * (w.left - v.left) + (p.top - v.top) * (w.top - v.top)) / l2;\r\n\t\tif (t < 0) return dist2(p, v);\r\n\t\tif (t > 1) return dist2(p, w);\r\n\t\treturn dist2(p, { left: v.left + t * (w.left - v.left), top: v.top + t * (w.top - v.top) });\r\n\t}\r\n\r\n\tfunction distToSegment(p, v, w) {\r\n\t\treturn Math.sqrt(distToSegmentSquared(p, v, w));\r\n\t}\r\n}\r\n\r\n// Notifies the sortable plugin about a new child that needs to be initialized.\r\nfunction addChild(child) {\r\n\tvar sortable = $(this);\r\n\tvar opt = loadOptions(\"sortable\", sortable);\r\n\topt._prepareChild.call(child);\r\n}\r\n\r\nregisterPlugin(\"sortable\", sortable, {\r\n\taddChild: addChild\r\n});\r\n$.fn.sortable.defaults = sortableDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar tabHeadersClass = \"ff-tab-headers\";\r\nvar tabPagesClass = \"ff-tab-pages\";\r\n\r\n// Defines default options for the tabs plugin.\r\nvar tabsDefaults = {\r\n};\r\n\r\n// Converts all div elements in each selected element into tab pages.\r\n// The tab page headers are read from the div elements' title attribute.\r\nfunction tabs(options) {\r\n\treturn this.each(function () {\r\n\t\tvar container = $(this);\r\n\t\tif (container.children(\"div.\" + tabHeadersClass).length !== 0) return;   // Already done\r\n\t\tvar opt = initOptions(\"tabs\", tabsDefaults, container, {}, options);\r\n\t\topt._addTab = addTab;\r\n\r\n\t\tvar pageDivs = $(this).children(\"div\");\r\n\t\tvar activePage = pageDivs.filter(\".active\").first();\r\n\t\tvar headers = $(\"<div/>\").addClass(tabHeadersClass).appendTo(container);\r\n\t\tvar pages = $(\"<div/>\").addClass(tabPagesClass).appendTo(container);\r\n\t\tpageDivs.each(addTab);\r\n\t\t\r\n\t\tfunction addTab() {\r\n\t\t\tvar header = $(\"<a/>\").attr(\"href\", \"#\").attr(\"tabindex\", \"-1\").text($(this).attr(\"title\")).appendTo(headers);\r\n\t\t\tvar page = $(this).removeAttr(\"title\").detach().appendTo(pages);\r\n\t\t\tif (activePage.length === 0 || activePage[0] === page[0]) {\r\n\t\t\t\theader.addClass(\"active\").removeAttr(\"tabindex\");\r\n\t\t\t\tpage.addClass(\"active\");\r\n\t\t\t\tactivePage = page;\r\n\t\t\t}\r\n\t\t\theader.click(function (event) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tcontainer.tabs.activeTab(page);\r\n\t\t\t});\r\n\t\t\theader.keydown(function (event) {\r\n\t\t\t\tif (event.which === 37) {   // Left\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.prev().focus().click();\r\n\t\t\t\t}\r\n\t\t\t\tif (event.which === 39) {   // Right\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.next().focus().click();\r\n\t\t\t\t}\r\n\t\t\t\tif (event.which === 36) {   // Home\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.parent().children().first().focus().click();\r\n\t\t\t\t}\r\n\t\t\t\tif (event.which === 35) {   // End\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.parent().children().last().focus().click();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Adds a new tab page and header from a page div element.\r\n//\r\n// page: The new tab page to add. It does not have to be added to the DOM yet.\r\nfunction addTab(page) {\r\n\tvar tabs = $(this);\r\n\tvar opt = loadOptions(\"tabs\", tabs);\r\n\topt._addTab.call(page);\r\n}\r\n\r\n// Removes a tab page and header.\r\n//\r\n// indexOrPage: The tab page to remove, either by index or the page.\r\nfunction removeTab(indexOrPage) {\r\n\tvar container = $(this);\r\n\tvar headers = container.children(\"div.\" + tabHeadersClass).first();\r\n\tvar pages = container.find(\"div.\" + tabPagesClass).first();\r\n\tvar index = indexOrPage;\r\n\tif (!$.isNumeric(indexOrPage)) {\r\n\t\tindex = indexOrPage.index();\r\n\t}\r\n\tvar count = pages.children().length;\r\n\tvar header = headers.children().eq(index);\r\n\tvar page = pages.children().eq(index);\r\n\theader.remove();\r\n\tpage.remove();\r\n\tif (page.hasClass(\"active\")) {\r\n\t\t// Activate another tab\r\n\t\tlet newIndex = Math.min(index, count - 2);\r\n\t\tif (newIndex >= 0)\r\n\t\t\tcontainer.tabs.activeTab(newIndex);\r\n\t}\r\n}\r\n\r\n// Gets the title of a tab page in a tab container.\r\n//\r\n// indexOrPage: The tab page, either by index or the page.\r\n// title: Sets the title.\r\nfunction title(indexOrPage, title) {\r\n\tvar container = $(this);\r\n\tvar headers = container.children(\"div.\" + tabHeadersClass).first();\r\n\tvar index = indexOrPage;\r\n\tif (!$.isNumeric(indexOrPage)) {\r\n\t\tindex = indexOrPage.index();\r\n\t}\r\n\tvar header = headers.children().eq(index);\r\n\t\r\n\t// Getter\r\n\tif (title === undefined) {\r\n\t\treturn header.text();\r\n\t}\r\n\t\r\n\t// Setter\r\n\theader.text(title);\r\n}\r\n\r\n// Gets the active page in a tab container.\r\n//\r\n// indexOrPage: Sets the active page in each selected tab container, either by index or the page.\r\nfunction activeTab(indexOrPage) {\r\n\t// Getter\r\n\tif (indexOrPage === undefined) {\r\n\t\treturn this.find(\"div.\" + tabPagesClass + \" > .active\").first();\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar container = $(this);\r\n\t\tvar headers = container.children(\"div.\" + tabHeadersClass).first();\r\n\t\tvar pages = container.find(\"div.\" + tabPagesClass).first();\r\n\t\tvar index, page;\r\n\t\tif ($.isNumeric(indexOrPage)) {\r\n\t\t\tindex = +indexOrPage;\r\n\t\t\tpage = pages.children().eq(index);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tindex = indexOrPage.index();\r\n\t\t\tpage = indexOrPage;\r\n\t\t}\r\n\r\n\t\tif (page && !page.hasClass(\"active\")) {\r\n\t\t\theaders.children().attr(\"tabindex\", \"-1\");\r\n\t\t\theaders.children(\".active\").removeClass(\"active\");\r\n\t\t\theaders.children().eq(index).addClass(\"active\").removeAttr(\"tabindex\");\r\n\t\t\tpages.children(\".active\").removeClass(\"active\");\r\n\t\t\tpage.addClass(\"active\");\r\n\t\t\tcontainer.trigger(\"activeTabChange\");\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Gets all page div elements.\r\nfunction pages() {\r\n\tvar container = $(this);\r\n\tvar pages = container.find(\"div.\" + tabPagesClass).first();\r\n\treturn pages.children();\r\n}\r\n\r\n// Moves a tab to another position.\r\nfunction moveTab(indexOrPage, newIndex) {\r\n\tvar container = $(this);\r\n\tvar headers = container.children(\"div.\" + tabHeadersClass).first();\r\n\tvar pages = container.find(\"div.\" + tabPagesClass).first();\r\n\tvar index = indexOrPage;\r\n\tif (!$.isNumeric(indexOrPage)) {\r\n\t\tindex = indexOrPage.index();\r\n\t}\r\n\tvar headersChildren = headers.children();\r\n\tvar pagesChildren = pages.children();\r\n\tvar count = pagesChildren.length;\r\n\tvar header = headersChildren.eq(index);\r\n\tvar page = pagesChildren.eq(index);\r\n\tvar destHeader = headersChildren.eq(newIndex);\r\n\tvar destPage = pagesChildren.eq(newIndex);\r\n\tif (destHeader.length === 0) {\r\n\t\tif (newIndex > 0) {\r\n\t\t\t// Move to end\r\n\t\t\theader.insertAfter(headersChildren.last());\r\n\t\t\tpage.insertAfter(pagesChildren.last());\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Move to beginning\r\n\t\t\theader.insertBefore(headersChildren.first());\r\n\t\t\tpage.insertBefore(pagesChildren.first());\r\n\t\t}\r\n\t}\r\n\telse if (newIndex > index) {\r\n\t\t// Move after newIndex\r\n\t\theader.insertAfter(destHeader);\r\n\t\tpage.insertAfter(destPage);\r\n\t}\r\n\telse if (newIndex < index) {\r\n\t\t// Move before newIndex\r\n\t\theader.insertBefore(destHeader);\r\n\t\tpage.insertBefore(destPage);\r\n\t}\r\n}\r\n\r\nregisterPlugin(\"tabs\", tabs, {\r\n\taddTab: addTab,\r\n\tremoveTab: removeTab,\r\n\ttitle: title,\r\n\tactiveTab: activeTab,\r\n\tpages: pages,\r\n\tmoveTab: moveTab\r\n});\r\n$.fn.tabs.defaults = tabsDefaults;\r\n","﻿// Automatically apply all controls now. Must be loaded at the end of the document.\r\n// Doing it now is faster than waiting for the DOM ready event, and when loaded at the end of the\r\n// document, all relevant DOM parts are already there.\r\n\r\n$.fn.frontfire = function (prefix) {\r\n\tif (prefix === undefined) prefix = \"\";\r\n\tlet t = this;\r\n\r\n\tfunction findInclSelf(selector) {\r\n\t\treturn t.find(selector).addBack(selector);\r\n\t}\r\n\r\n\tfindInclSelf(prefix + \".accordion\").accordion();\r\n\tfindInclSelf(prefix + \".carousel\").carousel();\r\n\t// TODO: dropdown\r\n\tfindInclSelf(prefix + \"input[type=number]\").spinner();\r\n\tfindInclSelf(prefix + \"input[type=color]\").colorPicker();\r\n\t// type=color has serious restrictions on acceptable values, ff-color is a workaround\r\n\tfindInclSelf(prefix + \"input[type=ff-color]\").colorPicker();\r\n\tfindInclSelf(prefix + \"input[type=checkbox], input[type=radio]\").styleCheckbox();\r\n\tfindInclSelf(prefix + \"input[type=checkbox].three-state\").threeState();\r\n\tfindInclSelf(prefix + \"textarea.auto-height\").autoHeight();\r\n\tfindInclSelf(prefix + \".menu\").menu();\r\n\tfindInclSelf(prefix + \".critical.closable, .error.closable, .warning.closable, .information.closable, .success.closable\").closableMessage();\r\n\t// TODO: modal\r\n\tfindInclSelf(prefix + \".progressbar\").progressbar();\r\n\tfindInclSelf(prefix + \".slider\").slider();\r\n\tfindInclSelf(prefix + \".sortable\").sortable();\r\n\tfindInclSelf(prefix + \".tabs\").tabs();\r\n\treturn this;\r\n};\r\n\r\n$(document).frontfire(\":not(.no-autostart)\");\r\n","/*! frontfire.js v0.1 | @license MIT | unclassified.software/source/frontfire */\r\n/* ecmascript */\r\n/* iife-params($, window, document) */\r\n/* iife-args(jQuery, window, document) */\r\n\r\n// Import common functions\r\nimport \"./compatibility\";\r\nimport \"./jquery-extras\";\r\nimport \"./jquery-ui\";\r\n\r\n// Import all modules\r\nimport \"./modules/accordion\";\r\nimport \"./modules/carousel\";\r\nimport \"./modules/color\";\r\nimport \"./modules/dom\";\r\nimport \"./modules/draggable\";\r\nimport \"./modules/dropdown\";\r\nimport \"./modules/input\";\r\nimport \"./modules/menu\";\r\nimport \"./modules/message\";\r\nimport \"./modules/modal\";\r\nimport \"./modules/offcanvas\";\r\nimport \"./modules/progressbar\";\r\nimport \"./modules/resizable\";\r\nimport \"./modules/selectable\";\r\nimport \"./modules/slider\";\r\nimport \"./modules/sortable\";\r\nimport \"./modules/tabs\";\r\n\r\n// Automatically apply all controls\r\nimport \"./modules/autostart\";\r\n"]}