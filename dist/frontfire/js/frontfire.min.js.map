{"version":3,"sources":["util.js","compatibility.js","jquery-extras.js","plugin.js","jquery-ui.js","modules/accordion.js","modules/carousel.js","modules/color.js","modules/dom.js","modules/draggable.js","modules/dropdown.js","modules/input.js","modules/menu.js","modules/message.js","dimmer.js","modules/modal.js","modules/offcanvas.js","modules/progressbar.js","modules/resizable.js","modules/selectable.js","modules/slider.js","modules/sortable.js","modules/tabs.js","modules/autostart.js"],"names":["minmax","value","min","max","Math","round","decimals","undefined","precision","pow","forceReflow","body","$","css","offset","installDisabledchangeHook","hooks","name","id","_get","_set","ffId","prevHook","get","a","b","c","result","set","installHook","propHooks","elem","disabled","trigger","bindInputButtonsDisabled","input","buttons","handler","disable","forEach","button","enable","on","preventScrolling","state","$document","document","$html","scrollTop","scrollLeft","off","String","prototype","includes","search","start","length","this","indexOf","startsWith","pos","substr","endsWith","this_len","substring","padEnd","targetLength","padString","repeat","slice","padStart","count","TypeError","str","RangeError","Infinity","floor","rpt","i","trunc","x","log10","log","LOG10E","fn","each$","each","index","element","call","valChange","oldValue","val","isEqual","Array","isArray","every","v","change","isSet","isBoolean","isNumber","isString","isEven","isOdd","isAndroid","navigator","userAgent","match","isIos","platform","isLinux","isMac","isWindows","addClass","isBlink","isChrome","isOpera","window","CSS","chrome","webstore","isEdge","isInternetExplorer","StyleMedia","isFirefox","InstallTrigger","documentMode","opr","addons","opera","isSafari","test","HTMLElement","safari","pushNotification","toString","registerPlugin","create","obj","Object","defineProperty","ret","key","isFunction","bind","initOptions","defaults","converters","params","opts","extend","optValue","data","Function","err","console","error","elemDataValue","loadOptions","expr","focusable","hasTabindex","map","mapName","img","focusableIfVisible","fieldset","nodeName","toLowerCase","parentNode","href","is","closest","_focusable","attr","accordionClass","accordionDefaults","exclusive","scrollOffset","scrollOffsetElement","options","accordion","hasClass","opt","children","item","header","first","content","last","click","clientHeight","collapse","expand","keydown","event","which","preventDefault","location","hash","height","animate","top","indexOrItem","items","isNumeric","eq","scrollHeight","removeClass","Event","history","replaceState","title","pathname","onTransitionEnd","originalEvent","propertyName","passedExpandedItem","carouselClass","carouselIndicatorClass","carouselDefaults","active","dotsEach","gutter","indicator","autoPlay","autoPlayInterval","pauseOnHover","dragCursor","animation","loop","carousel","find","stage","_gutterWidth","_gutterOffset","_itemWidthPercent","_layout","layout","autoPlayTimeout","itemOffset","startItemOffset","prevItemOffset","dragDirection","itemOffsetMin","itemOffsetMax","itemWidth","maxItemHeight","currentTransition","outerHeight","detach","appendTo","indicatorCount","ceil","_loop","dot","activeItem","suspendAutoplay","resumeAutoplay","draggable","axis","dx","abs","dragPoint","left","newPoint","width","lastPageFirstItem","_isDragging","removeTransition","elastic","exceeding","elemRect","addTransition","newDot","autoplaySuspendLevel","mouseenter","mouseleave","setTimeout","next","clearTimeout","clearPending","opacityTime","allSame","z1","z2","z2Opacity","parseFloat","anyZero","firstGtZero","push","anyPositive","firstZero","fullyVisible","partiallyVisible","sign","_z","_z2","_z2Opacity","currentVisible","percent","opacity","Color","format","r","g","trim","keep255","Number","keep1","context","getContext","fillStyle","fillRect","getImageData","_typeof","Color_prototype","processColor","color","hslMode","updateHSL","updateRGB","extendFF","toIntARGB","toHTML","toCSS","conv","number","h","s","l","q","p","t","that","blendWith","other","ratio","includeAlpha","isHSL","invert","complement","lighten","factor","darken","alpha","gray","isDark","text","origToggle","toggle","args","arguments","apply","origShow","show","origHide","hide","rect","relative","position","outerWidth","right","bottom","visible","includeLabel","prop","removeAttr","parents","refNode","parent","label","prev","toggleDisabled","firstChild","add","firstElementChild","actualCursor","cursor","fontExists","font","probes","refFonts","container","probe","k","j","remove","pointer","type","capture","mouse","touch","mouseHandler","touchHandler","touchType","types","split","eventRemovers","eventRemover","_eventRemovers","_that","addEventListener","removeEventListener","event2","pointerId","pointerType","handleMouseEvent","changedTouches","pageX","pageY","identifier","handleTouchEvent","draggableClass","resetAllCursorsClass","draggableDefaults","handle","cancel","containment","stack","dragClass","grid","scroll","$elem","dragging","draggingCancelled","minDragDistance","htmlCursor","$window","handleElem","originalTouchAction","stopImmediatePropagation","onMove","onEnd","sqrt","isDefaultPrevented","setCapture","stackedElems","topElem","el","zIndex","parseInt","dragElem","sort","maxZIndex","toArray","o","stackElements","documentElement","style","getPropertyValue","setProperty","gridBase","cont","contRect","stepX","stepY","_event","viewportWidth","viewportHeight","scrollIntoView","wasDragging","releaseCapture","revert","dropdownContainerClass","dropdownDefaults","placement","autoClose","closeOnResize","closeOnHide","maxHeight","fixed","target","dropdown","oldContainer","autoPlacement","optPlacement","targetRect","isReducedHeight","isRightAligned","isHorizontallyCentered","dropdownWidth","dropdownHeight","direction","availableHeight","scrollbarWidth","offsetWidth","clientWidth","selectedChild","selectedTop","tryClose","hidden","close","isOpen","closeEventTriggered","inputWrapperClass","repeatButtonClass","styleCheckboxClass","treeStateClass","textareaWrapperClass","timeout","ms","wrapper","before","decButton","stepBase","step","corr","valueStr","toFixed","replace","repeatButton","incButton","lastColor","keyCode","focus","pickButton","colorBox","setColor","buttonRow","colors","baseColor_","baseColor","newButton","activeButton","currentColor","toggleClass","toInput","wrap","after","cb","checked","readOnly","indeterminate","minRows","maxRows","extraRows","textarea","shadowContent","outerHeightOffset","lineHeight","updateShadow","copyStyle","menu","isVertical","has","submenu","ddOpt","one","messageCloseButtonClass","message","closeButton","closableMessage","backgroundDimmerClass","dimmingClass","dimmedClass","dimCount","dimBackground","noinput","backgroundLayer","undimBackground","$body","modalEventNamespace","modalClass","modalCloseButtonClass","modalLevel","modalDefaults","cancellable","closeTooltip","modal","level","blur","filter","append","html","className","buttonsElement","buttonPressed","buttonElement","icon","resultHandler","offCanvasEventNamespace","offCanvasClass","offCanvasDefaults","edge","offCanvas","_opposite","_htmlStyle","transition","overflowX","progressbarClass","progressbarDefaults","valuePrefix","valueSuffix","_setValue","setValue","bar","relWidth","progressbar","prefix","suffix","resizableClass","resizableDefaults","aspectRatio","handles","handleWidth","minWidth","minHeight","maxWidth","handleElements","isFinite","wasPositionStatic","optHandles","handleAddClass","addHandle","w","vertical","negative","vertical2","negative2","stopPropagation","resize","side","extent","extentLower","delta","newElemOffset","newLength","minLength","maxLength","newPosition","resizable","selectableClass","selectableDefaults","multiple","allowEmpty","separator","_prepareChild","prepareChild","_selectAll","selectAll","_selectNone","selectNone","replaceHtmlSelect","useDropdown","htmlSelect","htmlSelectChanging","blurCloseTimeout","origStyle","newSelect","insertAfter","updateFromHtmlSelect","updateButton","changeSelectedIndex","shiftKey","ctrlKey","onDisabledchange","lastClickedItem","lastSelectedItem","child","changed","lastIndex","currentIndex","i1","i2","updateHtmlSelect","selectedValues","_","option","selected","newOption","summaryText","summaryHtml","addChild","removeChild","selectable","getSelection","rangeClass","ticksClass","handleClass","resetAllCursorsClass$1","sliderDefaults","orientation","values","rangeBase","largeStep","smallStep","largeTicks","smallTicks","largeTickLabels","smallTickLabels","tickPlacement","handleCount","handleInteractionMode","rangeOverflowEqual","ranges","logarithmic","slider","draggedHandleCursor","sliderBorder","initialTabindex","dragHandleOffset","dragHandlePointerId","lastTouchedHandleIndex","rangeItem","ticks","$handles","_index","rangeBaseValue","startAttr","endAttr","handleLength","rangeBasePos","innerHeight","innerWidth","_index2","resetDragHandleOffset","large","tickArr","inArray","warn","isFirstDrag","pointerValue","getValueFromEvent","minValueDistance","valueIndex","valueDistance","otherIndex","_otherIndex","isLastDrag","myDragHandleOffset","pointerPosIntoSlider","sliderLength","sliderRect","getPosFromValue","rangeIndex","startHandleIndex","endHandleIndex","end","startPos","endPos","overflowEqual","setRange","pos0","pos1","moveHandle","multivalue","sortableClass","sortablePlaceholderClass","sortableDefaults","contents","nodeType","flowStart","flowEnd","crossStart","crossEnd","placeholder","initialChildAfterElement","placeholderAfterElement","betweenChildren","initialChildIndex","updateChildren","rowMin","rowMax","currentPos","rowElements","addRow","rowCenter","p1","createPoint","p2","center","colCount","td","reduce","childStartCenter","childEndCenter","newPlaceholderAfterElementStart","newPlaceholderAfterElementEnd","newPlaceholderAfterElement","minStartDistance","minEndDistance","startDistance","distToSegment","endDistance","eventCancelled","_event2","insertBefore","replaceWith","initialIndex","newIndex","flow","cross","dist2","l2","distToSegmentSquared","sortable","tabHeadersClass","tabPagesClass","tabsDefaults","_addTab","addTab","pageDivs","activePage","headers","pages","page","tabs","activeTab","removeTab","indexOrPage","moveTab","headersChildren","pagesChildren","destHeader","destPage","frontfire","findInclSelf","selector","addBack","spinner","colorPicker","styleCheckbox","threeState","autoHeight"],"mappings":"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","sourcesContent":["// Returns the value in the range between min and max.\r\nexport function minmax(value, min, max) {\r\n\treturn Math.max(min, Math.min(value, max));\r\n}\r\n\r\n// Returns the value rounded to the specified number of decimals.\r\nexport function round(value, decimals) {\r\n\tif (decimals === undefined) decimals = 0;\r\n\tvar precision = Math.pow(10, decimals);\r\n\treturn Math.round(value * precision) / precision;\r\n}\r\n\r\n// Forces a browser layout reflow. This can be used to start CSS transitions on new elements.\r\nexport function forceReflow() {\r\n\t// Try two different methods\r\n\tvar body = $(\"body\");\r\n\tbody.css(\"display\");\r\n\tbody.offset();\r\n}\r\n\r\n// Installs a jQuery hook if it isn't installed yet. Existing hooks are chained to the new hook.\r\n//\r\n// hooks: The hooks collection, like $.attrHooks or $.propHooks\r\n// name: The name of the hooked entry\r\n// id: The internal ID with which an already installed hook can be recognised\r\n// get: The get function (optional)\r\n// set: The set function (optional)\r\nfunction installHook(hooks, name, id, get, set) {\r\n\t// Explanation: https://blog.rodneyrehm.de/archives/11-jQuery-Hooks.html\r\n\tvar hookInstalled = name in hooks &&\r\n\t\t\"ffId\" in hooks[name] &&\r\n\t\thooks[name].ffId === id;\r\n\tif (!hookInstalled) {\r\n\t\tvar prevHook = hooks[name];\r\n\t\thooks[name] = {\r\n\t\t\tffId: id,\r\n\t\t\tget: function (a, b, c) {\r\n\t\t\t\tif (get) {\r\n\t\t\t\t\tvar result = get(a, b, c);\r\n\t\t\t\t\tif (result !== null)\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t\tif (prevHook && prevHook.get)\r\n\t\t\t\t\treturn prevHook.get(a, b, c);\r\n\t\t\t\treturn null;\r\n\t\t\t},\r\n\t\t\tset: function (a, b, c) {\r\n\t\t\t\tif (set) {\r\n\t\t\t\t\tvar result = set(a, b, c);\r\n\t\t\t\t\tif (result !== undefined)\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t\tif (prevHook && prevHook.set)\r\n\t\t\t\t\treturn prevHook.set(a, b, c);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n}\r\n\r\n// Installs a hook that triggers the \"disabledchange\" event for input elements.\r\nexport function installDisabledchangeHook() {\r\n\tinstallHook(\r\n\t\t$.propHooks, \"disabled\", \"disabledchange\",\r\n\t\tundefined,\r\n\t\tfunction (elem, value, name) {\r\n\t\t\tif (elem.disabled !== value) {\r\n\t\t\t\telem.disabled = value;   // Set before triggering change event\r\n\t\t\t\t$(elem).trigger(\"disabledchange\");\r\n\t\t\t}\r\n\t\t});\r\n}\r\n\r\n// Binds the disabled state of the input element to the associated buttons.\r\nexport function bindInputButtonsDisabled(input, buttons) {\r\n\t// When the input element was disabled or enabled, also update other elements\r\n\tinstallDisabledchangeHook();\r\n\tvar handler = function () {\r\n\t\tif (input.disabled()) {\r\n\t\t\tinput.disable();   // Disable everything related as well (label etc.)\r\n\t\t\tbuttons.forEach(button => button.disable());\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinput.enable();   // Enable everything related as well (label etc.)\r\n\t\t\tbuttons.forEach(button => button.enable());\r\n\t\t}\r\n\t};\r\n\tinput.on(\"disabledchange\", handler);\r\n\r\n\t// Setup disabled state initially.\r\n\t// Also enable elements. If they were disabled and the page is reloaded, their state\r\n\t// may be restored halfway. This setup brings everything in the same state.\r\n\thandler();\r\n}\r\n\r\n// Scrolls the window so that the rectangle is fully visible.\r\nexport function scrollIntoView(rect) {\r\n\tvar cont = $(window);\r\n\tvar viewportWidth = cont.width() - 1;\r\n\tvar viewportHeight = cont.height() - 1;\r\n\tvar scrollTop = cont.scrollTop();\r\n\tvar scrollLeft = cont.scrollLeft();\r\n\r\n\tif (rect.top < scrollTop) {\r\n\t\tcont.scrollTop(rect.top);\r\n\t}\r\n\tif (rect.bottom > scrollTop + viewportHeight) {\r\n\t\tcont.scrollTop(scrollTop + (rect.bottom - (scrollTop + viewportHeight)));\r\n\t}\r\n\tif (rect.left < scrollLeft) {\r\n\t\tcont.scrollLeft(rect.left);\r\n\t}\r\n\tif (rect.right > scrollLeft + viewportWidth) {\r\n\t\tcont.scrollLeft(scrollLeft + (rect.right - (scrollLeft + viewportWidth)));\r\n\t}\r\n}\r\n\r\n// Prevents scrolling the document.\r\n//\r\n// state: Enable or disable the scrolling prevention.\r\nexport function preventScrolling(state) {\r\n\tvar $document = $(document), $html = $(\"html\");\r\n\tif (state || state === undefined) {\r\n\t\tvar scrollTop = $document.scrollTop();\r\n\t\tvar scrollLeft = $document.scrollLeft();\r\n\t\t$document.on(\"scroll.ff-prevent-scrolling\", function () {\r\n\t\t\t$document.scrollTop(scrollTop);\r\n\t\t\t$document.scrollLeft(scrollLeft);\r\n\t\t});\r\n\t\t$html.css(\"touch-action\", \"none\");\r\n\t}\r\n\telse {\r\n\t\t$document.off(\"scroll.ff-prevent-scrolling\");\r\n\t\t$html.css(\"touch-action\", \"\");\r\n\t}\r\n}\r\n\r\n// Stacks the selected elements and moved one element to the top.\r\nexport function stackElements(stackedElems, topElem) {\r\n\t// Find all selected stackable elements and sort them by:\r\n\t//   currently dragging, then z-index, then DOM index\r\n\t// and assign their new z-index\r\n\tstackedElems = stackedElems\r\n\t\t.map(function (index, el) {\r\n\t\t\tvar zIndex = parseInt($(el).css(\"z-index\"));\r\n\t\t\tif (!$.isNumeric(zIndex))\r\n\t\t\t\tzIndex = stackedElems.length;\r\n\t\t\treturn { elem: el, dragElem: el === topElem ? 1 : 0, index: index, zIndex: zIndex };\r\n\t\t})\r\n\t\t.sort(function (a, b) {\r\n\t\t\tif (a.dragElem !== b.dragElem) return a.dragElem - b.dragElem;\r\n\t\t\tif (a.zIndex !== b.zIndex) return a.zIndex - b.zIndex;\r\n\t\t\treturn a.index - b.index;\r\n\t\t});\r\n\tif (stackedElems.length !== 0) {\r\n\t\tvar maxZIndex = Math.max.apply(Math, stackedElems.toArray().map(o => o.zIndex));\r\n\t\tstackedElems.each(function (index) {\r\n\t\t\t$(this.elem).css(\"z-index\", maxZIndex - (stackedElems.length - 1) + index);\r\n\t\t});\r\n\t}\r\n}\r\n","﻿// Bring older browsers to a usable level\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/includes#Polyfill\r\nif (!String.prototype.includes) {\r\n\tString.prototype.includes = function (search, start) {\r\n\t\tif (typeof start !== \"number\") start = 0;\r\n\t\tif (start + search.length > this.length) return false;\r\n\t\treturn this.indexOf(search, start) !== -1;\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith#Polyfill\r\nif (!String.prototype.startsWith) {\r\n\tString.prototype.startsWith = function (search, pos) {\r\n\t\treturn this.substr(!pos || pos < 0 ? 0 : +pos, search.length) === search;\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/endsWith#Polyfill\r\nif (!String.prototype.endsWith) {\r\n\tString.prototype.endsWith = function (search, this_len) {\r\n\t\tif (this_len === undefined || this_len > this.length) this_len = this.length;\r\n\t\treturn this.substring(this_len - search.length, this_len) === search;\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/padEnd#Polyfill\r\nif (!String.prototype.padEnd) {\r\n\tString.prototype.padEnd = function padEnd(targetLength, padString) {\r\n\t\ttargetLength = targetLength >> 0; //floor if number or convert non-number to 0;\r\n\t\tpadString = String(padString || ' ');\r\n\t\tif (this.length > targetLength) return String(this);\r\n\t\ttargetLength = targetLength - this.length;\r\n\t\tif (targetLength > padString.length)\r\n\t\t\tpadString += padString.repeat(targetLength / padString.length); //append to original to ensure we are longer than needed\r\n\t\treturn String(this) + padString.slice(0, targetLength);\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/padStart#Polyfill\r\nif (!String.prototype.padStart) {\r\n\tString.prototype.padStart = function padStart(targetLength, padString) {\r\n\t\ttargetLength = targetLength >> 0; //floor if number or convert non-number to 0;\r\n\t\tpadString = String(padString || ' ');\r\n\t\tif (this.length > targetLength) return String(this);\r\n\t\ttargetLength = targetLength - this.length;\r\n\t\tif (targetLength > padString.length)\r\n\t\t\tpadString += padString.repeat(targetLength / padString.length); //append to original to ensure we are longer than needed\r\n\t\treturn padString.slice(0, targetLength) + String(this);\r\n\t};\r\n}\r\n\r\n// Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/repeat#Polyfill\r\nif (!String.prototype.repeat) {\r\n\tString.prototype.repeat = function(count) {\r\n\t\t'use strict';\r\n\t\tif (this == null) {\r\n\t\t\tthrow new TypeError('can\\'t convert ' + this + ' to object');\r\n\t\t}\r\n\t\tvar str = '' + this;\r\n\t\tcount = +count;\r\n\t\tif (count != count) {\r\n\t\t\tcount = 0;\r\n\t\t}\r\n\t\tif (count < 0) {\r\n\t\t\tthrow new RangeError('repeat count must be non-negative');\r\n\t\t}\r\n\t\tif (count == Infinity) {\r\n\t\t\tthrow new RangeError('repeat count must be less than infinity');\r\n\t\t}\r\n\t\tcount = Math.floor(count);\r\n\t\tif (str.length == 0 || count == 0) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\t\t// Ensuring count is a 31-bit integer allows us to heavily optimize the\r\n\t\t// main part. But anyway, most current (August 2014) browsers can't handle\r\n\t\t// strings 1 << 28 chars or longer, so:\r\n\t\tif (str.length * count >= 1 << 28) {\r\n\t\t\tthrow new RangeError('repeat count must not overflow maximum string size');\r\n\t\t}\r\n\t\tvar rpt = '';\r\n\t\tfor (var i = 0; i < count; i++) {\r\n\t\t\trpt += str;\r\n\t\t}\r\n\t\treturn rpt;\r\n\t}\r\n}\r\n\r\n// Source: https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/Math/trunc#Polyfill\r\nMath.trunc = Math.trunc || (x => x - x % 1);\r\n\r\n// Source: https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/Math/log10#Polyfill\r\nMath.log10 = Math.log10 || (x => Math.log(x) * Math.LOG10E);\r\n","import { bindInputButtonsDisabled, forceReflow } from \"./util\";\r\n\r\n$.bindInputButtonsDisabled = bindInputButtonsDisabled;\r\n$.forceReflow = forceReflow;\r\n\r\n// Define some more helper functions as jQuery plugins. Similar functions already exist in\r\n// jQuery and these complement the set.\r\n\r\n// A variant of $.each that uses $(this) as the called function's context instead of this and also\r\n// the second parameter.\r\n$.fn.each$ = function (fn) {\r\n\treturn this.each(function (index, element) {\r\n\t\telement = $(element);\r\n\t\treturn fn.call(element, index, element);\r\n\t});\r\n};\r\n\r\n// A variant of $.val that also triggers the change event if the value has actually changed.\r\n$.fn.valChange = function (value) {\r\n\tlet oldValue = this.val();\r\n\tlet isEqual = oldValue === value;\r\n\tif (!isEqual && Array.isArray(oldValue) && Array.isArray(value)) {\r\n\t\tisEqual = oldValue.length === value.length && oldValue.every((v, index) => v === value[index]);\r\n\t}\r\n\tif (!isEqual) {\r\n\t\tthis.val(value).change();\r\n\t}\r\n};\r\n\r\n// Variable tests\r\n\r\n// Determines whether the value is set (i. e. not undefined or null).\r\n$.isSet = value => typeof value !== \"undefined\" && value !== null;\r\n\r\n// Determines whether the value is boolean.\r\n$.isBoolean = value => typeof value === \"boolean\";\r\n\r\n// Determines whether the value is a number.\r\n$.isNumber = value => typeof value === \"number\";\r\n\r\n// Determines whether the value is a string.\r\n$.isString = value => typeof value === \"string\";\r\n\r\n// Determines whether the value is an even number.\r\n$.isEven = value => $.isNumber(value) && value % 2 === 0;\r\n\r\n// Determines whether the value is an odd number.\r\n$.isOdd = value => $.isNumber(value) && value % 2 === 1;\r\n\r\n// Operating system tests\r\n\r\n// Determines whether the client operating system is Android.\r\n$.isAndroid = () => !!navigator.userAgent.match(/Android/);\r\n\r\n// Determines whether the client operating system is iOS.\r\n$.isIos = () => !!navigator.platform.match(/iPhone|iPad|iPod/);\r\n\r\n// Determines whether the client operating system is Linux (not Android).\r\n$.isLinux = () => !!navigator.platform.match(/Linux/) && !$.isAndroid();\r\n\r\n// Determines whether the client operating system is macOS.\r\n$.isMac = () => !!navigator.platform.match(/Mac/);\r\n\r\n// Determines whether the client operating system is Windows.\r\n$.isWindows = () => !!navigator.platform.match(/Win/);\r\n\r\nif ($.isAndroid()) {\r\n\t$(\"html\").addClass(\"simple-dimmer\");\r\n}\r\n\r\n// Browser tests\r\n// Source: https://stackoverflow.com/a/9851769\r\n\r\n// Determines whether the browser has a Blink engine.\r\n$.isBlink = () => ($.isChrome() || $.isOpera()) && !!window.CSS;\r\n\r\n// Determines whether the browser is Chrome.\r\n$.isChrome = () => !!window.chrome && !!window.chrome.webstore;\r\n\r\n// Determines whether the browser is Edge.\r\n$.isEdge = () => !$.isInternetExplorer() && !!window.StyleMedia;\r\n\r\n// Determines whether the browser is Firefox.\r\n$.isFirefox = () => typeof InstallTrigger !== 'undefined';\r\n\r\n// Determines whether the browser is Internet Explorer.\r\n$.isInternetExplorer = () => /*@cc_on!@*/false || !!document.documentMode;\r\n\r\n// Determines whether the browser is Opera.\r\n$.isOpera = () => (!!window.opr && !!opr.addons) || !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;\r\n\r\n// Determines whether the browser is Safari.\r\n$.isSafari = () => /constructor/i.test(window.HTMLElement) || (function (p) { return p.toString() === \"[object SafariRemoteNotification]\"; })(!window['safari'] || (typeof safari !== 'undefined' && safari.pushNotification));\r\n","// Registers a jQuery plugin.\r\n//\r\n// name: The name of the plugin.\r\n// create: The plugin create function.\r\n// obj: An object containing additional operation functions.\r\nexport function registerPlugin(name, create, obj) {\r\n\t// Define a new property for each jQuery object in which the plugin is accessible.\r\n\t// This property getter is called whenever the plugin or one of its additional functions is called.\r\n\tObject.defineProperty($.fn, name, {\r\n\t\tget: function () {\r\n\t\t\t// Plugin default function\r\n\t\t\t// Returned to make this property callable\r\n\t\t\tvar ret = create;\r\n\r\n\t\t\t// Plugin additional functions, added to the returned function\r\n\t\t\t// Bound to whoever has called this property to pass on \"this\" to the next function\r\n\t\t\tfor (let key in obj) {\r\n\t\t\t\tif ($.isFunction(obj[key])) {\r\n\t\t\t\t\tret[key] = obj[key].bind(this);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Determines the options to use for a plugin.\r\n//\r\n// name: The plugin name.\r\n// defaults: The plugin's default options. Only properties defined in here are considered for data attributes.\r\n// elem: The element to find data attributes in. Options are stored here, too.\r\n// converters: An object that specifies a conversion function for each special data attribute.\r\n// params: The options specified to the plugin function.\r\nexport function initOptions(name, defaults, elem, converters, params) {\r\n\tparams = params || {};\r\n\r\n\t// Start with the defaults\r\n\tvar opts = $.extend({}, defaults);\r\n\r\n\t// Look for a combined HTML data-opt attribute containing a JSON object\r\n\tvar optValue = $(elem).data(\"opt\");\r\n\tif (optValue !== undefined) {\r\n\t\ttry {\r\n\t\t\toptValue = (new Function(\"return \" + optValue + \";\"))();\r\n\t\t\topts = $.extend(opts, optValue);\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tconsole.error(\"ERROR: data-opt value for \" + name + \" cannot be parsed:\", optValue, err);\r\n\t\t}\r\n\t}\r\n\r\n\t// Then overwrite with individual HTML data attributes\r\n\tfor (let key in defaults) {\r\n\t\t// Only do the work if it's not overridden again by params\r\n\t\tif (params[key] === undefined) {\r\n\t\t\tlet elemDataValue = $(elem).data(\"opt-\" + key);\r\n\t\t\tif (elemDataValue !== undefined) {\r\n\t\t\t\tif ($.isFunction(converters[key])) {\r\n\t\t\t\t\topts[key] = converters[key](elemDataValue);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\topts[key] = elemDataValue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Finally overwrite with params\r\n\t$.extend(opts, params);\r\n\r\n\t// Keep options in DOM element's data\r\n\t$(elem).data(\"ff-\" + name + \"-options\", opts);\r\n\r\n\treturn opts;\r\n}\r\n\r\n// Loads plugin options for additional plugin functions.\r\n//\r\n// name: The plugin name.\r\n// elem: The element to find data attributes in. Options are stored here, too.\r\nexport function loadOptions(name, elem) {\r\n\treturn $(elem).data(\"ff-\" + name + \"-options\") || {};\r\n}\r\n","/*! jQuery UI - v1.12.1 - 2017-12-25\r\n* http://jqueryui.com\r\n* Includes: focusable.js\r\n* Copyright jQuery Foundation and other contributors; Licensed MIT */\r\n\r\n// NOTE: This file was modified to not include unnecessary jQuery UI stuff.\r\n// IE8 support removed, which was introduced in\r\n// * https://bugs.jqueryui.com/ticket/14596\r\n// * https://github.com/jquery/jquery-ui/commit/d3025968f349c37a8ca41bfc63ee1b37d9d7354f\r\n\r\n/*\r\n * jQuery UI Focusable 1.12.1\r\n * http://jqueryui.com\r\n *\r\n * Copyright jQuery Foundation and other contributors\r\n * Released under the MIT license.\r\n * http://jquery.org/license\r\n */\r\n\r\n//>>label: :focusable Selector\r\n//>>group: Core\r\n//>>description: Selects elements which can be focused.\r\n//>>docs: http://api.jqueryui.com/focusable-selector/\r\n\r\n\r\n\r\n// Selectors\r\nvar focusable = function( element, hasTabindex ) {\r\n\tvar map, mapName, img, focusableIfVisible, fieldset,\r\n\t\tnodeName = element.nodeName.toLowerCase();\r\n\r\n\tif ( \"area\" === nodeName ) {\r\n\t\tmap = element.parentNode;\r\n\t\tmapName = map.name;\r\n\t\tif ( !element.href || !mapName || map.nodeName.toLowerCase() !== \"map\" ) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\timg = $( \"img[usemap='#\" + mapName + \"']\" );\r\n\t\treturn img.length > 0 && img.is( \":visible\" );\r\n\t}\r\n\r\n\tif ( /^(input|select|textarea|button|object)$/.test( nodeName ) ) {\r\n\t\tfocusableIfVisible = !element.disabled;\r\n\r\n\t\tif ( focusableIfVisible ) {\r\n\r\n\t\t\t// Form controls within a disabled fieldset are disabled.\r\n\t\t\t// However, controls within the fieldset's legend do not get disabled.\r\n\t\t\t// Since controls generally aren't placed inside legends, we skip\r\n\t\t\t// this portion of the check.\r\n\t\t\tfieldset = $( element ).closest( \"fieldset\" )[ 0 ];\r\n\t\t\tif ( fieldset ) {\r\n\t\t\t\tfocusableIfVisible = !fieldset.disabled;\r\n\t\t\t}\r\n\t\t}\r\n\t} else if ( \"a\" === nodeName ) {\r\n\t\tfocusableIfVisible = element.href || hasTabindex;\r\n\t} else {\r\n\t\tfocusableIfVisible = hasTabindex;\r\n\t}\r\n\r\n\treturn focusableIfVisible && $( element ).is( \":visible\" ) && $( element ).css( \"visibility\" ) === \"visible\";\r\n};\r\n\r\n$.extend( $.expr[ \":\" ], {\r\n\tfocusable: function( element ) {\r\n\t\treturn focusable( element, $.attr( element, \"tabindex\" ) !== undefined );\r\n\t}\r\n} );\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow } from \"../util\";\r\n\r\nvar accordionClass = \"ff-accordion\";\r\n\r\n// Defines default options for the accordion plugin.\r\nvar accordionDefaults = {\r\n\t// Exclusive mode allows only one item to be expanded at a time. Default: false.\r\n\texclusive: false,\r\n\t// Offset to consider when scrolling to an item, when there are fixed elements at the top. Default: 0.\r\n\tscrollOffset: 0,\r\n\t// Element whose height to consider when scrolling to an item. Both offsets are added. Default: null.\r\n\tscrollOffsetElement: null\r\n};\r\n\r\n// Converts all div elements in each selected element into accordion pages.\r\nfunction accordion(options) {\r\n\treturn this.each(function () {\r\n\t\tvar accordion = $(this);\r\n\t\tif (accordion.hasClass(accordionClass)) return;   // Already done\r\n\t\tvar opt = initOptions(\"accordion\", accordionDefaults, accordion, {}, options);\r\n\r\n\t\taccordion.addClass(accordionClass);\r\n\t\tvar items = $(this).children(\"div\");\r\n\t\titems.each$(function () {\r\n\t\t\tvar item = this;\r\n\t\t\tvar header = item.children(\"div\").first();\r\n\t\t\tvar content = item.children(\"div\").last();\r\n\r\n\t\t\theader.css(\"transition\", \"none\");\r\n\t\t\theader.addClass(\"ff-accordion-header\");\r\n\t\t\tforceReflow();\r\n\t\t\theader.css(\"transition\", \"\");\r\n\t\t\theader.attr(\"tabindex\", \"0\");\r\n\r\n\t\t\tcontent.addClass(\"ff-accordion-content\");\r\n\t\t\t\r\n\t\t\theader.click(function () {\r\n\t\t\t\tif (content[0].clientHeight) {\r\n\t\t\t\t\taccordion.accordion.collapse(item);\r\n\t\t\t\t} else {\r\n\t\t\t\t\taccordion.accordion.expand(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\theader.keydown(function (event) {\r\n\t\t\t\tif (event.which === 13) {   // Enter\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.click();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tvar id = item.attr(\"id\");\r\n\t\t\tif (id !== undefined && location.hash === \"#\" + id) {\r\n\t\t\t\t// Manually set item expanded\r\n\t\t\t\titem.addClass(\"expanded\");\r\n\t\t\t\tcontent.css(\"height\", \"auto\");\r\n\t\t\t\t$(function() {\r\n\t\t\t\t\tlet offset = opt.scrollOffset || 0;\r\n\t\t\t\t\tif (opt.scrollOffsetElement) {\r\n\t\t\t\t\t\toffset += $(opt.scrollOffsetElement).height();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$(\"html,body\").animate({ scrollTop: item.offset().top - offset });\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcontent.css(\"transition\", \"none\");\r\n\t\t\t\taccordion.accordion.collapse(item);\r\n\t\t\t\tforceReflow();\r\n\t\t\t\tcontent.css(\"transition\", \"\");\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction collapse(indexOrItem) {\r\n\treturn this.each(function () {\r\n\t\tvar accordion = $(this);\r\n\t\tvar opt = loadOptions(\"accordion\", accordion);\r\n\r\n\t\tvar items = accordion.children(\"div\");\r\n\t\tif (indexOrItem === undefined) {\r\n\t\t\t// Collapse all items\r\n\t\t\titems.each(function () {\r\n\t\t\t\taccordion.accordion.collapse(this);\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar item;\r\n\t\tif ($.isNumeric(indexOrItem)) {\r\n\t\t\titem = items.eq(+indexOrItem);\r\n\t\t}\r\n\t\telse {\r\n\t\t\titem = $(indexOrItem);\r\n\t\t}\r\n\r\n\t\tvar content = item.children(\"div.ff-accordion-content\").first();\r\n\t\tif (!content.hasClass(\"ff-fixed-height\")) {\r\n\t\t\tcontent.css(\"height\", content[0].scrollHeight);   // explicitly set to current value\r\n\t\t\tforceReflow();\r\n\t\t\tcontent.css(\"height\", 0);   // now animate to 0\r\n\t\t\tcontent.addClass(\"ff-fixed-height\");\r\n\t\t\titem.removeClass(\"expanded\");\r\n\r\n\t\t\tlet event = $.Event(\"itemCollapse\");\r\n\t\t\tevent.item = item;\r\n\t\t\taccordion.trigger(event);\r\n\t\t}\r\n\r\n\t\tvar id = item.attr(\"id\");\r\n\t\tif (id !== undefined && location.hash === \"#\" + id) {\r\n\t\t\thistory.replaceState(null, document.title, location.pathname + location.search);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction expand(indexOrItem) {\r\n\treturn this.each(function () {\r\n\t\tvar accordion = $(this);\r\n\t\tvar opt = loadOptions(\"accordion\", accordion);\r\n\r\n\t\tvar items = accordion.children(\"div\");\r\n\t\tif (indexOrItem === undefined && !opt.exclusive) {\r\n\t\t\t// Expand all items\r\n\t\t\titems.each(function () {\r\n\t\t\t\taccordion.accordion.expand(this);\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar item;\r\n\t\tif ($.isNumeric(indexOrItem)) {\r\n\t\t\titem = items.eq(+indexOrItem);\r\n\t\t}\r\n\t\telse {\r\n\t\t\titem = $(indexOrItem);\r\n\t\t}\r\n\r\n\t\tvar content = item.children(\"div.ff-accordion-content\").first();\r\n\t\tif (content[0].clientHeight) {\r\n\t\t\treturn;   // Already expanded\r\n\t\t}\r\n\t\tcontent.css(\"height\", content[0].scrollHeight);   // animate to desired height\r\n\t\tfunction onTransitionEnd(event) {\r\n\t\t\tif (event.originalEvent.propertyName == \"height\") {\r\n\t\t\t\tcontent.css(\"height\", \"auto\");   // allow free layout again after animation has completed\r\n\t\t\t\tcontent.off(\"transitionend\", onTransitionEnd);\r\n\t\t\t\tcontent.removeClass(\"ff-fixed-height\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tcontent.on(\"transitionend\", onTransitionEnd);\r\n\t\titem.addClass(\"expanded\");\r\n\r\n\t\tlet event = $.Event(\"itemExpand\");\r\n\t\tevent.item = item;\r\n\t\taccordion.trigger(event);\r\n\r\n\t\tvar previousItemCollapsedHeight = 0;\r\n\t\tif (opt.exclusive) {\r\n\t\t\tlet passedExpandedItem = false;\r\n\t\t\titems.each(function () {\r\n\t\t\t\tif (this !== item[0]) {\r\n\t\t\t\t\tif (!passedExpandedItem)\r\n\t\t\t\t\t\tpreviousItemCollapsedHeight += $(this).children(\"div.ff-accordion-content\").height();\r\n\t\t\t\t\taccordion.accordion.collapse(this);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tpassedExpandedItem = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// If a previous item was collapsed, scroll so that the expanded header stays where it is on the screen\r\n\t\t//if (previousItemCollapsedHeight) {\r\n\t\t//\t$(\"html,body\").animate({ scrollTop: \"-=\" + previousItemCollapsedHeight }, 200);\r\n\t\t//}\r\n\t\t\r\n\t\t// TODO: At least keep the expanded header visible if a previous item was collapsed\r\n\r\n\t\t// TODO: Maybe also scroll to make the new content section visible as much as possible, while not pushing out its header (option)\r\n\r\n\t\tvar id = item.attr(\"id\");\r\n\t\tif (id !== undefined) {\r\n\t\t\thistory.replaceState(null, document.title, \"#\" + id);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"accordion\", accordion, {\r\n\tcollapse: collapse,\r\n\texpand: expand\r\n});\r\n$.fn.accordion.defaults = accordionDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar carouselClass = \"ff-carousel\";\r\nvar carouselIndicatorClass = \"ff-carousel-indicator\";\r\n\r\n// Defines default options for the carousel plugin.\r\nvar carouselDefaults = {\r\n\t// The index of the initially active item. Default: 0.\r\n\tactive: 0,\r\n\r\n\t// The number of items concurrently visible. Default: 1.\r\n\titems: 1,\r\n\r\n\t// Show an indicator dot each x items. Default: -1 means the same value as items.\r\n\tdotsEach: -1,\r\n\r\n\t// The margin between two items in pixels. Default: 0.\r\n\tgutter: 0,\r\n\r\n\t// Shows the indicator dots for the active item. Default: true.\r\n\tindicator: true,\r\n\r\n\t// Starts looping through all items automatically. Default: false.\r\n\tautoPlay: false,\r\n\r\n\t// Autoplay item switch interval in milliseconds. Default: 4000.\r\n\tautoPlayInterval: 4000,\r\n\r\n\t// Pauses autoplay while the carousel is hovered with the mouse. Default: true.\r\n\tpauseOnHover: true,\r\n\r\n\t// The mouse cursor to show during dragging. Default: None.\r\n\tdragCursor: undefined,\r\n\r\n\t// The animation between items. Default: slide-all.\r\n\t// Possible values: slide-all, slide-in, slide-out, fade, slide-fade\r\n\t// For more than one visible item, only slide-all is supported and automatically used.\r\n\tanimation: \"slide-all\",\r\n\r\n\t// Loops all items at the end instead of rewinding/restricting. Default: false.\r\n\t// TODO\r\n\tloop: false\r\n};\r\n\r\n// Converts each selected element into a carousel.\r\nfunction carousel(options) {\r\n\treturn this.each(function () {\r\n\t\tvar carousel = $(this);\r\n\t\tif (carousel.find(\".\" + carouselClass).length) return;   // Already done\r\n\t\tvar opt = initOptions(\"carousel\", carouselDefaults, carousel, {}, options);\r\n\r\n\t\tif (opt.items > 1 || opt.gutter > 0) opt.animation = \"slide-all\";\r\n\r\n\t\tvar stage = $(\"<div/>\").addClass(carouselClass);\r\n\r\n\t\topt._gutterWidth = (opt.items - 1) / opt.items * opt.gutter;\r\n\t\topt._gutterOffset = 1 / opt.items * opt.gutter;\r\n\t\topt._itemWidthPercent = 100 / opt.items;\r\n\t\topt._layout = layout;\r\n\r\n\t\tvar itemIndex = 0;\r\n\t\tvar maxItemHeight = 0;\r\n\t\tvar items = carousel.children();\r\n\t\tvar autoPlayTimeout;\r\n\t\tvar itemOffset, startItemOffset, prevItemOffset, dragDirection, itemOffsetMin, itemOffsetMax, itemWidth;\r\n\t\tvar currentTransition = \"\";\r\n\r\n\t\tif (opt.dotsEach === -1) opt.dotsEach = opt.items;\r\n\t\topt.dotsEach = minmax(opt.dotsEach, 0, opt.items);\r\n\r\n\t\t// Set up items positioning\r\n\t\titems.each$(function () {\r\n\t\t\tthis.css(\"width\", \"calc(\" + opt._itemWidthPercent + \"% - \" + opt._gutterWidth + \"px)\");\r\n\t\t\tmaxItemHeight = Math.max(maxItemHeight, this.outerHeight());\r\n\t\t\tthis.detach().appendTo(stage);\r\n\t\t\titemIndex++;\r\n\t\t});\r\n\t\tstage.appendTo(carousel);\r\n\t\tstage.css(\"height\", maxItemHeight);\r\n\r\n\t\t// Add controls\r\n\t\tif (opt.indicator) {\r\n\t\t\tvar indicator = $(\"<div/>\").addClass(carouselIndicatorClass).appendTo(carousel);\r\n\t\t\tvar indicatorCount = Math.ceil(items.length / opt.dotsEach) - (opt.items - opt.dotsEach);\r\n\t\t\tfor (let i = 0; i < indicatorCount; i++) {\r\n\t\t\t\tlet dot = $(\"<span tabindex='0'><span/></span>\").appendTo(indicator);\r\n\t\t\t\tlet fn = function () {\r\n\t\t\t\t\tcarousel.carousel.activeItem(i * opt.dotsEach);\r\n\t\t\t\t\tsuspendAutoplay();\r\n\t\t\t\t\tresumeAutoplay();\r\n\t\t\t\t};\r\n\t\t\t\tdot.click(fn);\r\n\t\t\t\tdot.keydown(function (event) {\r\n\t\t\t\t\tif (event.which === 13) {   // Enter\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\tfn();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcarousel.carousel.activeItem(opt.active);\r\n\r\n\t\tstage.draggable({\r\n\t\t\taxis: \"x\",\r\n\t\t\tdragCursor: opt.dragCursor\r\n\t\t});\r\n\t\tstage.on(\"draggablestart\", function (event) {\r\n\t\t\tvar dx = Math.abs(event.dragPoint.left - event.newPoint.left);\r\n\t\t\tvar dy = Math.abs(event.dragPoint.top - event.newPoint.top);\r\n\t\t\tif (dy > dx) {\r\n\t\t\t\t// Movement was mostly vertical, don't drag in that direction but leave scrolling intact\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\titemWidth = stage.width() / opt.items;\r\n\t\t\tprevItemOffset = startItemOffset = layout();\r\n\t\t\tvar lastPageFirstItem = Math.max(0, items.length - opt.items);\r\n\t\t\titemOffsetMin = -opt.active;\r\n\t\t\titemOffsetMax = lastPageFirstItem - opt.active;\r\n\t\t\topt._isDragging = true;\r\n\r\n\t\t\t// Disable transition and autoplay while dragging\r\n\t\t\tremoveTransition();\r\n\t\t\tsuspendAutoplay();\r\n\t\t});\r\n\t\tstage.on(\"draggablemove\", function (event) {\r\n\t\t\titemOffset = startItemOffset - (event.newPoint.left - event.elemRect.left) / itemWidth;\r\n\t\t\tdragDirection = itemOffset - prevItemOffset;\r\n\t\t\tprevItemOffset = itemOffset;\r\n\r\n\t\t\t// Don't move the stage anywhere! Just tell me how far the pointer is dragged and we'll\r\n\t\t\t// move something else (the items within the stage) to provide the expected visual feedback.\r\n\t\t\tevent.newPoint = event.elemRect;\r\n\r\n\t\t\t// Restrict dragging at start/end\r\n\t\t\tif (itemOffset < itemOffsetMin)\r\n\t\t\t\titemOffset = itemOffsetMin - elastic(itemOffsetMin - itemOffset);\r\n\t\t\tif (itemOffset > itemOffsetMax)\r\n\t\t\t\titemOffset = itemOffsetMax + elastic(itemOffset - itemOffsetMax);\r\n\r\n\t\t\tfunction elastic(exceeding) {\r\n\t\t\t\tvar max = 0.25;\r\n\t\t\t\t// This function has a slope of 1 for x = 0 and slowly approaches (but never reaches) max\r\n\t\t\t\treturn -max / (exceeding / max + 1) + max;\r\n\t\t\t}\r\n\r\n\t\t\tlayout(itemOffset);\r\n\t\t});\r\n\t\tstage.on(\"draggableend\", function (event) {\r\n\t\t\t// Restore transition and autoplay\r\n\t\t\taddTransition();\r\n\t\t\tresumeAutoplay();\r\n\t\t\topt._isDragging = false;\r\n\r\n\t\t\t// Snap to item, consider last drag direction\r\n\t\t\tvar itemIndex = opt.active + itemOffset;\r\n\t\t\tvar newDot = itemIndex / opt.dotsEach;\r\n\t\t\tif (dragDirection > 0)\r\n\t\t\t\tnewDot = Math.ceil(newDot);\r\n\t\t\telse\r\n\t\t\t\tnewDot = Math.floor(newDot);\r\n\t\t\tcarousel.carousel.activeItem(newDot * opt.dotsEach);\r\n\t\t});\r\n\r\n\t\t// Add transition after setting position of every item\r\n\t\tforceReflow();\r\n\t\taddTransition();\r\n\r\n\t\tvar autoplaySuspendLevel = 0;\r\n\t\tif (opt.autoPlay) {\r\n\t\t\tif (opt.pauseOnHover) {\r\n\t\t\t\tstage.mouseenter(suspendAutoplay);\r\n\t\t\t\tstage.mouseleave(resumeAutoplay);\r\n\t\t\t}\r\n\r\n\t\t\tautoPlayTimeout = setTimeout(next, opt.autoPlayInterval);\r\n\t\t}\r\n\r\n\t\tfunction suspendAutoplay() {\r\n\t\t\tautoPlayTimeout && clearTimeout(autoPlayTimeout);\r\n\t\t\tautoplaySuspendLevel++;\r\n\t\t}\r\n\r\n\t\tfunction resumeAutoplay(clearPending) {\r\n\t\t\tautoplaySuspendLevel--;\r\n\t\t\tif (opt.autoPlay && !autoplaySuspendLevel) {\r\n\t\t\t\tautoPlayTimeout = setTimeout(next, opt.autoPlayInterval * 2);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction next() {\r\n\t\t\tvar index = opt.active;\r\n\t\t\tindex += opt.dotsEach;\r\n\t\t\tif (index > items.length - opt.items) index = 0;\r\n\t\t\tcarousel.carousel.activeItem(index);\r\n\t\t\tautoPlayTimeout = setTimeout(next, opt.autoPlayInterval);\r\n\t\t}\r\n\r\n\t\tfunction removeTransition() {\r\n\t\t\tcurrentTransition = \"\";\r\n\t\t\titems.css(\"transition\", currentTransition);\r\n\t\t}\r\n\r\n\t\tfunction addTransition() {\r\n\t\t\tlet opacityTime = \"0.4s\";\r\n\t\t\tif (opt.animation === \"fade\")\r\n\t\t\t\topacityTime = \"0.8s\";\r\n\t\t\tcurrentTransition = \"left 0.4s ease-in-out, opacity \" + opacityTime + \" ease-in-out\";\r\n\t\t\titems.css(\"transition\", currentTransition);\r\n\t\t}\r\n\r\n\t\t// Modulo operation corrected for negative numbers.\r\n\t\tfunction mod(value, mod) {\r\n\t\t\twhile (value < 0) value += mod;\r\n\t\t\treturn value % mod;\r\n\t\t}\r\n\r\n\t\t// Item layouts for each animation type:\r\n\t\t// slide-all\r\n\t\t//   All items are positioned next to each other and moved simultaneously\r\n\t\t//   No z-index or opacity is used\r\n\t\t// slide-out\r\n\t\t//   There are two stacks next to each other\r\n\t\t//   The right stack is at left: 0 (visible in the stage), the left stack is directly next to it\r\n\t\t//   The active item and all following items are on the right (visible) stack, with z-index from front to back\r\n\t\t//   The previous items are on the left (invisible) stack\r\n\t\t//   Only one item can be moved to the other stack at a time\r\n\t\t// slide-in\r\n\t\t//   There are two stacks next to each other\r\n\t\t//   The left stack is at left: 0 (visible in the stage), the right stack is directly next to it\r\n\t\t//   The active item and all previous items are on the left (visible) stack, with z-index from back to front\r\n\t\t//   The following items are on the right (invisible) stack\r\n\t\t//   Only one item can be moved to the other stack at a time\r\n\t\t// fade\r\n\t\t//   All items are stacked above one another, at the same position (left: 0, in the stage)\r\n\t\t//   The visible item or the item that is becoming visible is on z-index 1, opacity is 1.\r\n\t\t//   The previously visible item or the item that is becoming invisible is on z-index 2, opacity is (becoming) 0, pointer-events is none.\r\n\t\t//   All other items are on z-index 0 with opacity 0.\r\n\t\t// slide-fade\r\n\t\t//   Based on slide-all but moving items by 1/10th of the stage width.\r\n\t\t//   The active/visible item has opacity 1, gradually changing to 0 for the adjacent and all other items.\r\n\r\n\t\t// Translates between an item offset and the current layout.\r\n\t\t// The getter is used to initialise the item offset when starting to drag during an ongoing transition.\r\n\t\t// The setter is used everywhere the items need to be laid out for a new active item or item offset.\r\n\t\tfunction layout(itemOffset) {\r\n\t\t\t// Getter\r\n\t\t\tif (itemOffset === undefined) {\r\n\t\t\t\tlet pos = [];\r\n\t\t\t\tlet allSame = true;\r\n\t\t\t\tswitch (opt.animation) {\r\n\t\t\t\t\tcase \"fade\":\r\n\t\t\t\t\t\tlet z1, z2, z2Opacity;\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tif (this.css(\"z-index\") == 1)\r\n\t\t\t\t\t\t\t\tz1 = index;\r\n\t\t\t\t\t\t\tif (this.css(\"z-index\") == 2) {\r\n\t\t\t\t\t\t\t\tz2 = index;\r\n\t\t\t\t\t\t\t\tz2Opacity = parseFloat(this.css(\"opacity\"));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t//console.log(\"get layout: z1=\" + z1 + \" z2=\" + z2 + \" z2Opacity=\" + z2Opacity + \" active=\" + opt.active);\r\n\t\t\t\t\t\tif (z2 !== undefined) {\r\n\t\t\t\t\t\t\tif (z1 > z2)   // Moving forward (a higher item index is in layer 1, becoming visible)\r\n\t\t\t\t\t\t\t\treturn z1 + (1 - z2Opacity) - opt.active - 1;\r\n\t\t\t\t\t\t\telse   // Moving backward\r\n\t\t\t\t\t\t\t\treturn z1 + z2Opacity - opt.active;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (z1 !== undefined) return z1 - opt.active;\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\tcase \"slide-in\":\r\n\t\t\t\t\t\tlet anyZero = false;\r\n\t\t\t\t\t\tlet firstGtZero = -1;\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tlet left = parseFloat(this.css(\"left\"));\r\n\t\t\t\t\t\t\tpos.push(left);\r\n\t\t\t\t\t\t\tif (left !== pos[0]) allSame = false;\r\n\t\t\t\t\t\t\tif (left === 0) anyZero = true;\r\n\t\t\t\t\t\t\tif (left > 0 && firstGtZero === -1) firstGtZero = index;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (allSame && pos[0] < 0) return items.length - 1 -pos[0] / itemWidth - opt.active;\r\n\t\t\t\t\t\tif (!anyZero) return -pos[0] / itemWidth - opt.active;\r\n\t\t\t\t\t\tif (firstGtZero > 0) return firstGtZero - pos[firstGtZero] / itemWidth - opt.active;\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\tcase \"slide-out\":\r\n\t\t\t\t\t\tlet anyPositive = false;\r\n\t\t\t\t\t\tlet firstZero = -1;\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tlet left = parseFloat(this.css(\"left\"));\r\n\t\t\t\t\t\t\tpos.push(left);\r\n\t\t\t\t\t\t\tif (left !== pos[0]) allSame = false;\r\n\t\t\t\t\t\t\tif (left >= 0) anyPositive = true;\r\n\t\t\t\t\t\t\tif (left === 0 && firstZero === -1) firstZero = index;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (allSame && pos[0] > 0) return -pos[0] / itemWidth - opt.active;\r\n\t\t\t\t\t\tif (!anyPositive) return items.length - 1 + -pos[pos.length - 1] / itemWidth - opt.active;\r\n\t\t\t\t\t\tif (firstZero > 0) return firstZero - 1 + -pos[firstZero - 1] / itemWidth - opt.active;\r\n\t\t\t\t\t\treturn 0;\r\n\t\t\t\t\tcase \"slide-fade\":\r\n\t\t\t\t\t\tlet activeItemLeft2 = parseFloat(items.eq(opt.active).css(\"left\"));\r\n\t\t\t\t\t\treturn -activeItemLeft2 / (itemWidth / 10);\r\n\t\t\t\t\tcase \"slide-all\":\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tlet activeItemLeft = parseFloat(items.eq(opt.active).css(\"left\"));\r\n\t\t\t\t\t\treturn -activeItemLeft / itemWidth;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Setter\r\n\t\t\tswitch (opt.animation) {\r\n\t\t\t\tcase \"fade\":\r\n\t\t\t\t\tif (itemOffset !== 0) {\r\n\t\t\t\t\t\tlet fullyVisible = opt.active + Math.trunc(itemOffset);\r\n\t\t\t\t\t\tlet partiallyVisible = opt.active + Math.trunc(itemOffset) + Math.sign(itemOffset);\r\n\t\t\t\t\t\t//console.log(fullyVisible, partiallyVisible);\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tif (index === fullyVisible) {\r\n\t\t\t\t\t\t\t\tthis.css(\"z-index\", 1).css(\"opacity\", 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (index === partiallyVisible) {\r\n\t\t\t\t\t\t\t\tthis.css(\"z-index\", 2).css(\"opacity\", Math.abs(itemOffset) - Math.trunc(Math.abs(itemOffset)));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthis.css(\"z-index\", 0).css(\"opacity\", 0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlet z1, z2, z2Opacity;\r\n\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\tif (this.css(\"z-index\") == 1)\r\n\t\t\t\t\t\t\t\tz1 = index;\r\n\t\t\t\t\t\t\tif (this.css(\"z-index\") == 2) {\r\n\t\t\t\t\t\t\t\tz2 = index;\r\n\t\t\t\t\t\t\t\tz2Opacity = parseFloat(this.css(\"opacity\"));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t//console.log(\"set layout: z1=\" + z1 + \" z2=\" + z2 + \" z2Opacity=\" + z2Opacity + \" active=\" + opt.active);\r\n\t\t\t\t\t\tif (opt.active === z1) {\r\n\t\t\t\t\t\t\titems.eq(z2).css(\"opacity\", 0).css(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (opt.active === z2) {\r\n\t\t\t\t\t\t\tremoveTransition();\r\n\t\t\t\t\t\t\titems.eq(z1).css(\"z-index\", 2).css(\"opacity\", 1 - z2Opacity);\r\n\t\t\t\t\t\t\titems.eq(z2).css(\"z-index\", 1).css(\"opacity\", 1).css(\"pointer-events\", \"\");\r\n\t\t\t\t\t\t\tforceReflow();\r\n\t\t\t\t\t\t\tif (!opt._isDragging) addTransition();\r\n\t\t\t\t\t\t\titems.eq(z1).css(\"opacity\", 0).css(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tlet currentVisible;\r\n\t\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\t\tif (this.css(\"z-index\") == 1)\r\n\t\t\t\t\t\t\t\t\tcurrentVisible = index;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tremoveTransition();\r\n\t\t\t\t\t\t\titems.eq(opt.active).css(\"z-index\", 1).css(\"opacity\", 1).css(\"pointer-events\", \"\");\r\n\t\t\t\t\t\t\tforceReflow();\r\n\t\t\t\t\t\t\tif (!opt._isDragging) addTransition();\r\n\t\t\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\t\t\tif (index === opt.active) {\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse if (index === currentVisible) {\r\n\t\t\t\t\t\t\t\t\tthis.css(\"z-index\", 2).css(\"opacity\", 0).css(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tthis.css(\"z-index\", 0).css(\"opacity\", 0).css(\"pointer-events\", \"\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet status = \"\";\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tstatus += index + \": z=\" + this.css(\"z-index\") + \" op=\" + this.css(\"opacity\") + (index === opt.active ? \" active\" : \"\") + \"\\n\";\r\n\t\t\t\t\t});\r\n\t\t\t\t\t//console.log(status);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"slide-in\":\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tlet left = opt.active + itemOffset <= items.length - 1 ?\r\n\t\t\t\t\t\t\tminmax((index - opt.active - itemOffset) * 100, 0, 100) :\r\n\t\t\t\t\t\t\t(items.length - 1 - opt.active - itemOffset) * 100;\r\n\t\t\t\t\t\tthis.css(\"left\", left + \"%\");\r\n\t\t\t\t\t\tthis.css(\"z-index\", index);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"slide-out\":\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tlet left = opt.active + itemOffset >= 0 ?\r\n\t\t\t\t\t\t\tminmax((index - opt.active - itemOffset) * 100, -100, 0) :\r\n\t\t\t\t\t\t\t(-opt.active - itemOffset) * 100;\r\n\t\t\t\t\t\tthis.css(\"left\", left + \"%\");\r\n\t\t\t\t\t\tthis.css(\"z-index\", items.length - 1 - index);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"slide-fade\":\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tlet percent = (index - opt.active) * 100 / 10;\r\n\t\t\t\t\t\tlet left = (index - opt.active) * opt._gutterOffset - itemOffset * stage.width() / 10;\r\n\t\t\t\t\t\tthis.css(\"left\", \"calc(\" + percent + \"% + \" + left + \"px)\");\r\n\t\t\t\t\t\tlet opacity = 1 - minmax(Math.abs(index - (opt.active + itemOffset)), 0, 1);\r\n\t\t\t\t\t\tthis.css(\"opacity\", opacity);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"slide-all\":\r\n\t\t\t\tdefault:\r\n\t\t\t\t\titems.each$(function (index) {\r\n\t\t\t\t\t\tlet percent = (index - opt.active) * opt._itemWidthPercent;\r\n\t\t\t\t\t\tlet left = (index - opt.active) * opt._gutterOffset - itemOffset * stage.width() / opt.items;\r\n\t\t\t\t\t\tthis.css(\"left\", \"calc(\" + percent + \"% + \" + left + \"px)\");\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Gets the active item in a carousel.\r\n//\r\n// indexOrItem: Sets the active item in each selected carousel, either by index or the element.\r\nfunction activeItem(indexOrItem) {\r\n\t// Getter\r\n\tif (indexOrItem === undefined) {\r\n\t\tvar carousel = this.first();\r\n\t\tif (carousel.length === 0) return;   // Nothing to do\r\n\t\tvar opt = loadOptions(\"carousel\", carousel);\r\n\t\treturn opt.active;\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar carousel = $(this);\r\n\t\tvar opt = loadOptions(\"carousel\", carousel);\r\n\t\tif (opt._isDragging) return;   // Ignore request while dragging\r\n\t\tvar items = carousel.find(\".\" + carouselClass).children();\r\n\t\tif (indexOrItem === Infinity) indexOrItem = items.length;   // Infinity can't be handled by Math.min\r\n\t\tvar index;\r\n\t\tif ($.isNumeric(indexOrItem)) {\r\n\t\t\tindex = +indexOrItem;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tindex = indexOrItem.index();\r\n\t\t}\r\n\r\n\t\tindex = minmax(index, 0, items.length - opt.items);\r\n\t\topt.active = index;\r\n\t\topt._layout(0);\r\n\t\tvar dots = carousel.find(\".\" + carouselIndicatorClass).children();\r\n\t\tdots.removeClass(\"active\").eq(Math.ceil(index / opt.dotsEach)).addClass(\"active\");\r\n\t\tcarousel.trigger(\"activeItemChange\");\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"carousel\", carousel, {\r\n\tactiveItem: activeItem\r\n});\r\n$.fn.carousel.defaults = carouselDefaults;\r\n","﻿import { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\n// This file uses its own scope to keep its helper functions private and make it reusable independently.\r\n// There are a few places where jQuery is used but they can easily be replaced with DOM calls if necessary.\r\n(function (undefined) {\r\n\t\"use strict\";\r\n\r\n\t// Parses any color value understood by a browser into an object with r, g, b, a properties.\r\n\tfunction Color(value) {\r\n\t\t// Allow calling without \"new\" keyword\r\n\t\tif (!(this instanceof Color))\r\n\t\t\treturn new Color(value);\r\n\r\n\t\tif (typeof value === \"string\") {\r\n\t\t\tif (value === \"\") {\r\n\t\t\t\tthis.format = \"CSS\";\r\n\t\t\t\tthis.r = this.g = this.b = this.a = 0;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.format = value.match(/^rgba?\\(/) ? \"CSS\" : \"HTML\";\r\n\r\n\t\t\t// Add \"#\" prefix if missing and the data is otherwise looking good (3/6/8 hex digits)\r\n\t\t\tif (value.match(/^\\s*[0-9A-Fa-f]{3}([0-9A-Fa-f]{3}([0-9A-Fa-f]{2})?)?\\s*$/)) value = \"#\" + value.trim();\r\n\r\n\t\t\t// Let the browser do the work\r\n\t\t\tvar color = $(\"<div/>\").css(\"color\", value).css(\"color\");\r\n\t\t\tvar match = color.match(/rgba?\\(\\s*([0-9.]+)\\s*,\\s*([0-9.]+)\\s*,\\s*([0-9.]+)\\s*(?:,\\s*([0-9.]+)\\s*)?\\)/);\r\n\t\t\tif (match) {\r\n\t\t\t\tthis.r = keep255(Number(match[1]));\r\n\t\t\t\tthis.g = keep255(Number(match[2]));\r\n\t\t\t\tthis.b = keep255(Number(match[3]));\r\n\t\t\t\tthis.a = match[4] !== undefined ? keep1(Number(match[4])) : 1;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Browser wasn't in the mood (probably Chrome with a named color), try harder\r\n\t\t\tvar context = $(\"<canvas width='1' height='1'/>\")[0].getContext(\"2d\");\r\n\t\t\tcontext.fillStyle = value;\r\n\t\t\tcontext.fillRect(0, 0, 1, 1);\r\n\t\t\tvar data = context.getImageData(0, 0, 1, 1).data;\r\n\t\t\tthis.r = data[0];\r\n\t\t\tthis.g = data[1];\r\n\t\t\tthis.b = data[2];\r\n\t\t\tthis.a = data[3] / 255;\r\n\t\t\t// If this is wrong, the named color probably doesn't exist, but we can't detect it\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (typeof value === \"number\") {\r\n\t\t\tthis.format = \"IntARGB\";\r\n\t\t\tthis.r = (value >> 16) & 0xff;\r\n\t\t\tthis.g = (value >> 8) & 0xff;\r\n\t\t\tthis.b = value & 0xff;\r\n\t\t\tvar a = (value >> 24) & 0xff;\r\n\t\t\tthis.a = a !== 0 ? round(a / 255, 3) : 1;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (typeof value === \"object\") {\r\n\t\t\tthis.format = value.format !== undefined ? value.format : \"Object\";\r\n\t\t\tthis.r = keep255(value.r);\r\n\t\t\tthis.g = keep255(value.g);\r\n\t\t\tthis.b = keep255(value.b);\r\n\t\t\tthis.a = value.a !== undefined ? keep1(value.a) : 1;\r\n\t\t\treturn;\r\n\t\t};\r\n\r\n\t\tconsole.error(\"Invalid color:\", value);\r\n\t}\r\n\r\n\t// Make it public\r\n\twindow.Color = Color;\r\n\r\n\t// Now add object methods\r\n\tvar Color_prototype = Color.prototype;\r\n\r\n\t// Formats the color in the format it was originally parsed from.\r\n\tColor_prototype.toString = function () {\r\n\t\tswitch (this.format) {\r\n\t\t\tcase \"IntARGB\":\r\n\t\t\t\treturn this.toIntARGB();\r\n\t\t\tcase \"HTML\":\r\n\t\t\t\treturn this.toHTML();\r\n\t\t\tcase \"CSS\":\r\n\t\t\tdefault:\r\n\t\t\t\treturn this.toCSS();\r\n\t\t}\r\n\t};\r\n\r\n\t// Formats a color object into a CSS rgb() string.\r\n\tColor_prototype.toCSS = function () {\r\n\t\tif (this.a === undefined || this.a === 1)\r\n\t\t\treturn \"rgb(\" + this.r + \", \" + this.g + \", \" + this.b + \")\";\r\n\t\treturn \"rgba(\" + this.r + \", \" + this.g + \", \" + this.b + \", \" + this.a + \")\";\r\n\t};\r\n\r\n\t// Formats a color object into an HTML hexadecimal string.\r\n\tColor_prototype.toHTML = function () {\r\n\t\tfunction conv(number) {\r\n\t\t\treturn (number < 16 ? \"0\" : \"\") +\r\n\t\t\t\tround(keep255(number)).toString(16).toLowerCase();\r\n\t\t}\r\n\r\n\t\tvar str = \"#\" + conv(this.r) + conv(this.g) + conv(this.b);\r\n\t\tif (this.a !== undefined && this.a !== 1) str += conv(this.a * 255);\r\n\t\treturn str;\r\n\t};\r\n\r\n\t// Converts a color object into an integer number like 0xAARRGGBB.\r\n\tColor_prototype.toIntARGB = function () {\r\n\t\treturn (this.a !== undefined ? round(keep1(this.a) * 255) : 255) << 24 |\r\n\t\t\tround(keep255(this.r)) << 16 |\r\n\t\t\tround(keep255(this.g)) << 8 |\r\n\t\t\tround(keep255(this.b));\r\n\t};\r\n\r\n\t// Calculates the HSL components from the RGB components in the color object.\r\n\tColor_prototype.updateHSL = function () {\r\n\t\tthis.r = keep255(this.r);\r\n\t\tthis.g = keep255(this.g);\r\n\t\tthis.b = keep255(this.b);\r\n\r\n\t\tvar r = this.r / 255;\r\n\t\tvar g = this.g / 255;\r\n\t\tvar b = this.b / 255;\r\n\t\tvar min = Math.min(r, g, b);\r\n\t\tvar max = Math.max(r, g, b);\r\n\r\n\t\tif (max === min)\r\n\t\t\tthis.h = 0;\r\n\t\telse if (max === r)\r\n\t\t\tthis.h = (60 * (g - b) / (max - min)) % 360;\r\n\t\telse if (max === g)\r\n\t\t\tthis.h = (60 * (b - r) / (max - min) + 120) % 360;\r\n\t\telse // if (max === b)\r\n\t\t\tthis.h = (60 * (r - g) / (max - min) + 240) % 360;\r\n\t\tif (this.h < 0)\r\n\t\t\tthis.h += 360;\r\n\r\n\t\tthis.s = 0;   // Just for the order of the properties\r\n\t\tthis.l = (max + min) / 2;\r\n\r\n\t\tif (max === min)\r\n\t\t\tthis.s = 0;\r\n\t\telse if (this.l <= 0.5)\r\n\t\t\tthis.s = (max - min) / (2 * this.l);\r\n\t\telse\r\n\t\t\tthis.s = (max - min) / (2 - 2 * this.l);\r\n\t\treturn this;\r\n\t};\r\n\r\n\t// Calculates the RGB components from the HSL components in the color object.\r\n\tColor_prototype.updateRGB = function () {\r\n\t\tthis.h = minmax(this.h, 0, 366);\r\n\t\tthis.s = keep1(this.s);\r\n\t\tthis.l = keep1(this.l);\r\n\r\n\t\tvar q = this.l < 0.5 ?\r\n\t\t\tthis.l * (1 + this.s) :\r\n\t\t\tthis.l + this.s - this.l * this.s;\r\n\t\tvar p = 2 * this.l - q;\r\n\t\tvar h = this.h / 360;   // Normalise hue to 0..1\r\n\t\tvar t = { r: h + 1 / 3, g: h, b: h - 1 / 3 };\r\n\r\n\t\tvar that = this;\r\n\t\t[\"r\", \"g\", \"b\"].forEach(function (c) {\r\n\t\t\tif (t[c] < 0) t[c]++;\r\n\t\t\tif (t[c] > 1) t[c]--;\r\n\t\t\tif (t[c] < 1 / 6)\r\n\t\t\t\tthat[c] = p + ((q - p) * 6 * t[c]);\r\n\t\t\telse if (t[c] < 1 / 2)\r\n\t\t\t\tthat[c] = q;\r\n\t\t\telse if (t[c] < 2 / 3)\r\n\t\t\t\tthat[c] = p + ((q - p) * 6 * (2 / 3 - t[c]));\r\n\t\t\telse\r\n\t\t\t\tthat[c] = p;\r\n\t\t\tthat[c] = round(that[c] * 255);\r\n\t\t});\r\n\t\tif (this.a === undefined) this.a = 1;\r\n\t\treturn this;\r\n\t};\r\n\r\n\t// Returns a blended color with the specified ratio from 0 (no change) to 1 (only other color).\r\n\tColor_prototype.blendWith = function (other, ratio, includeAlpha) {\r\n\t\tvar isHSL = this.h !== undefined || other.h !== undefined;\r\n\t\tvar color = Color(this);\r\n\t\tother = Color(other);\r\n\t\tratio = keep1(ratio);\r\n\t\t[\"r\", \"g\", \"b\"].forEach(function (c) {\r\n\t\t\tcolor[c] = keep255(round(extendFF(color[c]) + (extendFF(other[c]) - extendFF(color[c])) * ratio));\r\n\t\t});\r\n\t\tif (includeAlpha)\r\n\t\t\tcolor.a = round(color.a + (other.a - color.a) * ratio, 3);\r\n\t\tif (isHSL)\r\n\t\t\tcolor.updateHSL();\r\n\t\treturn color;\r\n\t};\r\n\r\n\t// Returns the inverted color.\r\n\tColor_prototype.invert = function () {\r\n\t\treturn processColor(this, false, function () {\r\n\t\t\tthis.r = 255 - keep255(this.r);\r\n\t\t\tthis.g = 255 - keep255(this.g);\r\n\t\t\tthis.b = 255 - keep255(this.b);\r\n\t\t});\r\n\t};\r\n\r\n\t// Returns the complementary color.\r\n\tColor_prototype.complement = function () {\r\n\t\treturn processColor(this, true, function () {\r\n\t\t\tthis.h = (this.h + 180) % 360;\r\n\t\t});\r\n\r\n\t\t// TODO: Add an option to return multiple complementary colors, as array\r\n\t};\r\n\r\n\t// Returns a color that is lighter by the factor between 0 (unchanged) and 1 (white).\r\n\tColor_prototype.lighten = function (factor) {\r\n\t\treturn processColor(this, true, function () {\r\n\t\t\tthis.l = keep1(this.l + keep1(factor) * (1 - this.l));\r\n\t\t});\r\n\t};\r\n\r\n\t// Returns a color that is darker by the factor between 0 (unchanged) and 1 (black).\r\n\tColor_prototype.darken = function (factor) {\r\n\t\treturn processColor(this, true, function () {\r\n\t\t\tthis.l = keep1(this.l * (1 - keep1(factor)));\r\n\t\t});\r\n\t};\r\n\r\n\t// TODO: Add functions to (de)saturate the color (similar to lighten and darken?)\r\n\r\n\t// Returns a color with a changed alpha value between 0 (transparent) and 1 (opaque).\r\n\tColor_prototype.alpha = function (alpha) {\r\n\t\treturn processColor(this, true, function () {\r\n\t\t\tthis.a = keep1(alpha);\r\n\t\t});\r\n\t};\r\n\r\n\t// Returns the grayscale color by perceived brightness.\r\n\tColor_prototype.gray = function () {\r\n\t\treturn processColor(this, false, function () {\r\n\t\t\tvar value = round(keep255(this.r) * 0.3 + keep255(this.g) * 0.59 + keep255(this.b) * 0.11);\r\n\t\t\tthis.r = value;\r\n\t\t\tthis.g = value;\r\n\t\t\tthis.b = value;\r\n\t\t\tthis.a = 1;\r\n\t\t});\r\n\t};\r\n\r\n\t// Returns a value indicating whether the specified color is dark.\r\n\tColor_prototype.isDark = function () {\r\n\t\treturn this.gray().r < 144;\r\n\t};\r\n\r\n\t// Returns white or black as suitable for the text color over the background color.\r\n\tColor_prototype.text = function () {\r\n\t\treturn processColor(this, false, function () {\r\n\t\t\tvar value = this.isDark() ? 255 : 0;\r\n\t\t\tthis.r = value;\r\n\t\t\tthis.g = value;\r\n\t\t\tthis.b = value;\r\n\t\t\tthis.a = 1;\r\n\t\t});\r\n\t};\r\n\r\n\tfunction processColor(color, hslMode, fn) {\r\n\t\tcolor = Color(color);   // Make a copy\r\n\t\tif (hslMode) color.updateHSL();\r\n\t\tfn.call(color);\r\n\t\tif (hslMode) color.updateRGB();\r\n\t\treturn color;\r\n\t}\r\n\r\n\tfunction extendFF(value) {\r\n\t\treturn value === 0xff ? 256 : value;\r\n\t}\r\n\r\n\tfunction keep1(value) {\r\n\t\treturn minmax(value, 0, 1);\r\n\t}\r\n\r\n\tfunction keep255(value) {\r\n\t\treturn minmax(value, 0, 255);\r\n\t}\r\n\r\n})();\r\n","﻿import { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\n// Add support for jQuery DOM functions with replaced elements by Frontfire (like selectable)\r\nlet origToggle = $.fn.toggle;\r\n$.fn.toggle = function () {\r\n\tlet args = arguments;\r\n\treturn this.each$(function () {\r\n\t\torigToggle.apply(this.data(\"ff-replacement\") || this, args);\r\n\t});\r\n};\r\n\r\nlet origShow = $.fn.show;\r\n$.fn.show = function () {\r\n\tlet args = arguments;\r\n\treturn this.each$(function () {\r\n\t\torigShow.apply(this.data(\"ff-replacement\") || this, args);\r\n\t});\r\n};\r\n\r\nlet origHide = $.fn.hide;\r\n$.fn.hide = function () {\r\n\tlet args = arguments;\r\n\treturn this.each$(function () {\r\n\t\torigHide.apply(this.data(\"ff-replacement\") || this, args);\r\n\t});\r\n};\r\n\r\n// Gets the offset and dimensions of the first selected element.\r\n//\r\n// relative: true to return the position relative to the offset parent, false for page position.\r\n$.fn.rect = function (relative) {\r\n\tvar offset = relative ? this.position() : this.offset();\r\n\tvar width = this.outerWidth();\r\n\tvar height = this.outerHeight();\r\n\treturn {\r\n\t\ttop: offset.top,\r\n\t\tleft: offset.left,\r\n\t\tright: offset.left + width,\r\n\t\tbottom: offset.top + height,\r\n\t\twidth: width,\r\n\t\theight: height\r\n\t};\r\n};\r\n\r\n// Determines whether the selected element is visible.\r\n//\r\n// value: Sets the visible state of the selected elements.\r\n$.fn.visible = function (value) {\r\n\t// Setter\r\n\tif (value !== undefined) {\r\n\t\treturn this.each(function () {\r\n\t\t\tif (value)\r\n\t\t\t\t$(this).show();\r\n\t\t\telse\r\n\t\t\t\t$(this).hide();\r\n\t\t});\r\n\t}\r\n\r\n\t// Getter\r\n\tif (this.length === 0) return;\r\n\tlet el = this.data(\"ff-replacement\") || this;\r\n\treturn el.css(\"display\") !== \"none\";\r\n};\r\n\r\n// Determines whether the selected element is disabled.\r\n//\r\n// value: Sets the disabled state of the selected elements and the associated label(s).\r\n// includeLabel: Also updates the parent form row label, if there is one. Default: true.\r\n$.fn.disabled = function (value, includeLabel) {\r\n\t// Setter\r\n\tif (value !== undefined) {\r\n\t\treturn this.each(function () {\r\n\t\t\tif (value)\r\n\t\t\t\t$(this).disable(includeLabel);\r\n\t\t\telse\r\n\t\t\t\t$(this).enable(includeLabel);\r\n\t\t});\r\n\t}\r\n\r\n\t// Getter\r\n\tif (this.length === 0) return;\r\n\t// Also explicitly check for the property to support the disabledchange hook\r\n\treturn this[0].disabled || this.attr(\"disabled\") !== undefined;\r\n};\r\n\r\n// Enables the selected elements and the associated label(s).\r\n//\r\n// includeLabel: Also updates the parent form row label, if there is one. Default: true.\r\n$.fn.enable = function (includeLabel) {\r\n\treturn this.each$(function () {\r\n\t\tvar supportsDisabledProp = \"disabled\" in this[0];\r\n\t\tif (supportsDisabledProp) {\r\n\t\t\t// Set property so that the hook can trigger the change event.\r\n\t\t\t// This automatically removes the HTML attribute as well.\r\n\t\t\tthis.prop(\"disabled\", false);\r\n\t\t\t// Also update replacement elements of Frontfire controls\r\n\t\t\tif (this.data(\"ff-replacement\"))\r\n\t\t\t\tthis.data(\"ff-replacement\").enable(false);\r\n\t\t}\r\n\t\telse if (this.attr(\"disabled\") !== undefined) {\r\n\t\t\t// Don't set the property or it will be added where not supported.\r\n\t\t\t// Only remove HTML attribute to allow CSS styling other elements than inputs\r\n\t\t\tthis.removeAttr(\"disabled\");\r\n\t\t\t// Trigger the event manually\r\n\t\t\tthis.trigger(\"disabledchange\");\r\n\t\t}\r\n\r\n\t\tthis.parents(\"label\").enable();\r\n\t\tvar id = this.attr(\"id\");\r\n\t\tif (id)\r\n\t\t\t$(\"label[for='\" + id + \"']\").enable();\r\n\t\t\r\n\t\tif (includeLabel !== false) {\r\n\t\t\t// Find previous .label sibling up on the .form-row level\r\n\t\t\tlet refNode = this;\r\n\t\t\twhile (refNode.parent().length > 0 && !refNode.parent().hasClass(\"form-row\"))\r\n\t\t\t\trefNode = refNode.parent();\r\n\t\t\tlet label = refNode.prev();\r\n\t\t\tif (label.hasClass(\"label\"))\r\n\t\t\t\tlabel.enable();\r\n\t\t}\r\n\t});\r\n};\r\n\r\n// Disables the selected elements and the associated label(s).\r\n//\r\n// includeLabel: Also updates the parent form row label, if there is one. Default: true.\r\n$.fn.disable = function (includeLabel) {\r\n\treturn this.each$(function () {\r\n\t\tvar supportsDisabledProp = \"disabled\" in this[0];\r\n\t\tif (supportsDisabledProp) {\r\n\t\t\t// Set property so that the hook can trigger the change event.\r\n\t\t\t// This automatically sets the HTML attribute as well.\r\n\t\t\tthis.prop(\"disabled\", true);\r\n\t\t\t// Also update replacement elements of Frontfire controls\r\n\t\t\tif (this.data(\"ff-replacement\"))\r\n\t\t\t\tthis.data(\"ff-replacement\").disable(false);\r\n\t\t}\r\n\t\telse if (this.attr(\"disabled\") === undefined) {\r\n\t\t\t// Don't set the property or it will be added where not supported.\r\n\t\t\t// Only set HTML attribute to allow CSS styling other elements than inputs\r\n\t\t\tthis.attr(\"disabled\", \"\");\r\n\t\t\t// Trigger the event manually\r\n\t\t\tthis.trigger(\"disabledchange\");\r\n\t\t}\r\n\r\n\t\tthis.parents(\"label\").disable();\r\n\t\tvar id = this.attr(\"id\");\r\n\t\tif (id)\r\n\t\t\t$(\"label[for='\" + id + \"']\").disable();\r\n\t\t\r\n\t\tif (includeLabel !== false) {\r\n\t\t\t// Find previous .label sibling up on the .form-row level\r\n\t\t\tlet refNode = this;\r\n\t\t\twhile (refNode.parent().length > 0 && !refNode.parent().hasClass(\"form-row\"))\r\n\t\t\t\trefNode = refNode.parent();\r\n\t\t\tlet label = refNode.prev();\r\n\t\t\tif (label.hasClass(\"label\"))\r\n\t\t\t\tlabel.disable();\r\n\t\t}\r\n\t});\r\n};\r\n\r\n// Toggles the disabled state of the selected elements and the associated label(s).\r\n//\r\n// includeLabel: Also updates the parent form row label, if there is one. Default: true.\r\n$.fn.toggleDisabled = function (includeLabel) {\r\n\treturn this.each$(function () {\r\n\t\tif (this.disabled())\r\n\t\t\tthis.enable(includeLabel);\r\n\t\telse\r\n\t\t\tthis.disable(includeLabel);\r\n\t});\r\n};\r\n\r\n// Returns the first child of each selected element, in the fastest possible way.\r\n$.fn.firstChild = function () {\r\n\tvar ret = $();\r\n\tthis.each(function () {\r\n\t\tret = ret.add(this.firstElementChild);\r\n\t});\r\n\treturn ret;\r\n};\r\n\r\n// Determines the actual cursor of the first selected element. \"auto\" is returned as \"default\".\r\n$.fn.actualCursor = function () {\r\n\t// Most elements like <a>, <input>, <textarea> or <area> already compute their actual cursor\r\n\t// value so there's nothing to do.\r\n\tvar cursor = this.css(\"cursor\");\r\n\tif (cursor !== \"auto\" || cursor === undefined) return cursor;\r\n\r\n\t// \"auto\" is mostly used for inline text content. Ignore that and just return the default\r\n\t// cursor that is shown over the empty areas of that element.\r\n\treturn \"default\";\r\n};\r\n\r\n// Determines whether the specified font exists on the client.\r\n// TODO: This fails completely on any Android browser, see https://stackoverflow.com/q/48077942\r\n$.fontExists = function (font) {\r\n\t// Test each probe letter separately so that their differences can't cancel each other\r\n\tvar probes = [\"A\", \"j\", \"l\", \"Q\", \"W\", \"1\", \"^\", \"{\", \"&\", \"@\"];\r\n\t// Compare with different fonts, of which two different ones should be available everywhere\r\n\tvar refFonts = [\"Courier\", \"Times New Roman\", \"Arial\", \"Courier New\", \"Roboto\"];\r\n\tvar container = $(\"<span style='font-size: 100px; line-height: 100%; margin: 0; padding: 0; position: absolute; top: -1000px; left: -1000px;'/>\").appendTo($(\"body\"));\r\n\r\n\tfor (var i = 0; i < probes.length; i++) {\r\n\t\t// Extend the probe to make small differences more easily measured, using a prime factor :)\r\n\t\tlet probe = \"\";\r\n\t\tfor (var k = 0; k < 7; k++) {\r\n\t\t\tprobe += probes[i];\r\n\t\t}\r\n\t\tcontainer.text(probe);\r\n\t\tfor (var j = 0; j < refFonts.length; j++) {\r\n\t\t\tcontainer.css(\"font-family\", refFonts[j]);\r\n\t\t\tvar width = container.width();\r\n\t\t\tvar height = container.height();\r\n\t\t\tcontainer.css(\"font-family\", \"\\\"\" + font + \"\\\",\\\"\" + refFonts[j] + \"\\\"\");\r\n\t\t\tif (container.width() != width || container.height() != height) {\r\n\t\t\t\tcontainer.remove();\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tcontainer.remove();\r\n\treturn false;\r\n};\r\n\r\n// Adds a pointer event handler to the selected elements, with mouse and touch fallbacks as supported.\r\n//\r\n// type: The event type (\"down\", \"move\", \"up\", \"cancel\"). Multiple types can be space-delimited.\r\n// handler: The event handler function.\r\n// capture: Specifies the capture option. If true, DOM addEventListener ist used instead of jQuery.\r\n// Returns a function that removes the event handler. Keep it and call it, there is no other way to remove it.\r\n$.fn.pointer = function (type, handler, capture) {\r\n\tvar add, remove, pointer, mouse, touch, touchType = type, mouseHandler, touchHandler;\r\n\tvar types = type.trim().split(/\\s+/);\r\n\r\n\t// Handle multiple types\r\n\tif (types.length > 1) {\r\n\t\t// Call self for each type and combine all event remover functions in a new function to return\r\n\t\tlet eventRemovers = [];\r\n\t\tlet that = this;\r\n\t\ttypes.forEach(function (type) {\r\n\t\t\teventRemovers.push($(that).pointer(type, handler, capture));\r\n\t\t});\r\n\t\treturn function () {\r\n\t\t\teventRemovers.forEach(function (eventRemover) { eventRemover(); });\r\n\t\t};\r\n\t}\r\n\r\n\t// Set up the functions to call and bind their context\r\n\tif (capture) {\r\n\t\t// Handle multiple selected elements\r\n\t\tif (this.length > 1) {\r\n\t\t\t// Call self for each element and combine all event remover functions in a new function to return\r\n\t\t\tlet eventRemovers = [];\r\n\t\t\tlet that = this;\r\n\t\t\tthis.each(function () {\r\n\t\t\t\teventRemovers.push($(that).pointer(type, handler, capture));\r\n\t\t\t});\r\n\t\t\treturn function () {\r\n\t\t\t\teventRemovers.forEach(function (eventRemover) { eventRemover(); });\r\n\t\t\t};\r\n\t\t}\r\n\t\tadd = this[0].addEventListener.bind(this[0]);\r\n\t\tremove = this[0].removeEventListener.bind(this[0]);\r\n\t}\r\n\telse {\r\n\t\tadd = this.on.bind(this);\r\n\t\tremove = this.off.bind(this);\r\n\t\tcapture = undefined;\r\n\t}\r\n\r\n\t// Fix touch event type names that are a little different\r\n\tswitch (type) {\r\n\t\tcase \"down\": touchType = \"start\"; break;\r\n\t\tcase \"up\": touchType = \"end\"; break;\r\n\t}\r\n\r\n\t// Determine the supported (and necessary) event types\r\n\tpointer = \"onpointer\" + type in window;\r\n\tif (!pointer) {\r\n\t\tmouse = \"onmouse\" + type in window;\r\n\t\ttouch = \"ontouch\" + touchType in window;\r\n\t}\r\n\r\n\t// Prepare adapted handlers for fallback event types\r\n\tif (mouse) mouseHandler = event => handleMouseEvent(handler, event);\r\n\tif (touch) touchHandler = event => handleTouchEvent(handler, event);\r\n\r\n\t// Add event handlers\r\n\tif (pointer) add(\"pointer\" + type, handler, capture);\r\n\tif (mouse) add(\"mouse\" + type, mouseHandler, capture);\r\n\tif (touch) add(\"touch\" + touchType, touchHandler, capture);\r\n\r\n\t// Return a function that removes all added event handlers, for the caller to call later\r\n\treturn function () {\r\n\t\tif (pointer) remove(\"pointer\" + type, handler, capture);\r\n\t\tif (mouse) remove(\"mouse\" + type, mouseHandler, capture);\r\n\t\tif (touch) remove(\"touch\" + touchType, touchHandler, capture);\r\n\t};\r\n};\r\n\r\n// Calls a pointer event handler for a mouse event.\r\nfunction handleMouseEvent(handler, event) {\r\n\tvar event2 = $.Event(event.type, event);\r\n\tevent2.pointerId = -event.button;\r\n\tevent2.pointerType = \"mouse\";\r\n\treturn handler(event2);\r\n}\r\n\r\n// Calls a pointer event handler for a touch event.\r\nfunction handleTouchEvent(handler, event) {\r\n\tfor (var index = 0; index < event.changedTouches.length; index++) {\r\n\t\tvar event2 = $.Event(event.type, event);\r\n\t\tevent2.pageX = event.changedTouches[index].pageX;\r\n\t\tevent2.pageY = event.changedTouches[index].pageY;\r\n\t\tevent2.pointerId = event.changedTouches[index].identifier;\r\n\t\tevent2.button = 0;\r\n\t\tevent2.pointerType = \"touch\";\r\n\t\tif (handler(event2) === false) return false;\r\n\t}\r\n}\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar draggableClass = \"ff-draggable\";\r\nvar resetAllCursorsClass = \"reset-all-cursors\";\r\n\r\n// Defines default options for the draggable plugin.\r\nvar draggableDefaults = {\r\n\t// The element(s) that can start a drag operation. Default: The element to drag.\r\n\thandle: undefined,\r\n\r\n\t// The element(s) that cannot start a drag operation. Default: None.\r\n\tcancel: undefined,\r\n\r\n\t// Constrains the drag movement along the \"x\" or \"y\" axis. Default: None.\r\n\taxis: undefined,\r\n\r\n\t// Constrains the drag movement inside the specified element or the \"parent\" of the dragged element or the \"viewport\". Default: None.\r\n\tcontainment: undefined,\r\n\r\n\t// The elements among which the dragged element will be pulled in the front. Default: None.\r\n\tstack: undefined,\r\n\r\n\t// The mouse cursor to show during dragging. Default: None.\r\n\tdragCursor: undefined,\r\n\r\n\t// A CSS class to add to the element while it's being dragged. Default: None.\r\n\tdragClass: undefined,\r\n\r\n\t// The grid to snap the dragged element to during dragging, as [x, y] in pixels. Default: [1, 1].\r\n\tgrid: undefined,\r\n\r\n\t// Indicates whether the window should scroll to keep the dragged element visible. Default: false.\r\n\tscroll: false\r\n};\r\n\r\n// Makes each selected element draggable.\r\nfunction draggable(options) {\r\n\treturn this.each(function () {\r\n\t\tvar elem = this;\r\n\t\tvar $elem = $(elem);\r\n\t\tif ($elem.hasClass(draggableClass)) return;   // Already done\r\n\t\t$elem.addClass(draggableClass);\r\n\t\tvar dragging, draggingCancelled, dragPoint, elemRect, minDragDistance, pointerId, htmlCursor;\r\n\t\tvar opt = initOptions(\"draggable\", draggableDefaults, $elem, {}, options);\r\n\t\tlet $window = $(window);\r\n\r\n\t\tvar handle = opt.handle ? $elem.find(opt.handle) : $elem;\r\n\t\topt.handleElem = handle;\r\n\r\n\t\t// Allow Pointer API to work properly in Edge\r\n\t\topt.originalTouchAction = handle.css(\"touch-action\");\r\n\t\tif (opt.axis === \"x\")\r\n\t\t\thandle.css(\"touch-action\", \"pan-y pinch-zoom\");\r\n\t\telse if (opt.axis === \"y\")\r\n\t\t\thandle.css(\"touch-action\", \"pan-x pinch-zoom\");\r\n\t\telse\r\n\t\t\thandle.css(\"touch-action\", \"pinch-zoom\");\r\n\r\n\t\topt.eventRemovers = [];\r\n\t\tvar eventRemovers = [];\r\n\t\topt.eventRemovers.push(handle.pointer(\"down\", function (event) {\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tif (dragging) return;\r\n\t\t\t\tdraggingCancelled = false;\r\n\t\t\t\tdragPoint = { left: event.pageX, top: event.pageY };\r\n\t\t\t\tpointerId = event.pointerId;\r\n\t\t\t\tminDragDistance = event.pointerType === \"touch\" ? 8 : 4;\r\n\t\t\t\teventRemovers.push($window.pointer(\"move\", onMove, true));\r\n\t\t\t\teventRemovers.push($window.pointer(\"up cancel\", onEnd, true));\r\n\t\t\t}\r\n\t\t}));\r\n\r\n\t\tif (opt.cancel) {\r\n\t\t\topt.eventRemovers.push($elem.find(opt.cancel).pointer(\"down\", function (event) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\tfunction onMove(event) {\r\n\t\t\tif (event.pointerId !== pointerId) return;   // Not my pointer\r\n\t\t\tif (draggingCancelled) return;   // Don't try again until the button was released\r\n\r\n\t\t\t// Consider starting a drag operation\r\n\t\t\tif (dragPoint && !dragging && !$elem.disabled()) {\r\n\t\t\t\tlet distance = Math.sqrt(Math.pow(event.pageX - dragPoint.left, 2) + Math.pow(event.pageY - dragPoint.top, 2));\r\n\t\t\t\tif (distance >= minDragDistance) {\r\n\t\t\t\t\telemRect = $elem.rect();\r\n\t\t\t\t\tlet event2 = $.Event(\"draggablestart\");\r\n\t\t\t\t\tevent2.dragPoint = dragPoint;\r\n\t\t\t\t\tevent2.newPoint = { left: event.pageX, top: event.pageY };\r\n\t\t\t\t\t$elem.trigger(event2);\r\n\t\t\t\t\tif (!event2.isDefaultPrevented()) {\r\n\t\t\t\t\t\tdragging = true;\r\n\t\t\t\t\t\topt.dragClass && $elem.addClass(opt.dragClass);\r\n\t\t\t\t\t\telem.setCapture && elem.setCapture();   // Firefox only (set cursor over entire desktop)\r\n\t\t\t\t\t\t$(\"html\").addClass(resetAllCursorsClass);   // All browsers (set cursor at least within page)\r\n\t\t\t\t\t\tif (opt.stack) {\r\n\t\t\t\t\t\t\tstackElements($(opt.stack), elem);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\thtmlCursor = document.documentElement.style.getPropertyValue(\"cursor\");\r\n\t\t\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", opt.dragCursor || $elem.actualCursor(), \"important\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tdraggingCancelled = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Handle an ongoing drag operation\r\n\t\t\tif (dragging) {\r\n\t\t\t\t// Start with the default drag movement position\r\n\t\t\t\tvar newPoint = {\r\n\t\t\t\t\ttop: elemRect.top + event.pageY - dragPoint.top,\r\n\t\t\t\t\tleft: elemRect.left + event.pageX - dragPoint.left\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Consider constraints\r\n\t\t\t\tif (opt.grid) {\r\n\t\t\t\t\tlet gridBase = $elem.parent().offset();\r\n\t\t\t\t\tnewPoint = {\r\n\t\t\t\t\t\ttop: Math.round((newPoint.top - gridBase.top) / opt.grid[1]) * opt.grid[1] + gridBase.top,\r\n\t\t\t\t\t\tleft: Math.round((newPoint.left - gridBase.left) / opt.grid[0]) * opt.grid[0] + gridBase.left\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.axis === \"x\") {\r\n\t\t\t\t\tnewPoint.top = elemRect.top;\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.axis === \"y\") {\r\n\t\t\t\t\tnewPoint.left = elemRect.left;\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.containment) {\r\n\t\t\t\t\tlet cont, contRect;\r\n\t\t\t\t\tif (opt.containment === \"parent\") {\r\n\t\t\t\t\t\tcont = $elem.parent();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (opt.containment === \"viewport\") {\r\n\t\t\t\t\t\tlet scrollTop = $window.scrollTop();\r\n\t\t\t\t\t\tlet scrollLeft = $window.scrollLeft();\r\n\t\t\t\t\t\tcontRect = {\r\n\t\t\t\t\t\t\ttop: 0 + scrollTop,\r\n\t\t\t\t\t\t\tleft: 0 + scrollLeft,\r\n\t\t\t\t\t\t\tbottom: $window.height() + scrollTop,\r\n\t\t\t\t\t\t\tright: $window.width() + scrollLeft\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tcont = $(opt.containment);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (cont && cont.length > 0) {\r\n\t\t\t\t\t\tcontRect = cont.rect();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (contRect) {\r\n\t\t\t\t\t\tlet stepX = opt.grid ? opt.grid[0] : 1;\r\n\t\t\t\t\t\tlet stepY = opt.grid ? opt.grid[1] : 1;\r\n\t\t\t\t\t\twhile (newPoint.left < contRect.left) newPoint.left += stepX;\r\n\t\t\t\t\t\twhile (newPoint.left + elemRect.width > contRect.right) newPoint.left -= stepX;\r\n\t\t\t\t\t\twhile (newPoint.top < contRect.top) newPoint.top += stepY;\r\n\t\t\t\t\t\twhile (newPoint.top + elemRect.height > contRect.bottom) newPoint.top -= stepY;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Move element\r\n\t\t\t\tlet event2 = $.Event(\"draggablemove\");\r\n\t\t\t\tevent2.elemRect = elemRect;\r\n\t\t\t\tevent2.newPoint = newPoint;\r\n\t\t\t\t$elem.trigger(event2);\r\n\t\t\t\tif (!event2.isDefaultPrevented()) {\r\n\t\t\t\t\t$elem.offset(event2.newPoint);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Handle auto-scrolling\r\n\t\t\t\tif (opt.scroll) {\r\n\t\t\t\t\tscrollIntoView($elem.rect());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onEnd(event) {\r\n\t\t\tif (event.pointerId !== pointerId) return;   // Not my pointer\r\n\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tvar wasDragging = dragging;\r\n\t\t\t\tdragPoint = undefined;\r\n\t\t\t\tdragging = false;\r\n\t\t\t\tpointerId = undefined;\r\n\t\t\t\topt.dragClass && $elem.removeClass(opt.dragClass);\r\n\r\n\t\t\t\teventRemovers.forEach(eventRemover => eventRemover());\r\n\t\t\t\teventRemovers = [];\r\n\r\n\t\t\t\tif (wasDragging) {\r\n\t\t\t\t\telem.releaseCapture && elem.releaseCapture();\r\n\t\t\t\t\t$(\"html\").removeClass(resetAllCursorsClass);\r\n\t\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", htmlCursor);\r\n\r\n\t\t\t\t\tlet event2 = $.Event(\"draggableend\");\r\n\t\t\t\t\tevent2.revert = function () {\r\n\t\t\t\t\t\t$elem.offset(elemRect);\r\n\t\t\t\t\t};\r\n\t\t\t\t\t$elem.trigger(event2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Removes the draggable features from the elements.\r\nfunction remove() {\r\n\treturn this.each(function () {\r\n\t\tvar elem = this;\r\n\t\tvar $elem = $(elem);\r\n\t\tif (!$elem.hasClass(draggableClass)) return;\r\n\t\t$elem.removeClass(draggableClass);\r\n\t\tvar opt = loadOptions(\"draggable\", $elem);\r\n\t\topt.handleElem.css(\"touch-action\", opt.originalTouchAction);\r\n\t\topt.eventRemovers.forEach(eventRemover => eventRemover());\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"draggable\", draggable, {\r\n\tremove: remove\r\n});\r\n$.fn.draggable.defaults = draggableDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { forceReflow } from \"../util\";\r\n\r\nvar dropdownContainerClass = \"ff-dropdown-container\";\r\n\r\n// Defines default options for the dropdown plugin.\r\nvar dropdownDefaults = {\r\n\t// The placement of the dropdown relative to the target element. Default: None.\r\n\tplacement: undefined,\r\n\r\n\t// Indicates whether the dropdown is closed when clicking anywhere outside of it. Default: true.\r\n\tautoClose: true,\r\n\t\r\n\t// Indicates whether the dropdown is closed when the window is resized. Default: true.\r\n\tcloseOnResize: true,\r\n\t\r\n\t// Indicates whether the dropdown is closed when the document is hidden. Default: true.\r\n\tcloseOnHide: true,\r\n\t\r\n\t// The maximum height of the dropdown, in pixels. Default: 0 (no limit).\r\n\tmaxHeight: 0,\r\n\r\n\t// Indicates whether the dropdown has fixed position instead of absolute. Default: false.\r\n\tfixed: false\r\n};\r\n\r\n// Opens a dropdown with the selected element and places it at the specified target element.\r\nfunction createDropdown(target, options) {\r\n\tvar dropdown = this.first();\r\n\tif (dropdown.length === 0) return this;   // Nothing to do\r\n\tif (dropdown.parent().hasClass(dropdownContainerClass)) {\r\n\t\tlet oldContainer = dropdown.parent();\r\n\t\tif (oldContainer.hasClass(\"closed\")) {\r\n\t\t\t// Already closed but the transition hasn't completed yet. Bring it to an end right now.\r\n\t\t\tdropdown.appendTo(\"body\");\r\n\t\t\toldContainer.remove();\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn;   // Already open\r\n\t\t}\r\n\t}\r\n\tvar opt = initOptions(\"dropdown\", dropdownDefaults, dropdown, {}, options);\r\n\r\n\tvar autoPlacement = false;\r\n\tif (!opt.placement) {\r\n\t\topt.placement = \"bottom-left\";\r\n\t\tautoPlacement = true;\r\n\t}\r\n\telse if (opt.placement === \"right\") {\r\n\t\topt.placement = \"bottom-right\";\r\n\t\tautoPlacement = true;\r\n\t}\r\n\tvar optPlacement = opt.placement;\r\n\r\n\t// Measure before adding the dropdown to the document (which may add a scrollbar, virtually)\r\n\tvar $window = $(window);\r\n\tvar viewportWidth = $window.width() - 1;\r\n\tvar viewportHeight = $window.height() - 1;\r\n\tvar scrollTop = $window.scrollTop();\r\n\tvar scrollLeft = $window.scrollLeft();\r\n\tvar targetRect = $(target).rect();\r\n\tvar isReducedHeight = false;\r\n\tvar isRightAligned = false;\r\n\tvar isHorizontallyCentered = false;\r\n\r\n\tvar container = $(\"<div/>\").addClass(dropdownContainerClass).appendTo(\"body\");\r\n\tif (opt.fixed) {\r\n\t\tcontainer.css(\"position\", \"fixed\");\r\n\t}\r\n\tif (dropdown.hasClass(\"bordered\")) {\r\n\t\tcontainer.addClass(\"bordered\");\r\n\t}\r\n\tif ($(document.body).hasClass(\"ff-dimmed\")) {\r\n\t\tcontainer.addClass(\"no-dim\");\r\n\t}\r\n\tdropdown.appendTo(container);\r\n\r\n\t// Now measure the container with its contents\r\n\tvar dropdownWidth = container.outerWidth();\r\n\tvar dropdownHeight = container.outerHeight();\r\n\r\n\t// Limit height if specified, has effect on placement\r\n\tif (opt.maxHeight && opt.maxHeight < dropdownHeight) {\r\n\t\tdropdownHeight = opt.maxHeight;\r\n\t\tcontainer.outerHeight(dropdownHeight);\r\n\t\tisReducedHeight = true;\r\n\t\tdropdownWidth = container.outerWidth();\r\n\t}\r\n\r\n\t// Place at bottom side, align left, by default\r\n\tvar top = targetRect.bottom,\r\n\t\tleft = targetRect.left,\r\n\t\tdirection = \"bottom\";\r\n\r\n\tif (optPlacement.startsWith(\"top\")) {\r\n\t\ttop = targetRect.top - dropdownHeight;\r\n\t\tdirection = \"top\";\r\n\t}\r\n\telse if (optPlacement.startsWith(\"bottom\")) {\r\n\t\ttop = targetRect.bottom;\r\n\t\tdirection = \"bottom\";\r\n\t}\r\n\telse if (optPlacement.startsWith(\"left\")) {\r\n\t\tleft = targetRect.left - dropdownWidth;\r\n\t\tdirection = \"left\";\r\n\t\tisRightAligned = true;\r\n\t}\r\n\telse if (optPlacement.startsWith(\"right\")) {\r\n\t\tleft = targetRect.right;\r\n\t\tdirection = \"right\";\r\n\t}\r\n\r\n\tif (optPlacement.endsWith(\"left\")) {\r\n\t\tleft = targetRect.left;\r\n\t}\r\n\telse if (optPlacement.endsWith(\"right\")) {\r\n\t\tleft = targetRect.right - dropdownWidth;\r\n\t\tisRightAligned = true;\r\n\t}\r\n\telse if (optPlacement.endsWith(\"top\")) {\r\n\t\ttop = targetRect.top;\r\n\t}\r\n\telse if (optPlacement.endsWith(\"bottom\")) {\r\n\t\ttop = targetRect.bottom - dropdownHeight;\r\n\t}\r\n\r\n\tif (optPlacement === \"top-center\" || optPlacement === \"bottom-center\") {\r\n\t\tleft = (targetRect.left + targetRect.right) / 2 - dropdownWidth / 2;\r\n\t\tisHorizontallyCentered = true;\r\n\t}\r\n\telse if (optPlacement === \"left-center\" || optPlacement === \"right-center\") {\r\n\t\ttop = (targetRect.top + targetRect.bottom) / 2 - dropdownHeight / 2;\r\n\t}\r\n\r\n\tif (autoPlacement && left + dropdownWidth > viewportWidth) {\r\n\t\tleft = viewportWidth - dropdownWidth;\r\n\t}\r\n\tif (autoPlacement && top + dropdownHeight > viewportHeight + scrollTop) {\r\n\t\tlet topSpace = targetRect.top - scrollTop;\r\n\t\tlet bottomSpace = viewportHeight + scrollTop - targetRect.bottom;\r\n\t\tif (topSpace > bottomSpace) {\r\n\t\t\ttop = targetRect.top - dropdownHeight;\r\n\t\t\tdirection = \"top\";\r\n\t\t}\r\n\t}\r\n\t\r\n\tlet availableHeight;\r\n\tif (direction === \"top\") {\r\n\t\tavailableHeight = targetRect.top - scrollTop;\r\n\t}\r\n\telse if (direction === \"bottom\") {\r\n\t\tavailableHeight = viewportHeight + scrollTop - targetRect.bottom;\r\n\t}\r\n\telse {\r\n\t\tavailableHeight = viewportHeight;\r\n\t}\r\n\tif (dropdownHeight > availableHeight) {\r\n\t\tdropdownHeight = availableHeight;\r\n\t\tcontainer.outerHeight(dropdownHeight);\r\n\t\tisReducedHeight = true;\r\n\t\tif (direction === \"top\")\r\n\t\t\ttop = targetRect.top - dropdownHeight;\r\n\t}\r\n\r\n\tif (direction === \"left\" || direction === \"right\") {\r\n\t\tif (top + dropdownHeight > viewportHeight + scrollTop) {\r\n\t\t\ttop = viewportHeight + scrollTop - dropdownHeight;\r\n\t\t}\r\n\t\telse if (top < scrollTop) {\r\n\t\t\ttop = scrollTop;\r\n\t\t}\r\n\t}\r\n\telse if (direction === \"top\" || direction === \"bottom\") {\r\n\t\tif (left + dropdownWidth > viewportWidth + scrollLeft) {\r\n\t\t\tleft = viewportWidth + scrollLeft - dropdownWidth;\r\n\t\t}\r\n\t\telse if (left < scrollLeft) {\r\n\t\t\tleft = scrollLeft;\r\n\t\t}\r\n\t}\r\n\t\r\n\tif (isReducedHeight) {\r\n\t\tlet scrollbarWidth = container[0].offsetWidth - container[0].clientWidth;\r\n\t\tif (scrollbarWidth > 0) {\r\n\t\t\tdropdownWidth += scrollbarWidth;\r\n\t\t\tif (dropdownWidth > viewportWidth) {\r\n\t\t\t\tdropdownWidth = viewportWidth;\r\n\t\t\t}\r\n\t\t\tcontainer.outerWidth(dropdownWidth);\r\n\t\t\tif (isRightAligned) {\r\n\t\t\t\tleft -= scrollbarWidth;\r\n\t\t\t}\r\n\t\t\telse if (isHorizontallyCentered) {\r\n\t\t\t\tleft -= scrollbarWidth / 2;\r\n\t\t\t}\r\n\r\n\t\t\tif (left + dropdownWidth > viewportWidth + scrollLeft) {\r\n\t\t\t\tleft = viewportWidth + scrollLeft - dropdownWidth;\r\n\t\t\t}\r\n\t\t\telse if (left < scrollLeft) {\r\n\t\t\t\tleft = scrollLeft;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Scroll to the first selected item in the dropdown (used for selectable)\r\n\tlet selectedChild = dropdown.children(\".selected\").first();\r\n\tif (selectedChild.length > 0) {\r\n\t\tlet selectedTop = selectedChild.position().top;\r\n\t\tcontainer.scrollTop(selectedTop + selectedChild.height() / 2 - dropdownHeight / 2);\r\n\t}\r\n\r\n\tcontainer.offset({ top: top, left: left })\r\n\t\t.addClass(\"animate-\" + direction);\r\n\tforceReflow();\r\n\tcontainer.addClass(\"open\");\r\n\r\n\t// Auto-close the dropdown when clicking outside of it\r\n\tif (opt.autoClose === undefined || opt.autoClose) {\r\n\t\tsetTimeout(function () {\r\n\t\t\t$(document).on(\"click.dropdown-close\", function (event) {\r\n\t\t\t\ttryClose();\r\n\t\t\t});\r\n\t\t}, 20);\r\n\t\tcontainer.click(function (event) {\r\n\t\t\t// Don't close the dropdown when clicking inside of it\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t});\r\n\t}\r\n\t\r\n\tif (opt.closeOnResize === undefined || opt.closeOnResize) {\r\n\t\t$window.on(\"resize.dropdown\", tryClose);\r\n\t}\r\n\t\r\n\tif (opt.closeOnHide === undefined || opt.closeOnHide) {\r\n\t\t$(document).on(\"visibilitychange.dropdown\", function () {\r\n\t\t\tif (document.hidden)\r\n\t\t\t\ttryClose();\r\n\t\t});\r\n\t}\r\n\treturn this;\r\n\r\n\tfunction tryClose() {\r\n\t\tvar event = $.Event(\"dropdownclose\");\r\n\t\tdropdown.trigger(event);\r\n\t\tif (!event.isDefaultPrevented()) {\r\n\t\t\tdropdown.dropdown.close(true);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Determines whether the dropdown is currently open.\r\n//\r\nfunction isDropdownOpen() {\r\n\tvar dropdown = this.first();\r\n\tif (dropdown.length === 0) return this;   // Nothing to do\r\n\tvar container = dropdown.parent();\r\n\treturn container.hasClass(dropdownContainerClass);\r\n}\r\n\r\n// Closes the selected dropdown.\r\n//\r\n// closeEventTriggered: For internal use.\r\nfunction closeDropdown(closeEventTriggered) {\r\n\tvar dropdown = this.first();\r\n\tif (dropdown.length === 0) return this;   // Nothing to do\r\n\tvar container = dropdown.parent();\r\n\tif (!container.hasClass(dropdownContainerClass)) return this;   // Dropdown is not open\r\n\t//var opt = loadOptions(\"dropdown\", dropdown);\r\n\r\n\t$(document).off(\"click.dropdown-close\");\r\n\tcontainer.removeClass(\"open\").addClass(\"closed\");\r\n\tcontainer.on(\"transitionend\", function () {\r\n\t\tdropdown.appendTo(\"body\");\r\n\t\tcontainer.remove();\r\n\t});\r\n\tif (!closeEventTriggered) {\r\n\t\tvar event = $.Event(\"dropdownclose\");\r\n\t\tdropdown.trigger(event);\r\n\t}\r\n\t$(window).off(\"resize.dropdown\");\r\n\t$(document).off(\"visibilitychange.dropdown\");\r\n\treturn this;\r\n}\r\n\r\nregisterPlugin(\"dropdown\", createDropdown, {\r\n\tisOpen: isDropdownOpen,\r\n\tclose: closeDropdown\r\n});\r\n$.fn.dropdown.defaults = dropdownDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar inputWrapperClass = \"ff-input-wrapper\";\r\nvar repeatButtonClass = \"ff-repeat-button\";\r\nvar styleCheckboxClass = \"ff-checkbox\";\r\nvar treeStateClass = \"ff-threestate\";\r\nvar textareaWrapperClass = \"ff-textarea-wrapper\";\r\n\r\n// Makes each selected button trigger repeated click events while being pressed.\r\n// The button will not trigger a click event anymore but instead repeatclick events.\r\nfunction repeatButton() {\r\n\treturn this.each(function () {\r\n\t\tvar button = $(this);\r\n\t\tif (button.hasClass(repeatButtonClass)) return;   // Already done\r\n\t\tbutton.addClass(repeatButtonClass);\r\n\t\tvar timeout, ms;\r\n\t\tbutton.on(\"mousedown touchstart\", function (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tms = 500;\r\n\t\t\tclick();\r\n\t\t});\r\n\t\tbutton.on(\"mouseup mouseleave touchend touchcancel\", function (event) {\r\n\t\t\tif (timeout) {\r\n\t\t\t\tclearTimeout(timeout);\r\n\t\t\t\ttimeout = undefined;\r\n\t\t\t}\r\n\t\t\tms = undefined;\r\n\t\t});\r\n\t\tbutton.click(function (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\r\n\t\t// Triggers the button's click event and repeats the timeout\r\n\t\tfunction click() {\r\n\t\t\tbutton.trigger(\"repeatclick\");\r\n\t\t\ttimeout = setTimeout(click, ms);\r\n\t\t\tms = 50 + Math.round((ms - 50) * 0.8);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"repeatButton\", repeatButton);\r\n\r\n// Adds buttons to each selected input[type=number] element to decrement or increment the value.\r\nfunction spinner() {\r\n\treturn this.each(function () {\r\n\t\tvar input = $(this);\r\n\t\tif (input.parent().hasClass(inputWrapperClass)) return;   // Already done\r\n\r\n\t\t// Put a wrapper between the input and its parent\r\n\t\tvar wrapper = $(\"<div/>\").addClass(inputWrapperClass).attr(\"style\", input.attr(\"style\"));\r\n\t\tinput.before(wrapper).appendTo(wrapper);\r\n\t\tinput.attr(\"autocomplete\", \"off\");\r\n\r\n\t\t// Add control buttons\r\n\t\tvar buttons = [];\r\n\t\tvar decButton = $(\"<button type='button'/>\").appendTo(wrapper).attr(\"tabindex\", \"-1\").text(\"\\u2212\");   // &minus;\r\n\t\tbuttons.push(decButton);\r\n\t\tdecButton.on(\"repeatclick\", function (event) {\r\n\t\t\tif (input.disabled()) return;\r\n\t\t\tvar value = +input.val();\r\n\t\t\tvar min = input.attr(\"min\");\r\n\t\t\tvar max = input.attr(\"max\");\r\n\t\t\tvar stepBase = min !== undefined ? +min : 0;\r\n\t\t\tlet match = input.attr(\"step\") ? input.attr(\"step\").match(/^\\s*\\*(.*)/) : false;\r\n\t\t\tif (match) {\r\n\t\t\t\tlet factor = +match[1] || 10;\r\n\t\t\t\tif ((min === undefined || value / factor >= min) && (max === undefined || value / factor <= max))\r\n\t\t\t\t\tvalue /= factor;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (max !== undefined && value > +max) value = +max + 1;\r\n\t\t\t\tvar step = +input.attr(\"step\") || 1;\r\n\t\t\t\tvar corr = step / 1000;   // Correct JavaScript's imprecise numbers\r\n\t\t\t\tvalue = (Math.ceil((value - stepBase - corr) / step) - 1) * step + stepBase;   // Set to next-smaller valid step\r\n\t\t\t\tif (min !== undefined && value < +min) value = +min;\r\n\t\t\t\twhile (max !== undefined && value > +max) value -= step;\r\n\t\t\t}\r\n\t\t\tlet valueStr = value.toFixed(10).replace(/0+$/, \"\").replace(/[.,]$/, \"\");   // Correct JavaScript's imprecise numbers again\r\n\t\t\tinput.val(valueStr);\r\n\t\t\tinput.trigger(\"input\").change();\r\n\t\t});\r\n\t\tdecButton.repeatButton();\r\n\t\tvar incButton = $(\"<button type='button'/>\").appendTo(wrapper).attr(\"tabindex\", \"-1\").text(\"+\");\r\n\t\tbuttons.push(incButton);\r\n\t\tincButton.on(\"repeatclick\", function (event) {\r\n\t\t\tif (input.disabled()) return;\r\n\t\t\tvar value = +input.val();\r\n\t\t\tvar min = input.attr(\"min\");\r\n\t\t\tvar max = input.attr(\"max\");\r\n\t\t\tvar stepBase = min !== undefined ? +min : 0;\r\n\t\t\tlet match = input.attr(\"step\") ? input.attr(\"step\").match(/^\\s*\\*(.*)/) : false;\r\n\t\t\tif (match) {\r\n\t\t\t\tlet factor = +match[1] || 10;\r\n\t\t\t\tif ((min === undefined || value * factor >= min) && (max === undefined || value * factor <= max))\r\n\t\t\t\t\tvalue *= factor;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (max !== undefined && value > +max) value = +max + 1;\r\n\t\t\t\tvar step = +input.attr(\"step\") || 1;\r\n\t\t\t\tvar corr = step / 1000;   // Correct JavaScript's imprecise numbers\r\n\t\t\t\tvalue = (Math.floor((value - stepBase + corr) / step) + 1) * step + stepBase;   // Set to next-greater valid step\r\n\t\t\t\tif (min !== undefined && value < +min) value = +min;\r\n\t\t\t\twhile (max !== undefined && value > +max) value -= step;\r\n\t\t\t}\r\n\t\t\tlet valueStr = +value.toFixed(10).replace(/0+$/, \"\").replace(/[.,]$/, \"\");   // Correct JavaScript's imprecise numbers again\r\n\t\t\tinput.val(valueStr);\r\n\t\t\tinput.trigger(\"input\").change();\r\n\t\t});\r\n\t\tincButton.repeatButton();\r\n\t\tbindInputButtonsDisabled(input, buttons);\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"spinner\", spinner);\r\n\r\n// Converts each selected input[type=color] element into a text field with color picker button.\r\nfunction colorPicker() {\r\n\treturn this.each(function () {\r\n\t\tvar input = $(this);\r\n\t\tif (input.parent().hasClass(inputWrapperClass)) return;   // Already done\r\n\t\tvar lastColor;\r\n\r\n\t\tinput.attr(\"type\", \"text\").attr(\"autocomplete\", \"off\");\r\n\r\n\t\t// Put a wrapper between the input and its parent\r\n\t\tvar wrapper = $(\"<div/>\").addClass(inputWrapperClass).attr(\"style\", input.attr(\"style\"));\r\n\t\tinput.before(wrapper).appendTo(wrapper);\r\n\r\n\t\t// Create picker dropdown\r\n\t\tvar dropdown = $(\"<div/>\").addClass(\"dropdown bordered ff-colorpicker\");\r\n\t\tdropdown.keydown(function (event) {\r\n\t\t\tif (event.keyCode >= 37 && event.keyCode <= 40) {   // Arrow keys\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tdropdown.find(\"button\").first().focus();\r\n\t\t\t\tdropdown.removeAttr(\"tabindex\");\r\n\t\t\t}\r\n\t\t\tif (event.keyCode === 27) {   // Esc\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tdropdown.dropdown.close();\r\n\t\t\t\tpickButton[0].focus();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Add control buttons\r\n\t\tvar buttons = [];\r\n\t\tvar pickButton = $(\"<button type='button'/>\").addClass(\"ff-colorbutton\").appendTo(wrapper);\r\n\t\tbuttons.push(pickButton);\r\n\t\tvar colorBox = $(\"<div/>\").appendTo(pickButton).text(\"\\u2026\");   // &hellip;\r\n\t\tinput.on(\"input change\", () => setColor(lastColor = input.val()));\r\n\t\tsetColor(lastColor = input.val());\r\n\r\n\t\t// Create dropdown contents\r\n\t\t// Add grey tones explicitly\r\n\t\tvar colors = [0x000000, 0x404040, 0x707070, 0xa0a0a0, 0xd0d0d0, 0xf0f0f0, 0xffffff];\r\n\t\t// Add colors with shades\r\n\t\t[\r\n\t\t\t0xff0000,   // red\r\n\t\t\t0xff8000,   // orange\r\n\t\t\t0xffc000,   // orangeyellow\r\n\t\t\t0xffe000,   // gold\r\n\t\t\t0xffff00,   // yellow\r\n\t\t\t0xc0ff00,   // greenyellow\r\n\t\t\t0x00ff00,   // green\r\n\t\t\t0x00ffc0,   // greencyan\r\n\t\t\t0x00ffff,   // cyan\r\n\t\t\t0x00c0ff,   // bluecyan\r\n\t\t\t0x0080ff,   // lightblue\r\n\t\t\t0x0000ff,   // blue\r\n\t\t\t0x8000ff,   // purple\r\n\t\t\t0xc000ff,   // violet\r\n\t\t\t0xff00ff    // magenta\r\n\t\t].forEach(function (baseColor_) {\r\n\t\t\tvar baseColor = Color(baseColor_);\r\n\t\t\t[0.75, 0.5, 0.25].forEach(factor => colors.push(baseColor.blendWith(0x000000, factor)));\r\n\t\t\tcolors.push(baseColor.toHTML());\r\n\t\t\t[0.5, 0.75, 0.875].forEach(factor => colors.push(baseColor.blendWith(0xffffff, factor)));\r\n\t\t});\r\n\t\tvar buttonRow;\r\n\t\tcolors.forEach(function (color, index) {\r\n\t\t\tcolor = Color(color);\r\n\t\t\tcolor.format = \"HTML\";\r\n\t\t\tif (index % 7 === 0)\r\n\t\t\t\tbuttonRow = $(\"<div/>\").appendTo(dropdown);\r\n\t\t\tvar button = $(\"<button type='button'/>\").css(\"background\", color).data(\"color\", String(color)).appendTo(buttonRow);\r\n\t\t\tif (color.isDark()) button.addClass(\"dark\");\r\n\t\t\tbutton.click(function (event) {\r\n\t\t\t\tsetColor(lastColor = color, true);\r\n\t\t\t\tdropdown.dropdown.close();\r\n\t\t\t\tpickButton[0].focus();\r\n\t\t\t});\r\n\t\t\tbutton.focus(function (event) {\r\n\t\t\t\tdropdown.find(\"button.active\").removeClass(\"active\");\r\n\t\t\t\tbutton.addClass(\"active\");\r\n\t\t\t\tsetColor(color, true);\r\n\t\t\t});\r\n\t\t\tbutton.keydown(function (event) {\r\n\t\t\t\tvar activeButton = dropdown.find(\"button.active\");\r\n\t\t\t\tvar newButton;\r\n\r\n\t\t\t\tswitch (event.keyCode) {\r\n\t\t\t\t\tcase 37:   // Left\r\n\t\t\t\t\t\tnewButton = activeButton.prev();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 39:   // Right\r\n\t\t\t\t\t\tnewButton = activeButton.next();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 40:   // Down\r\n\t\t\t\t\t\tnewButton = activeButton.parent().next().children().eq(activeButton.index());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 38:   // Up\r\n\t\t\t\t\t\tnewButton = activeButton.parent().prev().children().eq(activeButton.index());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 27:   // Esc\r\n\t\t\t\t\t\tsetColor(lastColor, true);\r\n\t\t\t\t\t\tdropdown.dropdown.close();\r\n\t\t\t\t\t\tpickButton[0].focus();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 13:   // Enter\r\n\t\t\t\t\t\tbutton.click();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn;   // Not handled\r\n\t\t\t\t}\r\n\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tnewButton && newButton[0] && newButton[0].focus();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tpickButton.click(function (event) {\r\n\t\t\tvar currentColor = input.val();\r\n\t\t\tvar activeButton;\r\n\t\t\tdropdown.find(\"button\").each$(function () {\r\n\t\t\t\tvar active = this.data(\"color\") === currentColor;\r\n\t\t\t\tthis.toggleClass(\"active\", active);\r\n\t\t\t\tif (active) activeButton = this[0];\r\n\t\t\t});\r\n\r\n\t\t\tdropdown.dropdown(pickButton, { placement: \"right\" });\r\n\t\t\tif (activeButton) {\r\n\t\t\t\tactiveButton.focus();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdropdown.attr(\"tabindex\", \"-1\");\r\n\t\t\t\tdropdown.focus();\r\n\t\t\t}\r\n\t\t});\r\n\t\tbindInputButtonsDisabled(input, buttons);\r\n\r\n\t\tfunction setColor(color, toInput) {\r\n\t\t\tif (toInput && input.val() != color) {\r\n\t\t\t\tinput.val(color).trigger(\"input\").change();\r\n\t\t\t}\r\n\t\t\tcolorBox.css(\"background\", color);\r\n\t\t\tcolorBox.css(\"color\", Color(color).text());\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"colorPicker\", colorPicker);\r\n\r\n// Applies the enhanced style on the selected checkbox and radio input elements.\r\nfunction styleCheckbox() {\r\n\treturn this.each(function () {\r\n\t\tvar input = $(this);\r\n\t\tif (input.hasClass(styleCheckboxClass)) return;   // Already done\r\n\t\tif (!input.is(\"input[type=checkbox], input[type=radio]\")) return;   // Wrong element\r\n\r\n\t\tif (input.parents(\"label\").length === 0) {\r\n\t\t\t// Styled input needs a label around it to remain clickable\r\n\t\t\tinput.wrap(\"<label class='empty'></label>\");\r\n\t\t}\r\n\t\tinput.addClass(styleCheckboxClass).after($(\"<span/>\"));\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"styleCheckbox\", styleCheckbox);\r\n\r\n// Makes each selected checkbox cycle through indeterminate (third) state on clicking.\r\nfunction threeState() {\r\n\treturn this.each(function () {\r\n\t\tvar input = $(this);\r\n\t\tif (input.hasClass(treeStateClass)) return;   // Already done\r\n\t\tif (!input.is(\"input[type=checkbox]\")) return;   // Wrong element\r\n\t\tinput.addClass(treeStateClass);\r\n\r\n\t\tvar cb = input[0];\r\n\t\t// Based on: https://css-tricks.com/indeterminate-checkboxes/\r\n\t\tinput.click(function (event) {\r\n\t\t\t// indeterminate is unset when the user clicks to change the checked state.\r\n\t\t\t// readonly (ineffective for checkboxes) is used to backup the previous indeterminate state.\r\n\t\t\t// In this event, checked is already updated to the new desired state.\r\n\t\t\tif (cb.checked && !cb.readOnly) {\r\n\t\t\t\t// Was unchecked and not readonly (indeterminate) -> uncheck and make indeterminate\r\n\t\t\t\tcb.checked = false;\r\n\t\t\t\tcb.readOnly = cb.indeterminate = true;\r\n\t\t\t}\r\n\t\t\telse if (cb.readOnly) {\r\n\t\t\t\t// Was readonly (indeterminate) -> check and forget indeterminate state (unset readonly)\r\n\t\t\t\tcb.checked = true;   // Firefox and Chrome are already checked here, Edge is not\r\n\t\t\t\tcb.readOnly = false;\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"threeState\", threeState);\r\n\r\n// Makes each selected textarea element automatically adjust its height to its content.\r\nfunction autoHeight(minRows, maxRows, extraRows) {\r\n\tminRows = minRows || 3;\r\n\treturn this.each(function () {\r\n\t\tvar textarea = $(this);\r\n\t\tif (textarea.parent().hasClass(textareaWrapperClass)) return;   // Already done\r\n\r\n\t\t// Put a wrapper between the textarea and its parent, and host a new shadow element in\r\n\t\t// the wrapper as well. The textarea is set to fill the container, and the shadow\r\n\t\t// element provides the size for the wrapper.\r\n\t\tvar wrapper = $(\"<div/>\").addClass(textareaWrapperClass).attr(\"style\", textarea.attr(\"style\"));\r\n\t\ttextarea.before(wrapper).appendTo(wrapper);\r\n\t\tvar shadowContent = $(\"<div/>\").appendTo(wrapper);\r\n\r\n\t\tvar outerHeightOffset = textarea.outerHeight() - textarea.height();\r\n\t\tvar lineHeight = parseFloat(textarea.css(\"line-height\"));\r\n\t\tif (lineHeight) {\r\n\t\t\tshadowContent.css(\"min-height\", minRows * lineHeight + outerHeightOffset);\r\n\t\t\tif (maxRows) {\r\n\t\t\t\tshadowContent.css(\"max-height\", maxRows * lineHeight + outerHeightOffset);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttextarea.on(\"input.autoheight\", updateShadow);\r\n\t\tupdateShadow();\r\n\r\n\t\tfunction updateShadow() {\r\n\t\t\t// Copy textarea contents; browser will calculate correct height of shadow copy,\r\n\t\t\t// which will make overall wrapper taller, which will make textarea taller.\r\n\t\t\t// Also make sure the last line break is visible.\r\n\t\t\t// Add an extra line break to convince the browser that the textarea doesn't need a scrollbar.\r\n\t\t\tvar text = textarea.val().replace(/\\n$/, \"\\n.\");\r\n\t\t\tif (extraRows)\r\n\t\t\t\ttext += \"\\n.\".repeat(extraRows);\r\n\t\t\tshadowContent.text(text);\r\n\r\n\t\t\t// Copy all layout-relevant styles from textarea to shadow element, in case they've changed\r\n\t\t\t[\r\n\t\t\t\t\"border-bottom-style\", \"border-bottom-width\",\r\n\t\t\t\t\"border-left-style\", \"border-left-width\",\r\n\t\t\t\t\"border-right-style\", \"border-right-width\",\r\n\t\t\t\t\"border-top-style\", \"border-top-width\",\r\n\t\t\t\t\"font-family\", \"font-feature-settings\", \"font-kerning\", \"font-size\", \"font-stretch\", \"font-style\",\r\n\t\t\t\t\"font-variant\", \"font-variant-alternates\", \"font-variant-caps\", \"font-variant-east-asian\",\r\n\t\t\t\t\"font-variant-ligatures\", \"font-variant-numeric\", \"font-variant-position\", \"font-weight\",\r\n\t\t\t\t\"hyphens\", \"letter-spacing\", \"line-height\",\r\n\t\t\t\t\"padding-bottom\", \"padding-left\", \"padding-right\", \"padding-top\",\r\n\t\t\t\t\"text-transform\", \"word-break\", \"word-spacing\"\r\n\t\t\t].forEach(copyStyle);\r\n\t\t}\r\n\r\n\t\tfunction copyStyle(name) {\r\n\t\t\tshadowContent.css(name, textarea.css(name));\r\n\t\t}\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"autoHeight\", autoHeight);\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\n\r\n// Converts each selected list element into a menu. Submenus are opened for nested lists.\r\nfunction menu() {\r\n\treturn this.each(function () {\r\n\t\tvar menu = $(this);\r\n\t\tvar isVertical = menu.hasClass(\"vertical\");\r\n\t\tvar itemsWithSubmenu = menu.children(\"li\").has(\"ul\");\r\n\t\titemsWithSubmenu.each(function () {\r\n\t\t\tvar item = $(this);\r\n\t\t\titem.addClass(\"ff-has-submenu\");\r\n\t\t\tvar submenu = item.children(\"ul\").first();\r\n\t\t\tif (submenu.hasClass(\"ff-submenu\")) return;   // Already done\r\n\t\t\tsubmenu.addClass(\"ff-submenu dropdown\");\r\n\t\t\tif (item.closest(\"nav\").length > 0)\r\n\t\t\t\tsubmenu.addClass(\"nav\");\r\n\r\n\t\t\t// Open submenu on click\r\n\t\t\titem.children(\"a\").first().click(function (event) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tif (item.disabled()) return;\r\n\t\t\t\tvar ddOpt = {};\r\n\t\t\t\tif (isVertical) {\r\n\t\t\t\t\tddOpt[\"placement\"] = \"right-top\";\r\n\t\t\t\t}\r\n\t\t\t\tsubmenu.dropdown(item, ddOpt);\r\n\t\t\t\titem.addClass(\"open\");\r\n\t\t\t\tsubmenu.one(\"dropdownclose\", function () {\r\n\t\t\t\t\titem.removeClass(\"open\");\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Prepare separators\r\n\t\t\tsubmenu.children(\"li\").each$(function () {\r\n\t\t\t\tif (this.text() === \"-\") {\r\n\t\t\t\t\tthis.text(\"\");\r\n\t\t\t\t\tthis.addClass(\"separator\");\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t// Close submenu when clicking on one of its items\r\n\t\t\tsubmenu.find(\"li > a:not(.stay-open)\").each$(function () {\r\n\t\t\t\tthis.click(function () {\r\n\t\t\t\t\tsubmenu.dropdown.close();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t\t// Replace # href with a true no-op\r\n\t\tmenu.find(\"li > a[href='#']\").attr(\"href\", \"javascript:\");\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"menu\", menu);\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar messageCloseButtonClass = \"ff-message-close-button\";\r\n\r\n// Makes each selected message div element closable by adding a close button to it.\r\nfunction closableMessage() {\r\n\treturn this.each(function () {\r\n\t\tvar message = $(this);\r\n\t\tif (message.find(\".\" + messageCloseButtonClass).length !== 0) return;   // Already added\r\n\r\n\t\t// Add close button\r\n\t\tvar closeButton = $(\"<a/>\").addClass(messageCloseButtonClass).attr(\"href\", \"#\").appendTo(message);\r\n\t\tmessage.addClass(\"closable\");\r\n\t\tcloseButton.click(function (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tmessage.closableMessage.close();\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\n// Closes each selected message div and removes it from the document.\r\nfunction closeMessage() {\r\n\treturn this.each(function () {\r\n\t\tvar message = $(this);\r\n\t\tmessage.addClass(\"ff-closed\");\r\n\t\tmessage.on(\"transitionend\", function () {\r\n\t\t\tmessage.remove();\r\n\t\t});\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"closableMessage\", closableMessage, {\r\n\tclose: closeMessage\r\n});\r\n","import { forceReflow } from \"./util\";\r\n\r\nvar backgroundDimmerClass = \"ff-background-dimmer\";\r\nvar dimmingClass = \"ff-dimming\";\r\nvar dimmedClass = \"ff-dimmed\";\r\n\r\nvar dimCount = 0;\r\n\r\n// Dims the entire document by adding an overlay.\r\nexport function dimBackground(noinput) {\r\n\tdimCount++;\r\n\tif ($(\"body > div.\" + backgroundDimmerClass + \":not(.closing)\").length !== 0) return;   // Already there\r\n\tvar existingBackgroundLayer = $(\"body > div.\" + backgroundDimmerClass);\r\n\tif (existingBackgroundLayer.length === 0)\r\n\t\t$(\"body\").trigger(\"dim\");\r\n\t$(\"body\").addClass(dimmingClass).addClass(dimmedClass);\r\n\tvar backgroundLayer = $(\"<div/>\")\r\n\t\t.addClass(backgroundDimmerClass)\r\n\t\t.appendTo(\"body\");\r\n\tnoinput && backgroundLayer.addClass(\"noinput\");\r\n\tforceReflow();\r\n\tbackgroundLayer.css(\"opacity\", \"1\");\r\n}\r\n\r\n// Removes the overlay from the document. The overlay is already click-through during its\r\n// fade-out transition.\r\nexport function undimBackground() {\r\n\tvar backgroundLayer = $(\"body > div.\" + backgroundDimmerClass);\r\n\tif (backgroundLayer.length === 0) return;   // Not there\r\n\tdimCount--;\r\n\tif (dimCount > 0) return false;   // Not the last one, keep it dimmed\r\n\tvar $body = $(\"body\");\r\n\t$body.removeClass(dimmedClass);\r\n\tbackgroundLayer.addClass(\"closing\").css(\"opacity\", \"0\");\r\n\tbackgroundLayer.on(\"transitionend\", function () {\r\n\t\tif (!$body.hasClass(dimmedClass)) {\r\n\t\t\t// No other layer appeared in the meantime\r\n\t\t\t$body.removeClass(dimmingClass);\r\n\t\t\t$(\"body\").trigger(\"undim\");\r\n\t\t}\r\n\t\tbackgroundLayer.remove();\r\n\t});\r\n\treturn true;\r\n}\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\nimport { dimBackground, undimBackground } from \"../dimmer\";\r\n\r\nvar modalEventNamespace = \".ff-modal\";\r\nvar modalClass = \"ff-modal-container\";\r\nvar modalCloseButtonClass = \"ff-modal-close-button\";\r\n\r\nvar modalLevel = 0;\r\n\r\n// Defines default options for the modal plugin.\r\nvar modalDefaults = {\r\n\t// Indicates whether the modal is closed when clicking anywhere outside of it or pressing Esc.\r\n\t// This also shows a close button in the model overlay. Default: true.\r\n\tcancellable: true,\r\n\t\r\n\t// The tooltip text for the close button. Default: empty.\r\n\tcloseTooltip: \"\",\r\n\t\r\n\t// Indicates whether the page background is dimmed while the modal is open. Default: true.\r\n\tdimBackground: true\r\n};\r\n\r\n// Opens a modal with the selected element.\r\nfunction modal(options) {\r\n\tvar modal = this.first();\r\n\tif (modal.length === 0) return this;   // Nothing to do\r\n\tif (modal.parent().hasClass(modalClass)) return this;   // Already open\r\n\tmodalLevel++;\r\n\tvar opt = initOptions(\"modal\", modalDefaults, modal, {}, options);\r\n\topt.level = modalLevel;\r\n\tif (opt.dimBackground && modalLevel === 1)\r\n\t\tdimBackground();\r\n\r\n\tvar container = $(\"<div/>\").addClass(modalClass).appendTo(\"body\");\r\n\tmodal.appendTo(container);\r\n\tmodal.find(\":focusable\").first().focus().blur();\r\n\r\n\tif (modalLevel === 1)\r\n\t\tpreventScrolling();\r\n\r\n\t// Prevent moving the focus out of the modal\r\n\t$(document).on(\"focusin\" + modalEventNamespace + \"-\" + opt.level, function (event) {\r\n\t\tif (opt.level === modalLevel) {\r\n\t\t\t// This is the top-most modal now, handle the focus event\r\n\t\t\tif ($(event.target).parents().filter(modal).length === 0) {\r\n\t\t\t\t// The focused element's ancestors do not include the modal, so the focus went out\r\n\t\t\t\t// of the modal. Bring it back.\r\n\t\t\t\tmodal.find(\":focusable\").first().focus();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tvar closeButton;\r\n\tif (opt.cancellable) {\r\n\t\t// Close on pressing the Escape key or clicking outside the modal\r\n\t\t$(document).on(\"keydown\" + modalEventNamespace + \"-\" + opt.level, function (event) {\r\n\t\t\tif (event.keyCode === 27) {   // Escape\r\n\t\t\t\tif (modalLevel === opt.level) {   // There might be another modal on top\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tmodal.modal.close();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tcontainer.click(function (event) {\r\n\t\t\tif (event.button === 0 && event.target === this) {\r\n\t\t\t\tmodal.modal.close();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Add default close button\r\n\t\tcloseButton = $(\"<a/>\").addClass(modalCloseButtonClass).attr(\"href\", \"#\").appendTo(modal);\r\n\t\tif (opt.closeTooltip)\r\n\t\t\tcloseButton[0].title = opt.closeTooltip;\r\n\t\tcloseButton.click(function (event) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tmodal.modal.close();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn this;\r\n}\r\n\r\n// Closes the selected modal.\r\nfunction closeModal() {\r\n\tvar modal = this.first();\r\n\tif (modal.length === 0) return this;   // Nothing to do\r\n\tvar container = modal.parent();\r\n\tif (!container.hasClass(modalClass)) return this;   // Modal is not open\r\n\tmodalLevel--;\r\n\tvar opt = loadOptions(\"modal\", modal);\r\n\tvar closeButton = modal.find(\".\" + modalCloseButtonClass).first();\r\n\r\n\tif (!modalLevel)\r\n\t\tpreventScrolling(false);\r\n\t$(document).off(\"focusin\" + modalEventNamespace + \"-\" + opt.level);\r\n\t$(document).off(\"keydown\" + modalEventNamespace + \"-\" + opt.level);\r\n\tmodal.appendTo(\"body\");\r\n\tcontainer.remove();\r\n\tif (closeButton)\r\n\t\tcloseButton.remove();\r\n\tif (opt.dimBackground && !modalLevel)\r\n\t\tundimBackground();\r\n\r\n\tlet event = $.Event(\"close\");\r\n\tmodal.trigger(event);\r\n\treturn this;\r\n}\r\n\r\nregisterPlugin(\"modal\", modal, {\r\n\tclose: closeModal\r\n});\r\n$.fn.modal.defaults = modalDefaults;\r\n\r\n// Shows a standard message box modal with content and buttons.\r\n//\r\n// options.content: (jQuery) The message content to display.\r\n// options.html: (String) The message HTML content to display.\r\n// options.text: (String) The message text to display.\r\n// options.buttons: (Array) The buttons to display in the modal.\r\n// options.buttons[].text: (String) The button text.\r\n// options.buttons[].icon: (String) The CSS class of an <i> element displayed before the text.\r\n// options.buttons[].className: (String) Additional CSS classes for the button.\r\n// options.buttons[].result: The result value of the button.\r\n// options.resultHandler: (Function) The modal response handler. It is passed the button handler's return value, or false if cancelled.\r\n//\r\n// If a string is passed as first argument, it is displayed as text with an OK button.\r\n$.modal = function (options) {\r\n\tif (typeof options === \"string\") {\r\n\t\toptions = {\r\n\t\t\ttext: options,\r\n\t\t\tbuttons: \"OK\"\r\n\t\t};\r\n\t}\r\n\t\r\n\tlet modal = $(\"<div/>\")\r\n\t\t.addClass(\"modal\");\r\n\tlet content = $(\"<div/>\")\r\n\t\t.css(\"overflow\", \"auto\")\r\n\t\t.css(\"max-height\", \"calc(100vh - 80px - 5em)\")   // padding of modal, height of buttons\r\n\t\t.appendTo(modal);\r\n\tif (options.content)\r\n\t\tcontent.append(options.content);\r\n\telse if (options.html)\r\n\t\tcontent.html(options.html);\r\n\telse if (options.text)\r\n\t\tcontent.text(options.text).css(\"white-space\", \"pre-wrap\");\r\n\r\n\tlet buttons = options.buttons;\r\n\tif (typeof buttons === \"string\") {\r\n\t\tswitch (buttons) {\r\n\t\t\tcase \"OK\":\r\n\t\t\t\tbuttons = [\r\n\t\t\t\t\t{ text: \"OK\", className: \"default\", result: true }\r\n\t\t\t\t];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"OK cancel\":\r\n\t\t\t\tbuttons = [\r\n\t\t\t\t\t{ text: \"OK\", className: \"default\", result: true },\r\n\t\t\t\t\t{ text: \"Cancel\", className: \"transparent\", result: false }\r\n\t\t\t\t];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"YES no\":\r\n\t\t\t\tbuttons = [\r\n\t\t\t\t\t{ text: \"Yes\", className: \"default\", result: true },\r\n\t\t\t\t\t{ text: \"No\", result: false }\r\n\t\t\t\t];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"yes NO\":\r\n\t\t\t\tbuttons = [\r\n\t\t\t\t\t{ text: \"Yes\", result: true },\r\n\t\t\t\t\t{ text: \"No\", className: \"default\", result: false }\r\n\t\t\t\t];\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbuttons = [];\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tlet buttonsElement;\r\n\tlet buttonPressed = false;\r\n\tif (buttons && buttons.length > 0) {\r\n\t\tbuttonsElement = $(\"<div/>\")\r\n\t\t\t.addClass(\"buttons\")\r\n\t\t\t.appendTo(modal);\r\n\t\tbuttons.forEach(function (button) {\r\n\t\t\tlet buttonElement = $(\"<button/>\")\r\n\t\t\t\t.addClass(button.className)\r\n\t\t\t\t.appendTo(buttonsElement);\r\n\t\t\tif (button.icon)\r\n\t\t\t\tbuttonElement.append($(\"<i/>\").addClass(button.icon));\r\n\t\t\tif (button.icon && button.text)\r\n\t\t\t\tbuttonElement.append(\" \");\r\n\t\t\tif (button.text)\r\n\t\t\t\tbuttonElement.append(button.text);\r\n\t\t\tbuttonElement.click(function (event) {\r\n\t\t\t\tbuttonPressed = true;\r\n\t\t\t\tmodal.modal.close();\r\n\t\t\t\tif (options.resultHandler)\r\n\t\t\t\t\toptions.resultHandler(button.result);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\tmodal.modal(options);\r\n\tif (buttonsElement)\r\n\t\tbuttonsElement.find(\"button\").first().focus();\r\n\tif (options.resultHandler) {\r\n\t\tmodal.on(\"close\", function () {\r\n\t\t\tif (!buttonPressed)\r\n\t\t\t\toptions.resultHandler();\r\n\t\t});\r\n\t}\r\n}\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\nimport { dimBackground, undimBackground } from \"../dimmer\";\r\n\r\nvar offCanvasEventNamespace = \".ff-off-canvas\";\r\nvar offCanvasClass = \"ff-off-canvas\";\r\n\r\n// Defines default options for the off-canvas plugin.\r\nvar offCanvasDefaults = {\r\n\t// Indicates whether the user can close the off-canvas panel by clicking anywhere outside of it or pressing the Escape key. Default: true.\r\n\tcancellable: true,\r\n\r\n\t// The side from which the off-canvas opens (left, right). Default: left.\r\n\tedge: \"left\",\r\n\r\n\t// Push the page content to the side when showing the off-canvas panel. Default: 1.\r\n\t// 0 doesn't push, 1 pushes the full panel width.\r\n\tpush: 1\r\n};\r\n\r\n// Opens an off-canvas with the selected element.\r\nfunction offCanvas(options) {\r\n\tvar offCanvas = this.first();\r\n\tif (offCanvas.length === 0) return this;   // Nothing to do\r\n\tif (offCanvas.hasClass(offCanvasClass)) return this;   // Already open\r\n\tvar opt = initOptions(\"offCanvas\", offCanvasDefaults, offCanvas, {}, options);\r\n\r\n\toffCanvas.addClass(offCanvasClass);\r\n\toffCanvas.detach().appendTo(\"body\");\r\n\r\n\tif ([\"left\", \"right\"].indexOf(opt.edge) === -1)\r\n\t\topt.edge = \"left\";\r\n\tif (opt.edge === \"left\") opt._opposite = \"right\";\r\n\telse if (opt.edge === \"right\") opt._opposite = \"left\";\r\n\r\n\tvar html = $(\"html\");\r\n\tvar width = offCanvas.outerWidth();\r\n\r\n\topt._htmlStyle = {\r\n\t\ttransition: html.css(\"transition\"),\r\n\t\toverflowX: html.css(\"overflow-x\")\r\n\t};\r\n\r\n\t$(window).on(\"resize\" + offCanvasEventNamespace, function () {\r\n\t\toffCanvas.offCanvas.close();\r\n\t});\r\n\r\n\t//$(window).on(\"resize\" + offCanvasEventNamespace, function () {   // TODO Failing workaround for Chrome/Android, see https://bugs.chromium.org/p/chromium/issues/detail?id=801621\r\n\t//\toffCanvas.css(\"height\", $(window).height());\r\n\t//});\r\n\t//offCanvas.css(\"height\", $(window).height());\r\n\r\n\t// Initialise position\r\n\toffCanvas.css(opt.edge, -width);\r\n\toffCanvas.css(opt._opposite, \"\");\r\n\tforceReflow();\r\n\toffCanvas.css(\"transition\", opt.edge + \" 0.4s\");\r\n\thtml.css(\"transition\", \"margin 0.4s\");\r\n\thtml.css(\"overflow-x\", \"hidden\");\r\n\r\n\t// Now start the transition to the opened state\r\n\toffCanvas.css(opt.edge, 0);\r\n\thtml.css(\"margin-\" + opt.edge, width * opt.push);\r\n\thtml.css(\"margin-\" + opt._opposite, -width * opt.push);\r\n\r\n\tdimBackground(true);\r\n\r\n\toffCanvas.find(\":focusable\").first().focus().blur();\r\n\r\n\tpreventScrolling();\r\n\r\n\t// Prevent moving the focus out of the offCanvas\r\n\t$(document).on(\"focusin\" + offCanvasEventNamespace, function (event) {\r\n\t\tif ($(event.target).parents().filter(offCanvas).length === 0) {\r\n\t\t\t// The focused element's ancestors do not include the offCanvas, so the focus went out\r\n\t\t\t// of the offCanvas. Bring it back.\r\n\t\t\toffCanvas.find(\":focusable\").first().focus();\r\n\t\t\tevent.preventDefault();\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\t// Close on pressing the Escape key or clicking outside the offCanvas\r\n\tif (opt.cancellable) {\r\n\t\t$(document).on(\"keydown\" + offCanvasEventNamespace, function (event) {\r\n\t\t\tif (event.keyCode === 27) {   // Escape\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\toffCanvas.offCanvas.close();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsetTimeout(function () {\r\n\t\t\t$(document).on(\"click\" + offCanvasEventNamespace, function (event) {\r\n\t\t\t\tif (event.button === 0) {\r\n\t\t\t\t\toffCanvas.offCanvas.close();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}, 20);\r\n\t\toffCanvas.on(\"click\" + offCanvasEventNamespace, function (event) {\r\n\t\t\t// Don't close the off-canvas when clicking inside of it\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t});\r\n\t}\r\n\r\n\toffCanvas.trigger(\"offcanvasopen\");\r\n\treturn this;\r\n}\r\n\r\n// Closes the selected off-canvas.\r\nfunction closeOffCanvas() {\r\n\tvar offCanvas = this.first();\r\n\tif (offCanvas.length === 0) return this;   // Nothing to do\r\n\tif (!offCanvas.hasClass(offCanvasClass)) return this;   // offCanvas is not open\r\n\tvar opt = loadOptions(\"offCanvas\", offCanvas);\r\n\r\n\tvar html = $(\"html\");\r\n\tvar width = offCanvas.outerWidth();\r\n\r\n\t// Start the transition back to the closed state\r\n\toffCanvas.css(opt.edge, -width);\r\n\thtml.css(\"margin-\" + opt.edge, 0);\r\n\thtml.css(\"margin-\" + opt._opposite, 0);\r\n\r\n\tpreventScrolling(false);\r\n\t$(document).off(\"focusin\" + offCanvasEventNamespace);\r\n\t$(document).off(\"keydown\" + offCanvasEventNamespace);\r\n\t$(document).off(\"click\" + offCanvasEventNamespace);\r\n\t$(window).off(\"resize\" + offCanvasEventNamespace);\r\n\toffCanvas.off(\"click\" + offCanvasEventNamespace);\r\n\tundimBackground();\r\n\toffCanvas.one(\"transitionend\", function () {\r\n\t\toffCanvas.removeClass(offCanvasClass);\r\n\t\thtml.css(opt._htmlStyle);\r\n\t});\r\n\toffCanvas.trigger(\"offcanvasclose\");\r\n\treturn this;\r\n}\r\n\r\nregisterPlugin(\"offCanvas\", offCanvas, {\r\n\tclose: closeOffCanvas\r\n});\r\n$.fn.offCanvas.defaults = offCanvasDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow } from \"../util\";\r\n\r\nvar progressbarClass = \"ff-progressbar\";\r\n\r\n// Defines default options for the progressbar plugin.\r\nvar progressbarDefaults = {\r\n\t// The minimum value of the progress bar. Default: 0.\r\n\tmin: 0,\r\n\r\n\t// The maximum value of the progress bar. Default: 100.\r\n\tmax: 100,\r\n\t\r\n\t// The current progress value. Default: 0.\r\n\tvalue: 0,\r\n\t\r\n\t// The string to display before the value in the progress bar. Default: \"\".\r\n\tvaluePrefix: \"\",\r\n\t\r\n\t// The string to display after the value in the progress bar. Default: \"\".\r\n\tvalueSuffix: \"\"\r\n};\r\n\r\n// Shows a progressbar on the element.\r\nfunction progressbar(options) {\r\n\treturn this.each(function () {\r\n\t\tvar $elem = $(this);\r\n\t\tif ($elem.hasClass(progressbarClass)) return;   // Already done\r\n\t\t$elem.addClass(progressbarClass);\r\n\t\tvar opt = initOptions(\"progressbar\", progressbarDefaults, $elem, {}, options);\r\n\t\topt._setValue = setValue;\r\n\r\n\t\tlet bar = $(\"<div/>\")\r\n\t\t\t.addClass(\"ff-bar\")\r\n\t\t\t.appendTo($elem);\r\n\t\tlet number = $(\"<span/>\")\r\n\t\t\t.appendTo(bar);\r\n\t\tsetValue(opt.value);\r\n\t\t\r\n\t\t// Sets a progress bar value and triggers the change event.\r\n\t\tfunction setValue(value) {\r\n\t\t\tvalue = minmax(value, opt.min, opt.max);\r\n\t\t\tlet relWidth = (value - opt.min) / (opt.max - opt.min);\r\n\t\t\tbar.css(\"width\", (relWidth * 100) + \"%\");\r\n\t\t\tnumber.text(opt.valuePrefix + value + opt.valueSuffix);\r\n\t\t\tnumber.toggleClass(\"outside\", number.width() + 8 > relWidth * $elem.width());\r\n\t\t\t\r\n\t\t\tif (value !== opt.value) {\r\n\t\t\t\topt.value = value;\r\n\t\t\t\t$elem.trigger(\"valuechange\");\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Gets the current progress bar value.\r\n//\r\n// value: Sets the progress value.\r\nfunction progressbarValue(value) {\r\n\t// Getter\r\n\tif (value === undefined) {\r\n\t\tvar progressbar = this.first();\r\n\t\tif (progressbar.length === 0) return;   // Nothing to do\r\n\t\tvar opt = loadOptions(\"progressbar\", progressbar);\r\n\t\treturn opt.value;\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar progressbar = $(this);\r\n\t\tvar opt = loadOptions(\"progressbar\", progressbar);\r\n\t\topt._setValue(value);\r\n\t});\r\n}\r\n\r\n// Gets the value prefix.\r\n//\r\n// prefix: Sets the value prefix.\r\nfunction valuePrefix(prefix) {\r\n\t// Getter\r\n\tif (prefix === undefined) {\r\n\t\tvar progressbar = this.first();\r\n\t\tif (progressbar.length === 0) return;   // Nothing to do\r\n\t\tvar opt = loadOptions(\"progressbar\", progressbar);\r\n\t\treturn opt.valuePrefix;\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar progressbar = $(this);\r\n\t\tvar opt = loadOptions(\"progressbar\", progressbar);\r\n\t\topt.valuePrefix = prefix;\r\n\t\topt._setValue(opt.value);\r\n\t});\r\n}\r\n\r\n// Gets the value suffix.\r\n//\r\n// suffix: Sets the value suffix.\r\nfunction valueSuffix(suffix) {\r\n\t// Getter\r\n\tif (suffix === undefined) {\r\n\t\tvar progressbar = this.first();\r\n\t\tif (progressbar.length === 0) return;   // Nothing to do\r\n\t\tvar opt = loadOptions(\"progressbar\", progressbar);\r\n\t\treturn opt.valueSuffix;\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar progressbar = $(this);\r\n\t\tvar opt = loadOptions(\"progressbar\", progressbar);\r\n\t\topt.valueSuffix = suffix;\r\n\t\topt._setValue(opt.value);\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"progressbar\", progressbar, {\r\n\tvalue: progressbarValue,\r\n\tvaluePrefix: valuePrefix,\r\n\tvalueSuffix: valueSuffix\r\n});\r\n$.fn.progressbar.defaults = progressbarDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, installDisabledchangeHook } from \"../util\";\r\n\r\nvar resizableClass = \"ff-resizable\";\r\n\r\n// Defines default options for the resizable plugin.\r\nvar resizableDefaults = {\r\n\t// The aspect ratio (x/y) to maintain during resizing, or true to maintain the initial aspect ratio. Default: None.\r\n\taspectRatio: undefined,\r\n\r\n\t// The resizing handles to use. Can be \"all\" or a combination of \"n,ne,e,se,s,sw,w,nw\". Default: All.\r\n\thandles: undefined,\r\n\t\r\n\t// The width of the default handles. Default: 10.\r\n\thandleWidth: 10,\r\n\r\n\t// Constrains the resizing inside the specified element or the \"parent\" of the resized element or the \"viewport\". Default: None.\r\n\tcontainment: undefined,\r\n\r\n\t// The grid to snap the resized element to during resizing, as [x, y] in pixels. Default: [1, 1].\r\n\tgrid: undefined,\r\n\r\n\t// The minimum width to keep during resizing. Default: None.\r\n\tminWidth: undefined,\r\n\r\n\t// The minimum height to keep during resizing. Default: None.\r\n\tminHeight: undefined,\r\n\r\n\t// The maximum width to keep during resizing. Default: None.\r\n\tmaxWidth: undefined,\r\n\r\n\t// The maximum height to keep during resizing. Default: None.\r\n\tmaxHeight: undefined,\r\n\r\n\t// Indicates whether the window should scroll to keep the resized edge visible. Default: false.\r\n\tscroll: false\r\n};\r\n\r\n// Makes each selected element resizable.\r\nfunction resizable(options) {\r\n\treturn this.each(function () {\r\n\t\tvar elem = this;\r\n\t\tvar $elem = $(elem);\r\n\t\tif ($elem.hasClass(resizableClass)) return;   // Already done\r\n\t\t$elem.addClass(resizableClass);\r\n\t\tvar htmlCursor;\r\n\t\tvar handleElements = $();\r\n\t\tvar opt = initOptions(\"resizable\", resizableDefaults, $elem, {}, options);\r\n\t\tlet $window = $(window);\r\n\r\n\t\tvar aspectRatio = opt.aspectRatio;\r\n\t\tif (aspectRatio === true || aspectRatio === \"true\") aspectRatio = $elem.outerWidth() / $elem.outerHeight();\r\n\t\tif ($.isNumeric(aspectRatio)) aspectRatio = parseFloat(aspectRatio);\r\n\t\tif (aspectRatio === 0 || !isFinite(aspectRatio) || !$.isNumber(aspectRatio)) aspectRatio = undefined;\r\n\r\n\t\tif ($elem.css(\"position\") === \"static\") {\r\n\t\t\topt.wasPositionStatic = true;\r\n\t\t\t$elem.css(\"position\", \"relative\");\r\n\t\t}\r\n\r\n\t\tvar optHandles = opt.handles;\r\n\t\tif (optHandles === undefined)\r\n\t\t\toptHandles = \"all\";\r\n\t\tif (optHandles === \"all\")\r\n\t\t\toptHandles = \"n,ne,e,se,s,sw,w,nw\";\r\n\t\tif ($.isString(optHandles))\r\n\t\t\toptHandles = optHandles.replace(/\\s/g, \"\").toLowerCase().split(\",\");\r\n\t\topt.handles = optHandles;\r\n\r\n\t\tvar vCursor = \"ns-resize\";\r\n\t\tvar hCursor = \"ew-resize\";\r\n\t\tvar nwCursor = \"nwse-resize\";\r\n\t\tvar neCursor = \"nesw-resize\";\r\n\r\n\t\tif (opt.handleAddClass === \"box\") {\r\n\t\t\tif (optHandles.indexOf(\"n\") !== -1)\r\n\t\t\t\taddHandle({ left: \"calc(50% - 4px)\", top: -9 }, vCursor, true, true);   // Top edge\r\n\t\t\tif (optHandles.indexOf(\"e\") !== -1)\r\n\t\t\t\taddHandle({ right: -9, top: \"calc(50% - 4px)\" }, hCursor, false, false);   // Right edge\r\n\t\t\tif (optHandles.indexOf(\"s\") !== -1)\r\n\t\t\t\taddHandle({ left: \"calc(50% - 4px)\", bottom: -9 }, vCursor, true, false);   // Bottom edge\r\n\t\t\tif (optHandles.indexOf(\"w\") !== -1)\r\n\t\t\t\taddHandle({ left: -9, top: \"calc(50% - 4px)\" }, hCursor, false, true);   // Left edge\r\n\r\n\t\t\tif (optHandles.indexOf(\"ne\") !== -1)\r\n\t\t\t\taddHandle({ top: -9, right: -9 }, neCursor, false, false, true, true);   // Top right corner\r\n\t\t\tif (optHandles.indexOf(\"se\") !== -1)\r\n\t\t\t\taddHandle({ bottom: -9, right: -9 }, nwCursor, false, false, true, false);   // Bottom right corner\r\n\t\t\tif (optHandles.indexOf(\"sw\") !== -1)\r\n\t\t\t\taddHandle({ bottom: -9, left: -9 }, neCursor, false, true, true, false);   // Bottom left corner\r\n\t\t\tif (optHandles.indexOf(\"nw\") !== -1)\r\n\t\t\t\taddHandle({ top: -9, left: -9 }, nwCursor, false, true, true, true);   // Top left corner\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet w = opt.handleWidth;\r\n\t\t\tif (optHandles.indexOf(\"n\") !== -1)\r\n\t\t\t\taddHandle({ left: w / 2, right: w / 2, top: -w / 2, height: w }, vCursor, true, true);   // Top edge\r\n\t\t\tif (optHandles.indexOf(\"e\") !== -1)\r\n\t\t\t\taddHandle({ top: w / 2, bottom: w / 2, right: -w / 2, width: w }, hCursor, false, false);   // Right edge\r\n\t\t\tif (optHandles.indexOf(\"s\") !== -1)\r\n\t\t\t\taddHandle({ left: w / 2, right: w / 2, bottom: -w / 2, height: w }, vCursor, true, false);   // Bottom edge\r\n\t\t\tif (optHandles.indexOf(\"w\") !== -1)\r\n\t\t\t\taddHandle({ top: w / 2, bottom: w / 2, left: -w / 2, width: w }, hCursor, false, true);   // Left edge\r\n\r\n\t\t\tif (optHandles.indexOf(\"ne\") !== -1)\r\n\t\t\t\taddHandle({ right: -w / 2, top: -w / 2, width: w, height: w }, neCursor, false, false, true, true);   // Top right corner\r\n\t\t\tif (optHandles.indexOf(\"se\") !== -1)\r\n\t\t\t\taddHandle({ right: -w / 2, bottom: -w / 2, width: w, height: w }, nwCursor, false, false, true, false);   // Bottom right corner\r\n\t\t\tif (optHandles.indexOf(\"sw\") !== -1)\r\n\t\t\t\taddHandle({ left: -w / 2, bottom: -w / 2, width: w, height: w }, neCursor, false, true, true, false);   // Bottom left corner\r\n\t\t\tif (optHandles.indexOf(\"nw\") !== -1)\r\n\t\t\t\taddHandle({ left: -w / 2, top: -w / 2, width: w, height: w }, nwCursor, false, true, true, true);   // Top left corner\r\n\t\t}\r\n\r\n\t\tinstallDisabledchangeHook();\r\n\t\t$elem.on(\"disabledchange.resizable\", function () {\r\n\t\t\thandleElements.visible(!$elem.disabled());\r\n\t\t});\r\n\r\n\t\tfunction addHandle(style, cursor, vertical, negative, vertical2, negative2) {\r\n\t\t\tvar handle = $(\"<div/>\")\r\n\t\t\t\t.addClass(\"ff-resizable-handle \" + opt.handleAddClass)\r\n\t\t\t\t.css(style)\r\n\t\t\t\t.css(\"position\", \"absolute\")\r\n\t\t\t\t.css(\"cursor\", cursor);\r\n\t\t\t$elem.append(handle);\r\n\t\t\thandleElements = handleElements.add(handle);\r\n\t\t\thandle.draggable({ scroll: opt.scroll });\r\n\t\t\thandle.on(\"draggablestart\", function (event) {\r\n\t\t\t\tevent.stopPropagation();   // Don't trigger for the resized (parent) element\r\n\t\t\t\tlet event2 = $.Event(\"resizablestart\");\r\n\t\t\t\tevent2.vertical = vertical;\r\n\t\t\t\tevent2.negative = negative;\r\n\t\t\t\tevent2.edge = vertical ? (negative ? \"top\" : \"bottom\") : (negative ? \"left\" : \"right\");\r\n\t\t\t\t$elem.trigger(event2);\r\n\t\t\t\tif (!event2.isDefaultPrevented()) {\r\n\t\t\t\t\thtmlCursor = document.documentElement.style.getPropertyValue(\"cursor\");\r\n\t\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", cursor, \"important\");\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\thandle.on(\"draggablemove\", function (event) {\r\n\t\t\t\tevent.stopPropagation();   // Don't trigger for the resized (parent) element\r\n\t\t\t\tevent.preventDefault();   // The handles already move with the element, don't touch their position\r\n\t\t\t\tresize(handle, event.newPoint, vertical, negative);\r\n\t\t\t\tif (vertical2 !== undefined)\r\n\t\t\t\t\tresize(handle, event.newPoint, vertical2, negative2);\r\n\t\t\t});\r\n\t\t\thandle.on(\"draggableend\", function (event) {\r\n\t\t\t\tevent.stopPropagation();   // Don't trigger for the resized (parent) element\r\n\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", htmlCursor);\r\n\t\t\t\tlet event2 = $.Event(\"resizableend\");\r\n\t\t\t\tevent2.vertical = vertical;\r\n\t\t\t\tevent2.negative = negative;\r\n\t\t\t\tevent2.edge = vertical ? (negative ? \"top\" : \"bottom\") : (negative ? \"left\" : \"right\");\r\n\t\t\t\t$elem.trigger(event2);\r\n\t\t\t});\r\n\t\t\treturn handle;\r\n\t\t}\r\n\r\n\t\tfunction resize(handle, newPoint, vertical, negative) {\r\n\t\t\tvar side = vertical ? \"top\" : \"left\";\r\n\t\t\tvar extent = vertical ? \"Height\" : \"Width\";\r\n\t\t\tvar extentLower = extent.toLowerCase();\r\n\t\t\tvar delta = newPoint[side] - handle.offset()[side];\r\n\t\t\tif (negative) delta = -delta;\r\n\r\n\t\t\tvar newElemOffset = $elem.offset();\r\n\t\t\tvar step = opt.grid ? opt.grid[vertical ? 1 : 0] : 1;\r\n\r\n\t\t\tif (opt.grid) {\r\n\t\t\t\tlet gridBase = $elem.parent().offset();\r\n\t\t\t\tif (negative) {\r\n\t\t\t\t\tdelta = newElemOffset[side] - (Math.round(((newElemOffset[side] - delta) - gridBase[side]) / step) * step + gridBase[side]);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlet length = $elem[\"outer\" + extent]();\r\n\t\t\t\t\tdelta = Math.round(((newElemOffset[side] + length + delta) - gridBase[side]) / step) * step + gridBase[side] - (newElemOffset[side] + length);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar newLength = $elem[\"outer\" + extent]() + delta;\r\n\r\n\t\t\tlet minLength = Math.max($elem[\"outer\" + extent]() - $elem[extentLower](), opt[\"min\" + extent] || 0);\r\n\t\t\twhile (newLength < minLength) {\r\n\t\t\t\tdelta += step;\r\n\t\t\t\tnewLength += step;\r\n\t\t\t}\r\n\t\t\tlet maxLength = opt[\"max\" + extent];\r\n\t\t\twhile (maxLength && newLength > maxLength) {\r\n\t\t\t\tdelta -= step;\r\n\t\t\t\tnewLength -= step;\r\n\t\t\t}\r\n\r\n\t\t\tif (negative) newElemOffset[side] -= delta;\r\n\r\n\t\t\tif (opt.containment) {\r\n\t\t\t\tlet cont, contRect;\r\n\t\t\t\tif (opt.containment === \"parent\") {\r\n\t\t\t\t\tcont = $elem.parent();\r\n\t\t\t\t}\r\n\t\t\t\telse if (opt.containment === \"viewport\") {\r\n\t\t\t\t\tlet scrollTop = $window.scrollTop();\r\n\t\t\t\t\tlet scrollLeft = $window.scrollLeft();\r\n\t\t\t\t\tcontRect = {\r\n\t\t\t\t\t\ttop: 0 + scrollTop,\r\n\t\t\t\t\t\tleft: 0 + scrollLeft,\r\n\t\t\t\t\t\theight: $window.height(),\r\n\t\t\t\t\t\twidth: $window.width()\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tcont = $(opt.containment);\r\n\t\t\t\t}\r\n\t\t\t\tif (cont && cont.length > 0) {\r\n\t\t\t\t\tcontRect = cont.rect();\r\n\t\t\t\t}\r\n\t\t\t\tif (contRect) {\r\n\t\t\t\t\tif (negative) {\r\n\t\t\t\t\t\twhile (newElemOffset[side] < contRect[side]) {\r\n\t\t\t\t\t\t\tnewElemOffset[side] += step;\r\n\t\t\t\t\t\t\tdelta -= step;\r\n\t\t\t\t\t\t\tnewLength -= step;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\twhile (newElemOffset[side] + newLength > contRect[side] + contRect[extentLower]) {\r\n\t\t\t\t\t\t\tdelta -= step;\r\n\t\t\t\t\t\t\tnewLength -= step;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet event2 = $.Event(\"resizing\");\r\n\t\t\tevent2.vertical = vertical;\r\n\t\t\tevent2.negative = negative;\r\n\t\t\tevent2.edge = vertical ? (negative ? \"top\" : \"bottom\") : (negative ? \"left\" : \"right\");\r\n\t\t\tevent2.newLength = newLength;\r\n\t\t\tevent2.newPosition = newElemOffset[side];\r\n\t\t\t$elem.trigger(event2);\r\n\t\t\tif (!event2.isDefaultPrevented()) {\r\n\t\t\t\t$elem[\"outer\" + extent](event2.newLength);\r\n\t\t\t\tnewElemOffset[side] = event2.newPosition;\r\n\t\t\t\tif (negative) $elem.offset(newElemOffset);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Removes the resizing features from the elements.\r\nfunction remove() {\r\n\treturn this.each(function () {\r\n\t\tvar elem = this;\r\n\t\tvar $elem = $(elem);\r\n\t\tif (!$elem.hasClass(resizableClass)) return;\r\n\t\t$elem.removeClass(resizableClass);\r\n\t\tvar opt = loadOptions(\"resizable\", $elem);\r\n\t\tif (opt.wasPositionStatic)\r\n\t\t\t$elem.css(\"position\", \"static\");\r\n\t\t$elem.find(\".ff-resizable-handle\").remove();\r\n\t\t$elem.off(\"disabledchange.resizable\");\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"resizable\", resizable, {\r\n\tremove: remove\r\n});\r\n$.fn.resizable.defaults = resizableDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow } from \"../util\";\r\n\r\nvar selectableClass = \"ff-selectable\";\r\n\r\n// Defines default options for the selectable plugin.\r\nvar selectableDefaults = {\r\n\t// Indicates whether multiple items can be selected. Default: false.\r\n\tmultiple: false,\r\n\r\n\t// Indicates whether a single click toggles the selection of an item. Default: false.\r\n\ttoggle: false,\r\n\r\n\t// Indicates whether the selection can be empty (only if multiple or toggle is true). Default: true.\r\n\tallowEmpty: true,\r\n\r\n\t// The separator for multi-select dropdown lists. Default: \", \"\r\n\tseparator: \", \"\r\n};\r\n\r\n// Makes the child elements in each selected element selectable.\r\nfunction selectable(options) {\r\n\treturn this.each(function () {\r\n\t\tvar elem = $(this);\r\n\t\tif (elem.hasClass(selectableClass)) return;   // Already done\r\n\t\telem.addClass(selectableClass);\r\n\t\tvar opt = initOptions(\"selectable\", selectableDefaults, elem, {}, options);\r\n\t\topt._prepareChild = prepareChild;\r\n\t\topt._selectAll = selectAll;\r\n\t\topt._selectNone = selectNone;\r\n\r\n\t\tlet replaceHtmlSelect = elem[0].nodeName === \"SELECT\";\r\n\t\tlet useDropdown = replaceHtmlSelect && !elem.attr(\"size\");\r\n\t\tlet htmlSelect, button;\r\n\t\tlet htmlSelectChanging;\r\n\t\tlet blurCloseTimeout;\r\n\t\t\r\n\t\tif (replaceHtmlSelect) {\r\n\t\t\thtmlSelect = elem;\r\n\t\t\tlet origStyle = elem.attr(\"style\");\r\n\t\t\thtmlSelect.hide();\r\n\t\t\topt.multiple |= htmlSelect.attr(\"multiple\") !== undefined;\r\n\t\t\tlet newSelect = $(\"<div/>\")\r\n\t\t\t\t.addClass(selectableClass)\r\n\t\t\t\t.insertAfter(htmlSelect);\r\n\t\t\telem = newSelect;\r\n\t\t\thtmlSelect.data(\"ff-replacement\", newSelect);\r\n\t\t\tupdateFromHtmlSelect();\r\n\t\t\tif (useDropdown) {\r\n\t\t\t\tbutton = $(\"<div/>\")\r\n\t\t\t\t\t.addClass(\"ff-selectable-button\")\r\n\t\t\t\t\t.attr(\"tabindex\", 0)\r\n\t\t\t\t\t.insertAfter(htmlSelect);\r\n\t\t\t\tbutton.attr(\"style\", origStyle);\r\n\t\t\t\tnewSelect.addClass(\"no-border dropdown bordered\");\r\n\t\t\t\thtmlSelect.data(\"ff-replacement\", button);\r\n\t\t\t\tupdateButton();\r\n\t\t\t\tbutton.click(function () {\r\n\t\t\t\t\tif (button.disabled()) return;\r\n\t\t\t\t\tbutton.addClass(\"open\");\r\n\t\t\t\t\tnewSelect.dropdown(button);\r\n\t\t\t\t\tif (button.closest(\".dark\").length > 0)\r\n\t\t\t\t\t\tnewSelect.parent().addClass(\"dark\");   // Set dropdown container to dark\r\n\t\t\t\t\tnewSelect.on(\"dropdownclose\", function () {\r\n\t\t\t\t\t\tbutton.removeClass(\"open\");\r\n\t\t\t\t\t});\r\n\t\t\t\t\tnewSelect.parent(\".ff-dropdown-container\").css(\"min-width\", button.outerWidth());\r\n\t\t\t\t});\r\n\t\t\t\tbutton.on(\"keydown\", function (event) {\r\n\t\t\t\t\t//console.log(event);\r\n\t\t\t\t\tif (button.disabled()) return;\r\n\t\t\t\t\tswitch (event.originalEvent.keyCode) {\r\n\t\t\t\t\t\tcase 13:   // Enter\r\n\t\t\t\t\t\tcase 32:   // Space\r\n\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\tbutton.click();\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 35:   // End\r\n\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\tchangeSelectedIndex(elem.children().length, !!event.originalEvent.shiftKey && opt.multiple);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 36:   // Home\r\n\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\tchangeSelectedIndex(-elem.children().length, !!event.originalEvent.shiftKey && opt.multiple);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 38:   // ArrowUp\r\n\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\tchangeSelectedIndex(-1, !!event.originalEvent.shiftKey && opt.multiple);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 40:   // ArrowDown\r\n\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\tchangeSelectedIndex(1, !!event.originalEvent.shiftKey && opt.multiple);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 65:   // KeyA\r\n\t\t\t\t\t\t\tif (!!event.originalEvent.ctrlKey && !event.originalEvent.shiftKey) {\r\n\t\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\t\tselectAll();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 68:   // KeyD\r\n\t\t\t\t\t\t\tif (!!event.originalEvent.ctrlKey && !event.originalEvent.shiftKey) {\r\n\t\t\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\t\t\tselectNone();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Make the button unfocusable while it is disabled\r\n\t\t\t\tlet onDisabledchange = function () {\r\n\t\t\t\t\tif (button.disabled())\r\n\t\t\t\t\t\tbutton.attr(\"tabindex\", null);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tbutton.attr(\"tabindex\", 0);\r\n\t\t\t\t};\r\n\t\t\t\tbutton.on(\"disabledchange\", onDisabledchange);\r\n\t\t\t\tonDisabledchange();\r\n\r\n\t\t\t\t// Close the dropdown when leaving the field with the Tab key\r\n\t\t\t\t// (but not when clicking an item in the dropdown)\r\n\t\t\t\tbutton.on(\"blur\", function () {\r\n\t\t\t\t\tif (button.hasClass(\"open\") && !blurCloseTimeout) {\r\n\t\t\t\t\t\tblurCloseTimeout = setTimeout(function () {\r\n\t\t\t\t\t\t\tnewSelect.dropdown.close();\r\n\t\t\t\t\t\t\tblurCloseTimeout = undefined;\r\n\t\t\t\t\t\t}, 50);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tbutton.on(\"focus\", function () {\r\n\t\t\t\t\tif (blurCloseTimeout) {\r\n\t\t\t\t\t\t// Clicked on an item, focused back; don't close the dropdown\r\n\t\t\t\t\t\tclearTimeout(blurCloseTimeout);\r\n\t\t\t\t\t\tblurCloseTimeout = undefined;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Apply disabled property where appropriate\r\n\t\t\tif (htmlSelect.disabled()) {\r\n\t\t\t\tif (useDropdown)\r\n\t\t\t\t\tbutton.disable();\r\n\t\t\t\telse\r\n\t\t\t\t\tnewSelect.disable();\r\n\t\t\t}\r\n\r\n\t\t\t// Apply nowrap class where appropriate\r\n\t\t\tif (htmlSelect.hasClass(\"wrap\")) {\r\n\t\t\t\tif (useDropdown)\r\n\t\t\t\t\tbutton.addClass(\"wrap\");\r\n\t\t\t\telse\r\n\t\t\t\t\tnewSelect.addClass(\"wrap\");\r\n\t\t\t}\r\n\r\n\t\t\thtmlSelect.change(function () {\r\n\t\t\t\tif (!htmlSelectChanging) {\r\n\t\t\t\t\tupdateFromHtmlSelect();\r\n\t\t\t\t\telem.children().each(prepareChild);\r\n\t\t\t\t\tlastClickedItem = elem.children(\".selected\").first();\r\n\t\t\t\t\tif (lastClickedItem.length === 0)\r\n\t\t\t\t\t\tlastClickedItem = elem.children(\":not(.disabled)\").first();\r\n\t\t\t\t}\r\n\t\t\t\tif (useDropdown) {\r\n\t\t\t\t\tupdateButton();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\telem.attr(\"tabindex\", 0);\r\n\t\telem.children().each(prepareChild);\r\n\t\tvar lastClickedItem = elem.children(\".selected\").first();\r\n\t\tif (lastClickedItem.length === 0)\r\n\t\t\tlastClickedItem = elem.children(\":not(.disabled)\").first();\r\n\t\tvar lastSelectedItem;\r\n\t\t\r\n\t\telem.on(\"keydown\", function (event) {\r\n\t\t\t//console.log(event);\r\n\t\t\tif (elem.disabled()) return;\r\n\t\t\tswitch (event.originalEvent.keyCode) {\r\n\t\t\t\tcase 35:   // End\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tchangeSelectedIndex(elem.children().length, !!event.originalEvent.shiftKey && opt.multiple);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 36:   // Home\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tchangeSelectedIndex(-elem.children().length, !!event.originalEvent.shiftKey && opt.multiple);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 38:   // ArrowUp\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tchangeSelectedIndex(-1, !!event.originalEvent.shiftKey && opt.multiple);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 40:   // ArrowDown\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tchangeSelectedIndex(1, !!event.originalEvent.shiftKey && opt.multiple);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 65:   // KeyA\r\n\t\t\t\t\tif (!!event.originalEvent.ctrlKey && !event.originalEvent.shiftKey) {\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\tselectAll();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 68:   // KeyD\r\n\t\t\t\t\tif (!!event.originalEvent.ctrlKey && !event.originalEvent.shiftKey) {\r\n\t\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\t\tselectNone();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Sets up event handlers on a selection child (passed as this).\r\n\t\tfunction prepareChild() {\r\n\t\t\tvar child = $(this);\r\n\t\t\tif (child.hasClass(\"disabled\"))\r\n\t\t\t\treturn;\r\n\t\t\tchild.on(\"mousedown\", function (event) {\r\n\t\t\t\tif (event.originalEvent.button === 0) {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tif (useDropdown)\r\n\t\t\t\t\t\t\tbutton.focus();\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\telem.focus();\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tchild.on(\"mouseup\", function (event) {\r\n\t\t\t\tif (useDropdown)\r\n\t\t\t\t\tbutton.focus();\r\n\t\t\t\telse\r\n\t\t\t\t\telem.focus();\r\n\t\t\t\tlet ctrlKey = !!event.originalEvent.ctrlKey;\r\n\t\t\t\tlet shiftKey = !!event.originalEvent.shiftKey;\r\n\t\t\t\tif (!opt.multiple) ctrlKey = shiftKey = false;\r\n\t\t\t\tif (opt.toggle) ctrlKey = true;\r\n\t\t\t\tlet changed = false;\r\n\t\t\t\tif (ctrlKey) {\r\n\t\t\t\t\tchild.toggleClass(\"selected\");\r\n\t\t\t\t\tif (!opt.allowEmpty && elem.children(\".selected\").length === 0) {\r\n\t\t\t\t\t\t// Empty selection not allowed\r\n\t\t\t\t\t\tchild.addClass(\"selected\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tchanged = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlastClickedItem = child;\r\n\t\t\t\t}\r\n\t\t\t\telse if (shiftKey) {\r\n\t\t\t\t\tlet lastIndex = lastClickedItem.index();\r\n\t\t\t\t\tlet currentIndex = child.index();\r\n\t\t\t\t\t// Bring indices in a defined order\r\n\t\t\t\t\tlet i1 = Math.min(lastIndex, currentIndex);\r\n\t\t\t\t\tlet i2 = Math.max(lastIndex, currentIndex);\r\n\t\t\t\t\t// Replace selection with all items between these indices (inclusive)\r\n\t\t\t\t\telem.children().removeClass(\"selected\");\r\n\t\t\t\t\tfor (let i = i1; i <= i2; i++) {\r\n\t\t\t\t\t\tlet c = elem.children().eq(i);\r\n\t\t\t\t\t\tif (!c.hasClass(\"disabled\"))\r\n\t\t\t\t\t\t\tc.addClass(\"selected\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchanged = true;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (!child.hasClass(\"selected\")) {\r\n\t\t\t\t\t\telem.children().removeClass(\"selected\");\r\n\t\t\t\t\t\tchild.addClass(\"selected\");\r\n\t\t\t\t\t\tchanged = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlastClickedItem = child;\r\n\t\t\t\t}\r\n\t\t\t\tlastSelectedItem = child;\r\n\t\t\t\tif (changed) {\r\n\t\t\t\t\telem.trigger(\"selectionchange\");\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (replaceHtmlSelect) {\r\n\t\t\t\t\tupdateHtmlSelect();\r\n\t\t\t\t\tif (useDropdown) {\r\n\t\t\t\t\t\tupdateButton();\r\n\t\t\t\t\t\tif (!(opt.multiple || opt.toggle)) {\r\n\t\t\t\t\t\t\telem.dropdown.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (useDropdown && opt.multiple && !opt.toggle) {\r\n\t\t\t\tchild.on(\"dblclick\", function (event) {\r\n\t\t\t\t\tlet ctrlKey = !!event.originalEvent.ctrlKey;\r\n\t\t\t\t\tlet shiftKey = !!event.originalEvent.shiftKey;\r\n\t\t\t\t\tif (!ctrlKey && !shiftKey) {\r\n\t\t\t\t\t\telem.dropdown.close();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Updates the HTML select element's selection from the UI elements (selected CSS class).\r\n\t\tfunction updateHtmlSelect() {\r\n\t\t\tlet selectedValues = [];\r\n\t\t\telem.children().each$(function (_, child) {\r\n\t\t\t\tif (child.hasClass(\"selected\"))\r\n\t\t\t\t\tselectedValues.push(child.data(\"value\"));\r\n\t\t\t});\r\n\r\n\t\t\thtmlSelectChanging = true;\r\n\t\t\thtmlSelect.children(\"option\").each$(function (_, option) {\r\n\t\t\t\tlet selected = selectedValues.indexOf(option.prop(\"value\")) !== -1;\r\n\t\t\t\toption.prop(\"selected\", selected);\r\n\t\t\t});\r\n\t\t\thtmlSelect.change();\r\n\t\t\thtmlSelectChanging = false;\r\n\t\t}\r\n\r\n\t\t// Recreates the UI list elements from the HTML select options, including their selected\r\n\t\t// state.\r\n\t\tfunction updateFromHtmlSelect() {\r\n\t\t\telem.children().remove();\r\n\t\t\thtmlSelect.children(\"option\").each$(function (_, option) {\r\n\t\t\t\tlet newOption = $(\"<div/>\")\r\n\t\t\t\t\t.text(option.text())\r\n\t\t\t\t\t.data(\"value\", option.prop(\"value\"))\r\n\t\t\t\t\t.appendTo(elem);\r\n\t\t\t\tif (option.data(\"html\"))\r\n\t\t\t\t\tnewOption.html(option.data(\"html\"))\r\n\t\t\t\tif (option.data(\"summary\"))\r\n\t\t\t\t\tnewOption.data(\"summary\", option.data(\"summary\"))\r\n\t\t\t\tif (option.data(\"summary-html\"))\r\n\t\t\t\t\tnewOption.data(\"summary-html\", option.data(\"summary-html\"))\r\n\t\t\t\tif (option.prop(\"selected\"))\r\n\t\t\t\t\tnewOption.addClass(\"selected\");\r\n\t\t\t\tif (option.prop(\"disabled\"))\r\n\t\t\t\t\tnewOption.addClass(\"disabled\");\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Updates the dropdown list button's text from the current selection.\r\n\t\tfunction updateButton() {\r\n\t\t\tlet html = \"\";\r\n\t\t\telem.children(\".selected\").each$(function (_, child) {\r\n\t\t\t\tif (html) html += opt.separator;\r\n\t\t\t\tlet summaryText = child.data(\"summary\");\r\n\t\t\t\tlet summaryHtml = child.data(\"summary-html\");\r\n\t\t\t\tif (summaryHtml)\r\n\t\t\t\t\thtml += summaryHtml;\r\n\t\t\t\telse if (summaryText)\r\n\t\t\t\t\thtml += summaryText.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\r\n\t\t\t\telse\r\n\t\t\t\t\thtml += child.html();\r\n\t\t\t});\r\n\t\t\tif (html) {\r\n\t\t\t\tbutton.html(\"<span>\" + html + \"</span>\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbutton.html(\"&nbsp;\");\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// Moves (and optionally extends) the selected index up or down.\r\n\t\tfunction changeSelectedIndex(offset, extend) {\r\n\t\t\tlet children = elem.children();\r\n\t\t\tlet count = children.length;\r\n\t\t\tif (count > 0 && offset !== 0) {\r\n\t\t\t\tlet index = lastSelectedItem ? lastSelectedItem.index() : lastClickedItem.index();\r\n\t\t\t\tif (offset === -1 || offset === 1) {\r\n\t\t\t\t\tif (!lastClickedItem.hasClass(\"selected\")) {\r\n\t\t\t\t\t\t// Select the lastClickedItem itself first, not one below/above it\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// Move selection until an enabled item was found\r\n\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\tindex += offset;\r\n\t\t\t\t\t\t\tif (index < 0 || index >= count) return;   // Nothing found\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\twhile (children.eq(index).hasClass(\"disabled\"));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (offset < 0) {\r\n\t\t\t\t\t// Move selection to the first enabled item\r\n\t\t\t\t\tindex = elem.children(\":not(.disabled)\").first().index();\r\n\t\t\t\t}\r\n\t\t\t\telse if (offset > 0) {\r\n\t\t\t\t\t// Move selection to the last enabled item\r\n\t\t\t\t\tindex = elem.children(\":not(.disabled)\").last().index();\r\n\t\t\t\t}\r\n\t\t\t\tif (index === -1) return;   // Nothing found\r\n\r\n\t\t\t\tchildren.removeClass(\"selected\");\r\n\t\t\t\tif (extend) {\r\n\t\t\t\t\tlet lastIndex = lastClickedItem.index();\r\n\t\t\t\t\t// Bring indices in a defined order\r\n\t\t\t\t\tlet i1 = Math.min(lastIndex, index);\r\n\t\t\t\t\tlet i2 = Math.max(lastIndex, index);\r\n\t\t\t\t\t// Replace selection with all items between these indices (inclusive)\r\n\t\t\t\t\tfor (let i = i1; i <= i2; i++) {\r\n\t\t\t\t\t\tlet c = children.eq(i);\r\n\t\t\t\t\t\tif (!c.hasClass(\"disabled\"))\r\n\t\t\t\t\t\t\tc.addClass(\"selected\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlastSelectedItem = children.eq(index);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tlastClickedItem = children.eq(index);\r\n\t\t\t\t\tlastClickedItem.addClass(\"selected\");\r\n\t\t\t\t\tlastSelectedItem = lastClickedItem;\r\n\t\t\t\t}\r\n\t\t\t\tupdateHtmlSelect();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Selects all items, if allowed.\r\n\t\tfunction selectAll() {\r\n\t\t\tif (opt.multiple || opt.toggle) {\r\n\t\t\t\telem.children(\":not(.disabled)\").addClass(\"selected\");\r\n\t\t\t\tupdateHtmlSelect();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Deselects all items, if allowed.\r\n\t\tfunction selectNone() {\r\n\t\t\tif (opt.allowEmpty) {\r\n\t\t\t\telem.children().removeClass(\"selected\");\r\n\t\t\t\tupdateHtmlSelect();\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Notifies the selectable plugin about a new child that needs to be initialized.\r\nfunction addChild(child) {\r\n\tvar selectable = $(this);\r\n\tvar opt = loadOptions(\"selectable\", selectable);\r\n\topt._prepareChild.call(child);\r\n}\r\n\r\n// Notifies the selectable plugin about a removed child that may affect the selection.\r\nfunction removeChild(child) {\r\n\tvar selectable = $(this);\r\n\tif (child.hasClass(\"selected\")) {\r\n\t\tselectable.trigger(\"selectionchange\");\r\n\t}\r\n}\r\n\r\n// Returns the currently selected elements.\r\nfunction getSelection() {\r\n\tvar selectable = $(this);\r\n\treturn selectable.children(\".selected\");\r\n}\r\n\r\n// Selects all items, if allowed.\r\nfunction selectAll() {\r\n\tvar selectable = $(this);\r\n\tvar opt = loadOptions(\"selectable\", selectable);\r\n\topt._selectAll();\r\n}\r\n\r\n// Deselects all items, if allowed.\r\nfunction selectNone() {\r\n\tvar selectable = $(this);\r\n\tvar opt = loadOptions(\"selectable\", selectable);\r\n\topt._selectNone();\r\n}\r\n\r\nregisterPlugin(\"selectable\", selectable, {\r\n\taddChild: addChild,\r\n\tremoveChild: removeChild,\r\n\tgetSelection: getSelection,\r\n\tselectAll: selectAll,\r\n\tselectNone: selectNone\r\n});\r\n$.fn.selectable.defaults = selectableDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, installDisabledchangeHook } from \"../util\";\r\n\r\nvar rangeClass = \"ff-range\";\r\nvar ticksClass = \"ff-ticks\";\r\nvar handleClass = \"ff-handle\";\r\nvar resetAllCursorsClass = \"reset-all-cursors\";\r\n\r\n// Defines default options for the slider plugin.\r\nvar sliderDefaults = {\r\n\t// The orientation of the slider, either \"h\" or \"v\". Default: \"h\".\r\n\torientation: \"h\",\r\n\r\n\t// The current value of the slider. Default: 0.\r\n\tvalue: 0,\r\n\r\n\t// The current values of the slider. Overrides the single value option. Default: null.\r\n\tvalues: null,\r\n\r\n\t// The minimum value of the slider range. Default: 0.\r\n\tmin: 0,\r\n\r\n\t// The maximum value of the slider range. Default: 100.\r\n\tmax: 100,\r\n\r\n\t// The base value of the range rectangle (\"min\", \"max\", any value e.g. 0). Default: \"min\".\r\n\trangeBase: 0,\r\n\r\n\t// The large step of the slider. Default: 10.\r\n\tlargeStep: 10,\r\n\r\n\t// The small step of the slider. Default: 1.\r\n\tsmallStep: 1,\r\n\r\n\t// Indicates whether the large step ticks are visible. Default: true.\r\n\tlargeTicks: true,\r\n\r\n\t// Indicates whether the small step ticks are visible. Default: false.\r\n\tsmallTicks: false,\r\n\r\n\t// Indicates whether the large step ticks have their value as label. Default: true.\r\n\tlargeTickLabels: true,\r\n\r\n\t// Indicates whether the small step ticks have their value as label. Default: false.\r\n\tsmallTickLabels: false,\r\n\r\n\t// The location of the tick marks in the slider (\"topleft\", \"bottomright\", \"both\", \"none\"). Default: \"topleft\".\r\n\ttickPlacement: \"topleft\",\r\n\r\n\t// The number of slider handles. Default: 1.\r\n\thandleCount: 1,\r\n\r\n\t// How multiple handles interact with each other while dragging (\"locked\", \"push\", \"free\"). Default: \"locked\".\r\n\thandleInteractionMode: \"locked\",\r\n\r\n\t// Overflow the range if the two handles have the same value. Default: false.\r\n\trangeOverflowEqual: false,\r\n\r\n\t// Individual ranges. Overrides the rangeBase option and two-handle range behaviour. Default: null.\r\n\t// Each range object has the properties: start, end, overflowEqual, color, className.\r\n\t// start and end can be fixed values, \"min\"/\"max\", or zero-based handle references prefixed with \"#\".\r\n\tranges: null,\r\n\r\n\t// Indicates whether the slider has a logarithmic scale. Default: false.\r\n\tlogarithmic: false,   // TODO\r\n\r\n\t// The mouse cursor to show during dragging the slider. Default: None.\r\n\tdragCursor: undefined\r\n};\r\n\r\n// Creates a slider widget.\r\nfunction slider(options) {\r\n\treturn this.each(function () {\r\n\t\tvar slider = $(this);\r\n\t\tif (slider.children(\"div.\" + handleClass).length !== 0) return;   // Already done\r\n\t\tvar opt = initOptions(\"slider\", sliderDefaults, slider, {}, options);\r\n\t\tvar htmlCursor, draggedHandleCursor;\r\n\t\tvar dragHandleOffset = [], dragHandlePointerId = [];\r\n\t\tvar lastTouchedHandleIndex = 0;\r\n\t\tvar isVertical = opt.orientation === \"v\";\r\n\t\tvar sliderBorder;\r\n\t\tvar initialTabindex;\r\n\r\n\t\topt._setValue = setValue;\r\n\r\n\t\tif (!opt.values) opt.values = [opt.value];\r\n\t\tif (opt.max < opt.min) opt.max = opt.min;\r\n\t\tif (opt.handleCount < 1) opt.handleCount = 1;\r\n\r\n\t\t// Create 1 pair of ranges by default; more only if individually specified\r\n\t\tvar ranges = [];\r\n\t\tfor (let index = 0; index < Math.max(1, opt.ranges && opt.ranges.length); index++) {\r\n\t\t\tranges[index * 2] = $(\"<div/>\").addClass(rangeClass).appendTo(slider);\r\n\t\t\tranges[index * 2 + 1] = $(\"<div/>\").addClass(rangeClass).appendTo(slider);\r\n\t\t}\r\n\t\tif (opt.ranges) {\r\n\t\t\topt.ranges.forEach(function (rangeItem, index) {\r\n\t\t\t\tif (rangeItem.color) {\r\n\t\t\t\t\tranges[index * 2].css(\"background\", rangeItem.color);\r\n\t\t\t\t\tranges[index * 2 + 1].css(\"background\", rangeItem.color);\r\n\t\t\t\t}\r\n\t\t\t\tif (rangeItem.className) {\r\n\t\t\t\t\tranges[index * 2].addClass(rangeItem.className);\r\n\t\t\t\t\tranges[index * 2 + 1].addClass(rangeItem.className);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Create ticks layer, it will contain the actual ticks with their labels\r\n\t\tvar ticks = $(\"<div/>\").addClass(ticksClass).appendTo(slider);\r\n\r\n\t\t// Create handles\r\n\t\t// Also keep them in a jQuery collection to add events to\r\n\t\tvar handles = [], $handles = $();\r\n\t\tfor (let index = 0; index < opt.handleCount; index++) {\r\n\t\t\thandles[index] = $(\"<div/>\").addClass(handleClass).appendTo(slider);\r\n\t\t\t$handles = $handles.add(handles[index]);\r\n\t\t}\r\n\r\n\t\t// Use precision to avoid ugly JavaScript floating point rounding issues\r\n\t\t// (like 35 * 0.01 = 0.35000000000000003)\r\n\t\tvar decimals = -Math.floor(Math.log10(opt.smallStep));\r\n\r\n\t\tvar rangeBaseValue = opt.rangeBase;\r\n\t\tif (rangeBaseValue === \"min\") rangeBaseValue = opt.min;\r\n\t\tif (rangeBaseValue === \"max\") rangeBaseValue = opt.max;\r\n\t\trangeBaseValue = minmax(rangeBaseValue, opt.min, opt.max);\r\n\t\tvar rangeBasePos = Math.round((rangeBaseValue - opt.min) / (opt.max - opt.min) * 10000) / 100;\r\n\r\n\t\tvar startAttr, endAttr;\r\n\t\tvar handleLength;   // Length of the handle in drag direction\r\n\r\n\t\tif (isVertical) {\r\n\t\t\tstartAttr = \"bottom\";\r\n\t\t\tendAttr = \"top\";\r\n\t\t\tslider.addClass(\"vertical\");\r\n\t\t\tsliderBorder = (slider.outerHeight() - slider.innerHeight()) / 2;\r\n\t\t\thandleLength = handles[0].outerHeight();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstartAttr = \"left\";\r\n\t\t\tendAttr = \"right\";\r\n\t\t\tslider.removeClass(\"vertical\");\r\n\t\t\tsliderBorder = (slider.outerWidth() - slider.innerWidth()) / 2;\r\n\t\t\thandleLength = handles[0].outerWidth();\r\n\t\t}\r\n\t\tfor (let index = 0; index < opt.handleCount; index++) {\r\n\t\t\tresetDragHandleOffset(index);\r\n\t\t\tsetValue(index, opt.values[index]);\r\n\t\t}\r\n\r\n\t\t// Draw ticks\r\n\t\tif (opt.smallTicks || opt.largeTicks) {\r\n\t\t\tvar minTick = Math.ceil(opt.min / opt.smallStep) * opt.smallStep;\r\n\t\t\tfor (let value = minTick; value <= opt.max; value += opt.smallStep) {\r\n\t\t\t\tvalue = round(value, decimals);\r\n\t\t\t\tlet large = value / opt.largeStep === Math.trunc(value / opt.largeStep);\r\n\t\t\t\tif (!large && !opt.smallTicks) continue;\r\n\r\n\t\t\t\tlet pos = Math.round((value - opt.min) / (opt.max - opt.min) * 10000) / 100;\r\n\t\t\t\tlet tickArr = $();\r\n\t\t\t\tif (opt.tickPlacement === \"both\" || opt.tickPlacement === \"topleft\") {\r\n\t\t\t\t\ttickArr = tickArr.add($(\"<div/>\").css(startAttr, pos + \"%\").appendTo(ticks));\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.tickPlacement === \"both\" || opt.tickPlacement === \"bottomright\") {\r\n\t\t\t\t\ttickArr = tickArr.add($(\"<div/>\").addClass(\"opposite\").css(startAttr, pos + \"%\").appendTo(ticks));\r\n\t\t\t\t}\r\n\t\t\t\tif (large) {\r\n\t\t\t\t\ttickArr.addClass(\"large\");\r\n\t\t\t\t}\r\n\t\t\t\tif (opt.smallTickLabels || opt.largeTickLabels && large) {\r\n\t\t\t\t\ttickArr.attr(\"data-label\", value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Allow Pointer API to work properly in Edge\r\n\t\tslider.css(\"touch-action\", \"none\");\r\n\r\n\t\tvar eventRemovers = [];\r\n\t\t$handles.pointer(\"down\", function (event) {\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\t// Select touched handle\r\n\t\t\tvar handle = $(event.target).closest(\".\" + handleClass);\r\n\t\t\tvar index = $.inArray(handle[0], $handles);\r\n\t\t\tif (index === -1) {\r\n\t\t\t\tconsole.warn(\"Clicked handle not found\");\r\n\t\t\t\treturn;   // Should not happen: handle not found\r\n\t\t\t}\r\n\r\n\t\t\t// Remember where the handle was dragged (probably not exactly the center)\r\n\t\t\tif (isVertical)\r\n\t\t\t\tdragHandleOffset[index] = handles[index].offset().top + handles[index].outerHeight() - event.pageY;\r\n\t\t\telse\r\n\t\t\t\tdragHandleOffset[index] = event.pageX - handles[index].offset().left;\r\n\r\n\t\t\tdraggedHandleCursor = handles[index].actualCursor();\r\n\t\t});\r\n\t\tslider.pointer(\"down\", function (event) {\r\n\t\t\tif (slider.disabled()) return;\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tslider.focus();\r\n\r\n\t\t\t\tvar isFirstDrag = true;\r\n\t\t\t\tdragHandlePointerId.forEach(function (item) {\r\n\t\t\t\t\tif (item !== undefined) isFirstDrag = false;\r\n\t\t\t\t});\r\n\t\t\t\tif (isFirstDrag)\r\n\t\t\t\t\tslider.trigger(\"firstdragstart\");\r\n\r\n\t\t\t\t// Select touched or nearest handle and remember by pointerId\r\n\t\t\t\tvar handle = $(event.target).closest(\".\" + handleClass);\r\n\t\t\t\tvar index = $.inArray(handle[0], $handles);\r\n\t\t\t\tif (index === -1) {\r\n\t\t\t\t\t// Not clicked on a handle.\r\n\t\t\t\t\t// Find nearest handle, prefer same direction (for locked handles on the same value)\r\n\t\t\t\t\tvar pointerValue = getValueFromEvent(event);\r\n\t\t\t\t\tvar minValueDistance = Infinity;\r\n\t\t\t\t\topt.values.forEach(function (value, valueIndex) {\r\n\t\t\t\t\t\tvar valueDistance = Math.abs(value - pointerValue);\r\n\t\t\t\t\t\tif (valueDistance < minValueDistance ||\r\n\t\t\t\t\t\t\tpointerValue > value && valueDistance <= minValueDistance) {\r\n\t\t\t\t\t\t\tminValueDistance = valueDistance;\r\n\t\t\t\t\t\t\tindex = valueIndex;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tdragHandlePointerId[index] = event.pointerId;\r\n\t\t\t\tlastTouchedHandleIndex = index;\r\n\r\n\t\t\t\thandles[index].addClass(\"pressed\");\r\n\t\t\t\tonMove(event);\r\n\r\n\t\t\t\tif (isFirstDrag) {\r\n\t\t\t\t\tslider.setCapture && slider.setCapture();   // Firefox only (set cursor over entire desktop)\r\n\t\t\t\t\t$(\"html\").addClass(resetAllCursorsClass);   // All browsers (set cursor at least within page)\r\n\t\t\t\t\thtmlCursor = document.documentElement.style.getPropertyValue(\"cursor\");\r\n\t\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", opt.dragCursor || draggedHandleCursor || slider.actualCursor(), \"important\");\r\n\r\n\t\t\t\t\teventRemovers.push($(window).pointer(\"move\", onMove, true));\r\n\t\t\t\t\teventRemovers.push($(window).pointer(\"up cancel\", onEnd, true));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Make the element focusable if not already specified\r\n\t\tinitialTabindex = slider.attr(\"tabindex\");\r\n\t\tif (initialTabindex === undefined) {\r\n\t\t\tinitialTabindex = \"0\";\r\n\t\t\tslider.attr(\"tabindex\", initialTabindex);\r\n\t\t}\r\n\r\n\t\t// Make the element unfocusable when disabled\r\n\t\tinstallDisabledchangeHook();\r\n\t\tslider.on(\"disabledchange\", function () {\r\n\t\t\tif (slider.disabled()) {\r\n\t\t\t\tslider.removeAttr(\"tabindex\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tslider.attr(\"tabindex\", initialTabindex);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tslider.keydown(onKeydown);\r\n\r\n\t\t// TODO: Trigger \"remove\" event for DOM elements being removed, like jQuery UI overrides $.cleanData (once!)\r\n\t\t// TODO: slider.on(\"remove\", /* cancel current drag operation and remove all events */) - also in other widgets!\r\n\r\n\t\tfunction onMove(event) {\r\n\t\t\t// Select dragged handle from pointerId\r\n\t\t\tvar index = dragHandlePointerId.indexOf(event.pointerId);\r\n\t\t\tif (index === -1) return;   // Not my pointer\r\n\r\n\t\t\tvar value = getValueFromEvent(event);\r\n\r\n\t\t\tif (opt.handleCount > 1) {\r\n\t\t\t\tswitch (opt.handleInteractionMode) {\r\n\t\t\t\t\tcase \"locked\":\r\n\t\t\t\t\t\tif (index > 0 && value < opt.values[index - 1])\r\n\t\t\t\t\t\t\tvalue = opt.values[index - 1];\r\n\t\t\t\t\t\tif (index < opt.handleCount - 1 && value > opt.values[index + 1])\r\n\t\t\t\t\t\t\tvalue = opt.values[index + 1];\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase \"push\":\r\n\t\t\t\t\t\tfor (let otherIndex = index - 1; otherIndex >= 0; otherIndex--) {\r\n\t\t\t\t\t\t\tif (value < opt.values[otherIndex])\r\n\t\t\t\t\t\t\t\tsetValue(otherIndex, value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (let otherIndex = index + 1; otherIndex < opt.handleCount; otherIndex++) {\r\n\t\t\t\t\t\t\tif (value > opt.values[otherIndex])\r\n\t\t\t\t\t\t\t\tsetValue(otherIndex, value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tsetValue(index, value);\r\n\t\t}\r\n\r\n\t\tfunction onEnd(event) {\r\n\t\t\t// Select dragged handle from pointerId\r\n\t\t\tvar index = dragHandlePointerId.indexOf(event.pointerId);\r\n\t\t\tif (index === -1) return;   // Not my pointer\r\n\r\n\t\t\tif (event.button === 0) {\r\n\t\t\t\tdragHandlePointerId[index] = undefined;\r\n\t\t\t\thandles[index].removeClass(\"pressed\");\r\n\t\t\t\tresetDragHandleOffset(index);\r\n\r\n\t\t\t\tvar isLastDrag = true;\r\n\t\t\t\tdragHandlePointerId.forEach(function (item) {\r\n\t\t\t\t\tif (item !== undefined) isLastDrag = false;\r\n\t\t\t\t});\r\n\t\t\t\tif (isLastDrag) {\r\n\t\t\t\t\tslider.releaseCapture && slider.releaseCapture();\r\n\t\t\t\t\t$(\"html\").removeClass(resetAllCursorsClass);\r\n\t\t\t\t\tdocument.documentElement.style.setProperty(\"cursor\", htmlCursor);\r\n\r\n\t\t\t\t\teventRemovers.forEach(function (eventRemover) { eventRemover(); });\r\n\t\t\t\t\teventRemovers = [];\r\n\r\n\t\t\t\t\tslider.trigger(\"lastdragend\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onKeydown(event) {\r\n\t\t\tif (slider.disabled()) return;\r\n\t\t\tif (event.keyCode === 40 || event.keyCode === 37) {   // Down, Left\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tsetValue(lastTouchedHandleIndex, opt.values[lastTouchedHandleIndex] - (event.shiftKey ? opt.largeStep : opt.smallStep));\r\n\t\t\t}\r\n\t\t\tif (event.keyCode === 38 || event.keyCode === 39) {   // Up, Right\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tsetValue(lastTouchedHandleIndex, opt.values[lastTouchedHandleIndex] + (event.shiftKey ? opt.largeStep : opt.smallStep));\r\n\t\t\t}\r\n\t\t\tif (event.keyCode === 36) {   // Home\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tsetValue(lastTouchedHandleIndex, opt.min);\r\n\t\t\t}\r\n\t\t\tif (event.keyCode === 35) {   // End\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tsetValue(lastTouchedHandleIndex, opt.max);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Gets the slider value from the coordinates of a pointer event.\r\n\t\tfunction getValueFromEvent(event) {\r\n\t\t\t// Select dragged handle from pointerId\r\n\t\t\tvar index = dragHandlePointerId.indexOf(event.pointerId);\r\n\r\n\t\t\t// Assume center click if pointer is unknown\r\n\t\t\tvar myDragHandleOffset = handleLength / 2;\r\n\t\t\tif (index !== -1) myDragHandleOffset = dragHandleOffset[index];\r\n\r\n\t\t\tvar sliderRect = slider.rect();\r\n\t\t\tvar pointerPosIntoSlider;   // Distance from min end of the slider to the pointer\r\n\t\t\tvar sliderLength;   // Length of the slider in drag direction\r\n\t\t\tif (isVertical) {\r\n\t\t\t\tpointerPosIntoSlider = sliderRect.bottom - sliderBorder - event.pageY;\r\n\t\t\t\tsliderLength = slider.innerHeight();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tpointerPosIntoSlider = event.pageX - sliderRect.left - sliderBorder;\r\n\t\t\t\tsliderLength = slider.innerWidth();\r\n\t\t\t}\r\n\r\n\t\t\tvar handleCenterPos = pointerPosIntoSlider - myDragHandleOffset + handleLength / 2;   // Position of the handle's center\r\n\t\t\tvar value = handleCenterPos / sliderLength * (opt.max - opt.min) + opt.min;   // Selected value\r\n\t\t\treturn value;\r\n\t\t}\r\n\r\n\t\t// Sets a slider value and triggers the change event. Also moves the handle.\r\n\t\tfunction setValue(index, value) {\r\n\t\t\tvalue = minmax(value, opt.min, opt.max);\r\n\t\t\tvalue = Math.round(value / opt.smallStep) * opt.smallStep;   // Snap to steps\r\n\t\t\tvalue = round(value, decimals);\r\n\t\t\tmoveHandle(index, value);\r\n\t\t\tif (value !== opt.values[index]) {\r\n\t\t\t\topt.values[index] = value;\r\n\t\t\t\tslider.trigger(\"valuechange\");   // TODO: Indicate the changed value index\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Moves a handle to the specified slider value and updates the ranges.\r\n\t\tfunction moveHandle(index, value) {\r\n\t\t\tvar pos = getPosFromValue(value);\r\n\t\t\thandles[index].css(startAttr, \"calc(\" + pos + \"% - \" + (handleLength / 2) + \"px)\");\r\n\r\n\t\t\t// Also update ranges\r\n\t\t\tif (opt.ranges) {\r\n\t\t\t\topt.ranges.forEach(function (rangeItem, rangeIndex) {\r\n\t\t\t\t\tvar start = rangeItem.start, startHandleIndex;\r\n\t\t\t\t\tif (start === \"min\") {\r\n\t\t\t\t\t\tstart = opt.min;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (start === \"max\") {\r\n\t\t\t\t\t\tstart = opt.max;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (start[0] === \"#\") {\r\n\t\t\t\t\t\tstartHandleIndex = Number(start.substr(1));\r\n\t\t\t\t\t\tstart = startHandleIndex === index ? value : opt.values[startHandleIndex];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar end = rangeItem.end, endHandleIndex;\r\n\t\t\t\t\tif (end === \"min\") {\r\n\t\t\t\t\t\tend = opt.min;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (end === \"max\") {\r\n\t\t\t\t\t\tend = opt.max;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (end[0] === \"#\") {\r\n\t\t\t\t\t\tendHandleIndex = Number(end.substr(1));\r\n\t\t\t\t\t\tend = endHandleIndex === index ? value : opt.values[endHandleIndex];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar startPos = getPosFromValue(start);\r\n\t\t\t\t\tvar endPos = getPosFromValue(end);\r\n\t\t\t\t\tvar overflowEqual = rangeItem.overflowEqual ||\r\n\t\t\t\t\t\tstartHandleIndex !== undefined && endHandleIndex !== undefined && endHandleIndex < startHandleIndex;\r\n\t\t\t\t\tsetRange(rangeIndex, startPos, endPos, overflowEqual);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse if (opt.handleCount === 1) {\r\n\t\t\t\tif (pos < rangeBasePos)\r\n\t\t\t\t\tsetRange(0, pos, rangeBasePos);\r\n\t\t\t\telse\r\n\t\t\t\t\tsetRange(0, rangeBasePos, pos);\r\n\t\t\t}\r\n\t\t\telse if (opt.handleCount === 2) {\r\n\t\t\t\tvar pos0 = index === 0 ? pos : getPosFromValue(opt.values[0]);\r\n\t\t\t\tvar pos1 = index === 1 ? pos : getPosFromValue(opt.values[1]);\r\n\t\t\t\tsetRange(0, pos0, pos1, opt.rangeOverflowEqual);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Sets the size of a range element for a start and end value, supporting overflow.\r\n\t\tfunction setRange(index, start, end, overflowEqual) {\r\n\t\t\tif (start < end || start === end && !overflowEqual) {\r\n\t\t\t\t// Only one contiguous range, hide the second element\r\n\t\t\t\tranges[index * 2].css(startAttr, start + \"%\");\r\n\t\t\t\tranges[index * 2].css(endAttr, (100 - end) + \"%\");\r\n\t\t\t\tranges[index * 2 + 1].css(startAttr, \"0%\");\r\n\t\t\t\tranges[index * 2 + 1].css(endAttr, \"100%\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// Overflow range, split in two elements from either end of the slider\r\n\t\t\t\tranges[index * 2].css(startAttr, \"0%\");\r\n\t\t\t\tranges[index * 2].css(endAttr, (100 - end) + \"%\");\r\n\t\t\t\tranges[index * 2 + 1].css(startAttr, start + \"%\");\r\n\t\t\t\tranges[index * 2 + 1].css(endAttr, \"0%\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Returns the relative position in percent from the slider value.\r\n\t\tfunction getPosFromValue(value) {\r\n\t\t\tvar pos = Math.round((value - opt.min) / (opt.max - opt.min) * 10000) / 100;\r\n\t\t\treturn pos;\r\n\t\t}\r\n\r\n\t\t// Resets the drag offset as if the handle was dragged exactly in the middle.\r\n\t\tfunction resetDragHandleOffset(index) {\r\n\t\t\tdragHandleOffset[index] = handleLength / 2;\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Gets the current slider value.\r\n//\r\n// value: Sets the slider value.\r\nfunction sliderValue(value) {\r\n\treturn this.slider.multivalue(0, value);\r\n}\r\n\r\n// Gets the current value of the specified slider handle.\r\n//\r\n// value: Sets the value of the specified slider handle.\r\nfunction sliderMultiValue(index, value) {\r\n\t// Getter\r\n\tif (value === undefined) {\r\n\t\tvar slider = this.first();\r\n\t\tif (slider.length === 0) return;   // Nothing to do\r\n\t\tvar opt = loadOptions(\"slider\", slider);\r\n\t\treturn opt.values[index];\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar slider = $(this);\r\n\t\tvar opt = loadOptions(\"slider\", slider);\r\n\t\topt._setValue(index, value);\r\n\t});\r\n}\r\n\r\nregisterPlugin(\"slider\", slider, {\r\n\tvalue: sliderValue,\r\n\tmultivalue: sliderMultiValue\r\n});\r\n$.fn.slider.defaults = sliderDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar sortableClass = \"ff-sortable\";\r\nvar sortablePlaceholderClass = \"ff-sortable-placeholder\";\r\n\r\n// Defines default options for the sortable plugin.\r\nvar sortableDefaults = {\r\n\t// The element(s) that can start a drag operation. Default: The element to drag.\r\n\thandle: undefined,\r\n\r\n\t// The element(s) that cannot start a drag operation. Default: None.\r\n\tcancel: undefined,\r\n\r\n\t// Constrains the drag movement along the \"x\" or \"y\" axis. Default: None.\r\n\taxis: undefined,\r\n\r\n\t// Constrains the drag movement inside the specified element or the \"parent\" of the dragged element. Default: None.\r\n\tcontainment: undefined,\r\n\r\n\t// The elements among which the dragged element will be pulled in the front, or true to stack all sortable children. Default: None.\r\n\tstack: undefined,\r\n\r\n\t// The mouse cursor to show during dragging. Default: None.\r\n\tdragCursor: undefined,\r\n\r\n\t// A CSS class to add to the element while it's being dragged. Default: None.\r\n\tdragClass: undefined,\r\n\r\n\t// Indicates whether the window should scroll to keep the dragged element visible. Default: false.\r\n\tscroll: false\r\n};\r\n\r\n// Makes the child elements in each selected element sortable by drag&drop.\r\nfunction sortable(options) {\r\n\treturn this.each(function () {\r\n\t\tvar elem = this;\r\n\t\tvar $elem = $(elem);\r\n\t\tif ($elem.hasClass(sortableClass)) return;   // Already done\r\n\t\t$elem.addClass(sortableClass);\r\n\t\tvar opt = initOptions(\"sortable\", sortableDefaults, $elem, {}, options);\r\n\t\topt._prepareChild = prepareChild;\r\n\r\n\t\t// Remove text nodes between children which cause layout issues when dragging\r\n\t\t$elem.contents().filter(function () {\r\n\t\t\treturn this.nodeType === 3;\r\n\t\t}).remove();\r\n\r\n\t\tvar isVertical = isBlockDisplay($elem.firstChild().css(\"display\"));\r\n\t\tvar flowStart = isVertical ? \"top\" : \"left\";\r\n\t\tvar flowEnd = isVertical ? \"bottom\" : \"right\";\r\n\t\tvar crossStart = isVertical ? \"left\" : \"top\";\r\n\t\tvar crossEnd = isVertical ? \"right\" : \"bottom\";\r\n\r\n\t\t$elem.children().each(prepareChild);\r\n\t\t\r\n\t\tfunction prepareChild() {\r\n\t\t\tvar child = $(this);\r\n\t\t\tvar placeholder, initialChildAfterElement, placeholderAfterElement, betweenChildren, initialChildIndex;\r\n\t\t\tvar stack = opt.stack;\r\n\t\t\tif (stack === true)\r\n\t\t\t\tstack = $elem.children();\r\n\r\n\t\t\tchild.draggable({\r\n\t\t\t\thandle: opt.handle,\r\n\t\t\t\tcancel: opt.cancel,\r\n\t\t\t\taxis: opt.axis,\r\n\t\t\t\tcontainment: opt.containment,\r\n\t\t\t\tstack: stack,\r\n\t\t\t\tdragCursor: opt.dragCursor,\r\n\t\t\t\tdragClass: opt.dragClass,\r\n\t\t\t\tscroll: opt.scroll\r\n\t\t\t});\r\n\t\t\tchild.on(\"draggablestart\", function (event) {\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tlet event2 = $.Event(\"sortablestart\");\r\n\t\t\t\tchild.trigger(event2);\r\n\t\t\t\tif (event2.isDefaultPrevented()) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remember where the element was before it was dragged, so it can be moved back there\r\n\t\t\t\tinitialChildAfterElement = child.prev();\r\n\t\t\t\tif (initialChildAfterElement.length === 0)\r\n\t\t\t\t\tinitialChildAfterElement = null;\r\n\t\t\t\tinitialChildIndex = child.index();\r\n\r\n\t\t\t\tlet rect = child.rect();\r\n\r\n\t\t\t\t// Fix the size of table row cells while dragging\r\n\t\t\t\tif (child[0].nodeName === \"TR\") {\r\n\t\t\t\t\tlet table = child.closest(\"table\").find(\"tr\").first().children(\"td, th\").each$(function () {\r\n\t\t\t\t\t\tthis.data(\"width-before-drag\", this[0].style.width || \"\");\r\n\t\t\t\t\t\tthis.css(\"width\", this.outerWidth());\r\n\t\t\t\t\t});\r\n\t\t\t\t\tchild.children(\"td, th\").each$(function () {\r\n\t\t\t\t\t\tthis.css(\"width\", this.outerWidth());\r\n\t\t\t\t\t});\r\n\t\t\t\t\tchild.css(\"min-width\", child.outerWidth() + 1);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// Create the placeholder element that will take the place of the dragged element\r\n\t\t\t\tplaceholder = $(\"<\" + child[0].nodeName + \"/>\")\r\n\t\t\t\t\t.addClass(child[0].className)\r\n\t\t\t\t\t.addClass(sortablePlaceholderClass)\r\n\t\t\t\t\t.text(\"\\xa0\")\r\n\t\t\t\t\t.css({ width: rect.width, height: rect.height });\r\n\t\t\t\tif (child[0].nodeName === \"TR\") {\r\n\t\t\t\t\tlet colCount = child.children(\"td, th\")\r\n\t\t\t\t\t\t.map(td => $(td).attr(\"colspan\") || 1)\r\n\t\t\t\t\t\t.get()   // Convert jQuery array to Array\r\n\t\t\t\t\t\t.reduce((a, b) => a + b);\r\n\t\t\t\t\tplaceholder.append($(\"<td/>\").attr(\"colspan\", colCount));\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Insert the placeholder where the dragged element is, and take that out of the layout flow\r\n\t\t\t\tchild.after(placeholder);\r\n\t\t\t\tchild.css({ position: \"absolute\", width: rect.width, height: rect.height });\r\n\t\t\t\tupdateChildren();\r\n\t\t\t});\r\n\t\t\tchild.on(\"draggablemove\", function (event) {\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tlet event2 = $.Event(\"sortablemove\");\r\n\t\t\t\tchild.trigger(event2);\r\n\t\t\t\tif (event2.isDefaultPrevented()) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find the center points of the dragged element, both at the start and end in flow direction\r\n\t\t\t\tvar rect = child.rect();\r\n\t\t\t\tvar childStartCenter = center(rect);\r\n\t\t\t\tchildStartCenter[flowStart] = rect[flowStart];\r\n\t\t\t\tvar childEndCenter = center(rect);\r\n\t\t\t\tchildEndCenter[flowStart] = rect[flowEnd];\r\n\r\n\t\t\t\tvar minStartDistance = Infinity;\r\n\t\t\t\tvar minEndDistance = Infinity;\r\n\t\t\t\tvar newPlaceholderAfterElementStart;\r\n\t\t\t\tvar newPlaceholderAfterElementEnd;\r\n\r\n\t\t\t\t// Iterate betweenChildren to find the closest line connecting two elements\r\n\t\t\t\tbetweenChildren.forEach(function (x) {\r\n\t\t\t\t\tvar startDistance = distToSegment(childStartCenter, x.p1, x.p2);\r\n\t\t\t\t\tif (startDistance < minStartDistance) {\r\n\t\t\t\t\t\tminStartDistance = startDistance;\r\n\t\t\t\t\t\tnewPlaceholderAfterElementStart = x.after;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar endDistance = distToSegment(childEndCenter, x.p1, x.p2);\r\n\t\t\t\t\tif (endDistance < minEndDistance) {\r\n\t\t\t\t\t\tminEndDistance = endDistance;\r\n\t\t\t\t\t\tnewPlaceholderAfterElementEnd = x.after;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Find the suggested new placeholder location that's different from the current...\r\n\t\t\t\t// TODO: If a short item is dragged over a long item at the beginning of a row and its placeholder still fits into the previous row, this flickers\r\n\t\t\t\t// * Visualise the generated lines between the items to get an idea of what the code sees\r\n\t\t\t\t//console.log(\"start is after center of \" + $(newPlaceholderAfterElementStart).text());\r\n\t\t\t\t//console.log(\"end is after center of \" + $(newPlaceholderAfterElementEnd).text());\r\n\t\t\t\tvar newPlaceholderAfterElement;\r\n\t\t\t\tif (newPlaceholderAfterElementStart !== placeholderAfterElement)\r\n\t\t\t\t\tnewPlaceholderAfterElement = newPlaceholderAfterElementStart;\r\n\t\t\t\tif (newPlaceholderAfterElementEnd !== placeholderAfterElement)\r\n\t\t\t\t\tnewPlaceholderAfterElement = newPlaceholderAfterElementEnd;\r\n\r\n\t\t\t\t// ...and move it there\r\n\t\t\t\tif (newPlaceholderAfterElement !== undefined) {\r\n\t\t\t\t\tvar eventCancelled = false;\r\n\t\t\t\t\tif (placeholderAfterElement !== undefined) {\r\n\t\t\t\t\t\tlet event2 = $.Event(\"sortablechange\");\r\n\t\t\t\t\t\tevent2.after = newPlaceholderAfterElement;\r\n\t\t\t\t\t\tchild.trigger(event2);\r\n\t\t\t\t\t\teventCancelled = event2.isDefaultPrevented();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!eventCancelled) {\r\n\t\t\t\t\t\tif (!newPlaceholderAfterElement)\r\n\t\t\t\t\t\t\tplaceholder.detach().insertBefore($elem.firstChild());\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tplaceholder.detach().insertAfter(newPlaceholderAfterElement);\r\n\t\t\t\t\t\tplaceholderAfterElement = newPlaceholderAfterElement;\r\n\t\t\t\t\t\tupdateChildren();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tchild.on(\"draggableend\", function (event) {\r\n\t\t\t\tevent.stopImmediatePropagation();\r\n\t\t\t\tchild.css({ position: \"\", width: \"\", height: \"\", top: \"\", left: \"\" });\r\n\t\t\t\tplaceholder.replaceWith(child);\r\n\t\t\t\tplaceholder = undefined;\r\n\t\t\t\tbetweenChildren = undefined;\r\n\r\n\t\t\t\t// Reset the size of table row cells\r\n\t\t\t\tif (child[0].nodeName === \"TR\") {\r\n\t\t\t\t\tlet table = child.closest(\"table\").find(\"tr\").first().children(\"td, th\").each$(function () {\r\n\t\t\t\t\t\tthis.css(\"width\", this.data(\"width-before-drag\"));\r\n\t\t\t\t\t\tthis.data(\"width-before-drag\", null);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tchild.children(\"td, th\").each$(function () {\r\n\t\t\t\t\t\tthis.css(\"width\", \"\");\r\n\t\t\t\t\t});\r\n\t\t\t\t\tchild.css(\"width\", \"\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet event2 = $.Event(\"sortableend\");\r\n\t\t\t\tevent2.initialIndex = initialChildIndex;\r\n\t\t\t\tevent2.newIndex = child.index();\r\n\t\t\t\tevent2.after = placeholderAfterElement;\r\n\t\t\t\tchild.trigger(event2);\r\n\t\t\t\tif (event2.isDefaultPrevented()) {\r\n\t\t\t\t\tif (!initialChildAfterElement)\r\n\t\t\t\t\t\tchild.detach().insertBefore($elem.firstChild());\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tchild.detach().insertAfter(initialChildAfterElement);\r\n\t\t\t\t}\r\n\t\t\t\tinitialChildAfterElement = undefined;\r\n\t\t\t});\r\n\r\n\t\t\tfunction updateChildren() {\r\n\t\t\t\tbetweenChildren = [];\r\n\t\t\t\tvar rowElements = [];\r\n\t\t\t\tvar rowMin, rowMax, currentPos, elem = null;\r\n\t\t\t\t$elem.children().each(function () {\r\n\t\t\t\t\tif (this !== child[0]) {\r\n\t\t\t\t\t\tvar rect = $(this).rect();\r\n\t\t\t\t\t\tif (rect[flowStart] + 0.1 < currentPos) {   // Need to compensate for rounding issues from the 4th decimal in Chrome/Edge/IE\r\n\t\t\t\t\t\t\t// This element is in a new row\r\n\t\t\t\t\t\t\taddRow();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Remember the width of a row\r\n\t\t\t\t\t\tif (rowMin === undefined || rect[crossStart] < rowMin) rowMin = rect[crossStart];\r\n\t\t\t\t\t\tif (rowMax === undefined || rect[crossEnd] < rowMax) rowMax = rect[crossEnd];\r\n\r\n\t\t\t\t\t\t// Remember how far the row has been used\r\n\t\t\t\t\t\tcurrentPos = rect[flowEnd];\r\n\r\n\t\t\t\t\t\tif (this !== placeholder[0]) elem = this;\r\n\t\t\t\t\t\trowElements.push({ elem: elem, rect: rect });\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Don't forget the last row\r\n\t\t\t\taddRow();\r\n\r\n\t\t\t\tfunction addRow() {\r\n\t\t\t\t\tvar rowCenter = (rowMin + rowMax) / 2;\r\n\r\n\t\t\t\t\t// Add line before the first element in the row\r\n\t\t\t\t\tbetweenChildren.push({\r\n\t\t\t\t\t\t// far away\r\n\t\t\t\t\t\tp1: createPoint(-10000, rowCenter),\r\n\t\t\t\t\t\t// the first row element's center\r\n\t\t\t\t\t\tp2: createPoint(center(rowElements[0].rect)[flowStart], rowCenter),\r\n\t\t\t\t\t\t// the position after the last element of the previous row, if any\r\n\t\t\t\t\t\tafter: betweenChildren.length > 0 ? betweenChildren[betweenChildren.length - 1].after : null\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Now add lines after each element in the row\r\n\t\t\t\t\trowElements.forEach(function (x, i) {\r\n\t\t\t\t\t\tbetweenChildren.push({\r\n\t\t\t\t\t\t\t// the current row element's center\r\n\t\t\t\t\t\t\tp1: createPoint(center(x.rect)[flowStart], rowCenter),\r\n\t\t\t\t\t\t\t// the next row element's center, if any; otherwise far away\r\n\t\t\t\t\t\t\tp2: createPoint(i < rowElements.length - 1 ? center(rowElements[i + 1].rect)[flowStart] : 10000, rowCenter),\r\n\t\t\t\t\t\t\t// the position after the current row element\r\n\t\t\t\t\t\t\tafter: x.elem\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Reset values for the new row\r\n\t\t\t\t\trowMin = rowMax = currentPos = undefined;\r\n\t\t\t\t\trowElements = [];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Returns an absolute point with \"left\" and \"top\" coordinates for the current orientation.\r\n\t\tfunction createPoint(flow, cross) {\r\n\t\t\tvar p = {};\r\n\t\t\tp[flowStart] = flow;\r\n\t\t\tp[crossStart] = cross;\r\n\t\t\treturn p;\r\n\t\t}\r\n\t});\r\n\r\n\t// Returns the center point of the specified rectangle.\r\n\tfunction center(rect) {\r\n\t\treturn {\r\n\t\t\ttop: rect.top + rect.height / 2,\r\n\t\t\tleft: rect.left + rect.width / 2\r\n\t\t};\r\n\t}\r\n\r\n\t// Determines whether the specified CSS display value defines a block instead of an inline.\r\n\tfunction isBlockDisplay(value) {\r\n\t\treturn [\"block\", \"flex\", \"grid\", \"list-item\", \"table\", \"table-footer-group\", \"table-header-group\", \"table-row\", \"table-row-group\"].indexOf(value) !== -1;\r\n\t}\r\n\r\n\t// Source: https://jsfiddle.net/beentaken/9k1sf6p2/ (modified)\r\n\tfunction dist2(v, w) {\r\n\t\treturn (v.left - w.left) ** 2 + (v.top - w.top) ** 2;\r\n\t}\r\n\r\n\tfunction distToSegmentSquared(p, v, w) {\r\n\t\tvar l2 = dist2(v, w);\r\n\t\tif (l2 == 0) return dist2(p, v);\r\n\t\tvar t = ((p.left - v.left) * (w.left - v.left) + (p.top - v.top) * (w.top - v.top)) / l2;\r\n\t\tif (t < 0) return dist2(p, v);\r\n\t\tif (t > 1) return dist2(p, w);\r\n\t\treturn dist2(p, { left: v.left + t * (w.left - v.left), top: v.top + t * (w.top - v.top) });\r\n\t}\r\n\r\n\tfunction distToSegment(p, v, w) {\r\n\t\treturn Math.sqrt(distToSegmentSquared(p, v, w));\r\n\t}\r\n}\r\n\r\n// Notifies the sortable plugin about a new child that needs to be initialized.\r\nfunction addChild(child) {\r\n\tvar sortable = $(this);\r\n\tvar opt = loadOptions(\"sortable\", sortable);\r\n\topt._prepareChild.call(child);\r\n}\r\n\r\nregisterPlugin(\"sortable\", sortable, {\r\n\taddChild: addChild\r\n});\r\n$.fn.sortable.defaults = sortableDefaults;\r\n","﻿import { registerPlugin, initOptions, loadOptions } from \"../plugin\";\r\nimport { minmax, round, forceReflow, bindInputButtonsDisabled, scrollIntoView, preventScrolling, stackElements } from \"../util\";\r\n\r\nvar tabHeadersClass = \"ff-tab-headers\";\r\nvar tabPagesClass = \"ff-tab-pages\";\r\n\r\n// Defines default options for the tabs plugin.\r\nvar tabsDefaults = {\r\n};\r\n\r\n// Converts all div elements in each selected element into tab pages.\r\n// The tab page headers are read from the div elements' title attribute.\r\nfunction tabs(options) {\r\n\treturn this.each(function () {\r\n\t\tvar container = $(this);\r\n\t\tif (container.children(\"div.\" + tabHeadersClass).length !== 0) return;   // Already done\r\n\t\tvar opt = initOptions(\"tabs\", tabsDefaults, container, {}, options);\r\n\t\topt._addTab = addTab;\r\n\r\n\t\tvar pageDivs = $(this).children(\"div\");\r\n\t\tvar activePage = pageDivs.filter(\".active\").first();\r\n\t\tvar headers = $(\"<div/>\").addClass(tabHeadersClass).appendTo(container);\r\n\t\tvar pages = $(\"<div/>\").addClass(tabPagesClass).appendTo(container);\r\n\t\tpageDivs.each(addTab);\r\n\t\t\r\n\t\tfunction addTab() {\r\n\t\t\tvar header = $(\"<a/>\").attr(\"href\", \"#\").attr(\"tabindex\", \"-1\").text($(this).attr(\"title\")).appendTo(headers);\r\n\t\t\tvar page = $(this).removeAttr(\"title\").detach().appendTo(pages);\r\n\t\t\tif (activePage.length === 0 || activePage[0] === page[0]) {\r\n\t\t\t\theader.addClass(\"active\").removeAttr(\"tabindex\");\r\n\t\t\t\tpage.addClass(\"active\");\r\n\t\t\t\tactivePage = page;\r\n\t\t\t}\r\n\t\t\theader.click(function (event) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tcontainer.tabs.activeTab(page);\r\n\t\t\t});\r\n\t\t\theader.keydown(function (event) {\r\n\t\t\t\tif (event.which === 37) {   // Left\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.prev().focus().click();\r\n\t\t\t\t}\r\n\t\t\t\tif (event.which === 39) {   // Right\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.next().focus().click();\r\n\t\t\t\t}\r\n\t\t\t\tif (event.which === 36) {   // Home\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.parent().children().first().focus().click();\r\n\t\t\t\t}\r\n\t\t\t\tif (event.which === 35) {   // End\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\theader.parent().children().last().focus().click();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Adds a new tab page and header from a page div element.\r\n//\r\n// page: The new tab page to add. It does not have to be added to the DOM yet.\r\nfunction addTab(page) {\r\n\tvar tabs = $(this);\r\n\tvar opt = loadOptions(\"tabs\", tabs);\r\n\topt._addTab.call(page);\r\n}\r\n\r\n// Removes a tab page and header.\r\n//\r\n// indexOrPage: The tab page to remove, either by index or the page.\r\nfunction removeTab(indexOrPage) {\r\n\tvar container = $(this);\r\n\tvar headers = container.children(\"div.\" + tabHeadersClass).first();\r\n\tvar pages = container.find(\"div.\" + tabPagesClass).first();\r\n\tvar index = indexOrPage;\r\n\tif (!$.isNumeric(indexOrPage)) {\r\n\t\tindex = indexOrPage.index();\r\n\t}\r\n\tvar count = pages.children().length;\r\n\tvar header = headers.children().eq(index);\r\n\tvar page = pages.children().eq(index);\r\n\theader.remove();\r\n\tpage.remove();\r\n\tif (page.hasClass(\"active\")) {\r\n\t\t// Activate another tab\r\n\t\tlet newIndex = Math.min(index, count - 2);\r\n\t\tif (newIndex >= 0)\r\n\t\t\tcontainer.tabs.activeTab(newIndex);\r\n\t}\r\n}\r\n\r\n// Gets the title of a tab page in a tab container.\r\n//\r\n// indexOrPage: The tab page, either by index or the page.\r\n// title: Sets the title.\r\nfunction title(indexOrPage, title) {\r\n\tvar container = $(this);\r\n\tvar headers = container.children(\"div.\" + tabHeadersClass).first();\r\n\tvar index = indexOrPage;\r\n\tif (!$.isNumeric(indexOrPage)) {\r\n\t\tindex = indexOrPage.index();\r\n\t}\r\n\tvar header = headers.children().eq(index);\r\n\t\r\n\t// Getter\r\n\tif (title === undefined) {\r\n\t\treturn header.text();\r\n\t}\r\n\t\r\n\t// Setter\r\n\theader.text(title);\r\n}\r\n\r\n// Gets the active page in a tab container.\r\n//\r\n// indexOrPage: Sets the active page in each selected tab container, either by index or the page.\r\nfunction activeTab(indexOrPage) {\r\n\t// Getter\r\n\tif (indexOrPage === undefined) {\r\n\t\treturn this.find(\"div.\" + tabPagesClass + \" > .active\").first();\r\n\t}\r\n\r\n\t// Setter\r\n\treturn this.each(function () {\r\n\t\tvar container = $(this);\r\n\t\tvar headers = container.children(\"div.\" + tabHeadersClass).first();\r\n\t\tvar pages = container.find(\"div.\" + tabPagesClass).first();\r\n\t\tvar index, page;\r\n\t\tif ($.isNumeric(indexOrPage)) {\r\n\t\t\tindex = +indexOrPage;\r\n\t\t\tpage = pages.children().eq(index);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tindex = indexOrPage.index();\r\n\t\t\tpage = indexOrPage;\r\n\t\t}\r\n\r\n\t\tif (page && !page.hasClass(\"active\")) {\r\n\t\t\theaders.children().attr(\"tabindex\", \"-1\");\r\n\t\t\theaders.children(\".active\").removeClass(\"active\");\r\n\t\t\theaders.children().eq(index).addClass(\"active\").removeAttr(\"tabindex\");\r\n\t\t\tpages.children(\".active\").removeClass(\"active\");\r\n\t\t\tpage.addClass(\"active\");\r\n\t\t\tcontainer.trigger(\"activeTabChange\");\r\n\t\t}\r\n\t});\r\n}\r\n\r\n// Gets all page div elements.\r\nfunction pages() {\r\n\tvar container = $(this);\r\n\tvar pages = container.find(\"div.\" + tabPagesClass).first();\r\n\treturn pages.children();\r\n}\r\n\r\n// Moves a tab to another position.\r\nfunction moveTab(indexOrPage, newIndex) {\r\n\tvar container = $(this);\r\n\tvar headers = container.children(\"div.\" + tabHeadersClass).first();\r\n\tvar pages = container.find(\"div.\" + tabPagesClass).first();\r\n\tvar index = indexOrPage;\r\n\tif (!$.isNumeric(indexOrPage)) {\r\n\t\tindex = indexOrPage.index();\r\n\t}\r\n\tvar headersChildren = headers.children();\r\n\tvar pagesChildren = pages.children();\r\n\tvar count = pagesChildren.length;\r\n\tvar header = headersChildren.eq(index);\r\n\tvar page = pagesChildren.eq(index);\r\n\tvar destHeader = headersChildren.eq(newIndex);\r\n\tvar destPage = pagesChildren.eq(newIndex);\r\n\tif (destHeader.length === 0) {\r\n\t\tif (newIndex > 0) {\r\n\t\t\t// Move to end\r\n\t\t\theader.insertAfter(headersChildren.last());\r\n\t\t\tpage.insertAfter(pagesChildren.last());\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Move to beginning\r\n\t\t\theader.insertBefore(headersChildren.first());\r\n\t\t\tpage.insertBefore(pagesChildren.first());\r\n\t\t}\r\n\t}\r\n\telse if (newIndex > index) {\r\n\t\t// Move after newIndex\r\n\t\theader.insertAfter(destHeader);\r\n\t\tpage.insertAfter(destPage);\r\n\t}\r\n\telse if (newIndex < index) {\r\n\t\t// Move before newIndex\r\n\t\theader.insertBefore(destHeader);\r\n\t\tpage.insertBefore(destPage);\r\n\t}\r\n}\r\n\r\nregisterPlugin(\"tabs\", tabs, {\r\n\taddTab: addTab,\r\n\tremoveTab: removeTab,\r\n\ttitle: title,\r\n\tactiveTab: activeTab,\r\n\tpages: pages,\r\n\tmoveTab: moveTab\r\n});\r\n$.fn.tabs.defaults = tabsDefaults;\r\n","﻿// Automatically apply all controls now. Must be loaded at the end of the document.\r\n// Doing it now is faster than waiting for the DOM ready event, and when loaded at the end of the\r\n// document, all relevant DOM parts are already there.\r\n\r\n$.fn.frontfire = function (prefix) {\r\n\tif (prefix === undefined) prefix = \"\";\r\n\tlet t = this;\r\n\r\n\tfunction findInclSelf(selector) {\r\n\t\treturn t.find(selector).addBack(selector);\r\n\t}\r\n\r\n\tfindInclSelf(prefix + \".accordion\").accordion();\r\n\tfindInclSelf(prefix + \".carousel\").carousel();\r\n\t// TODO: dropdown\r\n\tfindInclSelf(prefix + \"input[type=number]\").spinner();\r\n\tfindInclSelf(prefix + \"input[type=color]\").colorPicker();\r\n\t// type=color has serious restrictions on acceptable values, ff-color is a workaround\r\n\tfindInclSelf(prefix + \"input[type=ff-color]\").colorPicker();\r\n\tfindInclSelf(prefix + \"input[type=checkbox], input[type=radio]\").styleCheckbox();\r\n\tfindInclSelf(prefix + \"input[type=checkbox].three-state\").threeState();\r\n\tfindInclSelf(prefix + \"textarea.auto-height\").autoHeight();\r\n\tfindInclSelf(prefix + \".menu\").menu();\r\n\tfindInclSelf(prefix + \".critical.closable, .error.closable, .warning.closable, .information.closable, .success.closable\").closableMessage();\r\n\t// TODO: modal\r\n\tfindInclSelf(prefix + \".progressbar\").progressbar();\r\n\tfindInclSelf(prefix + \".slider\").slider();\r\n\tfindInclSelf(prefix + \".sortable\").sortable();\r\n\tfindInclSelf(prefix + \".tabs\").tabs();\r\n\tfindInclSelf(prefix + \".selectable\").selectable();\r\n\tfindInclSelf(prefix + \"select\").selectable();\r\n\treturn this;\r\n};\r\n\r\n$(document).frontfire(\":not(.no-autostart)\");\r\n"]}